(()=>{var cx=Object.create;var Cd=Object.defineProperty;var hx=Object.getOwnPropertyDescriptor;var ux=Object.getOwnPropertyNames;var px=Object.getPrototypeOf,dx=Object.prototype.hasOwnProperty;var fx=(c,u)=>()=>(u||c((u={exports:{}}).exports,u),u.exports),mx=(c,u)=>{for(var g in u)Cd(c,g,{get:u[g],enumerable:!0})},gx=(c,u,g,v)=>{if(u&&typeof u=="object"||typeof u=="function")for(let C of ux(u))!dx.call(c,C)&&C!==g&&Cd(c,C,{get:()=>u[C],enumerable:!(v=hx(u,C))||v.enumerable});return c};var _x=(c,u,g)=>(g=c!=null?cx(px(c)):{},gx(u||!c||!c.__esModule?Cd(g,"default",{value:c,enumerable:!0}):g,c));var Oy=fx((Bf,Rf)=>{(function(c,u){typeof Bf=="object"&&typeof Rf<"u"?Rf.exports=u():typeof define=="function"&&define.amd?define(u):(c=typeof globalThis<"u"?globalThis:c||self,c.mapboxgl=u())})(Bf,function(){"use strict";var c,u,g;function v(o,z){if(!c)c=z;else if(!u)u=z;else{var B="self.onerror = function() { console.error('An error occurred while parsing the WebWorker bundle. This is most likely due to improper transpilation by Babel; please see https://docs.mapbox.com/mapbox-gl-js/guides/install/#transpiling'); }; var sharedChunk = {}; ("+c+")(sharedChunk); ("+u+")(sharedChunk); self.onerror = null;",H={};c(H),g=z(H),typeof window<"u"&&window&&window.URL&&window.URL.createObjectURL&&(g.workerUrl=window.URL.createObjectURL(new Blob([B],{type:"text/javascript"})))}}v(["exports"],function(o){"use strict";var z=typeof self<"u"?self:{},B=H;function H(i,e,r,n){this.cx=3*i,this.bx=3*(r-i)-this.cx,this.ax=1-this.cx-this.bx,this.cy=3*e,this.by=3*(n-e)-this.cy,this.ay=1-this.cy-this.by,this.p1x=i,this.p1y=n,this.p2x=r,this.p2y=n}H.prototype.sampleCurveX=function(i){return((this.ax*i+this.bx)*i+this.cx)*i},H.prototype.sampleCurveY=function(i){return((this.ay*i+this.by)*i+this.cy)*i},H.prototype.sampleCurveDerivativeX=function(i){return(3*this.ax*i+2*this.bx)*i+this.cx},H.prototype.solveCurveX=function(i,e){var r,n,a,h,d;for(e===void 0&&(e=1e-6),a=i,d=0;d<8;d++){if(h=this.sampleCurveX(a)-i,Math.abs(h)<e)return a;var m=this.sampleCurveDerivativeX(a);if(Math.abs(m)<1e-6)break;a-=h/m}if((a=i)<(r=0))return r;if(a>(n=1))return n;for(;r<n;){if(h=this.sampleCurveX(a),Math.abs(h-i)<e)return a;i>h?r=a:n=a,a=.5*(n-r)+r}return a},H.prototype.solve=function(i,e){return this.sampleCurveY(this.solveCurveX(i,e))};var Y=oe;function oe(i,e){this.x=i,this.y=e}oe.prototype={clone:function(){return new oe(this.x,this.y)},add:function(i){return this.clone()._add(i)},sub:function(i){return this.clone()._sub(i)},multByPoint:function(i){return this.clone()._multByPoint(i)},divByPoint:function(i){return this.clone()._divByPoint(i)},mult:function(i){return this.clone()._mult(i)},div:function(i){return this.clone()._div(i)},rotate:function(i){return this.clone()._rotate(i)},rotateAround:function(i,e){return this.clone()._rotateAround(i,e)},matMult:function(i){return this.clone()._matMult(i)},unit:function(){return this.clone()._unit()},perp:function(){return this.clone()._perp()},round:function(){return this.clone()._round()},mag:function(){return Math.sqrt(this.x*this.x+this.y*this.y)},equals:function(i){return this.x===i.x&&this.y===i.y},dist:function(i){return Math.sqrt(this.distSqr(i))},distSqr:function(i){var e=i.x-this.x,r=i.y-this.y;return e*e+r*r},angle:function(){return Math.atan2(this.y,this.x)},angleTo:function(i){return Math.atan2(this.y-i.y,this.x-i.x)},angleWith:function(i){return this.angleWithSep(i.x,i.y)},angleWithSep:function(i,e){return Math.atan2(this.x*e-this.y*i,this.x*i+this.y*e)},_matMult:function(i){var e=i[2]*this.x+i[3]*this.y;return this.x=i[0]*this.x+i[1]*this.y,this.y=e,this},_add:function(i){return this.x+=i.x,this.y+=i.y,this},_sub:function(i){return this.x-=i.x,this.y-=i.y,this},_mult:function(i){return this.x*=i,this.y*=i,this},_div:function(i){return this.x/=i,this.y/=i,this},_multByPoint:function(i){return this.x*=i.x,this.y*=i.y,this},_divByPoint:function(i){return this.x/=i.x,this.y/=i.y,this},_unit:function(){return this._div(this.mag()),this},_perp:function(){var i=this.y;return this.y=this.x,this.x=-i,this},_rotate:function(i){var e=Math.cos(i),r=Math.sin(i),n=r*this.x+e*this.y;return this.x=e*this.x-r*this.y,this.y=n,this},_rotateAround:function(i,e){var r=Math.cos(i),n=Math.sin(i),a=e.y+n*(this.x-e.x)+r*(this.y-e.y);return this.x=e.x+r*(this.x-e.x)-n*(this.y-e.y),this.y=a,this},_round:function(){return this.x=Math.round(this.x),this.y=Math.round(this.y),this}},oe.convert=function(i){return i instanceof oe?i:Array.isArray(i)?new oe(i[0],i[1]):i};let Ee=Math.PI/180,Ae=180/Math.PI;function Ce(i){return i*Ee}function Ge(i){return i*Ae}let Ke=[[0,0],[1,0],[1,1],[0,1]];function Ye(i){if(i<=0)return 0;if(i>=1)return 1;let e=i*i,r=e*i;return 4*(i<.5?r:3*(i-e)+r-.75)}function ut(i,e,r,n){let a=new B(i,e,r,n);return function(h){return a.solve(h)}}let wt=ut(.25,.1,.25,1);function Je(i,e,r){return Math.min(r,Math.max(e,i))}function Et(i,e,r){return(r=Je((r-i)/(e-i),0,1))*r*(3-2*r)}function It(i,e,r){let n=r-e,a=((i-e)%n+n)%n+e;return a===e?r:a}function Ht(i,e,r){if(!i.length)return r(null,[]);let n=i.length,a=new Array(i.length),h=null;i.forEach((d,m)=>{e(d,(y,x)=>{y&&(h=y),a[m]=x,--n==0&&r(h,a)})})}function li(i){let e=[];for(let r in i)e.push(i[r]);return e}function Bt(i,...e){for(let r of e)for(let n in r)i[n]=r[n];return i}let Ci=1;function ki(){return Ci++}function ar(){return function i(e){return e?(e^Math.random()*(16>>e/4)).toString(16):([1e7]+-[1e3]+-4e3+-8e3+-1e11).replace(/[018]/g,i)}()}function lr(i){return i<=1?1:Math.pow(2,Math.ceil(Math.log(i)/Math.LN2))}function Ji(i){return!!i&&/^[0-9a-f]{8}-[0-9a-f]{4}-[4][0-9a-f]{3}-[89ab][0-9a-f]{3}-[0-9a-f]{12}$/i.test(i)}function vi(i,e){i.forEach(r=>{e[r]&&(e[r]=e[r].bind(e))})}function cr(i,e){return i.indexOf(e,i.length-e.length)!==-1}function Ri(i,e,r){let n={};for(let a in i)n[a]=e.call(r||this,i[a],a,i);return n}function Si(i,e,r){let n={};for(let a in i)e.call(r||this,i[a],a,i)&&(n[a]=i[a]);return n}function hr(i){return Array.isArray(i)?i.map(hr):typeof i=="object"&&i?Ri(i,hr):i}let Go={};function ci(i){Go[i]||(typeof console<"u"&&console.warn(i),Go[i]=!0)}function Fi(i,e,r){return(r.y-i.y)*(e.x-i.x)>(e.y-i.y)*(r.x-i.x)}function Wr(i){let e=0;for(let r,n,a=0,h=i.length,d=h-1;a<h;d=a++)r=i[a],n=i[d],e+=(n.x-r.x)*(r.y+n.y);return e}function Qi(){return typeof WorkerGlobalScope<"u"&&typeof self<"u"&&self instanceof WorkerGlobalScope}function Hr(i){let e={};if(i.replace(/(?:^|(?:\s*\,\s*))([^\x00-\x20\(\)<>@\,;\:\\"\/\[\]\?\=\{\}\x7F]+)(?:\=(?:([^\x00-\x20\(\)<>@\,;\:\\"\/\[\]\?\=\{\}\x7F]+)|(?:\"((?:[^"\\]|\\.)*)\")))?/g,(r,n,a,h)=>{let d=a||h;return e[n]=!d||d.toLowerCase(),""}),e["max-age"]){let r=parseInt(e["max-age"],10);isNaN(r)?delete e["max-age"]:e["max-age"]=r}return e}let Xr=null;function io(i){if(Xr==null){let e=i.navigator?i.navigator.userAgent:null;Xr=!!i.safari||!(!e||!(/\b(iPad|iPhone|iPod)\b/.test(e)||e.match("Safari")&&!e.match("Chrome")))}return Xr}function $o(i){try{let e=z[i];return e.setItem("_mapbox_test_",1),e.removeItem("_mapbox_test_"),!0}catch{return!1}}function Kr(i,e){return[i[4*e],i[4*e+1],i[4*e+2],i[4*e+3]]}let Hs=z.performance;function An(i){let e=i?i.url.toString():void 0;return Hs.getEntriesByName(e)}var Mn="2.9.2";let zt,Yr,In,Br,ur={now:()=>In!==void 0?In:z.performance.now(),setNow(i){In=i},restoreNow(){In=void 0},frame(i){let e=z.requestAnimationFrame(i);return{cancel:()=>z.cancelAnimationFrame(e)}},getImageData(i,e=0){let{width:r,height:n}=i;Br||(Br=z.document.createElement("canvas"));let a=Br.getContext("2d");if(!a)throw new Error("failed to create canvas 2d context");return(r>Br.width||n>Br.height)&&(Br.width=r,Br.height=n),a.clearRect(-e,-e,r+2*e,n+2*e),a.drawImage(i,0,0,r,n),a.getImageData(-e,-e,r+2*e,n+2*e)},resolveURL:i=>(zt||(zt=z.document.createElement("a")),zt.href=i,zt.href),get devicePixelRatio(){return z.devicePixelRatio},get prefersReducedMotion(){return!!z.matchMedia&&(Yr==null&&(Yr=z.matchMedia("(prefers-reduced-motion: reduce)")),Yr.matches)}},ro,At={API_URL:"https://api.mapbox.com",get API_URL_REGEX(){if(ro==null){let i=/^((https?:)?\/\/)?([^\/]+\.)?mapbox\.c(n|om)(\/|\?|$)/i;try{ro=process.env.API_URL_REGEX!=null?new RegExp(process.env.API_URL_REGEX):i}catch{ro=i}}return ro},get EVENTS_URL(){return this.API_URL?this.API_URL.indexOf("https://api.mapbox.cn")===0?"https://events.mapbox.cn/events/v2":this.API_URL.indexOf("https://api.mapbox.com")===0?"https://events.mapbox.com/events/v2":null:null},SESSION_PATH:"/map-sessions/v1",FEEDBACK_URL:"https://apps.mapbox.com/feedback",TILE_URL_VERSION:"v4",RASTER_URL_PREFIX:"raster/v1",REQUIRE_ACCESS_TOKEN:!0,ACCESS_TOKEN:null,MAX_PARALLEL_IMAGE_REQUESTS:16},dn={supported:!1,testSupport:function(i){!zn&&Qr&&(no?qo(i):Jr=i)}},Jr,Qr,zn=!1,no=!1;function qo(i){let e=i.createTexture();i.bindTexture(i.TEXTURE_2D,e);try{if(i.texImage2D(i.TEXTURE_2D,0,i.RGBA,i.RGBA,i.UNSIGNED_BYTE,Qr),i.isContextLost())return;dn.supported=!0}catch{}i.deleteTexture(e),zn=!0}z.document&&(Qr=z.document.createElement("img"),Qr.onload=function(){Jr&&qo(Jr),Jr=null,no=!0},Qr.onerror=function(){zn=!0,Jr=null},Qr.src="data:image/webp;base64,UklGRh4AAABXRUJQVlA4TBEAAAAvAQAAAAfQ//73v/+BiOh/AAA=");let Zo="01",er="NO_ACCESS_TOKEN";function Rr(i){return i.indexOf("mapbox:")===0}function Pn(i){return At.API_URL_REGEX.test(i)}let Xs=/^(\w+):\/\/([^/?]*)(\/[^?]+)?\??(.+)?/;function tr(i){let e=i.match(Xs);if(!e)throw new Error("Unable to parse URL object");return{protocol:e[1],authority:e[2],path:e[3]||"/",params:e[4]?e[4].split("&"):[]}}function en(i){let e=i.params.length?`?${i.params.join("&")}`:"";return`${i.protocol}://${i.authority}${i.path}${e}`}function Ks(i){if(!i)return null;let e=i.split(".");if(!e||e.length!==3)return null;try{return JSON.parse(decodeURIComponent(z.atob(e[1]).split("").map(r=>"%"+("00"+r.charCodeAt(0).toString(16)).slice(-2)).join("")))}catch{return null}}class Wo{constructor(e){this.type=e,this.anonId=null,this.eventData={},this.queue=[],this.pendingRequest=null}getStorageKey(e){let r=Ks(At.ACCESS_TOKEN),n="";return n=r&&r.u?z.btoa(encodeURIComponent(r.u).replace(/%([0-9A-F]{2})/g,(a,h)=>String.fromCharCode(Number("0x"+h)))):At.ACCESS_TOKEN||"",e?`mapbox.eventData.${e}:${n}`:`mapbox.eventData:${n}`}fetchEventData(){let e=$o("localStorage"),r=this.getStorageKey(),n=this.getStorageKey("uuid");if(e)try{let a=z.localStorage.getItem(r);a&&(this.eventData=JSON.parse(a));let h=z.localStorage.getItem(n);h&&(this.anonId=h)}catch{ci("Unable to read from LocalStorage")}}saveEventData(){let e=$o("localStorage"),r=this.getStorageKey(),n=this.getStorageKey("uuid");if(e)try{z.localStorage.setItem(n,this.anonId),Object.keys(this.eventData).length>=1&&z.localStorage.setItem(r,JSON.stringify(this.eventData))}catch{ci("Unable to write to LocalStorage")}}processRequests(e){}postEvent(e,r,n,a){if(!At.EVENTS_URL)return;let h=tr(At.EVENTS_URL);h.params.push(`access_token=${a||At.ACCESS_TOKEN||""}`);let d={event:this.type,created:new Date(e).toISOString(),sdkIdentifier:"mapbox-gl-js",sdkVersion:Mn,skuId:Zo,userId:this.anonId},m=r?Bt(d,r):d,y={url:en(h),headers:{"Content-Type":"text/plain"},body:JSON.stringify([m])};this.pendingRequest=me(y,x=>{this.pendingRequest=null,n(x),this.saveEventData(),this.processRequests(a)})}queueRequest(e,r){this.queue.push(e),this.processRequests(r)}}let Ho=new class extends Wo{constructor(i){super("appUserTurnstile"),this._customAccessToken=i}postTurnstileEvent(i,e){At.EVENTS_URL&&At.ACCESS_TOKEN&&Array.isArray(i)&&i.some(r=>Rr(r)||Pn(r))&&this.queueRequest(Date.now(),e)}processRequests(i){if(this.pendingRequest||this.queue.length===0)return;this.anonId&&this.eventData.lastSuccess&&this.eventData.tokenU||this.fetchEventData();let e=Ks(At.ACCESS_TOKEN),r=e?e.u:At.ACCESS_TOKEN,n=r!==this.eventData.tokenU;Ji(this.anonId)||(this.anonId=ar(),n=!0);let a=this.queue.shift();if(this.eventData.lastSuccess){let h=new Date(this.eventData.lastSuccess),d=new Date(a),m=(a-this.eventData.lastSuccess)/864e5;n=n||m>=1||m<-1||h.getDate()!==d.getDate()}else n=!0;n?this.postEvent(a,{"enabled.telemetry":!1},h=>{h||(this.eventData.lastSuccess=a,this.eventData.tokenU=r)},i):this.processRequests()}},Xo=Ho.postTurnstileEvent.bind(Ho),Ko=new class extends Wo{constructor(){super("map.load"),this.success={},this.skuToken=""}postMapLoadEvent(i,e,r,n){this.skuToken=e,this.errorCb=n,At.EVENTS_URL&&(r||At.ACCESS_TOKEN?this.queueRequest({id:i,timestamp:Date.now()},r):this.errorCb(new Error(er)))}processRequests(i){if(this.pendingRequest||this.queue.length===0)return;let{id:e,timestamp:r}=this.queue.shift();e&&this.success[e]||(this.anonId||this.fetchEventData(),Ji(this.anonId)||(this.anonId=ar()),this.postEvent(r,{skuToken:this.skuToken},n=>{n?this.errorCb(n):e&&(this.success[e]=!0)},i))}},Ys=Ko.postMapLoadEvent.bind(Ko),Js=new class extends Wo{constructor(){super("map.auth"),this.success={},this.skuToken=""}getSession(i,e,r,n){if(!At.API_URL||!At.SESSION_PATH)return;let a=tr(At.API_URL+At.SESSION_PATH);a.params.push(`sku=${e||""}`),a.params.push(`access_token=${n||At.ACCESS_TOKEN||""}`);let h={url:en(a),headers:{"Content-Type":"text/plain"}};this.pendingRequest=ze(h,d=>{this.pendingRequest=null,r(d),this.saveEventData(),this.processRequests(n)})}getSessionAPI(i,e,r,n){this.skuToken=e,this.errorCb=n,At.SESSION_PATH&&At.API_URL&&(r||At.ACCESS_TOKEN?this.queueRequest({id:i,timestamp:Date.now()},r):this.errorCb(new Error(er)))}processRequests(i){if(this.pendingRequest||this.queue.length===0)return;let{id:e,timestamp:r}=this.queue.shift();e&&this.success[e]||this.getSession(r,this.skuToken,n=>{n?this.errorCb(n):e&&(this.success[e]=!0)},i)}},ll=Js.getSessionAPI.bind(Js),fn=new Set,tn,oo=500,Qs=50,$i={};function Yo(i){let e=D(i),r,n;e&&e.forEach(h=>{let d=h.split("=");d[0]==="language"?r=d[1]:d[0]==="worldview"&&(n=d[1])});let a="mapbox-tiles";return r&&(a+=`-${r}`),n&&(a+=`-${n}`),a}function W(i){z.caches&&!$i[i]&&($i[i]=z.caches.open(i))}function D(i){let e=i.indexOf("?");return e>0?i.slice(e+1).split("&"):[]}function R(i){let e=i.indexOf("?");if(e<0)return i;let r=D(i).filter(n=>{let a=n.split("=");return a[0]==="language"||a[0]==="worldview"});return r.length?`${i.slice(0,e)}?${r.join("&")}`:i.slice(0,e)}let Z=1/0,ee={Unknown:"Unknown",Style:"Style",Source:"Source",Tile:"Tile",Glyphs:"Glyphs",SpriteImage:"SpriteImage",SpriteJSON:"SpriteJSON",Image:"Image"};typeof Object.freeze=="function"&&Object.freeze(ee);class le extends Error{constructor(e,r,n){r===401&&Pn(n)&&(e+=": you may have provided an invalid Mapbox access token. See https://www.mapbox.com/api-documentation/#access-tokens-and-token-scopes"),super(e),this.status=r,this.url=n}toString(){return`${this.name}: ${this.message} (${this.status}): ${this.url}`}}let fe=Qi()?()=>self.worker&&self.worker.referrer:()=>(z.location.protocol==="blob:"?z.parent:z).location.href,pe=function(i,e){if(!(/^file:/.test(r=i.url)||/^file:/.test(fe())&&!/^\w+:/.test(r))){if(z.fetch&&z.Request&&z.AbortController&&z.Request.prototype.hasOwnProperty("signal"))return function(n,a){let h=new z.AbortController,d=new z.Request(n.url,{method:n.method||"GET",body:n.body,credentials:n.credentials,headers:n.headers,referrer:fe(),signal:h.signal}),m=!1,y=!1,x=(E=d.url).indexOf("sku=")>0&&Pn(E);var E;n.type==="json"&&d.headers.set("Accept","application/json");let k=(M,P,F)=>{if(y)return;if(M&&M.message!=="SecurityError"&&ci(M),P&&F)return S(P);let G=Date.now();z.fetch(d).then(X=>{if(X.ok){let ne=x?X.clone():null;return S(X,ne,G)}return a(new le(X.statusText,X.status,n.url))}).catch(X=>{X.code!==20&&a(new Error(X.message))})},S=(M,P,F)=>{(n.type==="arrayBuffer"?M.arrayBuffer():n.type==="json"?M.json():M.text()).then(G=>{y||(P&&F&&function(X,ne,re){let se=Yo(X.url);if(W(se),!$i[se])return;let ce={status:ne.status,statusText:ne.statusText,headers:new z.Headers};ne.headers.forEach((we,Se)=>ce.headers.set(Se,we));let ue=Hr(ne.headers.get("Cache-Control")||"");if(ue["no-store"])return;ue["max-age"]&&ce.headers.set("Expires",new Date(re+1e3*ue["max-age"]).toUTCString());let ve=ce.headers.get("Expires");ve&&(new Date(ve).getTime()-re<42e4||function(we,Se){if(tn===void 0)try{new Response(new ReadableStream),tn=!0}catch{tn=!1}tn?Se(we.body):we.blob().then(Se)}(ne,we=>{let Se=new z.Response(we,ce);W(se),$i[se]&&$i[se].then(Le=>Le.put(R(X.url),Se)).catch(Le=>ci(Le.message))}))}(d,P,F),m=!0,a(null,G,M.headers.get("Cache-Control"),M.headers.get("Expires")))}).catch(G=>{y||a(new Error(G.message))})};return x?function(M,P){let F=Yo(M.url);if(W(F),!$i[F])return P(null);let G=R(M.url);$i[F].then(X=>{X.match(G).then(ne=>{let re=function(se){if(!se)return!1;let ce=new Date(se.headers.get("Expires")||0),ue=Hr(se.headers.get("Cache-Control")||"");return ce>Date.now()&&!ue["no-cache"]}(ne);X.delete(G),re&&X.put(G,ne.clone()),P(null,ne,re)}).catch(P)}).catch(P)}(d,k):k(null,null),{cancel:()=>{y=!0,m||h.abort()}}}(i,e);if(Qi()&&self.worker&&self.worker.actor)return self.worker.actor.send("getResource",i,e,void 0,!0)}var r;return function(n,a){let h=new z.XMLHttpRequest;h.open(n.method||"GET",n.url,!0),n.type==="arrayBuffer"&&(h.responseType="arraybuffer");for(let d in n.headers)h.setRequestHeader(d,n.headers[d]);return n.type==="json"&&(h.responseType="text",h.setRequestHeader("Accept","application/json")),h.withCredentials=n.credentials==="include",h.onerror=()=>{a(new Error(h.statusText))},h.onload=()=>{if((h.status>=200&&h.status<300||h.status===0)&&h.response!==null){let d=h.response;if(n.type==="json")try{d=JSON.parse(h.response)}catch(m){return a(m)}a(null,d,h.getResponseHeader("Cache-Control"),h.getResponseHeader("Expires"))}else a(new le(h.statusText,h.status,n.url))},h.send(n.body),{cancel:()=>h.abort()}}(i,e)},he=function(i,e){return pe(Bt(i,{type:"arrayBuffer"}),e)},me=function(i,e){return pe(Bt(i,{method:"POST"}),e)},ze=function(i,e){return pe(Bt(i,{method:"GET"}),e)};function Ze(i){let e=z.document.createElement("a");return e.href=i,e.protocol===z.document.location.protocol&&e.host===z.document.location.host}let De="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAAC0lEQVQYV2NgAAIAAAUAAarVyFEAAAAASUVORK5CYII=",nt,at;nt=[],at=0;let ot=function(i,e){if(dn.supported&&(i.headers||(i.headers={}),i.headers.accept="image/webp,*/*"),at>=At.MAX_PARALLEL_IMAGE_REQUESTS){let h={requestParameters:i,callback:e,cancelled:!1,cancel(){this.cancelled=!0}};return nt.push(h),h}at++;let r=!1,n=()=>{if(!r)for(r=!0,at--;nt.length&&at<At.MAX_PARALLEL_IMAGE_REQUESTS;){let h=nt.shift(),{requestParameters:d,callback:m,cancelled:y}=h;y||(h.cancel=ot(d,m).cancel)}},a=he(i,(h,d,m,y)=>{n(),h?e(h):d&&(z.createImageBitmap?function(x,E){let k=new z.Blob([new Uint8Array(x)],{type:"image/png"});z.createImageBitmap(k).then(S=>{E(null,S)}).catch(S=>{E(new Error(`Could not load image because of ${S.message}. Please make sure to use a supported image type such as PNG or JPEG. Note that SVGs are not supported.`))})}(d,(x,E)=>e(x,E,m,y)):function(x,E){let k=new z.Image,S=z.URL;k.onload=()=>{E(null,k),S.revokeObjectURL(k.src),k.onload=null,z.requestAnimationFrame(()=>{k.src=De})},k.onerror=()=>E(new Error("Could not load image. Please make sure to use a supported image type such as PNG or JPEG. Note that SVGs are not supported."));let M=new z.Blob([new Uint8Array(x)],{type:"image/png"});k.src=x.byteLength?S.createObjectURL(M):De}(d,(x,E)=>e(x,E,m,y)))});return{cancel:()=>{a.cancel(),n()}}};function ct(i,e,r){r[i]&&r[i].indexOf(e)!==-1||(r[i]=r[i]||[],r[i].push(e))}function _t(i,e,r){if(r&&r[i]){let n=r[i].indexOf(e);n!==-1&&r[i].splice(n,1)}}class Rt{constructor(e,r={}){Bt(this,r),this.type=e}}class Yt extends Rt{constructor(e,r={}){super("error",Bt({error:e},r))}}class Vt{on(e,r){return this._listeners=this._listeners||{},ct(e,r,this._listeners),this}off(e,r){return _t(e,r,this._listeners),_t(e,r,this._oneTimeListeners),this}once(e,r){return r?(this._oneTimeListeners=this._oneTimeListeners||{},ct(e,r,this._oneTimeListeners),this):new Promise(n=>this.once(e,n))}fire(e,r){typeof e=="string"&&(e=new Rt(e,r||{}));let n=e.type;if(this.listens(n)){e.target=this;let a=this._listeners&&this._listeners[n]?this._listeners[n].slice():[];for(let m of a)m.call(this,e);let h=this._oneTimeListeners&&this._oneTimeListeners[n]?this._oneTimeListeners[n].slice():[];for(let m of h)_t(n,m,this._oneTimeListeners),m.call(this,e);let d=this._eventedParent;d&&(Bt(e,typeof this._eventedParentData=="function"?this._eventedParentData():this._eventedParentData),d.fire(e))}else e instanceof Yt&&console.error(e.error);return this}listens(e){return!!(this._listeners&&this._listeners[e]&&this._listeners[e].length>0||this._oneTimeListeners&&this._oneTimeListeners[e]&&this._oneTimeListeners[e].length>0||this._eventedParent&&this._eventedParent.listens(e))}setEventedParent(e,r){return this._eventedParent=e,this._eventedParentData=r,this}}var de=JSON.parse('{"$version":8,"$root":{"version":{"required":true,"type":"enum","values":[8]},"name":{"type":"string"},"metadata":{"type":"*"},"center":{"type":"array","value":"number"},"zoom":{"type":"number"},"bearing":{"type":"number","default":0,"period":360,"units":"degrees"},"pitch":{"type":"number","default":0,"units":"degrees"},"light":{"type":"light"},"terrain":{"type":"terrain"},"fog":{"type":"fog"},"sources":{"required":true,"type":"sources"},"sprite":{"type":"string"},"glyphs":{"type":"string"},"transition":{"type":"transition"},"projection":{"type":"projection"},"layers":{"required":true,"type":"array","value":"layer"}},"sources":{"*":{"type":"source"}},"source":["source_vector","source_raster","source_raster_dem","source_geojson","source_video","source_image"],"source_vector":{"type":{"required":true,"type":"enum","values":{"vector":{}}},"url":{"type":"string"},"tiles":{"type":"array","value":"string"},"bounds":{"type":"array","value":"number","length":4,"default":[-180,-85.051129,180,85.051129]},"scheme":{"type":"enum","values":{"xyz":{},"tms":{}},"default":"xyz"},"minzoom":{"type":"number","default":0},"maxzoom":{"type":"number","default":22},"attribution":{"type":"string"},"promoteId":{"type":"promoteId"},"volatile":{"type":"boolean","default":false},"*":{"type":"*"}},"source_raster":{"type":{"required":true,"type":"enum","values":{"raster":{}}},"url":{"type":"string"},"tiles":{"type":"array","value":"string"},"bounds":{"type":"array","value":"number","length":4,"default":[-180,-85.051129,180,85.051129]},"minzoom":{"type":"number","default":0},"maxzoom":{"type":"number","default":22},"tileSize":{"type":"number","default":512,"units":"pixels"},"scheme":{"type":"enum","values":{"xyz":{},"tms":{}},"default":"xyz"},"attribution":{"type":"string"},"volatile":{"type":"boolean","default":false},"*":{"type":"*"}},"source_raster_dem":{"type":{"required":true,"type":"enum","values":{"raster-dem":{}}},"url":{"type":"string"},"tiles":{"type":"array","value":"string"},"bounds":{"type":"array","value":"number","length":4,"default":[-180,-85.051129,180,85.051129]},"minzoom":{"type":"number","default":0},"maxzoom":{"type":"number","default":22},"tileSize":{"type":"number","default":512,"units":"pixels"},"attribution":{"type":"string"},"encoding":{"type":"enum","values":{"terrarium":{},"mapbox":{}},"default":"mapbox"},"volatile":{"type":"boolean","default":false},"*":{"type":"*"}},"source_geojson":{"type":{"required":true,"type":"enum","values":{"geojson":{}}},"data":{"type":"*"},"maxzoom":{"type":"number","default":18},"attribution":{"type":"string"},"buffer":{"type":"number","default":128,"maximum":512,"minimum":0},"filter":{"type":"*"},"tolerance":{"type":"number","default":0.375},"cluster":{"type":"boolean","default":false},"clusterRadius":{"type":"number","default":50,"minimum":0},"clusterMaxZoom":{"type":"number"},"clusterMinPoints":{"type":"number"},"clusterProperties":{"type":"*"},"lineMetrics":{"type":"boolean","default":false},"generateId":{"type":"boolean","default":false},"promoteId":{"type":"promoteId"}},"source_video":{"type":{"required":true,"type":"enum","values":{"video":{}}},"urls":{"required":true,"type":"array","value":"string"},"coordinates":{"required":true,"type":"array","length":4,"value":{"type":"array","length":2,"value":"number"}}},"source_image":{"type":{"required":true,"type":"enum","values":{"image":{}}},"url":{"required":true,"type":"string"},"coordinates":{"required":true,"type":"array","length":4,"value":{"type":"array","length":2,"value":"number"}}},"layer":{"id":{"type":"string","required":true},"type":{"type":"enum","values":{"fill":{},"line":{},"symbol":{},"circle":{},"heatmap":{},"fill-extrusion":{},"raster":{},"hillshade":{},"background":{},"sky":{}},"required":true},"metadata":{"type":"*"},"source":{"type":"string"},"source-layer":{"type":"string"},"minzoom":{"type":"number","minimum":0,"maximum":24},"maxzoom":{"type":"number","minimum":0,"maximum":24},"filter":{"type":"filter"},"layout":{"type":"layout"},"paint":{"type":"paint"}},"layout":["layout_fill","layout_line","layout_circle","layout_heatmap","layout_fill-extrusion","layout_symbol","layout_raster","layout_hillshade","layout_background","layout_sky"],"layout_background":{"visibility":{"type":"enum","values":{"visible":{},"none":{}},"default":"visible","property-type":"constant"}},"layout_sky":{"visibility":{"type":"enum","values":{"visible":{},"none":{}},"default":"visible","property-type":"constant"}},"layout_fill":{"fill-sort-key":{"type":"number","expression":{"interpolated":false,"parameters":["zoom","feature"]},"property-type":"data-driven"},"visibility":{"type":"enum","values":{"visible":{},"none":{}},"default":"visible","property-type":"constant"}},"layout_circle":{"circle-sort-key":{"type":"number","expression":{"interpolated":false,"parameters":["zoom","feature"]},"property-type":"data-driven"},"visibility":{"type":"enum","values":{"visible":{},"none":{}},"default":"visible","property-type":"constant"}},"layout_heatmap":{"visibility":{"type":"enum","values":{"visible":{},"none":{}},"default":"visible","property-type":"constant"}},"layout_fill-extrusion":{"visibility":{"type":"enum","values":{"visible":{},"none":{}},"default":"visible","property-type":"constant"}},"layout_line":{"line-cap":{"type":"enum","values":{"butt":{},"round":{},"square":{}},"default":"butt","expression":{"interpolated":false,"parameters":["zoom","feature"]},"property-type":"data-driven"},"line-join":{"type":"enum","values":{"bevel":{},"round":{},"miter":{}},"default":"miter","expression":{"interpolated":false,"parameters":["zoom","feature"]},"property-type":"data-driven"},"line-miter-limit":{"type":"number","default":2,"requires":[{"line-join":"miter"}],"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"line-round-limit":{"type":"number","default":1.05,"requires":[{"line-join":"round"}],"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"line-sort-key":{"type":"number","expression":{"interpolated":false,"parameters":["zoom","feature"]},"property-type":"data-driven"},"visibility":{"type":"enum","values":{"visible":{},"none":{}},"default":"visible","property-type":"constant"}},"layout_symbol":{"symbol-placement":{"type":"enum","values":{"point":{},"line":{},"line-center":{}},"default":"point","expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"symbol-spacing":{"type":"number","default":250,"minimum":1,"units":"pixels","requires":[{"symbol-placement":"line"}],"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"symbol-avoid-edges":{"type":"boolean","default":false,"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"symbol-sort-key":{"type":"number","expression":{"interpolated":false,"parameters":["zoom","feature"]},"property-type":"data-driven"},"symbol-z-order":{"type":"enum","values":{"auto":{},"viewport-y":{},"source":{}},"default":"auto","expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"icon-allow-overlap":{"type":"boolean","default":false,"requires":["icon-image"],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"icon-ignore-placement":{"type":"boolean","default":false,"requires":["icon-image"],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"icon-optional":{"type":"boolean","default":false,"requires":["icon-image","text-field"],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"icon-rotation-alignment":{"type":"enum","values":{"map":{},"viewport":{},"auto":{}},"default":"auto","requires":["icon-image"],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"icon-size":{"type":"number","default":1,"minimum":0,"units":"factor of the original icon size","requires":["icon-image"],"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"icon-text-fit":{"type":"enum","values":{"none":{},"width":{},"height":{},"both":{}},"default":"none","requires":["icon-image","text-field"],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"icon-text-fit-padding":{"type":"array","value":"number","length":4,"default":[0,0,0,0],"units":"pixels","requires":["icon-image","text-field",{"icon-text-fit":["both","width","height"]}],"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"icon-image":{"type":"resolvedImage","tokens":true,"expression":{"interpolated":false,"parameters":["zoom","feature"]},"property-type":"data-driven"},"icon-rotate":{"type":"number","default":0,"period":360,"units":"degrees","requires":["icon-image"],"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"icon-padding":{"type":"number","default":2,"minimum":0,"units":"pixels","requires":["icon-image"],"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"icon-keep-upright":{"type":"boolean","default":false,"requires":["icon-image",{"icon-rotation-alignment":"map"},{"symbol-placement":["line","line-center"]}],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"icon-offset":{"type":"array","value":"number","length":2,"default":[0,0],"requires":["icon-image"],"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"icon-anchor":{"type":"enum","values":{"center":{},"left":{},"right":{},"top":{},"bottom":{},"top-left":{},"top-right":{},"bottom-left":{},"bottom-right":{}},"default":"center","requires":["icon-image"],"expression":{"interpolated":false,"parameters":["zoom","feature"]},"property-type":"data-driven"},"icon-pitch-alignment":{"type":"enum","values":{"map":{},"viewport":{},"auto":{}},"default":"auto","requires":["icon-image"],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"text-pitch-alignment":{"type":"enum","values":{"map":{},"viewport":{},"auto":{}},"default":"auto","requires":["text-field"],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"text-rotation-alignment":{"type":"enum","values":{"map":{},"viewport":{},"auto":{}},"default":"auto","requires":["text-field"],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"text-field":{"type":"formatted","default":"","tokens":true,"expression":{"interpolated":false,"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-font":{"type":"array","value":"string","default":["Open Sans Regular","Arial Unicode MS Regular"],"requires":["text-field"],"expression":{"interpolated":false,"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-size":{"type":"number","default":16,"minimum":0,"units":"pixels","requires":["text-field"],"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-max-width":{"type":"number","default":10,"minimum":0,"units":"ems","requires":["text-field",{"symbol-placement":["point"]}],"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-line-height":{"type":"number","default":1.2,"units":"ems","requires":["text-field"],"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-letter-spacing":{"type":"number","default":0,"units":"ems","requires":["text-field"],"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-justify":{"type":"enum","values":{"auto":{},"left":{},"center":{},"right":{}},"default":"center","requires":["text-field"],"expression":{"interpolated":false,"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-radial-offset":{"type":"number","units":"ems","default":0,"requires":["text-field"],"property-type":"data-driven","expression":{"interpolated":true,"parameters":["zoom","feature"]}},"text-variable-anchor":{"type":"array","value":"enum","values":{"center":{},"left":{},"right":{},"top":{},"bottom":{},"top-left":{},"top-right":{},"bottom-left":{},"bottom-right":{}},"requires":["text-field",{"symbol-placement":["point"]}],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"text-anchor":{"type":"enum","values":{"center":{},"left":{},"right":{},"top":{},"bottom":{},"top-left":{},"top-right":{},"bottom-left":{},"bottom-right":{}},"default":"center","requires":["text-field",{"!":"text-variable-anchor"}],"expression":{"interpolated":false,"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-max-angle":{"type":"number","default":45,"units":"degrees","requires":["text-field",{"symbol-placement":["line","line-center"]}],"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"text-writing-mode":{"type":"array","value":"enum","values":{"horizontal":{},"vertical":{}},"requires":["text-field"],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"text-rotate":{"type":"number","default":0,"period":360,"units":"degrees","requires":["text-field"],"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-padding":{"type":"number","default":2,"minimum":0,"units":"pixels","requires":["text-field"],"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"text-keep-upright":{"type":"boolean","default":true,"requires":["text-field",{"text-rotation-alignment":"map"},{"symbol-placement":["line","line-center"]}],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"text-transform":{"type":"enum","values":{"none":{},"uppercase":{},"lowercase":{}},"default":"none","requires":["text-field"],"expression":{"interpolated":false,"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-offset":{"type":"array","value":"number","units":"ems","length":2,"default":[0,0],"requires":["text-field",{"!":"text-radial-offset"}],"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-allow-overlap":{"type":"boolean","default":false,"requires":["text-field"],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"text-ignore-placement":{"type":"boolean","default":false,"requires":["text-field"],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"text-optional":{"type":"boolean","default":false,"requires":["text-field","icon-image"],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"visibility":{"type":"enum","values":{"visible":{},"none":{}},"default":"visible","property-type":"constant"}},"layout_raster":{"visibility":{"type":"enum","values":{"visible":{},"none":{}},"default":"visible","property-type":"constant"}},"layout_hillshade":{"visibility":{"type":"enum","values":{"visible":{},"none":{}},"default":"visible","property-type":"constant"}},"filter":{"type":"array","value":"*"},"filter_symbol":{"type":"boolean","default":false,"transition":false,"property-type":"data-driven","expression":{"interpolated":false,"parameters":["zoom","feature","pitch","distance-from-center"]}},"filter_fill":{"type":"boolean","default":false,"transition":false,"property-type":"data-driven","expression":{"interpolated":false,"parameters":["zoom","feature"]}},"filter_line":{"type":"boolean","default":false,"transition":false,"property-type":"data-driven","expression":{"interpolated":false,"parameters":["zoom","feature"]}},"filter_circle":{"type":"boolean","default":false,"transition":false,"property-type":"data-driven","expression":{"interpolated":false,"parameters":["zoom","feature"]}},"filter_fill-extrusion":{"type":"boolean","default":false,"transition":false,"property-type":"data-driven","expression":{"interpolated":false,"parameters":["zoom","feature"]}},"filter_heatmap":{"type":"boolean","default":false,"transition":false,"property-type":"data-driven","expression":{"interpolated":false,"parameters":["zoom","feature"]}},"filter_operator":{"type":"enum","values":{"==":{},"!=":{},">":{},">=":{},"<":{},"<=":{},"in":{},"!in":{},"all":{},"any":{},"none":{},"has":{},"!has":{},"within":{}}},"geometry_type":{"type":"enum","values":{"Point":{},"LineString":{},"Polygon":{}}},"function":{"expression":{"type":"expression"},"stops":{"type":"array","value":"function_stop"},"base":{"type":"number","default":1,"minimum":0},"property":{"type":"string","default":"$zoom"},"type":{"type":"enum","values":{"identity":{},"exponential":{},"interval":{},"categorical":{}},"default":"exponential"},"colorSpace":{"type":"enum","values":{"rgb":{},"lab":{},"hcl":{}},"default":"rgb"},"default":{"type":"*","required":false}},"function_stop":{"type":"array","minimum":0,"maximum":24,"value":["number","color"],"length":2},"expression":{"type":"array","value":"*","minimum":1},"fog":{"range":{"type":"array","default":[0.5,10],"minimum":-20,"maximum":20,"length":2,"value":"number","property-type":"data-constant","transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"color":{"type":"color","property-type":"data-constant","default":"#ffffff","expression":{"interpolated":true,"parameters":["zoom"]},"transition":true},"high-color":{"type":"color","property-type":"data-constant","default":"#245cdf","expression":{"interpolated":true,"parameters":["zoom"]},"transition":true},"space-color":{"type":"color","property-type":"data-constant","default":["interpolate",["linear"],["zoom"],4,"#010b19",7,"#367ab9"],"expression":{"interpolated":true,"parameters":["zoom"]},"transition":true},"horizon-blend":{"type":"number","property-type":"data-constant","default":["interpolate",["linear"],["zoom"],4,0.2,7,0.1],"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom"]},"transition":true},"star-intensity":{"type":"number","property-type":"data-constant","default":["interpolate",["linear"],["zoom"],5,0.35,6,0],"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom"]},"transition":true}},"light":{"anchor":{"type":"enum","default":"viewport","values":{"map":{},"viewport":{}},"property-type":"data-constant","transition":false,"expression":{"interpolated":false,"parameters":["zoom"]}},"position":{"type":"array","default":[1.15,210,30],"length":3,"value":"number","property-type":"data-constant","transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"color":{"type":"color","property-type":"data-constant","default":"#ffffff","expression":{"interpolated":true,"parameters":["zoom"]},"transition":true},"intensity":{"type":"number","property-type":"data-constant","default":0.5,"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom"]},"transition":true}},"projection":{"name":{"type":"enum","values":{"albers":{},"equalEarth":{},"equirectangular":{},"lambertConformalConic":{},"mercator":{},"naturalEarth":{},"winkelTripel":{},"globe":{}},"default":"mercator","required":true},"center":{"type":"array","length":2,"value":"number","property-type":"data-constant","minimum":[-180,-90],"maximum":[180,90],"transition":false,"requires":[{"name":["albers","lambertConformalConic"]}]},"parallels":{"type":"array","length":2,"value":"number","property-type":"data-constant","minimum":[-90,-90],"maximum":[90,90],"transition":false,"requires":[{"name":["albers","lambertConformalConic"]}]}},"terrain":{"source":{"type":"string","required":true},"exaggeration":{"type":"number","property-type":"data-constant","default":1,"minimum":0,"maximum":1000,"expression":{"interpolated":true,"parameters":["zoom"]},"transition":true,"requires":["source"]}},"paint":["paint_fill","paint_line","paint_circle","paint_heatmap","paint_fill-extrusion","paint_symbol","paint_raster","paint_hillshade","paint_background","paint_sky"],"paint_fill":{"fill-antialias":{"type":"boolean","default":true,"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"fill-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-color":{"type":"color","default":"#000000","transition":true,"requires":[{"!":"fill-pattern"}],"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-outline-color":{"type":"color","transition":true,"requires":[{"!":"fill-pattern"},{"fill-antialias":true}],"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-translate":{"type":"array","value":"number","length":2,"default":[0,0],"transition":true,"units":"pixels","expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"fill-translate-anchor":{"type":"enum","values":{"map":{},"viewport":{}},"default":"map","requires":["fill-translate"],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"fill-pattern":{"type":"resolvedImage","transition":true,"expression":{"interpolated":false,"parameters":["zoom","feature"]},"property-type":"cross-faded-data-driven"}},"paint_fill-extrusion":{"fill-extrusion-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"fill-extrusion-color":{"type":"color","default":"#000000","transition":true,"requires":[{"!":"fill-extrusion-pattern"}],"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-extrusion-translate":{"type":"array","value":"number","length":2,"default":[0,0],"transition":true,"units":"pixels","expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"fill-extrusion-translate-anchor":{"type":"enum","values":{"map":{},"viewport":{}},"default":"map","requires":["fill-extrusion-translate"],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"fill-extrusion-pattern":{"type":"resolvedImage","transition":true,"expression":{"interpolated":false,"parameters":["zoom","feature"]},"property-type":"cross-faded-data-driven"},"fill-extrusion-height":{"type":"number","default":0,"minimum":0,"units":"meters","transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-extrusion-base":{"type":"number","default":0,"minimum":0,"units":"meters","transition":true,"requires":["fill-extrusion-height"],"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-extrusion-vertical-gradient":{"type":"boolean","default":true,"transition":false,"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"}},"paint_line":{"line-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-color":{"type":"color","default":"#000000","transition":true,"requires":[{"!":"line-pattern"}],"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-translate":{"type":"array","value":"number","length":2,"default":[0,0],"transition":true,"units":"pixels","expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"line-translate-anchor":{"type":"enum","values":{"map":{},"viewport":{}},"default":"map","requires":["line-translate"],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"line-width":{"type":"number","default":1,"minimum":0,"transition":true,"units":"pixels","expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-gap-width":{"type":"number","default":0,"minimum":0,"transition":true,"units":"pixels","expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-offset":{"type":"number","default":0,"transition":true,"units":"pixels","expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-blur":{"type":"number","default":0,"minimum":0,"transition":true,"units":"pixels","expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-dasharray":{"type":"array","value":"number","minimum":0,"transition":true,"units":"line widths","requires":[{"!":"line-pattern"}],"expression":{"interpolated":false,"parameters":["zoom","feature"]},"property-type":"cross-faded-data-driven"},"line-pattern":{"type":"resolvedImage","transition":true,"expression":{"interpolated":false,"parameters":["zoom","feature"]},"property-type":"cross-faded-data-driven"},"line-gradient":{"type":"color","transition":false,"requires":[{"!":"line-pattern"},{"source":"geojson","has":{"lineMetrics":true}}],"expression":{"interpolated":true,"parameters":["line-progress"]},"property-type":"color-ramp"},"line-trim-offset":{"type":"array","value":"number","length":2,"default":[0,0],"minimum":[0,0],"maximum":[1,1],"transition":false,"requires":[{"source":"geojson","has":{"lineMetrics":true}}],"property-type":"constant"}},"paint_circle":{"circle-radius":{"type":"number","default":5,"minimum":0,"transition":true,"units":"pixels","expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-color":{"type":"color","default":"#000000","transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-blur":{"type":"number","default":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-translate":{"type":"array","value":"number","length":2,"default":[0,0],"transition":true,"units":"pixels","expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"circle-translate-anchor":{"type":"enum","values":{"map":{},"viewport":{}},"default":"map","requires":["circle-translate"],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"circle-pitch-scale":{"type":"enum","values":{"map":{},"viewport":{}},"default":"map","expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"circle-pitch-alignment":{"type":"enum","values":{"map":{},"viewport":{}},"default":"viewport","expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"circle-stroke-width":{"type":"number","default":0,"minimum":0,"transition":true,"units":"pixels","expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-stroke-color":{"type":"color","default":"#000000","transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-stroke-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"}},"paint_heatmap":{"heatmap-radius":{"type":"number","default":30,"minimum":1,"transition":true,"units":"pixels","expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"heatmap-weight":{"type":"number","default":1,"minimum":0,"transition":false,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"heatmap-intensity":{"type":"number","default":1,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"heatmap-color":{"type":"color","default":["interpolate",["linear"],["heatmap-density"],0,"rgba(0, 0, 255, 0)",0.1,"royalblue",0.3,"cyan",0.5,"lime",0.7,"yellow",1,"red"],"transition":false,"expression":{"interpolated":true,"parameters":["heatmap-density"]},"property-type":"color-ramp"},"heatmap-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"}},"paint_symbol":{"icon-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"requires":["icon-image"],"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"icon-color":{"type":"color","default":"#000000","transition":true,"requires":["icon-image"],"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"icon-halo-color":{"type":"color","default":"rgba(0, 0, 0, 0)","transition":true,"requires":["icon-image"],"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"icon-halo-width":{"type":"number","default":0,"minimum":0,"transition":true,"units":"pixels","requires":["icon-image"],"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"icon-halo-blur":{"type":"number","default":0,"minimum":0,"transition":true,"units":"pixels","requires":["icon-image"],"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"icon-translate":{"type":"array","value":"number","length":2,"default":[0,0],"transition":true,"units":"pixels","requires":["icon-image"],"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"icon-translate-anchor":{"type":"enum","values":{"map":{},"viewport":{}},"default":"map","requires":["icon-image","icon-translate"],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"text-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"requires":["text-field"],"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"text-color":{"type":"color","default":"#000000","transition":true,"overridable":true,"requires":["text-field"],"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"text-halo-color":{"type":"color","default":"rgba(0, 0, 0, 0)","transition":true,"requires":["text-field"],"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"text-halo-width":{"type":"number","default":0,"minimum":0,"transition":true,"units":"pixels","requires":["text-field"],"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"text-halo-blur":{"type":"number","default":0,"minimum":0,"transition":true,"units":"pixels","requires":["text-field"],"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"text-translate":{"type":"array","value":"number","length":2,"default":[0,0],"transition":true,"units":"pixels","requires":["text-field"],"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"text-translate-anchor":{"type":"enum","values":{"map":{},"viewport":{}},"default":"map","requires":["text-field","text-translate"],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"}},"paint_raster":{"raster-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"raster-hue-rotate":{"type":"number","default":0,"period":360,"transition":true,"units":"degrees","expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"raster-brightness-min":{"type":"number","default":0,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"raster-brightness-max":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"raster-saturation":{"type":"number","default":0,"minimum":-1,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"raster-contrast":{"type":"number","default":0,"minimum":-1,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"raster-resampling":{"type":"enum","values":{"linear":{},"nearest":{}},"default":"linear","expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"raster-fade-duration":{"type":"number","default":300,"minimum":0,"transition":false,"units":"milliseconds","expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"}},"paint_hillshade":{"hillshade-illumination-direction":{"type":"number","default":335,"minimum":0,"maximum":359,"transition":false,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"hillshade-illumination-anchor":{"type":"enum","values":{"map":{},"viewport":{}},"default":"viewport","expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"hillshade-exaggeration":{"type":"number","default":0.5,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"hillshade-shadow-color":{"type":"color","default":"#000000","transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"hillshade-highlight-color":{"type":"color","default":"#FFFFFF","transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"hillshade-accent-color":{"type":"color","default":"#000000","transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"}},"paint_background":{"background-color":{"type":"color","default":"#000000","transition":true,"requires":[{"!":"background-pattern"}],"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"background-pattern":{"type":"resolvedImage","transition":true,"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"cross-faded"},"background-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"}},"paint_sky":{"sky-type":{"type":"enum","values":{"gradient":{},"atmosphere":{}},"default":"atmosphere","expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"sky-atmosphere-sun":{"type":"array","value":"number","length":2,"units":"degrees","minimum":[0,0],"maximum":[360,180],"transition":false,"requires":[{"sky-type":"atmosphere"}],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"sky-atmosphere-sun-intensity":{"type":"number","requires":[{"sky-type":"atmosphere"}],"default":10,"minimum":0,"maximum":100,"transition":false,"property-type":"data-constant"},"sky-gradient-center":{"type":"array","requires":[{"sky-type":"gradient"}],"value":"number","default":[0,0],"length":2,"units":"degrees","minimum":[0,0],"maximum":[360,180],"transition":false,"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"sky-gradient-radius":{"type":"number","requires":[{"sky-type":"gradient"}],"default":90,"minimum":0,"maximum":180,"transition":false,"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"sky-gradient":{"type":"color","default":["interpolate",["linear"],["sky-radial-progress"],0.8,"#87ceeb",1,"white"],"transition":false,"requires":[{"sky-type":"gradient"}],"expression":{"interpolated":true,"parameters":["sky-radial-progress"]},"property-type":"color-ramp"},"sky-atmosphere-halo-color":{"type":"color","default":"white","transition":false,"requires":[{"sky-type":"atmosphere"}],"property-type":"data-constant"},"sky-atmosphere-color":{"type":"color","default":"white","transition":false,"requires":[{"sky-type":"atmosphere"}],"property-type":"data-constant"},"sky-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"}},"transition":{"duration":{"type":"number","default":300,"minimum":0,"units":"milliseconds"},"delay":{"type":"number","default":0,"minimum":0,"units":"milliseconds"}},"property-type":{"data-driven":{"type":"property-type"},"cross-faded":{"type":"property-type"},"cross-faded-data-driven":{"type":"property-type"},"color-ramp":{"type":"property-type"},"data-constant":{"type":"property-type"},"constant":{"type":"property-type"}},"promoteId":{"*":{"type":"string"}}}');function ir(i,...e){for(let r of e)for(let n in r)i[n]=r[n];return i}function ii(i){return i instanceof Number||i instanceof String||i instanceof Boolean?i.valueOf():i}function pr(i){if(Array.isArray(i))return i.map(pr);if(i instanceof Object&&!(i instanceof Number||i instanceof String||i instanceof Boolean)){let e={};for(let r in i)e[r]=pr(i[r]);return e}return ii(i)}class ip extends Error{constructor(e,r){super(r),this.message=r,this.key=e}}var rr=ip;class ea{constructor(e,r=[]){this.parent=e,this.bindings={};for(let[n,a]of r)this.bindings[n]=a}concat(e){return new ea(this,e)}get(e){if(this.bindings[e])return this.bindings[e];if(this.parent)return this.parent.get(e);throw new Error(`${e} not found in scope.`)}has(e){return!!this.bindings[e]||!!this.parent&&this.parent.has(e)}}var Gc=ea;let Jo={kind:"null"},$e={kind:"number"},Tt={kind:"string"},yt={kind:"boolean"},kr={kind:"color"},Dn={kind:"object"},ft={kind:"value"},rn={kind:"collator"},so={kind:"formatted"},Qo={kind:"resolvedImage"};function dr(i,e){return{kind:"array",itemType:i,N:e}}function ri(i){if(i.kind==="array"){let e=ri(i.itemType);return typeof i.N=="number"?`array<${e}, ${i.N}>`:i.itemType.kind==="value"?"array":`array<${e}>`}return i.kind}let $c=[Jo,$e,Tt,yt,kr,so,Dn,dr(ft),Qo];function ao(i,e){if(e.kind==="error")return null;if(i.kind==="array"){if(e.kind==="array"&&(e.N===0&&e.itemType.kind==="value"||!ao(i.itemType,e.itemType))&&(typeof i.N!="number"||i.N===e.N))return null}else{if(i.kind===e.kind)return null;if(i.kind==="value"){for(let r of $c)if(!ao(r,e))return null}}return`Expected ${ri(i)} but found ${ri(e)} instead.`}function ta(i,e){return e.some(r=>r.kind===i.kind)}function lo(i,e){return e.some(r=>r==="null"?i===null:r==="array"?Array.isArray(i):r==="object"?i&&!Array.isArray(i)&&typeof i=="object":r===typeof i)}function co(i){var e={exports:{}};return i(e,e.exports),e.exports}var qc=co(function(i,e){var r={transparent:[0,0,0,0],aliceblue:[240,248,255,1],antiquewhite:[250,235,215,1],aqua:[0,255,255,1],aquamarine:[127,255,212,1],azure:[240,255,255,1],beige:[245,245,220,1],bisque:[255,228,196,1],black:[0,0,0,1],blanchedalmond:[255,235,205,1],blue:[0,0,255,1],blueviolet:[138,43,226,1],brown:[165,42,42,1],burlywood:[222,184,135,1],cadetblue:[95,158,160,1],chartreuse:[127,255,0,1],chocolate:[210,105,30,1],coral:[255,127,80,1],cornflowerblue:[100,149,237,1],cornsilk:[255,248,220,1],crimson:[220,20,60,1],cyan:[0,255,255,1],darkblue:[0,0,139,1],darkcyan:[0,139,139,1],darkgoldenrod:[184,134,11,1],darkgray:[169,169,169,1],darkgreen:[0,100,0,1],darkgrey:[169,169,169,1],darkkhaki:[189,183,107,1],darkmagenta:[139,0,139,1],darkolivegreen:[85,107,47,1],darkorange:[255,140,0,1],darkorchid:[153,50,204,1],darkred:[139,0,0,1],darksalmon:[233,150,122,1],darkseagreen:[143,188,143,1],darkslateblue:[72,61,139,1],darkslategray:[47,79,79,1],darkslategrey:[47,79,79,1],darkturquoise:[0,206,209,1],darkviolet:[148,0,211,1],deeppink:[255,20,147,1],deepskyblue:[0,191,255,1],dimgray:[105,105,105,1],dimgrey:[105,105,105,1],dodgerblue:[30,144,255,1],firebrick:[178,34,34,1],floralwhite:[255,250,240,1],forestgreen:[34,139,34,1],fuchsia:[255,0,255,1],gainsboro:[220,220,220,1],ghostwhite:[248,248,255,1],gold:[255,215,0,1],goldenrod:[218,165,32,1],gray:[128,128,128,1],green:[0,128,0,1],greenyellow:[173,255,47,1],grey:[128,128,128,1],honeydew:[240,255,240,1],hotpink:[255,105,180,1],indianred:[205,92,92,1],indigo:[75,0,130,1],ivory:[255,255,240,1],khaki:[240,230,140,1],lavender:[230,230,250,1],lavenderblush:[255,240,245,1],lawngreen:[124,252,0,1],lemonchiffon:[255,250,205,1],lightblue:[173,216,230,1],lightcoral:[240,128,128,1],lightcyan:[224,255,255,1],lightgoldenrodyellow:[250,250,210,1],lightgray:[211,211,211,1],lightgreen:[144,238,144,1],lightgrey:[211,211,211,1],lightpink:[255,182,193,1],lightsalmon:[255,160,122,1],lightseagreen:[32,178,170,1],lightskyblue:[135,206,250,1],lightslategray:[119,136,153,1],lightslategrey:[119,136,153,1],lightsteelblue:[176,196,222,1],lightyellow:[255,255,224,1],lime:[0,255,0,1],limegreen:[50,205,50,1],linen:[250,240,230,1],magenta:[255,0,255,1],maroon:[128,0,0,1],mediumaquamarine:[102,205,170,1],mediumblue:[0,0,205,1],mediumorchid:[186,85,211,1],mediumpurple:[147,112,219,1],mediumseagreen:[60,179,113,1],mediumslateblue:[123,104,238,1],mediumspringgreen:[0,250,154,1],mediumturquoise:[72,209,204,1],mediumvioletred:[199,21,133,1],midnightblue:[25,25,112,1],mintcream:[245,255,250,1],mistyrose:[255,228,225,1],moccasin:[255,228,181,1],navajowhite:[255,222,173,1],navy:[0,0,128,1],oldlace:[253,245,230,1],olive:[128,128,0,1],olivedrab:[107,142,35,1],orange:[255,165,0,1],orangered:[255,69,0,1],orchid:[218,112,214,1],palegoldenrod:[238,232,170,1],palegreen:[152,251,152,1],paleturquoise:[175,238,238,1],palevioletred:[219,112,147,1],papayawhip:[255,239,213,1],peachpuff:[255,218,185,1],peru:[205,133,63,1],pink:[255,192,203,1],plum:[221,160,221,1],powderblue:[176,224,230,1],purple:[128,0,128,1],rebeccapurple:[102,51,153,1],red:[255,0,0,1],rosybrown:[188,143,143,1],royalblue:[65,105,225,1],saddlebrown:[139,69,19,1],salmon:[250,128,114,1],sandybrown:[244,164,96,1],seagreen:[46,139,87,1],seashell:[255,245,238,1],sienna:[160,82,45,1],silver:[192,192,192,1],skyblue:[135,206,235,1],slateblue:[106,90,205,1],slategray:[112,128,144,1],slategrey:[112,128,144,1],snow:[255,250,250,1],springgreen:[0,255,127,1],steelblue:[70,130,180,1],tan:[210,180,140,1],teal:[0,128,128,1],thistle:[216,191,216,1],tomato:[255,99,71,1],turquoise:[64,224,208,1],violet:[238,130,238,1],wheat:[245,222,179,1],white:[255,255,255,1],whitesmoke:[245,245,245,1],yellow:[255,255,0,1],yellowgreen:[154,205,50,1]};function n(m){return(m=Math.round(m))<0?0:m>255?255:m}function a(m){return n(m[m.length-1]==="%"?parseFloat(m)/100*255:parseInt(m))}function h(m){return(y=m[m.length-1]==="%"?parseFloat(m)/100:parseFloat(m))<0?0:y>1?1:y;var y}function d(m,y,x){return x<0?x+=1:x>1&&(x-=1),6*x<1?m+(y-m)*x*6:2*x<1?y:3*x<2?m+(y-m)*(2/3-x)*6:m}try{e.parseCSSColor=function(m){var y,x=m.replace(/ /g,"").toLowerCase();if(x in r)return r[x].slice();if(x[0]==="#")return x.length===4?(y=parseInt(x.substr(1),16))>=0&&y<=4095?[(3840&y)>>4|(3840&y)>>8,240&y|(240&y)>>4,15&y|(15&y)<<4,1]:null:x.length===7&&(y=parseInt(x.substr(1),16))>=0&&y<=16777215?[(16711680&y)>>16,(65280&y)>>8,255&y,1]:null;var E=x.indexOf("("),k=x.indexOf(")");if(E!==-1&&k+1===x.length){var S=x.substr(0,E),M=x.substr(E+1,k-(E+1)).split(","),P=1;switch(S){case"rgba":if(M.length!==4)return null;P=h(M.pop());case"rgb":return M.length!==3?null:[a(M[0]),a(M[1]),a(M[2]),P];case"hsla":if(M.length!==4)return null;P=h(M.pop());case"hsl":if(M.length!==3)return null;var F=(parseFloat(M[0])%360+360)%360/360,G=h(M[1]),X=h(M[2]),ne=X<=.5?X*(G+1):X+G-X*G,re=2*X-ne;return[n(255*d(re,ne,F+1/3)),n(255*d(re,ne,F)),n(255*d(re,ne,F-1/3)),P];default:return null}}return null}}catch{}});class bi{constructor(e,r,n,a=1){this.r=e,this.g=r,this.b=n,this.a=a}static parse(e){if(!e)return;if(e instanceof bi)return e;if(typeof e!="string")return;let r=qc.parseCSSColor(e);return r?new bi(r[0]/255*r[3],r[1]/255*r[3],r[2]/255*r[3],r[3]):void 0}toString(){let[e,r,n,a]=this.toArray();return`rgba(${Math.round(e)},${Math.round(r)},${Math.round(n)},${a})`}toArray(){let{r:e,g:r,b:n,a}=this;return a===0?[0,0,0,0]:[255*e/a,255*r/a,255*n/a,a]}toArray01(){let{r:e,g:r,b:n,a}=this;return a===0?[0,0,0,0]:[e/a,r/a,n/a,a]}toArray01PremultipliedAlpha(){let{r:e,g:r,b:n,a}=this;return[e,r,n,a]}}bi.black=new bi(0,0,0,1),bi.white=new bi(1,1,1,1),bi.transparent=new bi(0,0,0,0),bi.red=new bi(1,0,0,1),bi.blue=new bi(0,0,1,1);var hi=bi;class fr{constructor(e,r,n){this.sensitivity=e?r?"variant":"case":r?"accent":"base",this.locale=n,this.collator=new Intl.Collator(this.locale?this.locale:[],{sensitivity:this.sensitivity,usage:"search"})}compare(e,r){return this.collator.compare(e,r)}resolvedLocale(){return new Intl.Collator(this.locale?this.locale:[]).resolvedOptions().locale}}class cl{constructor(e,r,n,a,h){this.text=e.normalize?e.normalize():e,this.image=r,this.scale=n,this.fontStack=a,this.textColor=h}}class Oi{constructor(e){this.sections=e}static fromString(e){return new Oi([new cl(e,null,null,null,null)])}isEmpty(){return this.sections.length===0||!this.sections.some(e=>e.text.length!==0||e.image&&e.image.name.length!==0)}static factory(e){return e instanceof Oi?e:Oi.fromString(e)}toString(){return this.sections.length===0?"":this.sections.map(e=>e.text).join("")}serialize(){let e=["format"];for(let r of this.sections){if(r.image){e.push(["image",r.image.name]);continue}e.push(r.text);let n={};r.fontStack&&(n["text-font"]=["literal",r.fontStack.split(",")]),r.scale&&(n["font-scale"]=r.scale),r.textColor&&(n["text-color"]=["rgba"].concat(r.textColor.toArray())),e.push(n)}return e}}class mr{constructor(e){this.name=e.name,this.available=e.available}toString(){return this.name}static fromString(e){return e?new mr({name:e,available:!1}):null}serialize(){return["image",this.name]}}function ia(i,e,r,n){return typeof i=="number"&&i>=0&&i<=255&&typeof e=="number"&&e>=0&&e<=255&&typeof r=="number"&&r>=0&&r<=255?n===void 0||typeof n=="number"&&n>=0&&n<=1?null:`Invalid rgba value [${[i,e,r,n].join(", ")}]: 'a' must be between 0 and 1.`:`Invalid rgba value [${(typeof n=="number"?[i,e,r,n]:[i,e,r]).join(", ")}]: 'r', 'g', and 'b' must be between 0 and 255.`}function es(i){if(i===null||typeof i=="string"||typeof i=="boolean"||typeof i=="number"||i instanceof hi||i instanceof fr||i instanceof Oi||i instanceof mr)return!0;if(Array.isArray(i)){for(let e of i)if(!es(e))return!1;return!0}if(typeof i=="object"){for(let e in i)if(!es(i[e]))return!1;return!0}return!1}function si(i){if(i===null)return Jo;if(typeof i=="string")return Tt;if(typeof i=="boolean")return yt;if(typeof i=="number")return $e;if(i instanceof hi)return kr;if(i instanceof fr)return rn;if(i instanceof Oi)return so;if(i instanceof mr)return Qo;if(Array.isArray(i)){let e=i.length,r;for(let n of i){let a=si(n);if(r){if(r===a)continue;r=ft;break}r=a}return dr(r||ft,e)}return Dn}function Ln(i){let e=typeof i;return i===null?"":e==="string"||e==="number"||e==="boolean"?String(i):i instanceof hi||i instanceof Oi||i instanceof mr?i.toString():JSON.stringify(i)}class hl{constructor(e,r){this.type=e,this.value=r}static parse(e,r){if(e.length!==2)return r.error(`'literal' expression requires exactly one argument, but found ${e.length-1} instead.`);if(!es(e[1]))return r.error("invalid value");let n=e[1],a=si(n),h=r.expectedType;return a.kind!=="array"||a.N!==0||!h||h.kind!=="array"||typeof h.N=="number"&&h.N!==0||(a=h),new hl(a,n)}evaluate(){return this.value}eachChild(){}outputDefined(){return!0}serialize(){return this.type.kind==="array"||this.type.kind==="object"?["literal",this.value]:this.value instanceof hi?["rgba"].concat(this.value.toArray()):this.value instanceof Oi?this.value.serialize():this.value}}var ts=hl,zi=class{constructor(i){this.name="ExpressionEvaluationError",this.message=i}toJSON(){return this.message}};let ra={string:Tt,number:$e,boolean:yt,object:Dn};class is{constructor(e,r){this.type=e,this.args=r}static parse(e,r){if(e.length<2)return r.error("Expected at least one argument.");let n,a=1,h=e[0];if(h==="array"){let m,y;if(e.length>2){let x=e[1];if(typeof x!="string"||!(x in ra)||x==="object")return r.error('The item type argument of "array" must be one of string, number, boolean',1);m=ra[x],a++}else m=ft;if(e.length>3){if(e[2]!==null&&(typeof e[2]!="number"||e[2]<0||e[2]!==Math.floor(e[2])))return r.error('The length argument to "array" must be a positive integer literal',2);y=e[2],a++}n=dr(m,y)}else n=ra[h];let d=[];for(;a<e.length;a++){let m=r.parse(e[a],a,ft);if(!m)return null;d.push(m)}return new is(n,d)}evaluate(e){for(let r=0;r<this.args.length;r++){let n=this.args[r].evaluate(e);if(!ao(this.type,si(n)))return n;if(r===this.args.length-1)throw new zi(`Expected value to be of type ${ri(this.type)}, but found ${ri(si(n))} instead.`)}return null}eachChild(e){this.args.forEach(e)}outputDefined(){return this.args.every(e=>e.outputDefined())}serialize(){let e=this.type,r=[e.kind];if(e.kind==="array"){let n=e.itemType;if(n.kind==="string"||n.kind==="number"||n.kind==="boolean"){r.push(n.kind);let a=e.N;(typeof a=="number"||this.args.length>1)&&r.push(a)}}return r.concat(this.args.map(n=>n.serialize()))}}var nn=is;class mn{constructor(e){this.type=so,this.sections=e}static parse(e,r){if(e.length<2)return r.error("Expected at least one argument.");let n=e[1];if(!Array.isArray(n)&&typeof n=="object")return r.error("First argument must be an image or text section.");let a=[],h=!1;for(let d=1;d<=e.length-1;++d){let m=e[d];if(h&&typeof m=="object"&&!Array.isArray(m)){h=!1;let y=null;if(m["font-scale"]&&(y=r.parse(m["font-scale"],1,$e),!y))return null;let x=null;if(m["text-font"]&&(x=r.parse(m["text-font"],1,dr(Tt)),!x))return null;let E=null;if(m["text-color"]&&(E=r.parse(m["text-color"],1,kr),!E))return null;let k=a[a.length-1];k.scale=y,k.font=x,k.textColor=E}else{let y=r.parse(e[d],1,ft);if(!y)return null;let x=y.type.kind;if(x!=="string"&&x!=="value"&&x!=="null"&&x!=="resolvedImage")return r.error("Formatted text type must be 'string', 'value', 'image' or 'null'.");h=!0,a.push({content:y,scale:null,font:null,textColor:null})}}return new mn(a)}evaluate(e){return new Oi(this.sections.map(r=>{let n=r.content.evaluate(e);return si(n)===Qo?new cl("",n,null,null,null):new cl(Ln(n),null,r.scale?r.scale.evaluate(e):null,r.font?r.font.evaluate(e).join(","):null,r.textColor?r.textColor.evaluate(e):null)}))}eachChild(e){for(let r of this.sections)e(r.content),r.scale&&e(r.scale),r.font&&e(r.font),r.textColor&&e(r.textColor)}outputDefined(){return!1}serialize(){let e=["format"];for(let r of this.sections){e.push(r.content.serialize());let n={};r.scale&&(n["font-scale"]=r.scale.serialize()),r.font&&(n["text-font"]=r.font.serialize()),r.textColor&&(n["text-color"]=r.textColor.serialize()),e.push(n)}return e}}class na{constructor(e){this.type=Qo,this.input=e}static parse(e,r){if(e.length!==2)return r.error("Expected two arguments.");let n=r.parse(e[1],1,Tt);return n?new na(n):r.error("No image name provided.")}evaluate(e){let r=this.input.evaluate(e),n=mr.fromString(r);return n&&e.availableImages&&(n.available=e.availableImages.indexOf(r)>-1),n}eachChild(e){e(this.input)}outputDefined(){return!1}serialize(){return["image",this.input.serialize()]}}let rp={"to-boolean":yt,"to-color":kr,"to-number":$e,"to-string":Tt};class ul{constructor(e,r){this.type=e,this.args=r}static parse(e,r){if(e.length<2)return r.error("Expected at least one argument.");let n=e[0];if((n==="to-boolean"||n==="to-string")&&e.length!==2)return r.error("Expected one argument.");let a=rp[n],h=[];for(let d=1;d<e.length;d++){let m=r.parse(e[d],d,ft);if(!m)return null;h.push(m)}return new ul(a,h)}evaluate(e){if(this.type.kind==="boolean")return Boolean(this.args[0].evaluate(e));if(this.type.kind==="color"){let r,n;for(let a of this.args){if(r=a.evaluate(e),n=null,r instanceof hi)return r;if(typeof r=="string"){let h=e.parseColor(r);if(h)return h}else if(Array.isArray(r)&&(n=r.length<3||r.length>4?`Invalid rbga value ${JSON.stringify(r)}: expected an array containing either three or four numeric values.`:ia(r[0],r[1],r[2],r[3]),!n))return new hi(r[0]/255,r[1]/255,r[2]/255,r[3])}throw new zi(n||`Could not parse color from value '${typeof r=="string"?r:String(JSON.stringify(r))}'`)}if(this.type.kind==="number"){let r=null;for(let n of this.args){if(r=n.evaluate(e),r===null)return 0;let a=Number(r);if(!isNaN(a))return a}throw new zi(`Could not convert ${JSON.stringify(r)} to number.`)}return this.type.kind==="formatted"?Oi.fromString(Ln(this.args[0].evaluate(e))):this.type.kind==="resolvedImage"?mr.fromString(Ln(this.args[0].evaluate(e))):Ln(this.args[0].evaluate(e))}eachChild(e){this.args.forEach(e)}outputDefined(){return this.args.every(e=>e.outputDefined())}serialize(){if(this.type.kind==="formatted")return new mn([{content:this.args[0],scale:null,font:null,textColor:null}]).serialize();if(this.type.kind==="resolvedImage")return new na(this.args[0]).serialize();let e=[`to-${this.type.kind}`];return this.eachChild(r=>{e.push(r.serialize())}),e}}var ho=ul;let np=["Unknown","Point","LineString","Polygon"];var Zc=class{constructor(){this.globals=null,this.feature=null,this.featureState=null,this.formattedSection=null,this._parseColorCache={},this.availableImages=null,this.canonical=null,this.featureTileCoord=null,this.featureDistanceData=null}id(){return this.feature&&"id"in this.feature&&this.feature.id?this.feature.id:null}geometryType(){return this.feature?typeof this.feature.type=="number"?np[this.feature.type]:this.feature.type:null}geometry(){return this.feature&&"geometry"in this.feature?this.feature.geometry:null}canonicalID(){return this.canonical}properties(){return this.feature&&this.feature.properties||{}}distanceFromCenter(){if(this.featureTileCoord&&this.featureDistanceData){let i=this.featureDistanceData.center,e=this.featureDistanceData.scale,{x:r,y:n}=this.featureTileCoord;return this.featureDistanceData.bearing[0]*(r*e-i[0])+this.featureDistanceData.bearing[1]*(n*e-i[1])}return 0}parseColor(i){let e=this._parseColorCache[i];return e||(e=this._parseColorCache[i]=hi.parse(i)),e}};class uo{constructor(e,r,n,a){this.name=e,this.type=r,this._evaluate=n,this.args=a}evaluate(e){return this._evaluate(e,this.args)}eachChild(e){this.args.forEach(e)}outputDefined(){return!1}serialize(){return[this.name].concat(this.args.map(e=>e.serialize()))}static parse(e,r){let n=e[0],a=uo.definitions[n];if(!a)return r.error(`Unknown expression "${n}". If you wanted a literal array, use ["literal", [...]].`,0);let h=Array.isArray(a)?a[0]:a.type,d=Array.isArray(a)?[[a[1],a[2]]]:a.overloads,m=d.filter(([x])=>!Array.isArray(x)||x.length===e.length-1),y=null;for(let[x,E]of m){y=new Kc(r.registry,r.path,null,r.scope);let k=[],S=!1;for(let M=1;M<e.length;M++){let P=e[M],F=Array.isArray(x)?x[M-1]:x.type,G=y.parse(P,1+k.length,F);if(!G){S=!0;break}k.push(G)}if(!S)if(Array.isArray(x)&&x.length!==k.length)y.error(`Expected ${x.length} arguments, but found ${k.length} instead.`);else{for(let M=0;M<k.length;M++){let P=Array.isArray(x)?x[M]:x.type,F=k[M];y.concat(M+1).checkSubtype(P,F.type)}if(y.errors.length===0)return new uo(n,h,E,k)}}if(m.length===1)r.errors.push(...y.errors);else{let x=(m.length?m:d).map(([k])=>{return S=k,Array.isArray(S)?`(${S.map(ri).join(", ")})`:`(${ri(S.type)}...)`;var S}).join(" | "),E=[];for(let k=1;k<e.length;k++){let S=r.parse(e[k],1+E.length);if(!S)return null;E.push(ri(S.type))}r.error(`Expected arguments of type ${x}, but found (${E.join(", ")}) instead.`)}return null}static register(e,r){uo.definitions=r;for(let n in r)e[n]=uo}}var on=uo;class Bn{constructor(e,r,n){this.type=rn,this.locale=n,this.caseSensitive=e,this.diacriticSensitive=r}static parse(e,r){if(e.length!==2)return r.error("Expected one argument.");let n=e[1];if(typeof n!="object"||Array.isArray(n))return r.error("Collator options argument must be an object.");let a=r.parse(n["case-sensitive"]!==void 0&&n["case-sensitive"],1,yt);if(!a)return null;let h=r.parse(n["diacritic-sensitive"]!==void 0&&n["diacritic-sensitive"],1,yt);if(!h)return null;let d=null;return n.locale&&(d=r.parse(n.locale,1,Tt),!d)?null:new Bn(a,h,d)}evaluate(e){return new fr(this.caseSensitive.evaluate(e),this.diacriticSensitive.evaluate(e),this.locale?this.locale.evaluate(e):null)}eachChild(e){e(this.caseSensitive),e(this.diacriticSensitive),this.locale&&e(this.locale)}outputDefined(){return!1}serialize(){let e={};return e["case-sensitive"]=this.caseSensitive.serialize(),e["diacritic-sensitive"]=this.diacriticSensitive.serialize(),this.locale&&(e.locale=this.locale.serialize()),["collator",e]}}let gn=8192;function pl(i,e){i[0]=Math.min(i[0],e[0]),i[1]=Math.min(i[1],e[1]),i[2]=Math.max(i[2],e[0]),i[3]=Math.max(i[3],e[1])}function oa(i,e){return!(i[0]<=e[0]||i[2]>=e[2]||i[1]<=e[1]||i[3]>=e[3])}function op(i,e){let r=(180+i[0])/360,n=(180-180/Math.PI*Math.log(Math.tan(Math.PI/4+i[1]*Math.PI/360)))/360,a=Math.pow(2,e.z);return[Math.round(r*a*gn),Math.round(n*a*gn)]}function sp(i,e,r){let n=i[0]-e[0],a=i[1]-e[1],h=i[0]-r[0],d=i[1]-r[1];return n*d-h*a==0&&n*h<=0&&a*d<=0}function dl(i,e){let r=!1;for(let d=0,m=e.length;d<m;d++){let y=e[d];for(let x=0,E=y.length;x<E-1;x++){if(sp(i,y[x],y[x+1]))return!1;(a=y[x])[1]>(n=i)[1]!=(h=y[x+1])[1]>n[1]&&n[0]<(h[0]-a[0])*(n[1]-a[1])/(h[1]-a[1])+a[0]&&(r=!r)}}var n,a,h;return r}function Wc(i,e){for(let r=0;r<e.length;r++)if(dl(i,e[r]))return!0;return!1}function rs(i,e,r,n){let a=n[0]-r[0],h=n[1]-r[1],d=(i[0]-r[0])*h-a*(i[1]-r[1]),m=(e[0]-r[0])*h-a*(e[1]-r[1]);return d>0&&m<0||d<0&&m>0}function ap(i,e,r){for(let x of r)for(let E=0;E<x.length-1;++E)if((m=[(d=x[E+1])[0]-(h=x[E])[0],d[1]-h[1]])[0]*(y=[(a=e)[0]-(n=i)[0],a[1]-n[1]])[1]-m[1]*y[0]!=0&&rs(n,a,h,d)&&rs(h,d,n,a))return!0;var n,a,h,d,m,y;return!1}function Hc(i,e){for(let r=0;r<i.length;++r)if(!dl(i[r],e))return!1;for(let r=0;r<i.length-1;++r)if(ap(i[r],i[r+1],e))return!1;return!0}function lp(i,e){for(let r=0;r<e.length;r++)if(Hc(i,e[r]))return!0;return!1}function fl(i,e,r){let n=[];for(let a=0;a<i.length;a++){let h=[];for(let d=0;d<i[a].length;d++){let m=op(i[a][d],r);pl(e,m),h.push(m)}n.push(h)}return n}function Sr(i,e,r){let n=[];for(let a=0;a<i.length;a++){let h=fl(i[a],e,r);n.push(h)}return n}function ml(i,e,r,n){if(i[0]<r[0]||i[0]>r[2]){let a=.5*n,h=i[0]-r[0]>a?-n:r[0]-i[0]>a?n:0;h===0&&(h=i[0]-r[2]>a?-n:r[2]-i[0]>a?n:0),i[0]+=h}pl(e,i)}function gl(i,e,r,n){let a=Math.pow(2,n.z)*gn,h=[n.x*gn,n.y*gn],d=[];if(!i)return d;for(let m of i)for(let y of m){let x=[y.x+h[0],y.y+h[1]];ml(x,e,r,a),d.push(x)}return d}function ns(i,e,r,n){let a=Math.pow(2,n.z)*gn,h=[n.x*gn,n.y*gn],d=[];if(!i)return d;for(let y of i){let x=[];for(let E of y){let k=[E.x+h[0],E.y+h[1]];pl(e,k),x.push(k)}d.push(x)}if(e[2]-e[0]<=a/2){(m=e)[0]=m[1]=1/0,m[2]=m[3]=-1/0;for(let y of d)for(let x of y)ml(x,e,r,a)}var m;return d}class sn{constructor(e,r){this.type=yt,this.geojson=e,this.geometries=r}static parse(e,r){if(e.length!==2)return r.error(`'within' expression requires exactly one argument, but found ${e.length-1} instead.`);if(es(e[1])){let n=e[1];if(n.type==="FeatureCollection")for(let a=0;a<n.features.length;++a){let h=n.features[a].geometry.type;if(h==="Polygon"||h==="MultiPolygon")return new sn(n,n.features[a].geometry)}else if(n.type==="Feature"){let a=n.geometry.type;if(a==="Polygon"||a==="MultiPolygon")return new sn(n,n.geometry)}else if(n.type==="Polygon"||n.type==="MultiPolygon")return new sn(n,n)}return r.error("'within' expression requires valid geojson object that contains polygon geometry type.")}evaluate(e){if(e.geometry()!=null&&e.canonicalID()!=null){if(e.geometryType()==="Point")return function(r,n){let a=[1/0,1/0,-1/0,-1/0],h=[1/0,1/0,-1/0,-1/0],d=r.canonicalID();if(!d)return!1;if(n.type==="Polygon"){let m=fl(n.coordinates,h,d),y=gl(r.geometry(),a,h,d);if(!oa(a,h))return!1;for(let x of y)if(!dl(x,m))return!1}if(n.type==="MultiPolygon"){let m=Sr(n.coordinates,h,d),y=gl(r.geometry(),a,h,d);if(!oa(a,h))return!1;for(let x of y)if(!Wc(x,m))return!1}return!0}(e,this.geometries);if(e.geometryType()==="LineString")return function(r,n){let a=[1/0,1/0,-1/0,-1/0],h=[1/0,1/0,-1/0,-1/0],d=r.canonicalID();if(!d)return!1;if(n.type==="Polygon"){let m=fl(n.coordinates,h,d),y=ns(r.geometry(),a,h,d);if(!oa(a,h))return!1;for(let x of y)if(!Hc(x,m))return!1}if(n.type==="MultiPolygon"){let m=Sr(n.coordinates,h,d),y=ns(r.geometry(),a,h,d);if(!oa(a,h))return!1;for(let x of y)if(!lp(x,m))return!1}return!0}(e,this.geometries)}return!1}eachChild(){}outputDefined(){return!0}serialize(){return["within",this.geojson]}}var sa=sn;function po(i){if(i instanceof on&&(i.name==="get"&&i.args.length===1||i.name==="feature-state"||i.name==="has"&&i.args.length===1||i.name==="properties"||i.name==="geometry-type"||i.name==="id"||/^filter-/.test(i.name))||i instanceof sa)return!1;let e=!0;return i.eachChild(r=>{e&&!po(r)&&(e=!1)}),e}function fo(i){if(i instanceof on&&i.name==="feature-state")return!1;let e=!0;return i.eachChild(r=>{e&&!fo(r)&&(e=!1)}),e}function aa(i,e){if(i instanceof on&&e.indexOf(i.name)>=0)return!1;let r=!0;return i.eachChild(n=>{r&&!aa(n,e)&&(r=!1)}),r}class Ft{constructor(e,r){this.type=r.type,this.name=e,this.boundExpression=r}static parse(e,r){if(e.length!==2||typeof e[1]!="string")return r.error("'var' expression requires exactly one string literal argument.");let n=e[1];return r.scope.has(n)?new Ft(n,r.scope.get(n)):r.error(`Unknown variable "${n}". Make sure "${n}" has been bound in an enclosing "let" expression before using it.`,1)}evaluate(e){return this.boundExpression.evaluate(e)}eachChild(){}outputDefined(){return!1}serialize(){return["var",this.name]}}var Xc=Ft;class _l{constructor(e,r=[],n,a=new Gc,h=[]){this.registry=e,this.path=r,this.key=r.map(d=>`[${d}]`).join(""),this.scope=a,this.errors=h,this.expectedType=n}parse(e,r,n,a,h={}){return r?this.concat(r,n,a)._parse(e,h):this._parse(e,h)}_parse(e,r){function n(a,h,d){return d==="assert"?new nn(h,[a]):d==="coerce"?new ho(h,[a]):a}if(e!==null&&typeof e!="string"&&typeof e!="boolean"&&typeof e!="number"||(e=["literal",e]),Array.isArray(e)){if(e.length===0)return this.error('Expected an array with at least one element. If you wanted a literal array, use ["literal", []].');let a=e[0];if(typeof a!="string")return this.error(`Expression name must be a string, but found ${typeof a} instead. If you wanted a literal array, use ["literal", [...]].`,0),null;let h=this.registry[a];if(h){let d=h.parse(e,this);if(!d)return null;if(this.expectedType){let m=this.expectedType,y=d.type;if(m.kind!=="string"&&m.kind!=="number"&&m.kind!=="boolean"&&m.kind!=="object"&&m.kind!=="array"||y.kind!=="value")if(m.kind!=="color"&&m.kind!=="formatted"&&m.kind!=="resolvedImage"||y.kind!=="value"&&y.kind!=="string"){if(this.checkSubtype(m,y))return null}else d=n(d,m,r.typeAnnotation||"coerce");else d=n(d,m,r.typeAnnotation||"assert")}if(!(d instanceof ts)&&d.type.kind!=="resolvedImage"&&la(d)){let m=new Zc;try{d=new ts(d.type,d.evaluate(m))}catch(y){return this.error(y.message),null}}return d}return this.error(`Unknown expression "${a}". If you wanted a literal array, use ["literal", [...]].`,0)}return this.error(e===void 0?"'undefined' value invalid. Use null instead.":typeof e=="object"?'Bare objects invalid. Use ["literal", {...}] instead.':`Expected an array, but found ${typeof e} instead.`)}concat(e,r,n){let a=typeof e=="number"?this.path.concat(e):this.path,h=n?this.scope.concat(n):this.scope;return new _l(this.registry,a,r||null,h,this.errors)}error(e,...r){let n=`${this.key}${r.map(a=>`[${a}]`).join("")}`;this.errors.push(new rr(n,e))}checkSubtype(e,r){let n=ao(e,r);return n&&this.error(n),n}}var Kc=_l;function la(i){if(i instanceof Xc)return la(i.boundExpression);if(i instanceof on&&i.name==="error"||i instanceof Bn||i instanceof sa)return!1;let e=i instanceof ho||i instanceof nn,r=!0;return i.eachChild(n=>{r=e?r&&la(n):r&&n instanceof ts}),!!r&&po(i)&&aa(i,["zoom","heatmap-density","line-progress","sky-radial-progress","accumulated","is-supported-script","pitch","distance-from-center"])}function ca(i,e){let r=i.length-1,n,a,h=0,d=r,m=0;for(;h<=d;)if(m=Math.floor((h+d)/2),n=i[m],a=i[m+1],n<=e){if(m===r||e<a)return m;h=m+1}else{if(!(n>e))throw new zi("Input is not a number.");d=m-1}return 0}class ha{constructor(e,r,n){this.type=e,this.input=r,this.labels=[],this.outputs=[];for(let[a,h]of n)this.labels.push(a),this.outputs.push(h)}static parse(e,r){if(e.length-1<4)return r.error(`Expected at least 4 arguments, but found only ${e.length-1}.`);if((e.length-1)%2!=0)return r.error("Expected an even number of arguments.");let n=r.parse(e[1],1,$e);if(!n)return null;let a=[],h=null;r.expectedType&&r.expectedType.kind!=="value"&&(h=r.expectedType);for(let d=1;d<e.length;d+=2){let m=d===1?-1/0:e[d],y=e[d+1],x=d,E=d+1;if(typeof m!="number")return r.error('Input/output pairs for "step" expressions must be defined using literal numeric values (not computed expressions) for the input values.',x);if(a.length&&a[a.length-1][0]>=m)return r.error('Input/output pairs for "step" expressions must be arranged with input values in strictly ascending order.',x);let k=r.parse(y,E,h);if(!k)return null;h=h||k.type,a.push([m,k])}return new ha(h,n,a)}evaluate(e){let r=this.labels,n=this.outputs;if(r.length===1)return n[0].evaluate(e);let a=this.input.evaluate(e);if(a<=r[0])return n[0].evaluate(e);let h=r.length;return a>=r[h-1]?n[h-1].evaluate(e):n[ca(r,a)].evaluate(e)}eachChild(e){e(this.input);for(let r of this.outputs)e(r)}outputDefined(){return this.outputs.every(e=>e.outputDefined())}serialize(){let e=["step",this.input.serialize()];for(let r=0;r<this.labels.length;r++)r>0&&e.push(this.labels[r]),e.push(this.outputs[r].serialize());return e}}var ua=ha;function Pt(i,e,r){return i*(1-r)+e*r}var os=Object.freeze({__proto__:null,number:Pt,color:function(i,e,r){return new hi(Pt(i.r,e.r,r),Pt(i.g,e.g,r),Pt(i.b,e.b,r),Pt(i.a,e.a,r))},array:function(i,e,r){return i.map((n,a)=>Pt(n,e[a],r))}});let Rn=.95047,ss=1.08883,Yc=4/29,as=6/29,yl=3*as*as,cp=Math.PI/180,hp=180/Math.PI;function pa(i){return i>.008856451679035631?Math.pow(i,1/3):i/yl+Yc}function xl(i){return i>as?i*i*i:yl*(i-Yc)}function da(i){return 255*(i<=.0031308?12.92*i:1.055*Math.pow(i,1/2.4)-.055)}function fa(i){return(i/=255)<=.04045?i/12.92:Math.pow((i+.055)/1.055,2.4)}function vl(i){let e=fa(i.r),r=fa(i.g),n=fa(i.b),a=pa((.4124564*e+.3575761*r+.1804375*n)/Rn),h=pa((.2126729*e+.7151522*r+.072175*n)/1);return{l:116*h-16,a:500*(a-h),b:200*(h-pa((.0193339*e+.119192*r+.9503041*n)/ss)),alpha:i.a}}function Jc(i){let e=(i.l+16)/116,r=isNaN(i.a)?e:e+i.a/500,n=isNaN(i.b)?e:e-i.b/200;return e=1*xl(e),r=Rn*xl(r),n=ss*xl(n),new hi(da(3.2404542*r-1.5371385*e-.4985314*n),da(-.969266*r+1.8760108*e+.041556*n),da(.0556434*r-.2040259*e+1.0572252*n),i.alpha)}function Qc(i,e,r){let n=e-i;return i+r*(n>180||n<-180?n-360*Math.round(n/360):n)}let ls={forward:vl,reverse:Jc,interpolate:function(i,e,r){return{l:Pt(i.l,e.l,r),a:Pt(i.a,e.a,r),b:Pt(i.b,e.b,r),alpha:Pt(i.alpha,e.alpha,r)}}},mo={forward:function(i){let{l:e,a:r,b:n}=vl(i),a=Math.atan2(n,r)*hp;return{h:a<0?a+360:a,c:Math.sqrt(r*r+n*n),l:e,alpha:i.a}},reverse:function(i){let e=i.h*cp,r=i.c;return Jc({l:i.l,a:Math.cos(e)*r,b:Math.sin(e)*r,alpha:i.alpha})},interpolate:function(i,e,r){return{h:Qc(i.h,e.h,r),c:Pt(i.c,e.c,r),l:Pt(i.l,e.l,r),alpha:Pt(i.alpha,e.alpha,r)}}};var bl=Object.freeze({__proto__:null,lab:ls,hcl:mo});class ma{constructor(e,r,n,a,h){this.type=e,this.operator=r,this.interpolation=n,this.input=a,this.labels=[],this.outputs=[];for(let[d,m]of h)this.labels.push(d),this.outputs.push(m)}static interpolationFactor(e,r,n,a){let h=0;if(e.name==="exponential")h=wl(r,e.base,n,a);else if(e.name==="linear")h=wl(r,1,n,a);else if(e.name==="cubic-bezier"){let d=e.controlPoints;h=new B(d[0],d[1],d[2],d[3]).solve(wl(r,1,n,a))}return h}static parse(e,r){let[n,a,h,...d]=e;if(!Array.isArray(a)||a.length===0)return r.error("Expected an interpolation type expression.",1);if(a[0]==="linear")a={name:"linear"};else if(a[0]==="exponential"){let x=a[1];if(typeof x!="number")return r.error("Exponential interpolation requires a numeric base.",1,1);a={name:"exponential",base:x}}else{if(a[0]!=="cubic-bezier")return r.error(`Unknown interpolation type ${String(a[0])}`,1,0);{let x=a.slice(1);if(x.length!==4||x.some(E=>typeof E!="number"||E<0||E>1))return r.error("Cubic bezier interpolation requires four numeric arguments with values between 0 and 1.",1);a={name:"cubic-bezier",controlPoints:x}}}if(e.length-1<4)return r.error(`Expected at least 4 arguments, but found only ${e.length-1}.`);if((e.length-1)%2!=0)return r.error("Expected an even number of arguments.");if(h=r.parse(h,2,$e),!h)return null;let m=[],y=null;n==="interpolate-hcl"||n==="interpolate-lab"?y=kr:r.expectedType&&r.expectedType.kind!=="value"&&(y=r.expectedType);for(let x=0;x<d.length;x+=2){let E=d[x],k=d[x+1],S=x+3,M=x+4;if(typeof E!="number")return r.error('Input/output pairs for "interpolate" expressions must be defined using literal numeric values (not computed expressions) for the input values.',S);if(m.length&&m[m.length-1][0]>=E)return r.error('Input/output pairs for "interpolate" expressions must be arranged with input values in strictly ascending order.',S);let P=r.parse(k,M,y);if(!P)return null;y=y||P.type,m.push([E,P])}return y.kind==="number"||y.kind==="color"||y.kind==="array"&&y.itemType.kind==="number"&&typeof y.N=="number"?new ma(y,n,a,h,m):r.error(`Type ${ri(y)} is not interpolatable.`)}evaluate(e){let r=this.labels,n=this.outputs;if(r.length===1)return n[0].evaluate(e);let a=this.input.evaluate(e);if(a<=r[0])return n[0].evaluate(e);let h=r.length;if(a>=r[h-1])return n[h-1].evaluate(e);let d=ca(r,a),m=ma.interpolationFactor(this.interpolation,a,r[d],r[d+1]),y=n[d].evaluate(e),x=n[d+1].evaluate(e);return this.operator==="interpolate"?os[this.type.kind.toLowerCase()](y,x,m):this.operator==="interpolate-hcl"?mo.reverse(mo.interpolate(mo.forward(y),mo.forward(x),m)):ls.reverse(ls.interpolate(ls.forward(y),ls.forward(x),m))}eachChild(e){e(this.input);for(let r of this.outputs)e(r)}outputDefined(){return this.outputs.every(e=>e.outputDefined())}serialize(){let e;e=this.interpolation.name==="linear"?["linear"]:this.interpolation.name==="exponential"?this.interpolation.base===1?["linear"]:["exponential",this.interpolation.base]:["cubic-bezier"].concat(this.interpolation.controlPoints);let r=[this.operator,e,this.input.serialize()];for(let n=0;n<this.labels.length;n++)r.push(this.labels[n],this.outputs[n].serialize());return r}}function wl(i,e,r,n){let a=n-r,h=i-r;return a===0?0:e===1?h/a:(Math.pow(e,h)-1)/(Math.pow(e,a)-1)}var Fr=ma;class El{constructor(e,r){this.type=e,this.args=r}static parse(e,r){if(e.length<2)return r.error("Expectected at least one argument.");let n=null,a=r.expectedType;a&&a.kind!=="value"&&(n=a);let h=[];for(let m of e.slice(1)){let y=r.parse(m,1+h.length,n,void 0,{typeAnnotation:"omit"});if(!y)return null;n=n||y.type,h.push(y)}let d=a&&h.some(m=>ao(a,m.type));return new El(d?ft:n,h)}evaluate(e){let r,n=null,a=0;for(let h of this.args){if(a++,n=h.evaluate(e),n&&n instanceof mr&&!n.available&&(r||(r=n),n=null,a===this.args.length))return r;if(n!==null)break}return n}eachChild(e){this.args.forEach(e)}outputDefined(){return this.args.every(e=>e.outputDefined())}serialize(){let e=["coalesce"];return this.eachChild(r=>{e.push(r.serialize())}),e}}var eh=El;class Tl{constructor(e,r){this.type=r.type,this.bindings=[].concat(e),this.result=r}evaluate(e){return this.result.evaluate(e)}eachChild(e){for(let r of this.bindings)e(r[1]);e(this.result)}static parse(e,r){if(e.length<4)return r.error(`Expected at least 3 arguments, but found ${e.length-1} instead.`);let n=[];for(let h=1;h<e.length-1;h+=2){let d=e[h];if(typeof d!="string")return r.error(`Expected string, but found ${typeof d} instead.`,h);if(/[^a-zA-Z0-9_]/.test(d))return r.error("Variable names must contain only alphanumeric characters or '_'.",h);let m=r.parse(e[h+1],h+1);if(!m)return null;n.push([d,m])}let a=r.parse(e[e.length-1],e.length-1,r.expectedType,n);return a?new Tl(n,a):null}outputDefined(){return this.result.outputDefined()}serialize(){let e=["let"];for(let[r,n]of this.bindings)e.push(r,n.serialize());return e.push(this.result.serialize()),e}}var Cl=Tl;class kl{constructor(e,r,n){this.type=e,this.index=r,this.input=n}static parse(e,r){if(e.length!==3)return r.error(`Expected 2 arguments, but found ${e.length-1} instead.`);let n=r.parse(e[1],1,$e),a=r.parse(e[2],2,dr(r.expectedType||ft));return n&&a?new kl(a.type.itemType,n,a):null}evaluate(e){let r=this.index.evaluate(e),n=this.input.evaluate(e);if(r<0)throw new zi(`Array index out of bounds: ${r} < 0.`);if(r>=n.length)throw new zi(`Array index out of bounds: ${r} > ${n.length-1}.`);if(r!==Math.floor(r))throw new zi(`Array index must be an integer, but found ${r} instead.`);return n[r]}eachChild(e){e(this.index),e(this.input)}outputDefined(){return!1}serialize(){return["at",this.index.serialize(),this.input.serialize()]}}var up=kl;class Sl{constructor(e,r){this.type=yt,this.needle=e,this.haystack=r}static parse(e,r){if(e.length!==3)return r.error(`Expected 2 arguments, but found ${e.length-1} instead.`);let n=r.parse(e[1],1,ft),a=r.parse(e[2],2,ft);return n&&a?ta(n.type,[yt,Tt,$e,Jo,ft])?new Sl(n,a):r.error(`Expected first argument to be of type boolean, string, number or null, but found ${ri(n.type)} instead`):null}evaluate(e){let r=this.needle.evaluate(e),n=this.haystack.evaluate(e);if(n==null)return!1;if(!lo(r,["boolean","string","number","null"]))throw new zi(`Expected first argument to be of type boolean, string, number or null, but found ${ri(si(r))} instead.`);if(!lo(n,["string","array"]))throw new zi(`Expected second argument to be of type array or string, but found ${ri(si(n))} instead.`);return n.indexOf(r)>=0}eachChild(e){e(this.needle),e(this.haystack)}outputDefined(){return!0}serialize(){return["in",this.needle.serialize(),this.haystack.serialize()]}}var pp=Sl;class cs{constructor(e,r,n){this.type=$e,this.needle=e,this.haystack=r,this.fromIndex=n}static parse(e,r){if(e.length<=2||e.length>=5)return r.error(`Expected 3 or 4 arguments, but found ${e.length-1} instead.`);let n=r.parse(e[1],1,ft),a=r.parse(e[2],2,ft);if(!n||!a)return null;if(!ta(n.type,[yt,Tt,$e,Jo,ft]))return r.error(`Expected first argument to be of type boolean, string, number or null, but found ${ri(n.type)} instead`);if(e.length===4){let h=r.parse(e[3],3,$e);return h?new cs(n,a,h):null}return new cs(n,a)}evaluate(e){let r=this.needle.evaluate(e),n=this.haystack.evaluate(e);if(!lo(r,["boolean","string","number","null"]))throw new zi(`Expected first argument to be of type boolean, string, number or null, but found ${ri(si(r))} instead.`);if(!lo(n,["string","array"]))throw new zi(`Expected second argument to be of type array or string, but found ${ri(si(n))} instead.`);if(this.fromIndex){let a=this.fromIndex.evaluate(e);return n.indexOf(r,a)}return n.indexOf(r)}eachChild(e){e(this.needle),e(this.haystack),this.fromIndex&&e(this.fromIndex)}outputDefined(){return!1}serialize(){if(this.fromIndex!=null&&this.fromIndex!==void 0){let e=this.fromIndex.serialize();return["index-of",this.needle.serialize(),this.haystack.serialize(),e]}return["index-of",this.needle.serialize(),this.haystack.serialize()]}}var th=cs;class ga{constructor(e,r,n,a,h,d){this.inputType=e,this.type=r,this.input=n,this.cases=a,this.outputs=h,this.otherwise=d}static parse(e,r){if(e.length<5)return r.error(`Expected at least 4 arguments, but found only ${e.length-1}.`);if(e.length%2!=1)return r.error("Expected an even number of arguments.");let n,a;r.expectedType&&r.expectedType.kind!=="value"&&(a=r.expectedType);let h={},d=[];for(let x=2;x<e.length-1;x+=2){let E=e[x],k=e[x+1];Array.isArray(E)||(E=[E]);let S=r.concat(x);if(E.length===0)return S.error("Expected at least one branch label.");for(let P of E){if(typeof P!="number"&&typeof P!="string")return S.error("Branch labels must be numbers or strings.");if(typeof P=="number"&&Math.abs(P)>Number.MAX_SAFE_INTEGER)return S.error(`Branch labels must be integers no larger than ${Number.MAX_SAFE_INTEGER}.`);if(typeof P=="number"&&Math.floor(P)!==P)return S.error("Numeric branch labels must be integer values.");if(n){if(S.checkSubtype(n,si(P)))return null}else n=si(P);if(h[String(P)]!==void 0)return S.error("Branch labels must be unique.");h[String(P)]=d.length}let M=r.parse(k,x,a);if(!M)return null;a=a||M.type,d.push(M)}let m=r.parse(e[1],1,ft);if(!m)return null;let y=r.parse(e[e.length-1],e.length-1,a);return y?m.type.kind!=="value"&&r.concat(1).checkSubtype(n,m.type)?null:new ga(n,a,m,h,d,y):null}evaluate(e){let r=this.input.evaluate(e);return(si(r)===this.inputType&&this.outputs[this.cases[r]]||this.otherwise).evaluate(e)}eachChild(e){e(this.input),this.outputs.forEach(e),e(this.otherwise)}outputDefined(){return this.outputs.every(e=>e.outputDefined())&&this.otherwise.outputDefined()}serialize(){let e=["match",this.input.serialize()],r=Object.keys(this.cases).sort(),n=[],a={};for(let d of r){let m=a[this.cases[d]];m===void 0?(a[this.cases[d]]=n.length,n.push([this.cases[d],[d]])):n[m][1].push(d)}let h=d=>this.inputType.kind==="number"?Number(d):d;for(let[d,m]of n)e.push(m.length===1?h(m[0]):m.map(h)),e.push(this.outputs[d].serialize());return e.push(this.otherwise.serialize()),e}}var dp=ga;class Al{constructor(e,r,n){this.type=e,this.branches=r,this.otherwise=n}static parse(e,r){if(e.length<4)return r.error(`Expected at least 3 arguments, but found only ${e.length-1}.`);if(e.length%2!=0)return r.error("Expected an odd number of arguments.");let n;r.expectedType&&r.expectedType.kind!=="value"&&(n=r.expectedType);let a=[];for(let d=1;d<e.length-1;d+=2){let m=r.parse(e[d],d,yt);if(!m)return null;let y=r.parse(e[d+1],d+1,n);if(!y)return null;a.push([m,y]),n=n||y.type}let h=r.parse(e[e.length-1],e.length-1,n);return h?new Al(n,a,h):null}evaluate(e){for(let[r,n]of this.branches)if(r.evaluate(e))return n.evaluate(e);return this.otherwise.evaluate(e)}eachChild(e){for(let[r,n]of this.branches)e(r),e(n);e(this.otherwise)}outputDefined(){return this.branches.every(([e,r])=>r.outputDefined())&&this.otherwise.outputDefined()}serialize(){let e=["case"];return this.eachChild(r=>{e.push(r.serialize())}),e}}var ih=Al;class hs{constructor(e,r,n,a){this.type=e,this.input=r,this.beginIndex=n,this.endIndex=a}static parse(e,r){if(e.length<=2||e.length>=5)return r.error(`Expected 3 or 4 arguments, but found ${e.length-1} instead.`);let n=r.parse(e[1],1,ft),a=r.parse(e[2],2,$e);if(!n||!a)return null;if(!ta(n.type,[dr(ft),Tt,ft]))return r.error(`Expected first argument to be of type array or string, but found ${ri(n.type)} instead`);if(e.length===4){let h=r.parse(e[3],3,$e);return h?new hs(n.type,n,a,h):null}return new hs(n.type,n,a)}evaluate(e){let r=this.input.evaluate(e),n=this.beginIndex.evaluate(e);if(!lo(r,["string","array"]))throw new zi(`Expected first argument to be of type array or string, but found ${ri(si(r))} instead.`);if(this.endIndex){let a=this.endIndex.evaluate(e);return r.slice(n,a)}return r.slice(n)}eachChild(e){e(this.input),e(this.beginIndex),this.endIndex&&e(this.endIndex)}outputDefined(){return!1}serialize(){if(this.endIndex!=null&&this.endIndex!==void 0){let e=this.endIndex.serialize();return["slice",this.input.serialize(),this.beginIndex.serialize(),e]}return["slice",this.input.serialize(),this.beginIndex.serialize()]}}var rh=hs;function nh(i,e){return i==="=="||i==="!="?e.kind==="boolean"||e.kind==="string"||e.kind==="number"||e.kind==="null"||e.kind==="value":e.kind==="string"||e.kind==="number"||e.kind==="value"}function oh(i,e,r,n){return n.compare(e,r)===0}function go(i,e,r){let n=i!=="=="&&i!=="!=";return class Fy{constructor(h,d,m){this.type=yt,this.lhs=h,this.rhs=d,this.collator=m,this.hasUntypedArgument=h.type.kind==="value"||d.type.kind==="value"}static parse(h,d){if(h.length!==3&&h.length!==4)return d.error("Expected two or three arguments.");let m=h[0],y=d.parse(h[1],1,ft);if(!y)return null;if(!nh(m,y.type))return d.concat(1).error(`"${m}" comparisons are not supported for type '${ri(y.type)}'.`);let x=d.parse(h[2],2,ft);if(!x)return null;if(!nh(m,x.type))return d.concat(2).error(`"${m}" comparisons are not supported for type '${ri(x.type)}'.`);if(y.type.kind!==x.type.kind&&y.type.kind!=="value"&&x.type.kind!=="value")return d.error(`Cannot compare types '${ri(y.type)}' and '${ri(x.type)}'.`);n&&(y.type.kind==="value"&&x.type.kind!=="value"?y=new nn(x.type,[y]):y.type.kind!=="value"&&x.type.kind==="value"&&(x=new nn(y.type,[x])));let E=null;if(h.length===4){if(y.type.kind!=="string"&&x.type.kind!=="string"&&y.type.kind!=="value"&&x.type.kind!=="value")return d.error("Cannot use collator to compare non-string types.");if(E=d.parse(h[3],3,rn),!E)return null}return new Fy(y,x,E)}evaluate(h){let d=this.lhs.evaluate(h),m=this.rhs.evaluate(h);if(n&&this.hasUntypedArgument){let y=si(d),x=si(m);if(y.kind!==x.kind||y.kind!=="string"&&y.kind!=="number")throw new zi(`Expected arguments for "${i}" to be (string, string) or (number, number), but found (${y.kind}, ${x.kind}) instead.`)}if(this.collator&&!n&&this.hasUntypedArgument){let y=si(d),x=si(m);if(y.kind!=="string"||x.kind!=="string")return e(h,d,m)}return this.collator?r(h,d,m,this.collator.evaluate(h)):e(h,d,m)}eachChild(h){h(this.lhs),h(this.rhs),this.collator&&h(this.collator)}outputDefined(){return!0}serialize(){let h=[i];return this.eachChild(d=>{h.push(d.serialize())}),h}}}let fp=go("==",function(i,e,r){return e===r},oh),_a=go("!=",function(i,e,r){return e!==r},function(i,e,r,n){return!oh(0,e,r,n)}),sh=go("<",function(i,e,r){return e<r},function(i,e,r,n){return n.compare(e,r)<0}),ah=go(">",function(i,e,r){return e>r},function(i,e,r,n){return n.compare(e,r)>0}),mp=go("<=",function(i,e,r){return e<=r},function(i,e,r,n){return n.compare(e,r)<=0}),gp=go(">=",function(i,e,r){return e>=r},function(i,e,r,n){return n.compare(e,r)>=0});class Ml{constructor(e,r,n,a,h){this.type=Tt,this.number=e,this.locale=r,this.currency=n,this.minFractionDigits=a,this.maxFractionDigits=h}static parse(e,r){if(e.length!==3)return r.error("Expected two arguments.");let n=r.parse(e[1],1,$e);if(!n)return null;let a=e[2];if(typeof a!="object"||Array.isArray(a))return r.error("NumberFormat options argument must be an object.");let h=null;if(a.locale&&(h=r.parse(a.locale,1,Tt),!h))return null;let d=null;if(a.currency&&(d=r.parse(a.currency,1,Tt),!d))return null;let m=null;if(a["min-fraction-digits"]&&(m=r.parse(a["min-fraction-digits"],1,$e),!m))return null;let y=null;return a["max-fraction-digits"]&&(y=r.parse(a["max-fraction-digits"],1,$e),!y)?null:new Ml(n,h,d,m,y)}evaluate(e){return new Intl.NumberFormat(this.locale?this.locale.evaluate(e):[],{style:this.currency?"currency":"decimal",currency:this.currency?this.currency.evaluate(e):void 0,minimumFractionDigits:this.minFractionDigits?this.minFractionDigits.evaluate(e):void 0,maximumFractionDigits:this.maxFractionDigits?this.maxFractionDigits.evaluate(e):void 0}).format(this.number.evaluate(e))}eachChild(e){e(this.number),this.locale&&e(this.locale),this.currency&&e(this.currency),this.minFractionDigits&&e(this.minFractionDigits),this.maxFractionDigits&&e(this.maxFractionDigits)}outputDefined(){return!1}serialize(){let e={};return this.locale&&(e.locale=this.locale.serialize()),this.currency&&(e.currency=this.currency.serialize()),this.minFractionDigits&&(e["min-fraction-digits"]=this.minFractionDigits.serialize()),this.maxFractionDigits&&(e["max-fraction-digits"]=this.maxFractionDigits.serialize()),["number-format",this.number.serialize(),e]}}class ya{constructor(e){this.type=$e,this.input=e}static parse(e,r){if(e.length!==2)return r.error(`Expected 1 argument, but found ${e.length-1} instead.`);let n=r.parse(e[1],1);return n?n.type.kind!=="array"&&n.type.kind!=="string"&&n.type.kind!=="value"?r.error(`Expected argument of type string or array, but found ${ri(n.type)} instead.`):new ya(n):null}evaluate(e){let r=this.input.evaluate(e);if(typeof r=="string"||Array.isArray(r))return r.length;throw new zi(`Expected value to be of type string or array, but found ${ri(si(r))} instead.`)}eachChild(e){e(this.input)}outputDefined(){return!1}serialize(){let e=["length"];return this.eachChild(r=>{e.push(r.serialize())}),e}}let Il={"==":fp,"!=":_a,">":ah,"<":sh,">=":gp,"<=":mp,array:nn,at:up,boolean:nn,case:ih,coalesce:eh,collator:Bn,format:mn,image:na,in:pp,"index-of":th,interpolate:Fr,"interpolate-hcl":Fr,"interpolate-lab":Fr,length:ya,let:Cl,literal:ts,match:dp,number:nn,"number-format":Ml,object:nn,slice:rh,step:ua,string:nn,"to-boolean":ho,"to-color":ho,"to-number":ho,"to-string":ho,var:Xc,within:sa};function zl(i,[e,r,n,a]){e=e.evaluate(i),r=r.evaluate(i),n=n.evaluate(i);let h=a?a.evaluate(i):1,d=ia(e,r,n,h);if(d)throw new zi(d);return new hi(e/255*h,r/255*h,n/255*h,h)}function xa(i,e){return i in e}function Pl(i,e){let r=e[i];return r===void 0?null:r}function Fn(i){return{type:i}}on.register(Il,{error:[{kind:"error"},[Tt],(i,[e])=>{throw new zi(e.evaluate(i))}],typeof:[Tt,[ft],(i,[e])=>ri(si(e.evaluate(i)))],"to-rgba":[dr($e,4),[kr],(i,[e])=>e.evaluate(i).toArray()],rgb:[kr,[$e,$e,$e],zl],rgba:[kr,[$e,$e,$e,$e],zl],has:{type:yt,overloads:[[[Tt],(i,[e])=>xa(e.evaluate(i),i.properties())],[[Tt,Dn],(i,[e,r])=>xa(e.evaluate(i),r.evaluate(i))]]},get:{type:ft,overloads:[[[Tt],(i,[e])=>Pl(e.evaluate(i),i.properties())],[[Tt,Dn],(i,[e,r])=>Pl(e.evaluate(i),r.evaluate(i))]]},"feature-state":[ft,[Tt],(i,[e])=>Pl(e.evaluate(i),i.featureState||{})],properties:[Dn,[],i=>i.properties()],"geometry-type":[Tt,[],i=>i.geometryType()],id:[ft,[],i=>i.id()],zoom:[$e,[],i=>i.globals.zoom],pitch:[$e,[],i=>i.globals.pitch||0],"distance-from-center":[$e,[],i=>i.distanceFromCenter()],"heatmap-density":[$e,[],i=>i.globals.heatmapDensity||0],"line-progress":[$e,[],i=>i.globals.lineProgress||0],"sky-radial-progress":[$e,[],i=>i.globals.skyRadialProgress||0],accumulated:[ft,[],i=>i.globals.accumulated===void 0?null:i.globals.accumulated],"+":[$e,Fn($e),(i,e)=>{let r=0;for(let n of e)r+=n.evaluate(i);return r}],"*":[$e,Fn($e),(i,e)=>{let r=1;for(let n of e)r*=n.evaluate(i);return r}],"-":{type:$e,overloads:[[[$e,$e],(i,[e,r])=>e.evaluate(i)-r.evaluate(i)],[[$e],(i,[e])=>-e.evaluate(i)]]},"/":[$e,[$e,$e],(i,[e,r])=>e.evaluate(i)/r.evaluate(i)],"%":[$e,[$e,$e],(i,[e,r])=>e.evaluate(i)%r.evaluate(i)],ln2:[$e,[],()=>Math.LN2],pi:[$e,[],()=>Math.PI],e:[$e,[],()=>Math.E],"^":[$e,[$e,$e],(i,[e,r])=>Math.pow(e.evaluate(i),r.evaluate(i))],sqrt:[$e,[$e],(i,[e])=>Math.sqrt(e.evaluate(i))],log10:[$e,[$e],(i,[e])=>Math.log(e.evaluate(i))/Math.LN10],ln:[$e,[$e],(i,[e])=>Math.log(e.evaluate(i))],log2:[$e,[$e],(i,[e])=>Math.log(e.evaluate(i))/Math.LN2],sin:[$e,[$e],(i,[e])=>Math.sin(e.evaluate(i))],cos:[$e,[$e],(i,[e])=>Math.cos(e.evaluate(i))],tan:[$e,[$e],(i,[e])=>Math.tan(e.evaluate(i))],asin:[$e,[$e],(i,[e])=>Math.asin(e.evaluate(i))],acos:[$e,[$e],(i,[e])=>Math.acos(e.evaluate(i))],atan:[$e,[$e],(i,[e])=>Math.atan(e.evaluate(i))],min:[$e,Fn($e),(i,e)=>Math.min(...e.map(r=>r.evaluate(i)))],max:[$e,Fn($e),(i,e)=>Math.max(...e.map(r=>r.evaluate(i)))],abs:[$e,[$e],(i,[e])=>Math.abs(e.evaluate(i))],round:[$e,[$e],(i,[e])=>{let r=e.evaluate(i);return r<0?-Math.round(-r):Math.round(r)}],floor:[$e,[$e],(i,[e])=>Math.floor(e.evaluate(i))],ceil:[$e,[$e],(i,[e])=>Math.ceil(e.evaluate(i))],"filter-==":[yt,[Tt,ft],(i,[e,r])=>i.properties()[e.value]===r.value],"filter-id-==":[yt,[ft],(i,[e])=>i.id()===e.value],"filter-type-==":[yt,[Tt],(i,[e])=>i.geometryType()===e.value],"filter-<":[yt,[Tt,ft],(i,[e,r])=>{let n=i.properties()[e.value],a=r.value;return typeof n==typeof a&&n<a}],"filter-id-<":[yt,[ft],(i,[e])=>{let r=i.id(),n=e.value;return typeof r==typeof n&&r<n}],"filter->":[yt,[Tt,ft],(i,[e,r])=>{let n=i.properties()[e.value],a=r.value;return typeof n==typeof a&&n>a}],"filter-id->":[yt,[ft],(i,[e])=>{let r=i.id(),n=e.value;return typeof r==typeof n&&r>n}],"filter-<=":[yt,[Tt,ft],(i,[e,r])=>{let n=i.properties()[e.value],a=r.value;return typeof n==typeof a&&n<=a}],"filter-id-<=":[yt,[ft],(i,[e])=>{let r=i.id(),n=e.value;return typeof r==typeof n&&r<=n}],"filter->=":[yt,[Tt,ft],(i,[e,r])=>{let n=i.properties()[e.value],a=r.value;return typeof n==typeof a&&n>=a}],"filter-id->=":[yt,[ft],(i,[e])=>{let r=i.id(),n=e.value;return typeof r==typeof n&&r>=n}],"filter-has":[yt,[ft],(i,[e])=>e.value in i.properties()],"filter-has-id":[yt,[],i=>i.id()!==null&&i.id()!==void 0],"filter-type-in":[yt,[dr(Tt)],(i,[e])=>e.value.indexOf(i.geometryType())>=0],"filter-id-in":[yt,[dr(ft)],(i,[e])=>e.value.indexOf(i.id())>=0],"filter-in-small":[yt,[Tt,dr(ft)],(i,[e,r])=>r.value.indexOf(i.properties()[e.value])>=0],"filter-in-large":[yt,[Tt,dr(ft)],(i,[e,r])=>function(n,a,h,d){for(;h<=d;){let m=h+d>>1;if(a[m]===n)return!0;a[m]>n?d=m-1:h=m+1}return!1}(i.properties()[e.value],r.value,0,r.value.length-1)],all:{type:yt,overloads:[[[yt,yt],(i,[e,r])=>e.evaluate(i)&&r.evaluate(i)],[Fn(yt),(i,e)=>{for(let r of e)if(!r.evaluate(i))return!1;return!0}]]},any:{type:yt,overloads:[[[yt,yt],(i,[e,r])=>e.evaluate(i)||r.evaluate(i)],[Fn(yt),(i,e)=>{for(let r of e)if(r.evaluate(i))return!0;return!1}]]},"!":[yt,[yt],(i,[e])=>!e.evaluate(i)],"is-supported-script":[yt,[Tt],(i,[e])=>{let r=i.globals&&i.globals.isSupportedScript;return!r||r(e.evaluate(i))}],upcase:[Tt,[Tt],(i,[e])=>e.evaluate(i).toUpperCase()],downcase:[Tt,[Tt],(i,[e])=>e.evaluate(i).toLowerCase()],concat:[Tt,Fn(ft),(i,e)=>e.map(r=>Ln(r.evaluate(i))).join("")],"resolved-locale":[Tt,[rn],(i,[e])=>e.evaluate(i).resolvedLocale()]});var us=Il;function lh(i){return{result:"success",value:i}}function _o(i){return{result:"error",value:i}}function yo(i){return i["property-type"]==="data-driven"||i["property-type"]==="cross-faded-data-driven"}function Dl(i){return!!i.expression&&i.expression.parameters.indexOf("zoom")>-1}function va(i){return!!i.expression&&i.expression.interpolated}function Dt(i){return i instanceof Number?"number":i instanceof String?"string":i instanceof Boolean?"boolean":Array.isArray(i)?"array":i===null?"null":typeof i}function ba(i){return typeof i=="object"&&i!==null&&!Array.isArray(i)}function _p(i){return i}function ch(i,e){let r=e.type==="color",n=i.stops&&typeof i.stops[0][0]=="object",a=n||!(n||i.property!==void 0),h=i.type||(va(e)?"exponential":"interval");if(r&&((i=ir({},i)).stops&&(i.stops=i.stops.map(x=>[x[0],hi.parse(x[1])])),i.default=hi.parse(i.default?i.default:e.default)),i.colorSpace&&i.colorSpace!=="rgb"&&!bl[i.colorSpace])throw new Error(`Unknown color space: ${i.colorSpace}`);let d,m,y;if(h==="exponential")d=uh;else if(h==="interval")d=xo;else if(h==="categorical"){d=hh,m=Object.create(null);for(let x of i.stops)m[x[0]]=x[1];y=typeof i.stops[0][0]}else{if(h!=="identity")throw new Error(`Unknown function type "${h}"`);d=yp}if(n){let x={},E=[];for(let M=0;M<i.stops.length;M++){let P=i.stops[M],F=P[0].zoom;x[F]===void 0&&(x[F]={zoom:F,type:i.type,property:i.property,default:i.default,stops:[]},E.push(F)),x[F].stops.push([P[0].value,P[1]])}let k=[];for(let M of E)k.push([x[M].zoom,ch(x[M],e)]);let S={name:"linear"};return{kind:"composite",interpolationType:S,interpolationFactor:Fr.interpolationFactor.bind(void 0,S),zoomStops:k.map(M=>M[0]),evaluate:({zoom:M},P)=>uh({stops:k,base:i.base},e,M).evaluate(M,P)}}if(a){let x=h==="exponential"?{name:"exponential",base:i.base!==void 0?i.base:1}:null;return{kind:"camera",interpolationType:x,interpolationFactor:Fr.interpolationFactor.bind(void 0,x),zoomStops:i.stops.map(E=>E[0]),evaluate:({zoom:E})=>d(i,e,E,m,y)}}return{kind:"source",evaluate(x,E){let k=E&&E.properties?E.properties[i.property]:void 0;return k===void 0?gr(i.default,e.default):d(i,e,k,m,y)}}}function gr(i,e,r){return i!==void 0?i:e!==void 0?e:r!==void 0?r:void 0}function hh(i,e,r,n,a){return gr(typeof r===a?n[r]:void 0,i.default,e.default)}function xo(i,e,r){if(Dt(r)!=="number")return gr(i.default,e.default);let n=i.stops.length;if(n===1||r<=i.stops[0][0])return i.stops[0][1];if(r>=i.stops[n-1][0])return i.stops[n-1][1];let a=ca(i.stops.map(h=>h[0]),r);return i.stops[a][1]}function uh(i,e,r){let n=i.base!==void 0?i.base:1;if(Dt(r)!=="number")return gr(i.default,e.default);let a=i.stops.length;if(a===1||r<=i.stops[0][0])return i.stops[0][1];if(r>=i.stops[a-1][0])return i.stops[a-1][1];let h=ca(i.stops.map(E=>E[0]),r),d=function(E,k,S,M){let P=M-S,F=E-S;return P===0?0:k===1?F/P:(Math.pow(k,F)-1)/(Math.pow(k,P)-1)}(r,n,i.stops[h][0],i.stops[h+1][0]),m=i.stops[h][1],y=i.stops[h+1][1],x=os[e.type]||_p;if(i.colorSpace&&i.colorSpace!=="rgb"){let E=bl[i.colorSpace];x=(k,S)=>E.reverse(E.interpolate(E.forward(k),E.forward(S),d))}return typeof m.evaluate=="function"?{evaluate(...E){let k=m.evaluate.apply(void 0,E),S=y.evaluate.apply(void 0,E);if(k!==void 0&&S!==void 0)return x(k,S,d)}}:x(m,y,d)}function yp(i,e,r){return e.type==="color"?r=hi.parse(r):e.type==="formatted"?r=Oi.fromString(r.toString()):e.type==="resolvedImage"?r=mr.fromString(r.toString()):Dt(r)===e.type||e.type==="enum"&&e.values[r]||(r=void 0),gr(r,i.default,e.default)}class wa{constructor(e,r){this.expression=e,this._warningHistory={},this._evaluator=new Zc,this._defaultValue=r?function(n){return n.type==="color"&&(ba(n.default)||Array.isArray(n.default))?new hi(0,0,0,0):n.type==="color"?hi.parse(n.default)||null:n.default===void 0?null:n.default}(r):null,this._enumValues=r&&r.type==="enum"?r.values:null}evaluateWithoutErrorHandling(e,r,n,a,h,d,m,y){return this._evaluator.globals=e,this._evaluator.feature=r,this._evaluator.featureState=n,this._evaluator.canonical=a||null,this._evaluator.availableImages=h||null,this._evaluator.formattedSection=d,this._evaluator.featureTileCoord=m||null,this._evaluator.featureDistanceData=y||null,this.expression.evaluate(this._evaluator)}evaluate(e,r,n,a,h,d,m,y){this._evaluator.globals=e,this._evaluator.feature=r||null,this._evaluator.featureState=n||null,this._evaluator.canonical=a||null,this._evaluator.availableImages=h||null,this._evaluator.formattedSection=d||null,this._evaluator.featureTileCoord=m||null,this._evaluator.featureDistanceData=y||null;try{let x=this.expression.evaluate(this._evaluator);if(x==null||typeof x=="number"&&x!=x)return this._defaultValue;if(this._enumValues&&!(x in this._enumValues))throw new zi(`Expected value to be one of ${Object.keys(this._enumValues).map(E=>JSON.stringify(E)).join(", ")}, but found ${JSON.stringify(x)} instead.`);return x}catch(x){return this._warningHistory[x.message]||(this._warningHistory[x.message]=!0,typeof console<"u"&&console.warn(x.message)),this._defaultValue}}}function Ea(i){return Array.isArray(i)&&i.length>0&&typeof i[0]=="string"&&i[0]in us}function On(i,e){let r=new Kc(us,[],e?function(a){let h={color:kr,string:Tt,number:$e,enum:Tt,boolean:yt,formatted:so,resolvedImage:Qo};return a.type==="array"?dr(h[a.value]||ft,a.length):h[a.type]}(e):void 0),n=r.parse(i,void 0,void 0,void 0,e&&e.type==="string"?{typeAnnotation:"coerce"}:void 0);return n?lh(new wa(n,e)):_o(r.errors)}class Ta{constructor(e,r){this.kind=e,this._styleExpression=r,this.isStateDependent=e!=="constant"&&!fo(r.expression)}evaluateWithoutErrorHandling(e,r,n,a,h,d){return this._styleExpression.evaluateWithoutErrorHandling(e,r,n,a,h,d)}evaluate(e,r,n,a,h,d){return this._styleExpression.evaluate(e,r,n,a,h,d)}}class ps{constructor(e,r,n,a){this.kind=e,this.zoomStops=n,this._styleExpression=r,this.isStateDependent=e!=="camera"&&!fo(r.expression),this.interpolationType=a}evaluateWithoutErrorHandling(e,r,n,a,h,d){return this._styleExpression.evaluateWithoutErrorHandling(e,r,n,a,h,d)}evaluate(e,r,n,a,h,d){return this._styleExpression.evaluate(e,r,n,a,h,d)}interpolationFactor(e,r,n){return this.interpolationType?Fr.interpolationFactor(this.interpolationType,e,r,n):0}}function Ca(i,e){if((i=On(i,e)).result==="error")return i;let r=i.value.expression,n=po(r);if(!n&&!yo(e))return _o([new rr("","data expressions not supported")]);let a=aa(r,["zoom","pitch","distance-from-center"]);if(!a&&!Dl(e))return _o([new rr("","zoom expressions not supported")]);let h=vo(r);return h||a?h instanceof rr?_o([h]):h instanceof Fr&&!va(e)?_o([new rr("",'"interpolate" expressions cannot be used with this property')]):lh(h?new ps(n?"camera":"composite",i.value,h.labels,h instanceof Fr?h.interpolation:void 0):new Ta(n?"constant":"source",i.value)):_o([new rr("",'"zoom" expression may only be used as input to a top-level "step" or "interpolate" expression.')])}class ds{constructor(e,r){this._parameters=e,this._specification=r,ir(this,ch(this._parameters,this._specification))}static deserialize(e){return new ds(e._parameters,e._specification)}static serialize(e){return{_parameters:e._parameters,_specification:e._specification}}}function vo(i){let e=null;if(i instanceof Cl)e=vo(i.result);else if(i instanceof eh){for(let r of i.args)if(e=vo(r),e)break}else(i instanceof ua||i instanceof Fr)&&i.input instanceof on&&i.input.name==="zoom"&&(e=i);return e instanceof rr||i.eachChild(r=>{let n=vo(r);n instanceof rr?e=n:!e&&n?e=new rr("",'"zoom" expression may only be used as input to a top-level "step" or "interpolate" expression.'):e&&n&&e!==n&&(e=new rr("",'Only one zoom-based "step" or "interpolate" subexpression may be used in an expression.'))}),e}class We{constructor(e,r,n,a){this.message=(e?`${e}: `:"")+n,a&&(this.identifier=a),r!=null&&r.__line__&&(this.line=r.__line__)}}function _r(i){let e=i.key,r=i.value,n=i.valueSpec||{},a=i.objectElementValidators||{},h=i.style,d=i.styleSpec,m=[],y=Dt(r);if(y!=="object")return[new We(e,r,`object expected, ${y} found`)];for(let x in r){let E=x.split(".")[0],k=n[E]||n["*"],S;a[E]?S=a[E]:n[E]?S=Ti:a["*"]?S=a["*"]:n["*"]&&(S=Ti),S?m=m.concat(S({key:(e&&`${e}.`)+x,value:r[x],valueSpec:k,style:h,styleSpec:d,object:r,objectKey:x},r)):m.push(new We(e,r[x],`unknown property "${x}"`))}for(let x in n)a[x]||n[x].required&&n[x].default===void 0&&r[x]===void 0&&m.push(new We(e,r,`missing required property "${x}"`));return m}function fs(i){let e=i.value,r=i.valueSpec,n=i.style,a=i.styleSpec,h=i.key,d=i.arrayElementValidator||Ti;if(Dt(e)!=="array")return[new We(h,e,`array expected, ${Dt(e)} found`)];if(r.length&&e.length!==r.length)return[new We(h,e,`array length ${r.length} expected, length ${e.length} found`)];if(r["min-length"]&&e.length<r["min-length"])return[new We(h,e,`array length at least ${r["min-length"]} expected, length ${e.length} found`)];let m={type:r.value,values:r.values,minimum:r.minimum,maximum:r.maximum,function:void 0};a.$version<7&&(m.function=r.function),Dt(r.value)==="object"&&(m=r.value);let y=[];for(let x=0;x<e.length;x++)y=y.concat(d({array:e,arrayIndex:x,value:e[x],valueSpec:m,style:n,styleSpec:a,key:`${h}[${x}]`}));return y}function jn(i){let e=i.key,r=i.value,n=i.valueSpec,a=Dt(r);if(a==="number"&&r!=r&&(a="NaN"),a!=="number")return[new We(e,r,`number expected, ${a} found`)];if("minimum"in n){let h=n.minimum;if(Dt(n.minimum)==="array"&&(h=n.minimum[i.arrayIndex]),r<h)return[new We(e,r,`${r} is less than the minimum value ${h}`)]}if("maximum"in n){let h=n.maximum;if(Dt(n.maximum)==="array"&&(h=n.maximum[i.arrayIndex]),r>h)return[new We(e,r,`${r} is greater than the maximum value ${h}`)]}return[]}function Ll(i){let e=i.valueSpec,r=ii(i.value.type),n,a,h,d={},m=r!=="categorical"&&i.value.property===void 0,y=!m,x=Dt(i.value.stops)==="array"&&Dt(i.value.stops[0])==="array"&&Dt(i.value.stops[0][0])==="object",E=_r({key:i.key,value:i.value,valueSpec:i.styleSpec.function,style:i.style,styleSpec:i.styleSpec,objectElementValidators:{stops:function(M){if(r==="identity")return[new We(M.key,M.value,'identity function may not have a "stops" property')];let P=[],F=M.value;return P=P.concat(fs({key:M.key,value:F,valueSpec:M.valueSpec,style:M.style,styleSpec:M.styleSpec,arrayElementValidator:k})),Dt(F)==="array"&&F.length===0&&P.push(new We(M.key,F,"array must have at least one stop")),P},default:function(M){return Ti({key:M.key,value:M.value,valueSpec:e,style:M.style,styleSpec:M.styleSpec})}}});return r==="identity"&&m&&E.push(new We(i.key,i.value,'missing required property "property"')),r==="identity"||i.value.stops||E.push(new We(i.key,i.value,'missing required property "stops"')),r==="exponential"&&i.valueSpec.expression&&!va(i.valueSpec)&&E.push(new We(i.key,i.value,"exponential functions not supported")),i.styleSpec.$version>=8&&(y&&!yo(i.valueSpec)?E.push(new We(i.key,i.value,"property functions not supported")):m&&!Dl(i.valueSpec)&&E.push(new We(i.key,i.value,"zoom functions not supported"))),r!=="categorical"&&!x||i.value.property!==void 0||E.push(new We(i.key,i.value,'"property" property is required')),E;function k(M){let P=[],F=M.value,G=M.key;if(Dt(F)!=="array")return[new We(G,F,`array expected, ${Dt(F)} found`)];if(F.length!==2)return[new We(G,F,`array length 2 expected, length ${F.length} found`)];if(x){if(Dt(F[0])!=="object")return[new We(G,F,`object expected, ${Dt(F[0])} found`)];if(F[0].zoom===void 0)return[new We(G,F,"object stop key must have zoom")];if(F[0].value===void 0)return[new We(G,F,"object stop key must have value")];let X=ii(F[0].zoom);if(typeof X!="number")return[new We(G,F[0].zoom,"stop zoom values must be numbers")];if(h&&h>X)return[new We(G,F[0].zoom,"stop zoom values must appear in ascending order")];X!==h&&(h=X,a=void 0,d={}),P=P.concat(_r({key:`${G}[0]`,value:F[0],valueSpec:{zoom:{}},style:M.style,styleSpec:M.styleSpec,objectElementValidators:{zoom:jn,value:S}}))}else P=P.concat(S({key:`${G}[0]`,value:F[0],valueSpec:{},style:M.style,styleSpec:M.styleSpec},F));return Ea(pr(F[1]))?P.concat([new We(`${G}[1]`,F[1],"expressions are not allowed in function stops.")]):P.concat(Ti({key:`${G}[1]`,value:F[1],valueSpec:e,style:M.style,styleSpec:M.styleSpec}))}function S(M,P){let F=Dt(M.value),G=ii(M.value),X=M.value!==null?M.value:P;if(n){if(F!==n)return[new We(M.key,X,`${F} stop domain type must match previous stop domain type ${n}`)]}else n=F;if(F!=="number"&&F!=="string"&&F!=="boolean"&&typeof G!="number"&&typeof G!="string"&&typeof G!="boolean")return[new We(M.key,X,"stop domain value must be a number, string, or boolean")];if(F!=="number"&&r!=="categorical"){let ne=`number expected, ${F} found`;return yo(e)&&r===void 0&&(ne+='\nIf you intended to use a categorical function, specify `"type": "categorical"`.'),[new We(M.key,X,ne)]}return r!=="categorical"||F!=="number"||typeof G=="number"&&isFinite(G)&&Math.floor(G)===G?r!=="categorical"&&F==="number"&&typeof G=="number"&&typeof a=="number"&&a!==void 0&&G<a?[new We(M.key,X,"stop domain values must appear in ascending order")]:(a=G,r==="categorical"&&G in d?[new We(M.key,X,"stop domain values must be unique")]:(d[G]=!0,[])):[new We(M.key,X,`integer expected, found ${String(G)}`)]}}function Un(i){let e=(i.expressionContext==="property"?Ca:On)(pr(i.value),i.valueSpec);if(e.result==="error")return e.value.map(n=>new We(`${i.key}${n.key}`,i.value,n.message));let r=e.value.expression||e.value._styleExpression.expression;if(i.expressionContext==="property"&&i.propertyKey==="text-font"&&!r.outputDefined())return[new We(i.key,i.value,`Invalid data expression for "${i.propertyKey}". Output values must be contained as literals within the expression.`)];if(i.expressionContext==="property"&&i.propertyType==="layout"&&!fo(r))return[new We(i.key,i.value,'"feature-state" data expressions are not supported with layout properties.')];if(i.expressionContext==="filter")return ka(r,i);if(i.expressionContext&&i.expressionContext.indexOf("cluster")===0){if(!aa(r,["zoom","feature-state"]))return[new We(i.key,i.value,'"zoom" and "feature-state" expressions are not supported with cluster properties.')];if(i.expressionContext==="cluster-initial"&&!po(r))return[new We(i.key,i.value,"Feature data expressions are not supported with initial expression part of cluster properties.")]}return[]}function ka(i,e){let r=new Set(["zoom","feature-state","pitch","distance-from-center"]);if(e.valueSpec&&e.valueSpec.expression)for(let a of e.valueSpec.expression.parameters)r.delete(a);if(r.size===0)return[];let n=[];return i instanceof on&&r.has(i.name)?[new We(e.key,e.value,`["${i.name}"] expression is not supported in a filter for a ${e.object.type} layer with id: ${e.object.id}`)]:(i.eachChild(a=>{n.push(...ka(a,e))}),n)}function ms(i){let e=i.key,r=i.value,n=i.valueSpec,a=[];return Array.isArray(n.values)?n.values.indexOf(ii(r))===-1&&a.push(new We(e,r,`expected one of [${n.values.join(", ")}], ${JSON.stringify(r)} found`)):Object.keys(n.values).indexOf(ii(r))===-1&&a.push(new We(e,r,`expected one of [${Object.keys(n.values).join(", ")}], ${JSON.stringify(r)} found`)),a}function Bl(i){if(i===!0||i===!1)return!0;if(!Array.isArray(i)||i.length===0)return!1;switch(i[0]){case"has":return i.length>=2&&i[1]!=="$id"&&i[1]!=="$type";case"in":return i.length>=3&&(typeof i[1]!="string"||Array.isArray(i[2]));case"!in":case"!has":case"none":return!1;case"==":case"!=":case">":case">=":case"<":case"<=":return i.length!==3||Array.isArray(i[1])||Array.isArray(i[2]);case"any":case"all":for(let e of i.slice(1))if(!Bl(e)&&typeof e!="boolean")return!1;return!0;default:return!0}}function Vn(i,e="fill"){if(i==null)return{filter:()=>!0,needGeometry:!1,needFeature:!1};Bl(i)||(i=Nn(i));let r=i,n=!0;try{n=function(x){if(!bo(x))return x;let E=pr(x);return dh(E),E=ph(E),E}(r)}catch{console.warn(`Failed to extract static filter. Filter will continue working, but at higher memory usage and slower framerate.
This is most likely a bug, please report this via https://github.com/mapbox/mapbox-gl-js/issues/new?assignees=&labels=&template=Bug_report.md
and paste the contents of this message in the report.
Thank you!
Filter Expression:
${JSON.stringify(r,null,2)}
        `)}let a=de[`filter_${e}`],h=On(n,a),d=null;if(h.result==="error")throw new Error(h.value.map(x=>`${x.key}: ${x.message}`).join(", "));d=(x,E,k)=>h.value.evaluate(x,E,{},k);let m=null,y=null;if(n!==r){let x=On(r,a);if(x.result==="error")throw new Error(x.value.map(E=>`${E.key}: ${E.message}`).join(", "));m=(E,k,S,M,P)=>x.value.evaluate(E,k,{},S,void 0,void 0,M,P),y=!po(x.value.expression)}return d=d,{filter:d,dynamicFilter:m||void 0,needGeometry:gs(n),needFeature:!!y}}function ph(i){if(!Array.isArray(i))return i;let e=function(r){if(xp.has(r[0])){for(let n=1;n<r.length;n++)if(bo(r[n]))return!0}return r}(i);return e===!0?e:e.map(r=>ph(r))}function dh(i){let e=!1,r=[];if(i[0]==="case"){for(let n=1;n<i.length-1;n+=2)e=e||bo(i[n]),r.push(i[n+1]);r.push(i[i.length-1])}else if(i[0]==="match"){e=e||bo(i[1]);for(let n=2;n<i.length-1;n+=2)r.push(i[n+1]);r.push(i[i.length-1])}else if(i[0]==="step"){e=e||bo(i[1]);for(let n=1;n<i.length-1;n+=2)r.push(i[n+1])}e&&(i.length=0,i.push("any",...r));for(let n=1;n<i.length;n++)dh(i[n])}function bo(i){if(!Array.isArray(i))return!1;if((e=i[0])==="pitch"||e==="distance-from-center")return!0;var e;for(let r=1;r<i.length;r++)if(bo(i[r]))return!0;return!1}let xp=new Set(["in","==","!=",">",">=","<","<=","to-boolean"]);function vp(i,e){return i<e?-1:i>e?1:0}function gs(i){if(!Array.isArray(i))return!1;if(i[0]==="within")return!0;for(let e=1;e<i.length;e++)if(gs(i[e]))return!0;return!1}function Nn(i){if(!i)return!0;let e=i[0];return i.length<=1?e!=="any":e==="=="?Ni(i[1],i[2],"=="):e==="!="?Sa(Ni(i[1],i[2],"==")):e==="<"||e===">"||e==="<="||e===">="?Ni(i[1],i[2],e):e==="any"?(r=i.slice(1),["any"].concat(r.map(Nn))):e==="all"?["all"].concat(i.slice(1).map(Nn)):e==="none"?["all"].concat(i.slice(1).map(Nn).map(Sa)):e==="in"?_s(i[1],i.slice(2)):e==="!in"?Sa(_s(i[1],i.slice(2))):e==="has"?fh(i[1]):e==="!has"?Sa(fh(i[1])):e!=="within"||i;var r}function Ni(i,e,r){switch(i){case"$type":return[`filter-type-${r}`,e];case"$id":return[`filter-id-${r}`,e];default:return[`filter-${r}`,i,e]}}function _s(i,e){if(e.length===0)return!1;switch(i){case"$type":return["filter-type-in",["literal",e]];case"$id":return["filter-id-in",["literal",e]];default:return e.length>200&&!e.some(r=>typeof r!=typeof e[0])?["filter-in-large",i,["literal",e.sort(vp)]]:["filter-in-small",i,["literal",e]]}}function fh(i){switch(i){case"$type":return!0;case"$id":return["filter-has-id"];default:return["filter-has",i]}}function Sa(i){return["!",i]}function Rl(i){return Bl(pr(i.value))?Un(ir({},i,{expressionContext:"filter",valueSpec:i.styleSpec[`filter_${i.layerType||"fill"}`]})):mh(i)}function mh(i){let e=i.value,r=i.key;if(Dt(e)!=="array")return[new We(r,e,`array expected, ${Dt(e)} found`)];let n=i.styleSpec,a,h=[];if(e.length<1)return[new We(r,e,"filter array must have at least 1 element")];switch(h=h.concat(ms({key:`${r}[0]`,value:e[0],valueSpec:n.filter_operator,style:i.style,styleSpec:i.styleSpec})),ii(e[0])){case"<":case"<=":case">":case">=":e.length>=2&&ii(e[1])==="$type"&&h.push(new We(r,e,`"$type" cannot be use with operator "${e[0]}"`));case"==":case"!=":e.length!==3&&h.push(new We(r,e,`filter array for operator "${e[0]}" must have 3 elements`));case"in":case"!in":e.length>=2&&(a=Dt(e[1]),a!=="string"&&h.push(new We(`${r}[1]`,e[1],`string expected, ${a} found`)));for(let d=2;d<e.length;d++)a=Dt(e[d]),ii(e[1])==="$type"?h=h.concat(ms({key:`${r}[${d}]`,value:e[d],valueSpec:n.geometry_type,style:i.style,styleSpec:i.styleSpec})):a!=="string"&&a!=="number"&&a!=="boolean"&&h.push(new We(`${r}[${d}]`,e[d],`string, number, or boolean expected, ${a} found`));break;case"any":case"all":case"none":for(let d=1;d<e.length;d++)h=h.concat(mh({key:`${r}[${d}]`,value:e[d],style:i.style,styleSpec:i.styleSpec}));break;case"has":case"!has":a=Dt(e[1]),e.length!==2?h.push(new We(r,e,`filter array for "${e[0]}" operator must have 2 elements`)):a!=="string"&&h.push(new We(`${r}[1]`,e[1],`string expected, ${a} found`));break;case"within":a=Dt(e[1]),e.length!==2?h.push(new We(r,e,`filter array for "${e[0]}" operator must have 2 elements`)):a!=="object"&&h.push(new We(`${r}[1]`,e[1],`object expected, ${a} found`))}return h}function Aa(i,e){let r=i.key,n=i.style,a=i.styleSpec,h=i.value,d=i.objectKey,m=a[`${e}_${i.layerType}`];if(!m)return[];let y=d.match(/^(.*)-transition$/);if(e==="paint"&&y&&m[y[1]]&&m[y[1]].transition)return Ti({key:r,value:h,valueSpec:a.transition,style:n,styleSpec:a});let x=i.valueSpec||m[d];if(!x)return[new We(r,h,`unknown property "${d}"`)];let E;if(Dt(h)==="string"&&yo(x)&&!x.tokens&&(E=/^{([^}]+)}$/.exec(h)))return[new We(r,h,`"${d}" does not support interpolation syntax
Use an identity property function instead: \`{ "type": "identity", "property": ${JSON.stringify(E[1])} }\`.`)];let k=[];return i.layerType==="symbol"&&(d==="text-field"&&n&&!n.glyphs&&k.push(new We(r,h,'use of "text-field" requires a style "glyphs" property')),d==="text-font"&&ba(pr(h))&&ii(h.type)==="identity"&&k.push(new We(r,h,'"text-font" does not support identity functions'))),k.concat(Ti({key:i.key,value:h,valueSpec:x,style:n,styleSpec:a,expressionContext:"property",propertyType:e,propertyKey:d}))}function gh(i){return Aa(i,"paint")}function Ma(i){return Aa(i,"layout")}function _h(i){let e=[],r=i.value,n=i.key,a=i.style,h=i.styleSpec;r.type||r.ref||e.push(new We(n,r,'either "type" or "ref" is required'));let d=ii(r.type),m=ii(r.ref);if(r.id){let y=ii(r.id);for(let x=0;x<i.arrayIndex;x++){let E=a.layers[x];ii(E.id)===y&&e.push(new We(n,r.id,`duplicate layer id "${r.id}", previously used at line ${E.id.__line__}`))}}if("ref"in r){let y;["type","source","source-layer","filter","layout"].forEach(x=>{x in r&&e.push(new We(n,r[x],`"${x}" is prohibited for ref layers`))}),a.layers.forEach(x=>{ii(x.id)===m&&(y=x)}),y?y.ref?e.push(new We(n,r.ref,"ref cannot reference another ref layer")):d=ii(y.type):typeof m=="string"&&e.push(new We(n,r.ref,`ref layer "${m}" not found`))}else if(d!=="background"&&d!=="sky")if(r.source){let y=a.sources&&a.sources[r.source],x=y&&ii(y.type);y?x==="vector"&&d==="raster"?e.push(new We(n,r.source,`layer "${r.id}" requires a raster source`)):x==="raster"&&d!=="raster"?e.push(new We(n,r.source,`layer "${r.id}" requires a vector source`)):x!=="vector"||r["source-layer"]?x==="raster-dem"&&d!=="hillshade"?e.push(new We(n,r.source,"raster-dem source can only be used with layer type 'hillshade'.")):d!=="line"||!r.paint||!r.paint["line-gradient"]&&!r.paint["line-trim-offset"]||x==="geojson"&&y.lineMetrics||e.push(new We(n,r,`layer "${r.id}" specifies a line-gradient, which requires a GeoJSON source with \`lineMetrics\` enabled.`)):e.push(new We(n,r,`layer "${r.id}" must specify a "source-layer"`)):e.push(new We(n,r.source,`source "${r.source}" not found`))}else e.push(new We(n,r,'missing required property "source"'));return e=e.concat(_r({key:n,value:r,valueSpec:h.layer,style:i.style,styleSpec:i.styleSpec,objectElementValidators:{"*":()=>[],type:()=>Ti({key:`${n}.type`,value:r.type,valueSpec:h.layer.type,style:i.style,styleSpec:i.styleSpec,object:r,objectKey:"type"}),filter:y=>Rl(ir({layerType:d},y)),layout:y=>_r({layer:r,key:y.key,value:y.value,valueSpec:{},style:y.style,styleSpec:y.styleSpec,objectElementValidators:{"*":x=>Ma(ir({layerType:d},x))}}),paint:y=>_r({layer:r,key:y.key,value:y.value,valueSpec:{},style:y.style,styleSpec:y.styleSpec,objectElementValidators:{"*":x=>gh(ir({layerType:d},x))}})}})),e}function wo(i){let e=i.value,r=i.key,n=Dt(e);return n!=="string"?[new We(r,e,`string expected, ${n} found`)]:[]}let Ia={promoteId:function({key:i,value:e}){if(Dt(e)==="string")return wo({key:i,value:e});{let r=[];for(let n in e)r.push(...wo({key:`${i}.${n}`,value:e[n]}));return r}}};function yh(i){let e=i.value,r=i.key,n=i.styleSpec,a=i.style;if(!e.type)return[new We(r,e,'"type" is required')];let h=ii(e.type),d;switch(h){case"vector":case"raster":case"raster-dem":return d=_r({key:r,value:e,valueSpec:n[`source_${h.replace("-","_")}`],style:i.style,styleSpec:n,objectElementValidators:Ia}),d;case"geojson":if(d=_r({key:r,value:e,valueSpec:n.source_geojson,style:a,styleSpec:n,objectElementValidators:Ia}),e.cluster)for(let m in e.clusterProperties){let[y,x]=e.clusterProperties[m],E=typeof y=="string"?[y,["accumulated"],["get",m]]:y;d.push(...Un({key:`${r}.${m}.map`,value:x,expressionContext:"cluster-map"})),d.push(...Un({key:`${r}.${m}.reduce`,value:E,expressionContext:"cluster-reduce"}))}return d;case"video":return _r({key:r,value:e,valueSpec:n.source_video,style:a,styleSpec:n});case"image":return _r({key:r,value:e,valueSpec:n.source_image,style:a,styleSpec:n});case"canvas":return[new We(r,null,"Please use runtime APIs to add canvas sources, rather than including them in stylesheets.","source.canvas")];default:return ms({key:`${r}.type`,value:e.type,valueSpec:{values:["vector","raster","raster-dem","geojson","video","image"]},style:a,styleSpec:n})}}function Fl(i){let e=i.value,r=i.styleSpec,n=r.light,a=i.style,h=[],d=Dt(e);if(e===void 0)return h;if(d!=="object")return h=h.concat([new We("light",e,`object expected, ${d} found`)]),h;for(let m in e){let y=m.match(/^(.*)-transition$/);h=h.concat(y&&n[y[1]]&&n[y[1]].transition?Ti({key:m,value:e[m],valueSpec:r.transition,style:a,styleSpec:r}):n[m]?Ti({key:m,value:e[m],valueSpec:n[m],style:a,styleSpec:r}):[new We(m,e[m],`unknown property "${m}"`)])}return h}function Ol(i){let e=i.value,r=i.key,n=i.style,a=i.styleSpec,h=a.terrain,d=[],m=Dt(e);if(e===void 0)return d;if(m!=="object")return d=d.concat([new We("terrain",e,`object expected, ${m} found`)]),d;for(let y in e){let x=y.match(/^(.*)-transition$/);d=d.concat(x&&h[x[1]]&&h[x[1]].transition?Ti({key:y,value:e[y],valueSpec:a.transition,style:n,styleSpec:a}):h[y]?Ti({key:y,value:e[y],valueSpec:h[y],style:n,styleSpec:a}):[new We(y,e[y],`unknown property "${y}"`)])}if(e.source){let y=n.sources&&n.sources[e.source],x=y&&ii(y.type);y?x!=="raster-dem"&&d.push(new We(r,e.source,`terrain cannot be used with a source of type ${String(x)}, it only be used with a "raster-dem" source type`)):d.push(new We(r,e.source,`source "${e.source}" not found`))}else d.push(new We(r,e,'terrain is missing required property "source"'));return d}function xh(i){let e=i.value,r=i.style,n=i.styleSpec,a=n.fog,h=[],d=Dt(e);if(e===void 0)return h;if(d!=="object")return h=h.concat([new We("fog",e,`object expected, ${d} found`)]),h;for(let m in e){let y=m.match(/^(.*)-transition$/);h=h.concat(y&&a[y[1]]&&a[y[1]].transition?Ti({key:m,value:e[m],valueSpec:n.transition,style:r,styleSpec:n}):a[m]?Ti({key:m,value:e[m],valueSpec:a[m],style:r,styleSpec:n}):[new We(m,e[m],`unknown property "${m}"`)])}return h}let za={"*":()=>[],array:fs,boolean:function(i){let e=i.value,r=i.key,n=Dt(e);return n!=="boolean"?[new We(r,e,`boolean expected, ${n} found`)]:[]},number:jn,color:function(i){let e=i.key,r=i.value,n=Dt(r);return n!=="string"?[new We(e,r,`color expected, ${n} found`)]:qc.parseCSSColor(r)===null?[new We(e,r,`color expected, "${r}" found`)]:[]},enum:ms,filter:Rl,function:Ll,layer:_h,object:_r,source:yh,light:Fl,terrain:Ol,fog:xh,string:wo,formatted:function(i){return wo(i).length===0?[]:Un(i)},resolvedImage:function(i){return wo(i).length===0?[]:Un(i)},projection:function(i){let e=i.value,r=i.styleSpec,n=r.projection,a=i.style,h=[],d=Dt(e);if(d==="object")for(let m in e)h=h.concat(Ti({key:m,value:e[m],valueSpec:n[m],style:a,styleSpec:r}));else d!=="string"&&(h=h.concat([new We("projection",e,`object or string expected, ${d} found`)]));return h}};function Ti(i){let e=i.value,r=i.valueSpec,n=i.styleSpec;return r.expression&&ba(ii(e))?Ll(i):r.expression&&Ea(pr(e))?Un(i):r.type&&za[r.type]?za[r.type](i):_r(ir({},i,{valueSpec:r.type?n[r.type]:r}))}function vh(i){let e=i.value,r=i.key,n=wo(i);return n.length||(e.indexOf("{fontstack}")===-1&&n.push(new We(r,e,'"glyphs" url must include a "{fontstack}" token')),e.indexOf("{range}")===-1&&n.push(new We(r,e,'"glyphs" url must include a "{range}" token'))),n}function bh(i,e=de){return Ar(Ti({key:"",value:i,valueSpec:e.$root,styleSpec:e,style:i,objectElementValidators:{glyphs:vh,"*":()=>[]}}))}let wh=i=>Ar(gh(i)),bp=i=>Ar(Ma(i));function Ar(i){return i.slice().sort((e,r)=>e.line&&r.line?e.line-r.line:0)}function Eh(i,e){let r=!1;if(e&&e.length)for(let n of e)i.fire(new Yt(new Error(n.message))),r=!0;return r}var Eo=Or;function Or(i,e,r){var n=this.cells=[];if(i instanceof ArrayBuffer){this.arrayBuffer=i;var a=new Int32Array(this.arrayBuffer);i=a[0],this.d=(e=a[1])+2*(r=a[2]);for(var h=0;h<this.d*this.d;h++){var d=a[3+h],m=a[3+h+1];n.push(d===m?null:a.subarray(d,m))}var y=a[3+n.length+1];this.keys=a.subarray(a[3+n.length],y),this.bboxes=a.subarray(y),this.insert=this._insertReadonly}else{this.d=e+2*r;for(var x=0;x<this.d*this.d;x++)n.push([]);this.keys=[],this.bboxes=[]}this.n=e,this.extent=i,this.padding=r,this.scale=e/i,this.uid=0;var E=r/e*i;this.min=-E,this.max=i+E}Or.prototype.insert=function(i,e,r,n,a){this._forEachCell(e,r,n,a,this._insertCell,this.uid++),this.keys.push(i),this.bboxes.push(e),this.bboxes.push(r),this.bboxes.push(n),this.bboxes.push(a)},Or.prototype._insertReadonly=function(){throw"Cannot insert into a GridIndex created from an ArrayBuffer."},Or.prototype._insertCell=function(i,e,r,n,a,h){this.cells[a].push(h)},Or.prototype.query=function(i,e,r,n,a){var h=this.min,d=this.max;if(i<=h&&e<=h&&d<=r&&d<=n&&!a)return Array.prototype.slice.call(this.keys);var m=[];return this._forEachCell(i,e,r,n,this._queryCell,m,{},a),m},Or.prototype._queryCell=function(i,e,r,n,a,h,d,m){var y=this.cells[a];if(y!==null)for(var x=this.keys,E=this.bboxes,k=0;k<y.length;k++){var S=y[k];if(d[S]===void 0){var M=4*S;(m?m(E[M+0],E[M+1],E[M+2],E[M+3]):i<=E[M+2]&&e<=E[M+3]&&r>=E[M+0]&&n>=E[M+1])?(d[S]=!0,h.push(x[S])):d[S]=!1}}},Or.prototype._forEachCell=function(i,e,r,n,a,h,d,m){for(var y=this._convertToCellCoord(i),x=this._convertToCellCoord(e),E=this._convertToCellCoord(r),k=this._convertToCellCoord(n),S=y;S<=E;S++)for(var M=x;M<=k;M++){var P=this.d*M+S;if((!m||m(this._convertFromCellCoord(S),this._convertFromCellCoord(M),this._convertFromCellCoord(S+1),this._convertFromCellCoord(M+1)))&&a.call(this,i,e,r,n,P,h,d,m))return}},Or.prototype._convertFromCellCoord=function(i){return(i-this.padding)/this.scale},Or.prototype._convertToCellCoord=function(i){return Math.max(0,Math.min(this.d-1,Math.floor(i*this.scale)+this.padding))},Or.prototype.toArrayBuffer=function(){if(this.arrayBuffer)return this.arrayBuffer;for(var i=this.cells,e=3+this.cells.length+1+1,r=0,n=0;n<this.cells.length;n++)r+=this.cells[n].length;var a=new Int32Array(e+r+this.keys.length+this.bboxes.length);a[0]=this.extent,a[1]=this.n,a[2]=this.padding;for(var h=e,d=0;d<i.length;d++){var m=i[d];a[3+d]=h,a.set(m,h),h+=m.length}return a[3+i.length]=h,a.set(this.keys,h),a[3+i.length+1]=h+=this.keys.length,a.set(this.bboxes,h),h+=this.bboxes.length,a.buffer};let Pa={};function He(i,e,r={}){Object.defineProperty(i,"_classRegistryKey",{value:e,writeable:!1}),Pa[e]={klass:i,omit:r.omit||[]}}He(Object,"Object"),Eo.serialize=function(i,e){let r=i.toArrayBuffer();return e&&e.push(r),{buffer:r}},Eo.deserialize=function(i){return new Eo(i.buffer)},Object.defineProperty(Eo,"name",{value:"Grid"}),He(Eo,"Grid"),He(hi,"Color"),He(Error,"Error"),He(le,"AJAXError"),He(mr,"ResolvedImage"),He(ds,"StylePropertyFunction"),He(wa,"StyleExpression",{omit:["_evaluator"]}),He(ps,"ZoomDependentExpression"),He(Ta,"ZoomConstantExpression"),He(on,"CompoundExpression",{omit:["_evaluate"]});for(let i in us)Pa[us[i]._classRegistryKey]||He(us[i],`Expression${i}`);function Th(i){return i&&typeof ArrayBuffer<"u"&&(i instanceof ArrayBuffer||i.constructor&&i.constructor.name==="ArrayBuffer")}function Ch(i){return z.ImageBitmap&&i instanceof z.ImageBitmap}function ys(i,e){if(i==null||typeof i=="boolean"||typeof i=="number"||typeof i=="string"||i instanceof Boolean||i instanceof Number||i instanceof String||i instanceof Date||i instanceof RegExp)return i;if(Th(i)||Ch(i))return e&&e.push(i),i;if(ArrayBuffer.isView(i)){let r=i;return e&&e.push(r.buffer),r}if(i instanceof z.ImageData)return e&&e.push(i.data.buffer),i;if(Array.isArray(i)){let r=[];for(let n of i)r.push(ys(n,e));return r}if(typeof i=="object"){let r=i.constructor,n=r._classRegistryKey;if(!n)throw new Error(`can't serialize object of unregistered class ${n}`);let a=r.serialize?r.serialize(i,e):{};if(!r.serialize){for(let h in i)i.hasOwnProperty(h)&&(Pa[n].omit.indexOf(h)>=0||(a[h]=ys(i[h],e)));i instanceof Error&&(a.message=i.message)}if(a.$name)throw new Error("$name property is reserved for worker serialization logic.");return n!=="Object"&&(a.$name=n),a}throw new Error("can't serialize object of type "+typeof i)}function xs(i){if(i==null||typeof i=="boolean"||typeof i=="number"||typeof i=="string"||i instanceof Boolean||i instanceof Number||i instanceof String||i instanceof Date||i instanceof RegExp||Th(i)||Ch(i)||ArrayBuffer.isView(i)||i instanceof z.ImageData)return i;if(Array.isArray(i))return i.map(xs);if(typeof i=="object"){let e=i.$name||"Object",{klass:r}=Pa[e];if(!r)throw new Error(`can't deserialize unregistered class ${e}`);if(r.deserialize)return r.deserialize(i);let n=Object.create(r.prototype);for(let a of Object.keys(i))a!=="$name"&&(n[a]=xs(i[a]));return n}throw new Error("can't deserialize object of type "+typeof i)}class kh{constructor(){this.first=!0}update(e,r){let n=Math.floor(e);return this.first?(this.first=!1,this.lastIntegerZoom=n,this.lastIntegerZoomTime=0,this.lastZoom=e,this.lastFloorZoom=n,!0):(this.lastFloorZoom>n?(this.lastIntegerZoom=n+1,this.lastIntegerZoomTime=r):this.lastFloorZoom<n&&(this.lastIntegerZoom=n,this.lastIntegerZoomTime=r),e!==this.lastZoom&&(this.lastZoom=e,this.lastFloorZoom=n,!0))}}let Sh=i=>i>=1536&&i<=1791,Ah=i=>i>=1872&&i<=1919,vs=i=>i>=2208&&i<=2303,Mh=i=>i>=11904&&i<=12031,Ih=i=>i>=12032&&i<=12255,bs=i=>i>=12272&&i<=12287,Da=i=>i>=12288&&i<=12351,La=i=>i>=12352&&i<=12447,Ba=i=>i>=12448&&i<=12543,jl=i=>i>=12544&&i<=12591,Ul=i=>i>=12704&&i<=12735,Vl=i=>i>=12736&&i<=12783,Nl=i=>i>=12784&&i<=12799,Ra=i=>i>=12800&&i<=13055,Fa=i=>i>=13056&&i<=13311,zh=i=>i>=13312&&i<=19903,Gl=i=>i>=19968&&i<=40959,Ph=i=>i>=40960&&i<=42127,Oa=i=>i>=42128&&i<=42191,Dh=i=>i>=44032&&i<=55215,Lh=i=>i>=63744&&i<=64255,$l=i=>i>=64336&&i<=65023,Bh=i=>i>=65040&&i<=65055,ql=i=>i>=65072&&i<=65103,Zl=i=>i>=65104&&i<=65135,Wl=i=>i>=65136&&i<=65279,Hl=i=>i>=65280&&i<=65519;function ja(i){for(let e of i)if(t(e.charCodeAt(0)))return!0;return!1}function Ua(i){for(let e of i)if(!l(e.charCodeAt(0)))return!1;return!0}function l(i){return!(Sh(i)||Ah(i)||vs(i)||$l(i)||Wl(i))}function t(i){return!(i!==746&&i!==747&&(i<4352||!(Ul(i)||jl(i)||ql(i)&&!(i>=65097&&i<=65103)||Lh(i)||Fa(i)||Mh(i)||Vl(i)||!(!Da(i)||i>=12296&&i<=12305||i>=12308&&i<=12319||i===12336)||zh(i)||Gl(i)||Ra(i)||(e=>e>=12592&&e<=12687)(i)||(e=>e>=43360&&e<=43391)(i)||(e=>e>=55216&&e<=55295)(i)||(e=>e>=4352&&e<=4607)(i)||Dh(i)||La(i)||bs(i)||(e=>e>=12688&&e<=12703)(i)||Ih(i)||Nl(i)||Ba(i)&&i!==12540||!(!Hl(i)||i===65288||i===65289||i===65293||i>=65306&&i<=65310||i===65339||i===65341||i===65343||i>=65371&&i<=65503||i===65507||i>=65512&&i<=65519)||!(!Zl(i)||i>=65112&&i<=65118||i>=65123&&i<=65126)||(e=>e>=5120&&e<=5759)(i)||(e=>e>=6320&&e<=6399)(i)||Bh(i)||(e=>e>=19904&&e<=19967)(i)||Ph(i)||Oa(i))))}function s(i){return!(t(i)||function(e){return!!((r=>r>=128&&r<=255)(e)&&(e===167||e===169||e===174||e===177||e===188||e===189||e===190||e===215||e===247)||(r=>r>=8192&&r<=8303)(e)&&(e===8214||e===8224||e===8225||e===8240||e===8241||e===8251||e===8252||e===8258||e===8263||e===8264||e===8265||e===8273)||(r=>r>=8448&&r<=8527)(e)||(r=>r>=8528&&r<=8591)(e)||(r=>r>=8960&&r<=9215)(e)&&(e>=8960&&e<=8967||e>=8972&&e<=8991||e>=8996&&e<=9e3||e===9003||e>=9085&&e<=9114||e>=9150&&e<=9165||e===9167||e>=9169&&e<=9179||e>=9186&&e<=9215)||(r=>r>=9216&&r<=9279)(e)&&e!==9251||(r=>r>=9280&&r<=9311)(e)||(r=>r>=9312&&r<=9471)(e)||(r=>r>=9632&&r<=9727)(e)||(r=>r>=9728&&r<=9983)(e)&&!(e>=9754&&e<=9759)||(r=>r>=11008&&r<=11263)(e)&&(e>=11026&&e<=11055||e>=11088&&e<=11097||e>=11192&&e<=11243)||Da(e)||Ba(e)||(r=>r>=57344&&r<=63743)(e)||ql(e)||Zl(e)||Hl(e)||e===8734||e===8756||e===8757||e>=9984&&e<=10087||e>=10102&&e<=10131||e===65532||e===65533)}(i))}function p(i){return i>=1424&&i<=2303||$l(i)||Wl(i)}function f(i,e){return!(!e&&p(i)||i>=2304&&i<=3583||i>=3840&&i<=4255||(r=>r>=6016&&r<=6143)(i))}function _(i){for(let e of i)if(p(e.charCodeAt(0)))return!0;return!1}let b="deferred",w="loading",T="loaded",A=null,I="unavailable",L=null,O=function(i){i&&typeof i=="string"&&i.indexOf("NetworkError")>-1&&(I="error"),A&&A(i)};function V(){N.fire(new Rt("pluginStateChange",{pluginStatus:I,pluginURL:L}))}let N=new Vt,j=function(){return I},J=function(){if(I!==b||!L)throw new Error("rtl-text-plugin cannot be downloaded unless a pluginURL is specified");I=w,V(),L&&he({url:L},i=>{i?O(i):(I=T,V())})},U={applyArabicShaping:null,processBidirectionalText:null,processStyledBidirectionalText:null,isLoaded:()=>I===T||U.applyArabicShaping!=null,isLoading:()=>I===w,setState(i){I=i.pluginStatus,L=i.pluginURL},isParsed:()=>U.applyArabicShaping!=null&&U.processBidirectionalText!=null&&U.processStyledBidirectionalText!=null,getPluginURL:()=>L};class ${constructor(e,r){this.zoom=e,r?(this.now=r.now,this.fadeDuration=r.fadeDuration,this.zoomHistory=r.zoomHistory,this.transition=r.transition,this.pitch=r.pitch):(this.now=0,this.fadeDuration=0,this.zoomHistory=new kh,this.transition={},this.pitch=0)}isSupportedScript(e){return function(r,n){for(let a of r)if(!f(a.charCodeAt(0),n))return!1;return!0}(e,U.isLoaded())}crossFadingFactor(){return this.fadeDuration===0?1:Math.min((this.now-this.zoomHistory.lastIntegerZoomTime)/this.fadeDuration,1)}getCrossfadeParameters(){let e=this.zoom,r=e-Math.floor(e),n=this.crossFadingFactor();return e>this.zoomHistory.lastIntegerZoom?{fromScale:2,toScale:1,t:r+(1-r)*n}:{fromScale:.5,toScale:1,t:1-(1-n)*r}}}class q{constructor(e,r){this.property=e,this.value=r,this.expression=function(n,a){if(ba(n))return new ds(n,a);if(Ea(n)){let h=Ca(n,a);if(h.result==="error")throw new Error(h.value.map(d=>`${d.key}: ${d.message}`).join(", "));return h.value}{let h=n;return typeof n=="string"&&a.type==="color"&&(h=hi.parse(n)),{kind:"constant",evaluate:()=>h}}}(r===void 0?e.specification.default:r,e.specification)}isDataDriven(){return this.expression.kind==="source"||this.expression.kind==="composite"}possiblyEvaluate(e,r,n){return this.property.possiblyEvaluate(this,e,r,n)}}class ie{constructor(e){this.property=e,this.value=new q(e,void 0)}transitioned(e,r){return new Q(this.property,this.value,r,Bt({},e.transition,this.transition),e.now)}untransitioned(){return new Q(this.property,this.value,null,{},0)}}class K{constructor(e){this._properties=e,this._values=Object.create(e.defaultTransitionablePropertyValues)}getValue(e){return hr(this._values[e].value.value)}setValue(e,r){this._values.hasOwnProperty(e)||(this._values[e]=new ie(this._values[e].property)),this._values[e].value=new q(this._values[e].property,r===null?void 0:hr(r))}getTransition(e){return hr(this._values[e].transition)}setTransition(e,r){this._values.hasOwnProperty(e)||(this._values[e]=new ie(this._values[e].property)),this._values[e].transition=hr(r)||void 0}serialize(){let e={};for(let r of Object.keys(this._values)){let n=this.getValue(r);n!==void 0&&(e[r]=n);let a=this.getTransition(r);a!==void 0&&(e[`${r}-transition`]=a)}return e}transitioned(e,r){let n=new ae(this._properties);for(let a of Object.keys(this._values))n._values[a]=this._values[a].transitioned(e,r._values[a]);return n}untransitioned(){let e=new ae(this._properties);for(let r of Object.keys(this._values))e._values[r]=this._values[r].untransitioned();return e}}class Q{constructor(e,r,n,a,h){let d=a.delay||0,m=a.duration||0;h=h||0,this.property=e,this.value=r,this.begin=h+d,this.end=this.begin+m,e.specification.transition&&(a.delay||a.duration)&&(this.prior=n)}possiblyEvaluate(e,r,n){let a=e.now||0,h=this.value.possiblyEvaluate(e,r,n),d=this.prior;if(d){if(a>this.end)return this.prior=null,h;if(this.value.isDataDriven())return this.prior=null,h;if(a<this.begin)return d.possiblyEvaluate(e,r,n);{let m=(a-this.begin)/(this.end-this.begin);return this.property.interpolate(d.possiblyEvaluate(e,r,n),h,Ye(m))}}return h}}class ae{constructor(e){this._properties=e,this._values=Object.create(e.defaultTransitioningPropertyValues)}possiblyEvaluate(e,r,n){let a=new xe(this._properties);for(let h of Object.keys(this._values))a._values[h]=this._values[h].possiblyEvaluate(e,r,n);return a}hasTransition(){for(let e of Object.keys(this._values))if(this._values[e].prior)return!0;return!1}}class ye{constructor(e){this._properties=e,this._values=Object.create(e.defaultPropertyValues)}getValue(e){return hr(this._values[e].value)}setValue(e,r){this._values[e]=new q(this._values[e].property,r===null?void 0:hr(r))}serialize(){let e={};for(let r of Object.keys(this._values)){let n=this.getValue(r);n!==void 0&&(e[r]=n)}return e}possiblyEvaluate(e,r,n){let a=new xe(this._properties);for(let h of Object.keys(this._values))a._values[h]=this._values[h].possiblyEvaluate(e,r,n);return a}}class be{constructor(e,r,n){this.property=e,this.value=r,this.parameters=n}isConstant(){return this.value.kind==="constant"}constantOr(e){return this.value.kind==="constant"?this.value.value:e}evaluate(e,r,n,a){return this.property.evaluate(this.value,this.parameters,e,r,n,a)}}class xe{constructor(e){this._properties=e,this._values=Object.create(e.defaultPossiblyEvaluatedValues)}get(e){return this._values[e]}}class _e{constructor(e){this.specification=e}possiblyEvaluate(e,r){return e.expression.evaluate(r)}interpolate(e,r,n){let a=os[this.specification.type];return a?a(e,r,n):e}}class te{constructor(e,r){this.specification=e,this.overrides=r}possiblyEvaluate(e,r,n,a){return new be(this,e.expression.kind==="constant"||e.expression.kind==="camera"?{kind:"constant",value:e.expression.evaluate(r,null,{},n,a)}:e.expression,r)}interpolate(e,r,n){if(e.value.kind!=="constant"||r.value.kind!=="constant")return e;if(e.value.value===void 0||r.value.value===void 0)return new be(this,{kind:"constant",value:void 0},e.parameters);let a=os[this.specification.type];return a?new be(this,{kind:"constant",value:a(e.value.value,r.value.value,n)},e.parameters):e}evaluate(e,r,n,a,h,d){return e.kind==="constant"?e.value:e.evaluate(r,n,a,h,d)}}class Ie extends te{possiblyEvaluate(e,r,n,a){if(e.value===void 0)return new be(this,{kind:"constant",value:void 0},r);if(e.expression.kind==="constant"){let h=e.expression.evaluate(r,null,{},n,a),d=e.property.specification.type==="resolvedImage"&&typeof h!="string"?h.name:h,m=this._calculate(d,d,d,r);return new be(this,{kind:"constant",value:m},r)}if(e.expression.kind==="camera"){let h=this._calculate(e.expression.evaluate({zoom:r.zoom-1}),e.expression.evaluate({zoom:r.zoom}),e.expression.evaluate({zoom:r.zoom+1}),r);return new be(this,{kind:"constant",value:h},r)}return new be(this,e.expression,r)}evaluate(e,r,n,a,h,d){if(e.kind==="source"){let m=e.evaluate(r,n,a,h,d);return this._calculate(m,m,m,r)}return e.kind==="composite"?this._calculate(e.evaluate({zoom:Math.floor(r.zoom)-1},n,a),e.evaluate({zoom:Math.floor(r.zoom)},n,a),e.evaluate({zoom:Math.floor(r.zoom)+1},n,a),r):e.value}_calculate(e,r,n,a){return a.zoom>a.zoomHistory.lastIntegerZoom?{from:e,to:r,other:n}:{from:n,to:r,other:e}}interpolate(e){return e}}class Me{constructor(e){this.specification=e}possiblyEvaluate(e,r,n,a){if(e.value!==void 0){if(e.expression.kind==="constant"){let h=e.expression.evaluate(r,null,{},n,a);return this._calculate(h,h,h,r)}return this._calculate(e.expression.evaluate(new $(Math.floor(r.zoom-1),r)),e.expression.evaluate(new $(Math.floor(r.zoom),r)),e.expression.evaluate(new $(Math.floor(r.zoom+1),r)),r)}}_calculate(e,r,n,a){return a.zoom>a.zoomHistory.lastIntegerZoom?{from:e,to:r}:{from:n,to:r}}interpolate(e){return e}}class Ve{constructor(e){this.specification=e}possiblyEvaluate(e,r,n,a){return!!e.expression.evaluate(r,null,{},n,a)}interpolate(){return!1}}class Te{constructor(e){this.properties=e,this.defaultPropertyValues={},this.defaultTransitionablePropertyValues={},this.defaultTransitioningPropertyValues={},this.defaultPossiblyEvaluatedValues={},this.overridableProperties=[];let r=new $(0,{});for(let n in e){let a=e[n];a.specification.overridable&&this.overridableProperties.push(n);let h=this.defaultPropertyValues[n]=new q(a,void 0),d=this.defaultTransitionablePropertyValues[n]=new ie(a);this.defaultTransitioningPropertyValues[n]=d.untransitioned(),this.defaultPossiblyEvaluatedValues[n]=h.possiblyEvaluate(r)}}}function tt(i,e){return 256*(i=Je(Math.floor(i),0,255))+Je(Math.floor(e),0,255)}He(te,"DataDrivenProperty"),He(_e,"DataConstantProperty"),He(Ie,"CrossFadedDataDrivenProperty"),He(Me,"CrossFadedProperty"),He(Ve,"ColorRampProperty");let Ue={Int8:Int8Array,Uint8:Uint8Array,Int16:Int16Array,Uint16:Uint16Array,Int32:Int32Array,Uint32:Uint32Array,Float32:Float32Array};class je{constructor(e,r){this._structArray=e,this._pos1=r*this.size,this._pos2=this._pos1/2,this._pos4=this._pos1/4,this._pos8=this._pos1/8}}class Fe{constructor(){this.isTransferred=!1,this.capacity=-1,this.resize(0)}static serialize(e,r){return e._trim(),r&&(e.isTransferred=!0,r.push(e.arrayBuffer)),{length:e.length,arrayBuffer:e.arrayBuffer}}static deserialize(e){let r=Object.create(this.prototype);return r.arrayBuffer=e.arrayBuffer,r.length=e.length,r.capacity=e.arrayBuffer.byteLength/r.bytesPerElement,r._refreshViews(),r}_trim(){this.length!==this.capacity&&(this.capacity=this.length,this.arrayBuffer=this.arrayBuffer.slice(0,this.length*this.bytesPerElement),this._refreshViews())}clear(){this.length=0}resize(e){this.reserve(e),this.length=e}reserve(e){if(e>this.capacity){this.capacity=Math.max(e,Math.floor(5*this.capacity),128),this.arrayBuffer=new ArrayBuffer(this.capacity*this.bytesPerElement);let r=this.uint8;this._refreshViews(),r&&this.uint8.set(r)}}_refreshViews(){throw new Error("_refreshViews() must be implemented by each concrete StructArray layout")}destroy(){this.int8=this.uint8=this.int16=this.uint16=this.int32=this.uint32=this.float32=null,this.arrayBuffer=null}}function Oe(i,e=1){let r=0,n=0;return{members:i.map(a=>{let h=Ue[a.type].BYTES_PER_ELEMENT,d=r=ht(r,Math.max(e,h)),m=a.components||1;return n=Math.max(n,h),r+=h*m,{name:a.name,type:a.type,components:m,offset:d}}),size:ht(r,Math.max(n,e)),alignment:e}}function ht(i,e){return Math.ceil(i/e)*e}class rt extends Fe{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(e,r){let n=this.length;return this.resize(n+1),this.emplace(n,e,r)}emplace(e,r,n){let a=2*e;return this.int16[a+0]=r,this.int16[a+1]=n,e}}rt.prototype.bytesPerElement=4,He(rt,"StructArrayLayout2i4");class mt extends Fe{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(e,r,n){let a=this.length;return this.resize(a+1),this.emplace(a,e,r,n)}emplace(e,r,n,a){let h=3*e;return this.int16[h+0]=r,this.int16[h+1]=n,this.int16[h+2]=a,e}}mt.prototype.bytesPerElement=6,He(mt,"StructArrayLayout3i6");class et extends Fe{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(e,r,n,a){let h=this.length;return this.resize(h+1),this.emplace(h,e,r,n,a)}emplace(e,r,n,a,h){let d=4*e;return this.int16[d+0]=r,this.int16[d+1]=n,this.int16[d+2]=a,this.int16[d+3]=h,e}}et.prototype.bytesPerElement=8,He(et,"StructArrayLayout4i8");class pt extends Fe{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(e,r,n,a,h,d,m){let y=this.length;return this.resize(y+1),this.emplace(y,e,r,n,a,h,d,m)}emplace(e,r,n,a,h,d,m,y){let x=6*e,E=12*e,k=3*e;return this.int16[x+0]=r,this.int16[x+1]=n,this.uint8[E+4]=a,this.uint8[E+5]=h,this.uint8[E+6]=d,this.uint8[E+7]=m,this.float32[k+2]=y,e}}pt.prototype.bytesPerElement=12,He(pt,"StructArrayLayout2i4ub1f12");class Ot extends Fe{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(e,r,n,a){let h=this.length;return this.resize(h+1),this.emplace(h,e,r,n,a)}emplace(e,r,n,a,h){let d=4*e;return this.float32[d+0]=r,this.float32[d+1]=n,this.float32[d+2]=a,this.float32[d+3]=h,e}}Ot.prototype.bytesPerElement=16,He(Ot,"StructArrayLayout4f16");class Gt extends Fe{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(e,r,n,a,h,d,m,y,x,E){let k=this.length;return this.resize(k+1),this.emplace(k,e,r,n,a,h,d,m,y,x,E)}emplace(e,r,n,a,h,d,m,y,x,E,k){let S=10*e;return this.uint16[S+0]=r,this.uint16[S+1]=n,this.uint16[S+2]=a,this.uint16[S+3]=h,this.uint16[S+4]=d,this.uint16[S+5]=m,this.uint16[S+6]=y,this.uint16[S+7]=x,this.uint16[S+8]=E,this.uint16[S+9]=k,e}}Gt.prototype.bytesPerElement=20,He(Gt,"StructArrayLayout10ui20");class di extends Fe{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(e,r,n,a,h,d,m,y){let x=this.length;return this.resize(x+1),this.emplace(x,e,r,n,a,h,d,m,y)}emplace(e,r,n,a,h,d,m,y,x){let E=8*e;return this.uint16[E+0]=r,this.uint16[E+1]=n,this.uint16[E+2]=a,this.uint16[E+3]=h,this.uint16[E+4]=d,this.uint16[E+5]=m,this.uint16[E+6]=y,this.uint16[E+7]=x,e}}di.prototype.bytesPerElement=16,He(di,"StructArrayLayout8ui16");class Zt extends Fe{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(e,r,n,a,h,d){let m=this.length;return this.resize(m+1),this.emplace(m,e,r,n,a,h,d)}emplace(e,r,n,a,h,d,m){let y=6*e;return this.int16[y+0]=r,this.int16[y+1]=n,this.int16[y+2]=a,this.int16[y+3]=h,this.int16[y+4]=d,this.int16[y+5]=m,e}}Zt.prototype.bytesPerElement=12,He(Zt,"StructArrayLayout6i12");class nr extends Fe{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(e,r,n,a,h,d,m,y,x,E,k,S){let M=this.length;return this.resize(M+1),this.emplace(M,e,r,n,a,h,d,m,y,x,E,k,S)}emplace(e,r,n,a,h,d,m,y,x,E,k,S,M){let P=12*e;return this.int16[P+0]=r,this.int16[P+1]=n,this.int16[P+2]=a,this.int16[P+3]=h,this.uint16[P+4]=d,this.uint16[P+5]=m,this.uint16[P+6]=y,this.uint16[P+7]=x,this.int16[P+8]=E,this.int16[P+9]=k,this.int16[P+10]=S,this.int16[P+11]=M,e}}nr.prototype.bytesPerElement=24,He(nr,"StructArrayLayout4i4ui4i24");class jr extends Fe{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(e,r,n,a,h,d){let m=this.length;return this.resize(m+1),this.emplace(m,e,r,n,a,h,d)}emplace(e,r,n,a,h,d,m){let y=10*e,x=5*e;return this.int16[y+0]=r,this.int16[y+1]=n,this.int16[y+2]=a,this.float32[x+2]=h,this.float32[x+3]=d,this.float32[x+4]=m,e}}jr.prototype.bytesPerElement=20,He(jr,"StructArrayLayout3i3f20");class an extends Fe{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer)}emplaceBack(e){let r=this.length;return this.resize(r+1),this.emplace(r,e)}emplace(e,r){return this.uint32[1*e+0]=r,e}}an.prototype.bytesPerElement=4,He(an,"StructArrayLayout1ul4");class Jt extends Fe{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(e,r,n,a,h,d,m,y,x,E,k,S,M){let P=this.length;return this.resize(P+1),this.emplace(P,e,r,n,a,h,d,m,y,x,E,k,S,M)}emplace(e,r,n,a,h,d,m,y,x,E,k,S,M,P){let F=20*e,G=10*e;return this.int16[F+0]=r,this.int16[F+1]=n,this.int16[F+2]=a,this.int16[F+3]=h,this.int16[F+4]=d,this.float32[G+3]=m,this.float32[G+4]=y,this.float32[G+5]=x,this.float32[G+6]=E,this.int16[F+14]=k,this.uint32[G+8]=S,this.uint16[F+18]=M,this.uint16[F+19]=P,e}}Jt.prototype.bytesPerElement=40,He(Jt,"StructArrayLayout5i4f1i1ul2ui40");class ei extends Fe{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(e,r,n,a,h,d,m){let y=this.length;return this.resize(y+1),this.emplace(y,e,r,n,a,h,d,m)}emplace(e,r,n,a,h,d,m,y){let x=8*e;return this.int16[x+0]=r,this.int16[x+1]=n,this.int16[x+2]=a,this.int16[x+4]=h,this.int16[x+5]=d,this.int16[x+6]=m,this.int16[x+7]=y,e}}ei.prototype.bytesPerElement=16,He(ei,"StructArrayLayout3i2i2i16");class jt extends Fe{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(e,r,n,a,h){let d=this.length;return this.resize(d+1),this.emplace(d,e,r,n,a,h)}emplace(e,r,n,a,h,d){let m=4*e,y=8*e;return this.float32[m+0]=r,this.float32[m+1]=n,this.float32[m+2]=a,this.int16[y+6]=h,this.int16[y+7]=d,e}}jt.prototype.bytesPerElement=16,He(jt,"StructArrayLayout2f1f2i16");class _i extends Fe{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(e,r,n,a){let h=this.length;return this.resize(h+1),this.emplace(h,e,r,n,a)}emplace(e,r,n,a,h){let d=12*e,m=3*e;return this.uint8[d+0]=r,this.uint8[d+1]=n,this.float32[m+1]=a,this.float32[m+2]=h,e}}_i.prototype.bytesPerElement=12,He(_i,"StructArrayLayout2ub2f12");class Pi extends Fe{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(e,r,n){let a=this.length;return this.resize(a+1),this.emplace(a,e,r,n)}emplace(e,r,n,a){let h=3*e;return this.float32[h+0]=r,this.float32[h+1]=n,this.float32[h+2]=a,e}}Pi.prototype.bytesPerElement=12,He(Pi,"StructArrayLayout3f12");class Mt extends Fe{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(e,r,n){let a=this.length;return this.resize(a+1),this.emplace(a,e,r,n)}emplace(e,r,n,a){let h=3*e;return this.uint16[h+0]=r,this.uint16[h+1]=n,this.uint16[h+2]=a,e}}Mt.prototype.bytesPerElement=6,He(Mt,"StructArrayLayout3ui6");class qi extends Fe{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer)}emplaceBack(e,r,n,a,h,d,m,y,x,E,k,S,M,P,F,G,X,ne,re,se,ce){let ue=this.length;return this.resize(ue+1),this.emplace(ue,e,r,n,a,h,d,m,y,x,E,k,S,M,P,F,G,X,ne,re,se,ce)}emplace(e,r,n,a,h,d,m,y,x,E,k,S,M,P,F,G,X,ne,re,se,ce,ue){let ve=30*e,we=15*e,Se=60*e;return this.int16[ve+0]=r,this.int16[ve+1]=n,this.int16[ve+2]=a,this.float32[we+2]=h,this.float32[we+3]=d,this.uint16[ve+8]=m,this.uint16[ve+9]=y,this.uint32[we+5]=x,this.uint32[we+6]=E,this.uint32[we+7]=k,this.uint16[ve+16]=S,this.uint16[ve+17]=M,this.uint16[ve+18]=P,this.float32[we+10]=F,this.float32[we+11]=G,this.uint8[Se+48]=X,this.uint8[Se+49]=ne,this.uint8[Se+50]=re,this.uint32[we+13]=se,this.int16[ve+28]=ce,this.uint8[Se+58]=ue,e}}qi.prototype.bytesPerElement=60,He(qi,"StructArrayLayout3i2f2ui3ul3ui2f3ub1ul1i1ub60");class Gn extends Fe{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer)}emplaceBack(e,r,n,a,h,d,m,y,x,E,k,S,M,P,F,G,X,ne,re,se,ce,ue,ve,we,Se,Le,ge,ke,Be,Re){let qe=this.length;return this.resize(qe+1),this.emplace(qe,e,r,n,a,h,d,m,y,x,E,k,S,M,P,F,G,X,ne,re,se,ce,ue,ve,we,Se,Le,ge,ke,Be,Re)}emplace(e,r,n,a,h,d,m,y,x,E,k,S,M,P,F,G,X,ne,re,se,ce,ue,ve,we,Se,Le,ge,ke,Be,Re,qe){let Pe=38*e,Ne=19*e;return this.int16[Pe+0]=r,this.int16[Pe+1]=n,this.int16[Pe+2]=a,this.float32[Ne+2]=h,this.float32[Ne+3]=d,this.int16[Pe+8]=m,this.int16[Pe+9]=y,this.int16[Pe+10]=x,this.int16[Pe+11]=E,this.int16[Pe+12]=k,this.int16[Pe+13]=S,this.uint16[Pe+14]=M,this.uint16[Pe+15]=P,this.uint16[Pe+16]=F,this.uint16[Pe+17]=G,this.uint16[Pe+18]=X,this.uint16[Pe+19]=ne,this.uint16[Pe+20]=re,this.uint16[Pe+21]=se,this.uint16[Pe+22]=ce,this.uint16[Pe+23]=ue,this.uint16[Pe+24]=ve,this.uint16[Pe+25]=we,this.uint16[Pe+26]=Se,this.uint16[Pe+27]=Le,this.uint16[Pe+28]=ge,this.uint32[Ne+15]=ke,this.float32[Ne+16]=Be,this.float32[Ne+17]=Re,this.float32[Ne+18]=qe,e}}Gn.prototype.bytesPerElement=76,He(Gn,"StructArrayLayout3i2f6i15ui1ul3f76");class Mr extends Fe{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(e){let r=this.length;return this.resize(r+1),this.emplace(r,e)}emplace(e,r){return this.float32[1*e+0]=r,e}}Mr.prototype.bytesPerElement=4,He(Mr,"StructArrayLayout1f4");class To extends Fe{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(e,r,n,a,h,d,m){let y=this.length;return this.resize(y+1),this.emplace(y,e,r,n,a,h,d,m)}emplace(e,r,n,a,h,d,m,y){let x=7*e;return this.float32[x+0]=r,this.float32[x+1]=n,this.float32[x+2]=a,this.float32[x+3]=h,this.float32[x+4]=d,this.float32[x+5]=m,this.float32[x+6]=y,e}}To.prototype.bytesPerElement=28,He(To,"StructArrayLayout7f28");class Co extends Fe{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(e,r,n,a,h){let d=this.length;return this.resize(d+1),this.emplace(d,e,r,n,a,h)}emplace(e,r,n,a,h,d){let m=5*e;return this.float32[m+0]=r,this.float32[m+1]=n,this.float32[m+2]=a,this.float32[m+3]=h,this.float32[m+4]=d,e}}Co.prototype.bytesPerElement=20,He(Co,"StructArrayLayout5f20");class _n extends Fe{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(e,r,n,a){let h=this.length;return this.resize(h+1),this.emplace(h,e,r,n,a)}emplace(e,r,n,a,h){let d=6*e;return this.uint32[3*e+0]=r,this.uint16[d+2]=n,this.uint16[d+3]=a,this.uint16[d+4]=h,e}}_n.prototype.bytesPerElement=12,He(_n,"StructArrayLayout1ul3ui12");class yi extends Fe{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(e,r){let n=this.length;return this.resize(n+1),this.emplace(n,e,r)}emplace(e,r,n){let a=2*e;return this.uint16[a+0]=r,this.uint16[a+1]=n,e}}yi.prototype.bytesPerElement=4,He(yi,"StructArrayLayout2ui4");class Ur extends Fe{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(e){let r=this.length;return this.resize(r+1),this.emplace(r,e)}emplace(e,r){return this.uint16[1*e+0]=r,e}}Ur.prototype.bytesPerElement=2,He(Ur,"StructArrayLayout1ui2");class ln extends Fe{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(e,r){let n=this.length;return this.resize(n+1),this.emplace(n,e,r)}emplace(e,r,n){let a=2*e;return this.float32[a+0]=r,this.float32[a+1]=n,e}}ln.prototype.bytesPerElement=8,He(ln,"StructArrayLayout2f8");class ws extends je{get a_pos_30(){return this._structArray.int16[this._pos2+0]}get a_pos_31(){return this._structArray.int16[this._pos2+1]}get a_pos_32(){return this._structArray.int16[this._pos2+2]}get a_pos_normal_30(){return this._structArray.int16[this._pos2+3]}get a_pos_normal_31(){return this._structArray.int16[this._pos2+4]}get a_pos_normal_32(){return this._structArray.int16[this._pos2+5]}}ws.prototype.size=12;class Of extends Zt{get(e){return new ws(this,e)}}He(Of,"FillExtrusionExtArray");class jf extends je{get projectedAnchorX(){return this._structArray.int16[this._pos2+0]}get projectedAnchorY(){return this._structArray.int16[this._pos2+1]}get projectedAnchorZ(){return this._structArray.int16[this._pos2+2]}get tileAnchorX(){return this._structArray.int16[this._pos2+3]}get tileAnchorY(){return this._structArray.int16[this._pos2+4]}get x1(){return this._structArray.float32[this._pos4+3]}get y1(){return this._structArray.float32[this._pos4+4]}get x2(){return this._structArray.float32[this._pos4+5]}get y2(){return this._structArray.float32[this._pos4+6]}get padding(){return this._structArray.int16[this._pos2+14]}get featureIndex(){return this._structArray.uint32[this._pos4+8]}get sourceLayerIndex(){return this._structArray.uint16[this._pos2+18]}get bucketIndex(){return this._structArray.uint16[this._pos2+19]}}jf.prototype.size=40;class wp extends Jt{get(e){return new jf(this,e)}}He(wp,"CollisionBoxArray");class Uf extends je{get projectedAnchorX(){return this._structArray.int16[this._pos2+0]}get projectedAnchorY(){return this._structArray.int16[this._pos2+1]}get projectedAnchorZ(){return this._structArray.int16[this._pos2+2]}get tileAnchorX(){return this._structArray.float32[this._pos4+2]}get tileAnchorY(){return this._structArray.float32[this._pos4+3]}get glyphStartIndex(){return this._structArray.uint16[this._pos2+8]}get numGlyphs(){return this._structArray.uint16[this._pos2+9]}get vertexStartIndex(){return this._structArray.uint32[this._pos4+5]}get lineStartIndex(){return this._structArray.uint32[this._pos4+6]}get lineLength(){return this._structArray.uint32[this._pos4+7]}get segment(){return this._structArray.uint16[this._pos2+16]}get lowerSize(){return this._structArray.uint16[this._pos2+17]}get upperSize(){return this._structArray.uint16[this._pos2+18]}get lineOffsetX(){return this._structArray.float32[this._pos4+10]}get lineOffsetY(){return this._structArray.float32[this._pos4+11]}get writingMode(){return this._structArray.uint8[this._pos1+48]}get placedOrientation(){return this._structArray.uint8[this._pos1+49]}set placedOrientation(e){this._structArray.uint8[this._pos1+49]=e}get hidden(){return this._structArray.uint8[this._pos1+50]}set hidden(e){this._structArray.uint8[this._pos1+50]=e}get crossTileID(){return this._structArray.uint32[this._pos4+13]}set crossTileID(e){this._structArray.uint32[this._pos4+13]=e}get associatedIconIndex(){return this._structArray.int16[this._pos2+28]}get flipState(){return this._structArray.uint8[this._pos1+58]}set flipState(e){this._structArray.uint8[this._pos1+58]=e}}Uf.prototype.size=60;class Vf extends qi{get(e){return new Uf(this,e)}}He(Vf,"PlacedSymbolArray");class Nf extends je{get projectedAnchorX(){return this._structArray.int16[this._pos2+0]}get projectedAnchorY(){return this._structArray.int16[this._pos2+1]}get projectedAnchorZ(){return this._structArray.int16[this._pos2+2]}get tileAnchorX(){return this._structArray.float32[this._pos4+2]}get tileAnchorY(){return this._structArray.float32[this._pos4+3]}get rightJustifiedTextSymbolIndex(){return this._structArray.int16[this._pos2+8]}get centerJustifiedTextSymbolIndex(){return this._structArray.int16[this._pos2+9]}get leftJustifiedTextSymbolIndex(){return this._structArray.int16[this._pos2+10]}get verticalPlacedTextSymbolIndex(){return this._structArray.int16[this._pos2+11]}get placedIconSymbolIndex(){return this._structArray.int16[this._pos2+12]}get verticalPlacedIconSymbolIndex(){return this._structArray.int16[this._pos2+13]}get key(){return this._structArray.uint16[this._pos2+14]}get textBoxStartIndex(){return this._structArray.uint16[this._pos2+15]}get textBoxEndIndex(){return this._structArray.uint16[this._pos2+16]}get verticalTextBoxStartIndex(){return this._structArray.uint16[this._pos2+17]}get verticalTextBoxEndIndex(){return this._structArray.uint16[this._pos2+18]}get iconBoxStartIndex(){return this._structArray.uint16[this._pos2+19]}get iconBoxEndIndex(){return this._structArray.uint16[this._pos2+20]}get verticalIconBoxStartIndex(){return this._structArray.uint16[this._pos2+21]}get verticalIconBoxEndIndex(){return this._structArray.uint16[this._pos2+22]}get featureIndex(){return this._structArray.uint16[this._pos2+23]}get numHorizontalGlyphVertices(){return this._structArray.uint16[this._pos2+24]}get numVerticalGlyphVertices(){return this._structArray.uint16[this._pos2+25]}get numIconVertices(){return this._structArray.uint16[this._pos2+26]}get numVerticalIconVertices(){return this._structArray.uint16[this._pos2+27]}get useRuntimeCollisionCircles(){return this._structArray.uint16[this._pos2+28]}get crossTileID(){return this._structArray.uint32[this._pos4+15]}set crossTileID(e){this._structArray.uint32[this._pos4+15]=e}get textOffset0(){return this._structArray.float32[this._pos4+16]}get textOffset1(){return this._structArray.float32[this._pos4+17]}get collisionCircleDiameter(){return this._structArray.float32[this._pos4+18]}}Nf.prototype.size=76;class Gf extends Gn{get(e){return new Nf(this,e)}}He(Gf,"SymbolInstanceArray");class $f extends Mr{getoffsetX(e){return this.float32[1*e+0]}}He($f,"GlyphOffsetArray");class qf extends mt{getx(e){return this.int16[3*e+0]}gety(e){return this.int16[3*e+1]}gettileUnitDistanceFromAnchor(e){return this.int16[3*e+2]}}He(qf,"SymbolLineVertexArray");class Zf extends je{get featureIndex(){return this._structArray.uint32[this._pos4+0]}get sourceLayerIndex(){return this._structArray.uint16[this._pos2+2]}get bucketIndex(){return this._structArray.uint16[this._pos2+3]}get layoutVertexArrayOffset(){return this._structArray.uint16[this._pos2+4]}}Zf.prototype.size=12;class Wf extends _n{get(e){return new Zf(this,e)}}He(Wf,"FeatureIndexArray");class Hf extends je{get a_centroid_pos0(){return this._structArray.uint16[this._pos2+0]}get a_centroid_pos1(){return this._structArray.uint16[this._pos2+1]}}Hf.prototype.size=4;class Xf extends yi{get(e){return new Hf(this,e)}}He(Xf,"FillExtrusionCentroidArray");class Kf extends je{get a_pos_30(){return this._structArray.int16[this._pos2+0]}get a_pos_31(){return this._structArray.int16[this._pos2+1]}get a_pos_32(){return this._structArray.int16[this._pos2+2]}get a_pos_normal_30(){return this._structArray.int16[this._pos2+3]}get a_pos_normal_31(){return this._structArray.int16[this._pos2+4]}get a_pos_normal_32(){return this._structArray.int16[this._pos2+5]}}Kf.prototype.size=12;class Yf extends Zt{get(e){return new Kf(this,e)}}He(Yf,"CircleGlobeExtArray");let jy=Oe([{name:"a_pattern_to",components:4,type:"Uint16"},{name:"a_pattern_from",components:4,type:"Uint16"},{name:"a_pixel_ratio_to",components:1,type:"Uint16"},{name:"a_pixel_ratio_from",components:1,type:"Uint16"}]),Uy=Oe([{name:"a_dash_to",components:4,type:"Uint16"},{name:"a_dash_from",components:4,type:"Uint16"}]);var Jf=co(function(i){i.exports=function(e,r){var n,a,h,d,m,y,x,E;for(a=e.length-(n=3&e.length),h=r,m=3432918353,y=461845907,E=0;E<a;)x=255&e.charCodeAt(E)|(255&e.charCodeAt(++E))<<8|(255&e.charCodeAt(++E))<<16|(255&e.charCodeAt(++E))<<24,++E,h=27492+(65535&(d=5*(65535&(h=(h^=x=(65535&(x=(x=(65535&x)*m+(((x>>>16)*m&65535)<<16)&4294967295)<<15|x>>>17))*y+(((x>>>16)*y&65535)<<16)&4294967295)<<13|h>>>19))+((5*(h>>>16)&65535)<<16)&4294967295))+((58964+(d>>>16)&65535)<<16);switch(x=0,n){case 3:x^=(255&e.charCodeAt(E+2))<<16;case 2:x^=(255&e.charCodeAt(E+1))<<8;case 1:h^=x=(65535&(x=(x=(65535&(x^=255&e.charCodeAt(E)))*m+(((x>>>16)*m&65535)<<16)&4294967295)<<15|x>>>17))*y+(((x>>>16)*y&65535)<<16)&4294967295}return h^=e.length,h=2246822507*(65535&(h^=h>>>16))+((2246822507*(h>>>16)&65535)<<16)&4294967295,h=3266489909*(65535&(h^=h>>>13))+((3266489909*(h>>>16)&65535)<<16)&4294967295,(h^=h>>>16)>>>0}}),Vy=co(function(i){i.exports=function(e,r){for(var n,a=e.length,h=r^a,d=0;a>=4;)n=1540483477*(65535&(n=255&e.charCodeAt(d)|(255&e.charCodeAt(++d))<<8|(255&e.charCodeAt(++d))<<16|(255&e.charCodeAt(++d))<<24))+((1540483477*(n>>>16)&65535)<<16),h=1540483477*(65535&h)+((1540483477*(h>>>16)&65535)<<16)^(n=1540483477*(65535&(n^=n>>>24))+((1540483477*(n>>>16)&65535)<<16)),a-=4,++d;switch(a){case 3:h^=(255&e.charCodeAt(d+2))<<16;case 2:h^=(255&e.charCodeAt(d+1))<<8;case 1:h=1540483477*(65535&(h^=255&e.charCodeAt(d)))+((1540483477*(h>>>16)&65535)<<16)}return h=1540483477*(65535&(h^=h>>>13))+((1540483477*(h>>>16)&65535)<<16),(h^=h>>>15)>>>0}}),Xl=Jf,Ny=Vy;Xl.murmur3=Jf,Xl.murmur2=Ny;class Rh{constructor(){this.ids=[],this.positions=[],this.indexed=!1}add(e,r,n,a){this.ids.push(Qf(e)),this.positions.push(r,n,a)}getPositions(e){let r=Qf(e),n=0,a=this.ids.length-1;for(;n<a;){let d=n+a>>1;this.ids[d]>=r?a=d:n=d+1}let h=[];for(;this.ids[n]===r;)h.push({index:this.positions[3*n],start:this.positions[3*n+1],end:this.positions[3*n+2]}),n++;return h}static serialize(e,r){let n=new Float64Array(e.ids),a=new Uint32Array(e.positions);return Ep(n,a,0,n.length-1),r&&r.push(n.buffer,a.buffer),{ids:n,positions:a}}static deserialize(e){let r=new Rh;return r.ids=e.ids,r.positions=e.positions,r.indexed=!0,r}}function Qf(i){let e=+i;return!isNaN(e)&&Number.MIN_SAFE_INTEGER<=e&&e<=Number.MAX_SAFE_INTEGER?e:Xl(String(i))}function Ep(i,e,r,n){for(;r<n;){let a=i[r+n>>1],h=r-1,d=n+1;for(;;){do h++;while(i[h]<a);do d--;while(i[d]>a);if(h>=d)break;Fh(i,h,d),Fh(e,3*h,3*d),Fh(e,3*h+1,3*d+1),Fh(e,3*h+2,3*d+2)}d-r<n-d?(Ep(i,e,r,d),r=d+1):(Ep(i,e,d+1,n),n=d)}}function Fh(i,e,r){let n=i[e];i[e]=i[r],i[r]=n}He(Rh,"FeaturePositionMap");class $n{constructor(e,r){this.gl=e.gl,this.location=r}}class Oh extends $n{constructor(e,r){super(e,r),this.current=0}set(e){this.current!==e&&(this.current=e,this.gl.uniform1f(this.location,e))}}class em extends $n{constructor(e,r){super(e,r),this.current=[0,0,0,0]}set(e){e[0]===this.current[0]&&e[1]===this.current[1]&&e[2]===this.current[2]&&e[3]===this.current[3]||(this.current=e,this.gl.uniform4f(this.location,e[0],e[1],e[2],e[3]))}}class tm extends $n{constructor(e,r){super(e,r),this.current=hi.transparent}set(e){e.r===this.current.r&&e.g===this.current.g&&e.b===this.current.b&&e.a===this.current.a||(this.current=e,this.gl.uniform4f(this.location,e.r,e.g,e.b,e.a))}}let Gy=new Float32Array(16),$y=new Float32Array(9),qy=new Float32Array(4);function Tp(i){return[tt(255*i.r,255*i.g),tt(255*i.b,255*i.a)]}class Kl{constructor(e,r,n){this.value=e,this.uniformNames=r.map(a=>`u_${a}`),this.type=n}setUniform(e,r,n){e.set(n.constantOr(this.value))}getBinding(e,r,n){return this.type==="color"?new tm(e,r):new Oh(e,r)}}class Va{constructor(e,r){this.uniformNames=r.map(n=>`u_${n}`),this.patternFrom=null,this.patternTo=null,this.pixelRatioFrom=1,this.pixelRatioTo=1}setConstantPatternPositions(e,r){this.pixelRatioFrom=r.pixelRatio||1,this.pixelRatioTo=e.pixelRatio||1,this.patternFrom=r.tl.concat(r.br),this.patternTo=e.tl.concat(e.br)}setUniform(e,r,n,a){let h=a==="u_pattern_to"||a==="u_dash_to"?this.patternTo:a==="u_pattern_from"||a==="u_dash_from"?this.patternFrom:a==="u_pixel_ratio_to"?this.pixelRatioTo:a==="u_pixel_ratio_from"?this.pixelRatioFrom:null;h&&e.set(h)}getBinding(e,r,n){return n==="u_pattern_from"||n==="u_pattern_to"||n==="u_dash_from"||n==="u_dash_to"?new em(e,r):new Oh(e,r)}}class qn{constructor(e,r,n,a){this.expression=e,this.type=n,this.maxValue=0,this.paintVertexAttributes=r.map(h=>({name:`a_${h}`,type:"Float32",components:n==="color"?2:1,offset:0})),this.paintVertexArray=new a}populatePaintArray(e,r,n,a,h,d){let m=this.paintVertexArray.length,y=this.expression.evaluate(new $(0),r,{},h,a,d);this.paintVertexArray.resize(e),this._setPaintValue(m,e,y)}updatePaintArray(e,r,n,a,h){let d=this.expression.evaluate({zoom:0},n,a,void 0,h);this._setPaintValue(e,r,d)}_setPaintValue(e,r,n){if(this.type==="color"){let a=Tp(n);for(let h=e;h<r;h++)this.paintVertexArray.emplace(h,a[0],a[1])}else{for(let a=e;a<r;a++)this.paintVertexArray.emplace(a,n);this.maxValue=Math.max(this.maxValue,Math.abs(n))}}upload(e){this.paintVertexArray&&this.paintVertexArray.arrayBuffer&&(this.paintVertexBuffer&&this.paintVertexBuffer.buffer?this.paintVertexBuffer.updateData(this.paintVertexArray):this.paintVertexBuffer=e.createVertexBuffer(this.paintVertexArray,this.paintVertexAttributes,this.expression.isStateDependent))}destroy(){this.paintVertexBuffer&&this.paintVertexBuffer.destroy()}}class cn{constructor(e,r,n,a,h,d){this.expression=e,this.uniformNames=r.map(m=>`u_${m}_t`),this.type=n,this.useIntegerZoom=a,this.zoom=h,this.maxValue=0,this.paintVertexAttributes=r.map(m=>({name:`a_${m}`,type:"Float32",components:n==="color"?4:2,offset:0})),this.paintVertexArray=new d}populatePaintArray(e,r,n,a,h,d){let m=this.expression.evaluate(new $(this.zoom),r,{},h,a,d),y=this.expression.evaluate(new $(this.zoom+1),r,{},h,a,d),x=this.paintVertexArray.length;this.paintVertexArray.resize(e),this._setPaintValue(x,e,m,y)}updatePaintArray(e,r,n,a,h){let d=this.expression.evaluate({zoom:this.zoom},n,a,void 0,h),m=this.expression.evaluate({zoom:this.zoom+1},n,a,void 0,h);this._setPaintValue(e,r,d,m)}_setPaintValue(e,r,n,a){if(this.type==="color"){let h=Tp(n),d=Tp(a);for(let m=e;m<r;m++)this.paintVertexArray.emplace(m,h[0],h[1],d[0],d[1])}else{for(let h=e;h<r;h++)this.paintVertexArray.emplace(h,n,a);this.maxValue=Math.max(this.maxValue,Math.abs(n),Math.abs(a))}}upload(e){this.paintVertexArray&&this.paintVertexArray.arrayBuffer&&(this.paintVertexBuffer&&this.paintVertexBuffer.buffer?this.paintVertexBuffer.updateData(this.paintVertexArray):this.paintVertexBuffer=e.createVertexBuffer(this.paintVertexArray,this.paintVertexAttributes,this.expression.isStateDependent))}destroy(){this.paintVertexBuffer&&this.paintVertexBuffer.destroy()}setUniform(e,r){let n=this.useIntegerZoom?Math.floor(r.zoom):r.zoom,a=Je(this.expression.interpolationFactor(n,this.zoom,this.zoom+1),0,1);e.set(a)}getBinding(e,r,n){return new Oh(e,r)}}class ko{constructor(e,r,n,a,h,d,m){this.expression=e,this.type=n,this.useIntegerZoom=a,this.zoom=h,this.layerId=m,this.paintVertexAttributes=(n==="array"?Uy:jy).members;for(let y=0;y<r.length;++y);this.zoomInPaintVertexArray=new d,this.zoomOutPaintVertexArray=new d}populatePaintArray(e,r,n){let a=this.zoomInPaintVertexArray.length;this.zoomInPaintVertexArray.resize(e),this.zoomOutPaintVertexArray.resize(e),this._setPaintValues(a,e,r.patterns&&r.patterns[this.layerId],n)}updatePaintArray(e,r,n,a,h,d){this._setPaintValues(e,r,n.patterns&&n.patterns[this.layerId],d)}_setPaintValues(e,r,n,a){if(!a||!n)return;let{min:h,mid:d,max:m}=n,y=a[h],x=a[d],E=a[m];if(y&&x&&E)for(let k=e;k<r;k++)this._setPaintValue(this.zoomInPaintVertexArray,k,x,y),this._setPaintValue(this.zoomOutPaintVertexArray,k,x,E)}_setPaintValue(e,r,n,a){e.emplace(r,n.tl[0],n.tl[1],n.br[0],n.br[1],a.tl[0],a.tl[1],a.br[0],a.br[1],n.pixelRatio,a.pixelRatio)}upload(e){this.zoomInPaintVertexArray&&this.zoomInPaintVertexArray.arrayBuffer&&this.zoomOutPaintVertexArray&&this.zoomOutPaintVertexArray.arrayBuffer&&(this.zoomInPaintVertexBuffer=e.createVertexBuffer(this.zoomInPaintVertexArray,this.paintVertexAttributes,this.expression.isStateDependent),this.zoomOutPaintVertexBuffer=e.createVertexBuffer(this.zoomOutPaintVertexArray,this.paintVertexAttributes,this.expression.isStateDependent))}destroy(){this.zoomOutPaintVertexBuffer&&this.zoomOutPaintVertexBuffer.destroy(),this.zoomInPaintVertexBuffer&&this.zoomInPaintVertexBuffer.destroy()}}class So{constructor(e,r,n=()=>!0){this.binders={},this._buffers=[];let a=[];for(let h in e.paint._values){if(!n(h))continue;let d=e.paint.get(h);if(!(d instanceof be&&yo(d.property.specification)))continue;let m=Wy(h,e.type),y=d.value,x=d.property.specification.type,E=d.property.useIntegerZoom,k=d.property.specification["property-type"],S=k==="cross-faded"||k==="cross-faded-data-driven",M=String(h)==="line-dasharray"&&e.layout.get("line-cap").value.kind!=="constant";if(y.kind!=="constant"||M)if(y.kind==="source"||M||S){let P=im(h,x,"source");this.binders[h]=S?new ko(y,m,x,E,r,P,e.id):new qn(y,m,x,P),a.push(`/a_${h}`)}else{let P=im(h,x,"composite");this.binders[h]=new cn(y,m,x,E,r,P),a.push(`/z_${h}`)}else this.binders[h]=S?new Va(y.value,m):new Kl(y.value,m,x),a.push(`/u_${h}`)}this.cacheKey=a.sort().join("")}getMaxValue(e){let r=this.binders[e];return r instanceof qn||r instanceof cn?r.maxValue:0}populatePaintArrays(e,r,n,a,h,d){for(let m in this.binders){let y=this.binders[m];(y instanceof qn||y instanceof cn||y instanceof ko)&&y.populatePaintArray(e,r,n,a,h,d)}}setConstantPatternPositions(e,r){for(let n in this.binders){let a=this.binders[n];a instanceof Va&&a.setConstantPatternPositions(e,r)}}updatePaintArrays(e,r,n,a,h,d){let m=!1;for(let y in e){let x=r.getPositions(y);for(let E of x){let k=n.feature(E.index);for(let S in this.binders){let M=this.binders[S];if((M instanceof qn||M instanceof cn||M instanceof ko)&&M.expression.isStateDependent===!0){let P=a.paint.get(S);M.expression=P.value,M.updatePaintArray(E.start,E.end,k,e[y],h,d),m=!0}}}}return m}defines(){let e=[];for(let r in this.binders){let n=this.binders[r];(n instanceof Kl||n instanceof Va)&&e.push(...n.uniformNames.map(a=>`#define HAS_UNIFORM_${a}`))}return e}getBinderAttributes(){let e=[];for(let r in this.binders){let n=this.binders[r];if(n instanceof qn||n instanceof cn||n instanceof ko)for(let a=0;a<n.paintVertexAttributes.length;a++)e.push(n.paintVertexAttributes[a].name)}return e}getBinderUniforms(){let e=[];for(let r in this.binders){let n=this.binders[r];if(n instanceof Kl||n instanceof Va||n instanceof cn)for(let a of n.uniformNames)e.push(a)}return e}getPaintVertexBuffers(){return this._buffers}getUniforms(e,r){let n=[];for(let a in this.binders){let h=this.binders[a];if(h instanceof Kl||h instanceof Va||h instanceof cn){for(let d of h.uniformNames)if(r[d]){let m=h.getBinding(e,r[d],d);n.push({name:d,property:a,binding:m})}}}return n}setUniforms(e,r,n,a){for(let{name:h,property:d,binding:m}of r)this.binders[d].setUniform(m,a,n.get(d),h)}updatePaintBuffers(e){this._buffers=[];for(let r in this.binders){let n=this.binders[r];if(e&&n instanceof ko){let a=e.fromScale===2?n.zoomInPaintVertexBuffer:n.zoomOutPaintVertexBuffer;a&&this._buffers.push(a)}else(n instanceof qn||n instanceof cn)&&n.paintVertexBuffer&&this._buffers.push(n.paintVertexBuffer)}}upload(e){for(let r in this.binders){let n=this.binders[r];(n instanceof qn||n instanceof cn||n instanceof ko)&&n.upload(e)}this.updatePaintBuffers()}destroy(){for(let e in this.binders){let r=this.binders[e];(r instanceof qn||r instanceof cn||r instanceof ko)&&r.destroy()}}}class Es{constructor(e,r,n=()=>!0){this.programConfigurations={};for(let a of e)this.programConfigurations[a.id]=new So(a,r,n);this.needsUpload=!1,this._featureMap=new Rh,this._bufferOffset=0}populatePaintArrays(e,r,n,a,h,d,m){for(let y in this.programConfigurations)this.programConfigurations[y].populatePaintArrays(e,r,a,h,d,m);r.id!==void 0&&this._featureMap.add(r.id,n,this._bufferOffset,e),this._bufferOffset=e,this.needsUpload=!0}updatePaintArrays(e,r,n,a,h){for(let d of n)this.needsUpload=this.programConfigurations[d.id].updatePaintArrays(e,this._featureMap,r,d,a,h)||this.needsUpload}get(e){return this.programConfigurations[e]}upload(e){if(this.needsUpload){for(let r in this.programConfigurations)this.programConfigurations[r].upload(e);this.needsUpload=!1}}destroy(){for(let e in this.programConfigurations)this.programConfigurations[e].destroy()}}let Zy={"text-opacity":["opacity"],"icon-opacity":["opacity"],"text-color":["fill_color"],"icon-color":["fill_color"],"text-halo-color":["halo_color"],"icon-halo-color":["halo_color"],"text-halo-blur":["halo_blur"],"icon-halo-blur":["halo_blur"],"text-halo-width":["halo_width"],"icon-halo-width":["halo_width"],"line-gap-width":["gapwidth"],"line-pattern":["pattern_to","pattern_from","pixel_ratio_to","pixel_ratio_from"],"fill-pattern":["pattern_to","pattern_from","pixel_ratio_to","pixel_ratio_from"],"fill-extrusion-pattern":["pattern_to","pattern_from","pixel_ratio_to","pixel_ratio_from"],"line-dasharray":["dash_to","dash_from"]};function Wy(i,e){return Zy[i]||[i.replace(`${e}-`,"").replace(/-/g,"_")]}let Hy={"line-pattern":{source:Gt,composite:Gt},"fill-pattern":{source:Gt,composite:Gt},"fill-extrusion-pattern":{source:Gt,composite:Gt},"line-dasharray":{source:di,composite:di}},Xy={color:{source:ln,composite:Ot},number:{source:Mr,composite:ln}};function im(i,e,r){let n=Hy[i];return n&&n[r]||Xy[e][r]}He(Kl,"ConstantBinder"),He(Va,"CrossFadedConstantBinder"),He(qn,"SourceExpressionBinder"),He(ko,"CrossFadedCompositeBinder"),He(cn,"CompositeExpressionBinder"),He(So,"ProgramConfiguration",{omit:["_buffers"]}),He(Es,"ProgramConfigurationSet");let jh="-transition";class hn extends Vt{constructor(e,r){if(super(),this.id=e.id,this.type=e.type,this._featureFilter={filter:()=>!0,needGeometry:!1,needFeature:!1},this._filterCompiled=!1,e.type!=="custom"&&(this.metadata=(e=e).metadata,this.minzoom=e.minzoom,this.maxzoom=e.maxzoom,e.type!=="background"&&e.type!=="sky"&&(this.source=e.source,this.sourceLayer=e["source-layer"],this.filter=e.filter),r.layout&&(this._unevaluatedLayout=new ye(r.layout)),r.paint)){this._transitionablePaint=new K(r.paint);for(let n in e.paint)this.setPaintProperty(n,e.paint[n],{validate:!1});for(let n in e.layout)this.setLayoutProperty(n,e.layout[n],{validate:!1});this._transitioningPaint=this._transitionablePaint.untransitioned(),this.paint=new xe(r.paint)}}getCrossfadeParameters(){return this._crossfadeParameters}getLayoutProperty(e){return e==="visibility"?this.visibility:this._unevaluatedLayout.getValue(e)}setLayoutProperty(e,r,n={}){r!=null&&this._validate(bp,`layers.${this.id}.layout.${e}`,e,r,n)||(e!=="visibility"?this._unevaluatedLayout.setValue(e,r):this.visibility=r)}getPaintProperty(e){return cr(e,jh)?this._transitionablePaint.getTransition(e.slice(0,-jh.length)):this._transitionablePaint.getValue(e)}setPaintProperty(e,r,n={}){if(r!=null&&this._validate(wh,`layers.${this.id}.paint.${e}`,e,r,n))return!1;if(cr(e,jh))return this._transitionablePaint.setTransition(e.slice(0,-jh.length),r||void 0),!1;{let a=this._transitionablePaint._values[e],h=a.property.specification["property-type"]==="cross-faded-data-driven",d=a.value.isDataDriven(),m=a.value;this._transitionablePaint.setValue(e,r),this._handleSpecialPaintPropertyUpdate(e);let y=this._transitionablePaint._values[e].value;return y.isDataDriven()||d||h||this._handleOverridablePaintPropertyUpdate(e,m,y)}}_handleSpecialPaintPropertyUpdate(e){}getProgramIds(){return null}getProgramConfiguration(e){return null}_handleOverridablePaintPropertyUpdate(e,r,n){return!1}isHidden(e){return!!(this.minzoom&&e<this.minzoom)||!!(this.maxzoom&&e>=this.maxzoom)||this.visibility==="none"}updateTransitions(e){this._transitioningPaint=this._transitionablePaint.transitioned(e,this._transitioningPaint)}hasTransition(){return this._transitioningPaint.hasTransition()}recalculate(e,r){e.getCrossfadeParameters&&(this._crossfadeParameters=e.getCrossfadeParameters()),this._unevaluatedLayout&&(this.layout=this._unevaluatedLayout.possiblyEvaluate(e,void 0,r)),this.paint=this._transitioningPaint.possiblyEvaluate(e,void 0,r)}serialize(){let e={id:this.id,type:this.type,source:this.source,"source-layer":this.sourceLayer,metadata:this.metadata,minzoom:this.minzoom,maxzoom:this.maxzoom,filter:this.filter,layout:this._unevaluatedLayout&&this._unevaluatedLayout.serialize(),paint:this._transitionablePaint&&this._transitionablePaint.serialize()};return this.visibility&&(e.layout=e.layout||{},e.layout.visibility=this.visibility),Si(e,(r,n)=>!(r===void 0||n==="layout"&&!Object.keys(r).length||n==="paint"&&!Object.keys(r).length))}_validate(e,r,n,a,h={}){return(!h||h.validate!==!1)&&Eh(this,e.call(bh,{key:r,layerType:this.type,objectKey:n,value:a,styleSpec:de,style:{glyphs:!0,sprite:!0}}))}is3D(){return!1}isSky(){return!1}isTileClipped(){return!1}hasOffscreenPass(){return!1}resize(){}isStateDependent(){for(let e in this.paint._values){let r=this.paint.get(e);if(r instanceof be&&yo(r.property.specification)&&(r.value.kind==="source"||r.value.kind==="composite")&&r.value.isStateDependent)return!0}return!1}compileFilter(){this._filterCompiled||(this._featureFilter=Vn(this.filter),this._filterCompiled=!0)}invalidateCompiledFilter(){this._filterCompiled=!1}dynamicFilter(){return this._featureFilter.dynamicFilter}dynamicFilterNeedsFeature(){return this._featureFilter.needFeature}}let Ky=Oe([{name:"a_pos",components:2,type:"Int16"}],4),Yy=Oe([{name:"a_pos_3",components:3,type:"Int16"},{name:"a_pos_normal_3",components:3,type:"Int16"}]);class fi{constructor(e=[]){this.segments=e}prepareSegment(e,r,n,a){let h=this.segments[this.segments.length-1];return e>fi.MAX_VERTEX_ARRAY_LENGTH&&ci(`Max vertices per segment is ${fi.MAX_VERTEX_ARRAY_LENGTH}: bucket requested ${e}`),(!h||h.vertexLength+e>fi.MAX_VERTEX_ARRAY_LENGTH||h.sortKey!==a)&&(h={vertexOffset:r.length,primitiveOffset:n.length,vertexLength:0,primitiveLength:0},a!==void 0&&(h.sortKey=a),this.segments.push(h)),h}get(){return this.segments}destroy(){for(let e of this.segments)for(let r in e.vaos)e.vaos[r].destroy()}static simpleSegment(e,r,n,a){return new fi([{vertexOffset:e,primitiveOffset:r,vertexLength:n,primitiveLength:a,vaos:{},sortKey:0}])}}fi.MAX_VERTEX_ARRAY_LENGTH=Math.pow(2,16)-1,He(fi,"SegmentVector");var lt=8192;class Ao{constructor(e,r){e&&(r?this.setSouthWest(e).setNorthEast(r):e.length===4?this.setSouthWest([e[0],e[1]]).setNorthEast([e[2],e[3]]):this.setSouthWest(e[0]).setNorthEast(e[1]))}setNorthEast(e){return this._ne=e instanceof $t?new $t(e.lng,e.lat):$t.convert(e),this}setSouthWest(e){return this._sw=e instanceof $t?new $t(e.lng,e.lat):$t.convert(e),this}extend(e){let r=this._sw,n=this._ne,a,h;if(e instanceof $t)a=e,h=e;else{if(!(e instanceof Ao))return Array.isArray(e)?e.length===4||e.every(Array.isArray)?this.extend(Ao.convert(e)):this.extend($t.convert(e)):this;if(a=e._sw,h=e._ne,!a||!h)return this}return r||n?(r.lng=Math.min(a.lng,r.lng),r.lat=Math.min(a.lat,r.lat),n.lng=Math.max(h.lng,n.lng),n.lat=Math.max(h.lat,n.lat)):(this._sw=new $t(a.lng,a.lat),this._ne=new $t(h.lng,h.lat)),this}getCenter(){return new $t((this._sw.lng+this._ne.lng)/2,(this._sw.lat+this._ne.lat)/2)}getSouthWest(){return this._sw}getNorthEast(){return this._ne}getNorthWest(){return new $t(this.getWest(),this.getNorth())}getSouthEast(){return new $t(this.getEast(),this.getSouth())}getWest(){return this._sw.lng}getSouth(){return this._sw.lat}getEast(){return this._ne.lng}getNorth(){return this._ne.lat}toArray(){return[this._sw.toArray(),this._ne.toArray()]}toString(){return`LngLatBounds(${this._sw.toString()}, ${this._ne.toString()})`}isEmpty(){return!(this._sw&&this._ne)}contains(e){let{lng:r,lat:n}=$t.convert(e),a=this._sw.lng<=r&&r<=this._ne.lng;return this._sw.lng>this._ne.lng&&(a=this._sw.lng>=r&&r>=this._ne.lng),this._sw.lat<=n&&n<=this._ne.lat&&a}static convert(e){return!e||e instanceof Ao?e:new Ao(e)}}let Cp=63710088e-1;class $t{constructor(e,r){if(isNaN(e)||isNaN(r))throw new Error(`Invalid LngLat object: (${e}, ${r})`);if(this.lng=+e,this.lat=+r,this.lat>90||this.lat<-90)throw new Error("Invalid LngLat latitude value: must be between -90 and 90")}wrap(){return new $t(It(this.lng,-180,180),this.lat)}toArray(){return[this.lng,this.lat]}toString(){return`LngLat(${this.lng}, ${this.lat})`}distanceTo(e){let r=Math.PI/180,n=this.lat*r,a=e.lat*r,h=Math.sin(n)*Math.sin(a)+Math.cos(n)*Math.cos(a)*Math.cos((e.lng-this.lng)*r);return Cp*Math.acos(Math.min(h,1))}toBounds(e=0){let r=360*e/40075017,n=r/Math.cos(Math.PI/180*this.lat);return new Ao(new $t(this.lng-n,this.lat-r),new $t(this.lng+n,this.lat+r))}static convert(e){if(e instanceof $t)return e;if(Array.isArray(e)&&(e.length===2||e.length===3))return new $t(Number(e[0]),Number(e[1]));if(!Array.isArray(e)&&typeof e=="object"&&e!==null)return new $t(Number("lng"in e?e.lng:e.lon),Number(e.lat));throw new Error("`LngLatLike` argument must be specified as a LngLat instance, an object {lng: <lng>, lat: <lat>}, an object {lon: <lng>, lat: <lat>}, or an array of [<lng>, <lat>]")}}let rm=2*Math.PI*Cp;function kp(i){return rm*Math.cos(i*Math.PI/180)}function Ts(i){return(180+i)/360}function Cs(i){return(180-180/Math.PI*Math.log(Math.tan(Math.PI/4+i*Math.PI/360)))/360}function Vr(i,e){return i/kp(e)}function Zi(i){return 360*i-180}function wi(i){return 360/Math.PI*Math.atan(Math.exp((180-360*i)*Math.PI/180))-90}function nm(i,e){return i*kp(wi(e))}let yn=85.051129;class Na{constructor(e,r,n=0){this.x=+e,this.y=+r,this.z=+n}static fromLngLat(e,r=0){let n=$t.convert(e);return new Na(Ts(n.lng),Cs(n.lat),Vr(r,n.lat))}toLngLat(){return new $t(Zi(this.x),wi(this.y))}toAltitude(){return nm(this.z,this.y)}meterInMercatorCoordinateUnits(){return 1/rm*(e=wi(this.y),1/Math.cos(e*Math.PI/180));var e}}function Sp(i,e,r,n,a,h,d,m,y){let x=(e+n)/2,E=(r+a)/2,k=new Y(x,E);m(k),function(S,M,P,F,G,X){let ne=P-G,re=F-X;return Math.abs((F-M)*ne-(P-S)*re)/Math.hypot(ne,re)}(k.x,k.y,h.x,h.y,d.x,d.y)>=y?(Sp(i,e,r,x,E,h,k,m,y),Sp(i,x,E,n,a,k,d,m,y)):i.push(d)}function om(i,e,r){let n=i[0],a=n.x,h=n.y;e(n);let d=[n];for(let m=1;m<i.length;m++){let y=i[m],{x,y:E}=y;e(y),Sp(d,a,h,x,E,n,y,e,r),a=x,h=E,n=y}return d}function Ap(i,e,r,n,a){if(a(e,r)){let h=e.add(r).mult(.5);n(h),Ap(i,e,h,n,a),Ap(i,h,r,n,a)}else i.push(r)}function Jy(i,e,r){let n=i[0];e(n);let a=[n];for(let h=1;h<i.length;h++){let d=i[h];e(d),Ap(a,n,d,e,r),n=d}return a}let Mp=Math.pow(2,14)-1,sm=-Mp-1;function Qy(i,e){let r=Math.round(i.x*e),n=Math.round(i.y*e);return i.x=Je(r,sm,Mp),i.y=Je(n,sm,Mp),(r<i.x||r>i.x+1||n<i.y||n>i.y+1)&&ci("Geometry exceeds allowed extent, reduce your vector tile buffer size"),i}function Zn(i,e,r){let n=i.loadGeometry(),a=i.extent,h=lt/a;if(e&&r&&r.projection.isReprojectedInTileSpace){let d=1<<e.z,{scale:m,x:y,y:x,projection:E}=r,k=S=>{let M=Zi((e.x+S.x/a)/d),P=wi((e.y+S.y/a)/d),F=E.project(M,P);S.x=(F.x*m-y)*a,S.y=(F.y*m-x)*a};for(let S=0;S<n.length;S++)if(i.type!==1)n[S]=om(n[S],k,1);else{let M=[];for(let P of n[S])P.x<0||P.x>=a||P.y<0||P.y>=a||(k(P),M.push(P));n[S]=M}}for(let d of n)for(let m of d)Qy(m,h);return n}function ks(i,e){return{type:i.type,id:i.id,properties:i.properties,geometry:e?Zn(i):[]}}function Uh(i,e,r,n,a){i.emplaceBack(2*e+(n+1)/2,2*r+(a+1)/2)}function Vh(i,e,r){i.emplaceBack(e.x,e.y,e.z,r[0]*16384,r[1]*16384,r[2]*16384)}class Ip{constructor(e){this.zoom=e.zoom,this.overscaling=e.overscaling,this.layers=e.layers,this.layerIds=this.layers.map(r=>r.id),this.index=e.index,this.hasPattern=!1,this.projection=e.projection,this.layoutVertexArray=new rt,this.indexArray=new Mt,this.segments=new fi,this.programConfigurations=new Es(e.layers,e.zoom),this.stateDependentLayerIds=this.layers.filter(r=>r.isStateDependent()).map(r=>r.id)}populate(e,r,n,a){let h=this.layers[0],d=[],m=null;h.type==="circle"&&(m=h.layout.get("circle-sort-key"));for(let{feature:x,id:E,index:k,sourceLayerIndex:S}of e){let M=this.layers[0]._featureFilter.needGeometry,P=ks(x,M);if(!this.layers[0]._featureFilter.filter(new $(this.zoom),P,n))continue;let F=m?m.evaluate(P,{},n):void 0,G={id:E,properties:x.properties,type:x.type,sourceLayerIndex:S,index:k,geometry:M?P.geometry:Zn(x,n,a),patterns:{},sortKey:F};d.push(G)}m&&d.sort((x,E)=>x.sortKey-E.sortKey);let y=null;a.projection.name==="globe"&&(this.globeExtVertexArray=new Yf,y=a.projection);for(let x of d){let{geometry:E,index:k,sourceLayerIndex:S}=x,M=e[k].feature;this.addFeature(x,E,k,r.availableImages,n,y),r.featureIndex.insert(M,E,k,S,this.index)}}update(e,r,n,a){this.stateDependentLayers.length&&this.programConfigurations.updatePaintArrays(e,r,this.stateDependentLayers,n,a)}isEmpty(){return this.layoutVertexArray.length===0}uploadPending(){return!this.uploaded||this.programConfigurations.needsUpload}upload(e){this.uploaded||(this.layoutVertexBuffer=e.createVertexBuffer(this.layoutVertexArray,Ky.members),this.indexBuffer=e.createIndexBuffer(this.indexArray),this.globeExtVertexArray&&(this.globeExtVertexBuffer=e.createVertexBuffer(this.globeExtVertexArray,Yy.members))),this.programConfigurations.upload(e),this.uploaded=!0}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.programConfigurations.destroy(),this.segments.destroy(),this.globeExtVertexBuffer&&this.globeExtVertexBuffer.destroy())}addFeature(e,r,n,a,h,d){for(let m of r)for(let y of m){let x=y.x,E=y.y;if(x<0||x>=lt||E<0||E>=lt)continue;if(d){let M=d.projectTilePoint(x,E,h),P=d.upVector(h,x,E),F=this.globeExtVertexArray;Vh(F,M,P),Vh(F,M,P),Vh(F,M,P),Vh(F,M,P)}let k=this.segments.prepareSegment(4,this.layoutVertexArray,this.indexArray,e.sortKey),S=k.vertexLength;Uh(this.layoutVertexArray,x,E,-1,-1),Uh(this.layoutVertexArray,x,E,1,-1),Uh(this.layoutVertexArray,x,E,1,1),Uh(this.layoutVertexArray,x,E,-1,1),this.indexArray.emplaceBack(S,S+1,S+2),this.indexArray.emplaceBack(S,S+2,S+3),k.vertexLength+=4,k.primitiveLength+=2}this.programConfigurations.populatePaintArrays(this.layoutVertexArray.length,e,n,{},a,h)}}function am(i,e){for(let r=0;r<i.length;r++)if(Ss(e,i[r]))return!0;for(let r=0;r<e.length;r++)if(Ss(i,e[r]))return!0;return!!zp(i,e)}function e0(i,e,r){return!!Ss(i,e)||!!Pp(e,i,r)}function lm(i,e){if(i.length===1)return hm(e,i[0]);for(let r=0;r<e.length;r++){let n=e[r];for(let a=0;a<n.length;a++)if(Ss(i,n[a]))return!0}for(let r=0;r<i.length;r++)if(hm(e,i[r]))return!0;for(let r=0;r<e.length;r++)if(zp(i,e[r]))return!0;return!1}function t0(i,e,r){if(i.length>1){if(zp(i,e))return!0;for(let n=0;n<e.length;n++)if(Pp(e[n],i,r))return!0}for(let n=0;n<i.length;n++)if(Pp(i[n],e,r))return!0;return!1}function zp(i,e){if(i.length===0||e.length===0)return!1;for(let r=0;r<i.length-1;r++){let n=i[r],a=i[r+1];for(let h=0;h<e.length-1;h++)if(i0(n,a,e[h],e[h+1]))return!0}return!1}function i0(i,e,r,n){return Fi(i,r,n)!==Fi(e,r,n)&&Fi(i,e,r)!==Fi(i,e,n)}function Pp(i,e,r){let n=r*r;if(e.length===1)return i.distSqr(e[0])<n;for(let a=1;a<e.length;a++)if(cm(i,e[a-1],e[a])<n)return!0;return!1}function cm(i,e,r){let n=e.distSqr(r);if(n===0)return i.distSqr(e);let a=((i.x-e.x)*(r.x-e.x)+(i.y-e.y)*(r.y-e.y))/n;return i.distSqr(a<0?e:a>1?r:r.sub(e)._mult(a)._add(e))}function hm(i,e){let r,n,a,h=!1;for(let d=0;d<i.length;d++){r=i[d];for(let m=0,y=r.length-1;m<r.length;y=m++)n=r[m],a=r[y],n.y>e.y!=a.y>e.y&&e.x<(a.x-n.x)*(e.y-n.y)/(a.y-n.y)+n.x&&(h=!h)}return h}function Ss(i,e){let r=!1;for(let n=0,a=i.length-1;n<i.length;a=n++){let h=i[n],d=i[a];h.y>e.y!=d.y>e.y&&e.x<(d.x-h.x)*(e.y-h.y)/(d.y-h.y)+h.x&&(r=!r)}return r}function um(i,e,r,n,a){for(let d of i)if(e<=d.x&&r<=d.y&&n>=d.x&&a>=d.y)return!0;let h=[new Y(e,r),new Y(e,a),new Y(n,a),new Y(n,r)];if(i.length>2){for(let d of h)if(Ss(i,d))return!0}for(let d=0;d<i.length-1;d++)if(r0(i[d],i[d+1],h))return!0;return!1}function r0(i,e,r){let n=r[0],a=r[2];if(i.x<n.x&&e.x<n.x||i.x>a.x&&e.x>a.x||i.y<n.y&&e.y<n.y||i.y>a.y&&e.y>a.y)return!1;let h=Fi(i,e,r[0]);return h!==Fi(i,e,r[1])||h!==Fi(i,e,r[2])||h!==Fi(i,e,r[3])}function Ga(i,e,r){let n=e.paint.get(i).value;return n.kind==="constant"?n.value:r.programConfigurations.get(e.id).getMaxValue(i)}function Nh(i){return Math.sqrt(i[0]*i[0]+i[1]*i[1])}function pm(i,e,r,n,a){if(!e[0]&&!e[1])return i;let h=Y.convert(e)._mult(a);r==="viewport"&&h._rotate(-n);let d=[];for(let m=0;m<i.length;m++)d.push(i[m].sub(h));return d}function dm(i,e,r,n){let a=Y.convert(i)._mult(n);return e==="viewport"&&a._rotate(-r),a}He(Ip,"CircleBucket",{omit:["layers"]});let n0=new Te({"circle-sort-key":new te(de.layout_circle["circle-sort-key"])});var o0={paint:new Te({"circle-radius":new te(de.paint_circle["circle-radius"]),"circle-color":new te(de.paint_circle["circle-color"]),"circle-blur":new te(de.paint_circle["circle-blur"]),"circle-opacity":new te(de.paint_circle["circle-opacity"]),"circle-translate":new _e(de.paint_circle["circle-translate"]),"circle-translate-anchor":new _e(de.paint_circle["circle-translate-anchor"]),"circle-pitch-scale":new _e(de.paint_circle["circle-pitch-scale"]),"circle-pitch-alignment":new _e(de.paint_circle["circle-pitch-alignment"]),"circle-stroke-width":new te(de.paint_circle["circle-stroke-width"]),"circle-stroke-color":new te(de.paint_circle["circle-stroke-color"]),"circle-stroke-opacity":new te(de.paint_circle["circle-stroke-opacity"])}),layout:n0},Gh=1e-6,yr=typeof Float32Array<"u"?Float32Array:Array;function fm(){var i=new yr(9);return yr!=Float32Array&&(i[1]=0,i[2]=0,i[3]=0,i[5]=0,i[6]=0,i[7]=0),i[0]=1,i[4]=1,i[8]=1,i}function xr(i){return i[0]=1,i[1]=0,i[2]=0,i[3]=0,i[4]=0,i[5]=1,i[6]=0,i[7]=0,i[8]=0,i[9]=0,i[10]=1,i[11]=0,i[12]=0,i[13]=0,i[14]=0,i[15]=1,i}function Mo(i,e,r){var n=e[0],a=e[1],h=e[2],d=e[3],m=e[4],y=e[5],x=e[6],E=e[7],k=e[8],S=e[9],M=e[10],P=e[11],F=e[12],G=e[13],X=e[14],ne=e[15],re=r[0],se=r[1],ce=r[2],ue=r[3];return i[0]=re*n+se*m+ce*k+ue*F,i[1]=re*a+se*y+ce*S+ue*G,i[2]=re*h+se*x+ce*M+ue*X,i[3]=re*d+se*E+ce*P+ue*ne,i[4]=(re=r[4])*n+(se=r[5])*m+(ce=r[6])*k+(ue=r[7])*F,i[5]=re*a+se*y+ce*S+ue*G,i[6]=re*h+se*x+ce*M+ue*X,i[7]=re*d+se*E+ce*P+ue*ne,i[8]=(re=r[8])*n+(se=r[9])*m+(ce=r[10])*k+(ue=r[11])*F,i[9]=re*a+se*y+ce*S+ue*G,i[10]=re*h+se*x+ce*M+ue*X,i[11]=re*d+se*E+ce*P+ue*ne,i[12]=(re=r[12])*n+(se=r[13])*m+(ce=r[14])*k+(ue=r[15])*F,i[13]=re*a+se*y+ce*S+ue*G,i[14]=re*h+se*x+ce*M+ue*X,i[15]=re*d+se*E+ce*P+ue*ne,i}function As(i,e,r){var n,a,h,d,m,y,x,E,k,S,M,P,F=r[0],G=r[1],X=r[2];return e===i?(i[12]=e[0]*F+e[4]*G+e[8]*X+e[12],i[13]=e[1]*F+e[5]*G+e[9]*X+e[13],i[14]=e[2]*F+e[6]*G+e[10]*X+e[14],i[15]=e[3]*F+e[7]*G+e[11]*X+e[15]):(a=e[1],h=e[2],d=e[3],m=e[4],y=e[5],x=e[6],E=e[7],k=e[8],S=e[9],M=e[10],P=e[11],i[0]=n=e[0],i[1]=a,i[2]=h,i[3]=d,i[4]=m,i[5]=y,i[6]=x,i[7]=E,i[8]=k,i[9]=S,i[10]=M,i[11]=P,i[12]=n*F+m*G+k*X+e[12],i[13]=a*F+y*G+S*X+e[13],i[14]=h*F+x*G+M*X+e[14],i[15]=d*F+E*G+P*X+e[15]),i}function xn(i,e,r){var n=r[0],a=r[1],h=r[2];return i[0]=e[0]*n,i[1]=e[1]*n,i[2]=e[2]*n,i[3]=e[3]*n,i[4]=e[4]*a,i[5]=e[5]*a,i[6]=e[6]*a,i[7]=e[7]*a,i[8]=e[8]*h,i[9]=e[9]*h,i[10]=e[10]*h,i[11]=e[11]*h,i[12]=e[12],i[13]=e[13],i[14]=e[14],i[15]=e[15],i}function $h(i,e,r){var n=Math.sin(r),a=Math.cos(r),h=e[4],d=e[5],m=e[6],y=e[7],x=e[8],E=e[9],k=e[10],S=e[11];return e!==i&&(i[0]=e[0],i[1]=e[1],i[2]=e[2],i[3]=e[3],i[12]=e[12],i[13]=e[13],i[14]=e[14],i[15]=e[15]),i[4]=h*a+x*n,i[5]=d*a+E*n,i[6]=m*a+k*n,i[7]=y*a+S*n,i[8]=x*a-h*n,i[9]=E*a-d*n,i[10]=k*a-m*n,i[11]=S*a-y*n,i}function qh(i,e,r){var n=Math.sin(r),a=Math.cos(r),h=e[0],d=e[1],m=e[2],y=e[3],x=e[8],E=e[9],k=e[10],S=e[11];return e!==i&&(i[4]=e[4],i[5]=e[5],i[6]=e[6],i[7]=e[7],i[12]=e[12],i[13]=e[13],i[14]=e[14],i[15]=e[15]),i[0]=h*a-x*n,i[1]=d*a-E*n,i[2]=m*a-k*n,i[3]=y*a-S*n,i[8]=h*n+x*a,i[9]=d*n+E*a,i[10]=m*n+k*a,i[11]=y*n+S*a,i}function mm(i,e,r){var n,a,h,d=r[0],m=r[1],y=r[2],x=Math.hypot(d,m,y);return x<Gh?null:(d*=x=1/x,m*=x,y*=x,n=Math.sin(e),a=Math.cos(e),i[0]=d*d*(h=1-a)+a,i[1]=m*d*h+y*n,i[2]=y*d*h-m*n,i[3]=0,i[4]=d*m*h-y*n,i[5]=m*m*h+a,i[6]=y*m*h+d*n,i[7]=0,i[8]=d*y*h+m*n,i[9]=m*y*h-d*n,i[10]=y*y*h+a,i[11]=0,i[12]=0,i[13]=0,i[14]=0,i[15]=1,i)}Math.hypot||(Math.hypot=function(){for(var i=0,e=arguments.length;e--;)i+=arguments[e]*arguments[e];return Math.sqrt(i)});var s0=Mo;function Dp(){var i=new yr(3);return yr!=Float32Array&&(i[0]=0,i[1]=0,i[2]=0),i}function gm(i){var e=new yr(3);return e[0]=i[0],e[1]=i[1],e[2]=i[2],e}function Yl(i){return Math.hypot(i[0],i[1],i[2])}function $a(i,e,r){var n=new yr(3);return n[0]=i,n[1]=e,n[2]=r,n}function Io(i,e,r){return i[0]=e[0]+r[0],i[1]=e[1]+r[1],i[2]=e[2]+r[2],i}function Lp(i,e,r){return i[0]=e[0]-r[0],i[1]=e[1]-r[1],i[2]=e[2]-r[2],i}function _m(i,e,r){return i[0]=e[0]*r[0],i[1]=e[1]*r[1],i[2]=e[2]*r[2],i}function Zh(i,e,r){return i[0]=Math.min(e[0],r[0]),i[1]=Math.min(e[1],r[1]),i[2]=Math.min(e[2],r[2]),i}function Wh(i,e,r){return i[0]=Math.max(e[0],r[0]),i[1]=Math.max(e[1],r[1]),i[2]=Math.max(e[2],r[2]),i}function vn(i,e,r){return i[0]=e[0]*r,i[1]=e[1]*r,i[2]=e[2]*r,i}function Hh(i,e,r,n){return i[0]=e[0]+r[0]*n,i[1]=e[1]+r[1]*n,i[2]=e[2]+r[2]*n,i}function Wi(i,e){var r=e[0],n=e[1],a=e[2],h=r*r+n*n+a*a;return h>0&&(h=1/Math.sqrt(h)),i[0]=e[0]*h,i[1]=e[1]*h,i[2]=e[2]*h,i}function Nr(i,e){return i[0]*e[0]+i[1]*e[1]+i[2]*e[2]}function Bp(i,e,r){var n=e[0],a=e[1],h=e[2],d=r[0],m=r[1],y=r[2];return i[0]=a*y-h*m,i[1]=h*d-n*y,i[2]=n*m-a*d,i}function ji(i,e,r){var n=e[0],a=e[1],h=e[2],d=r[3]*n+r[7]*a+r[11]*h+r[15];return i[0]=(r[0]*n+r[4]*a+r[8]*h+r[12])/(d=d||1),i[1]=(r[1]*n+r[5]*a+r[9]*h+r[13])/d,i[2]=(r[2]*n+r[6]*a+r[10]*h+r[14])/d,i}function ym(i,e,r){var n=r[0],a=r[1],h=r[2],d=e[0],m=e[1],y=e[2],x=a*y-h*m,E=h*d-n*y,k=n*m-a*d,S=a*k-h*E,M=h*x-n*k,P=n*E-a*x,F=2*r[3];return E*=F,k*=F,M*=2,P*=2,i[0]=d+(x*=F)+(S*=2),i[1]=m+E+M,i[2]=y+k+P,i}var Jl,Gr=Lp,a0=_m,l0=Yl;function xm(i,e,r){return i[0]=e[0]*r,i[1]=e[1]*r,i[2]=e[2]*r,i[3]=e[3]*r,i}function Ms(i,e,r){var n=e[0],a=e[1],h=e[2],d=e[3];return i[0]=r[0]*n+r[4]*a+r[8]*h+r[12]*d,i[1]=r[1]*n+r[5]*a+r[9]*h+r[13]*d,i[2]=r[2]*n+r[6]*a+r[10]*h+r[14]*d,i[3]=r[3]*n+r[7]*a+r[11]*h+r[15]*d,i}function vm(){var i=new yr(4);return yr!=Float32Array&&(i[0]=0,i[1]=0,i[2]=0),i[3]=1,i}function bm(i){return i[0]=0,i[1]=0,i[2]=0,i[3]=1,i}function wm(i,e,r){r*=.5;var n=e[0],a=e[1],h=e[2],d=e[3],m=Math.sin(r),y=Math.cos(r);return i[0]=n*y+d*m,i[1]=a*y+h*m,i[2]=h*y-a*m,i[3]=d*y-n*m,i}function Em(i,e,r){r*=.5;var n=e[0],a=e[1],h=e[2],d=e[3],m=Math.sin(r),y=Math.cos(r);return i[0]=n*y-h*m,i[1]=a*y+d*m,i[2]=h*y+n*m,i[3]=d*y-a*m,i}Dp(),Jl=new yr(4),yr!=Float32Array&&(Jl[0]=0,Jl[1]=0,Jl[2]=0,Jl[3]=0),Dp(),$a(1,0,0),$a(0,1,0),vm(),vm(),fm();class Rp{constructor(e,r){this.pos=e,this.dir=r}intersectsPlane(e,r,n){let a=Nr(r,this.dir);if(Math.abs(a)<1e-6)return!1;let h=((e[0]-this.pos[0])*r[0]+(e[1]-this.pos[1])*r[1]+(e[2]-this.pos[2])*r[2])/a;return n[0]=this.pos[0]+this.dir[0]*h,n[1]=this.pos[1]+this.dir[1]*h,n[2]=this.pos[2]+this.dir[2]*h,!0}closestPointOnSphere(e,r,n){if(function(M,P){var F=M[0],G=M[1],X=M[2],ne=P[0],re=P[1],se=P[2];return Math.abs(F-ne)<=Gh*Math.max(1,Math.abs(F),Math.abs(ne))&&Math.abs(G-re)<=Gh*Math.max(1,Math.abs(G),Math.abs(re))&&Math.abs(X-se)<=Gh*Math.max(1,Math.abs(X),Math.abs(se))}(this.pos,e)||r===0)return n[0]=n[1]=n[2]=0,!1;let[a,h,d]=this.dir,m=this.pos[0]-e[0],y=this.pos[1]-e[1],x=this.pos[2]-e[2],E=a*a+h*h+d*d,k=2*(m*a+y*h+x*d),S=k*k-4*E*(m*m+y*y+x*x-r*r);if(S<0){let M=Math.max(-k/2,0),P=m+a*M,F=y+h*M,G=x+d*M,X=Math.hypot(P,F,G);return n[0]=P*r/X,n[1]=F*r/X,n[2]=G*r/X,!1}{let M=(-k-Math.sqrt(S))/(2*E);if(M<0){let P=Math.hypot(m,y,x);return n[0]=m*r/P,n[1]=y*r/P,n[2]=x*r/P,!1}return n[0]=m+a*M,n[1]=y+h*M,n[2]=x+d*M,!0}}}class Fp{constructor(e,r,n,a,h){this.TL=e,this.TR=r,this.BR=n,this.BL=a,this.horizon=h}static fromInvProjectionMatrix(e,r,n){let a=[-1,1,1],h=[1,1,1],d=[1,-1,1],m=[-1,-1,1],y=ji(a,a,e),x=ji(h,h,e),E=ji(d,d,e),k=ji(m,m,e);return new Fp(y,x,E,k,r/n)}}class Op{constructor(e,r){this.points=e,this.planes=r}static fromInvProjectionMatrix(e,r,n,a){let h=Math.pow(2,n),d=[[-1,1,-1,1],[1,1,-1,1],[1,-1,-1,1],[-1,-1,-1,1],[-1,1,1,1],[1,1,1,1],[1,-1,1,1],[-1,-1,1,1]].map(y=>{let x=Ms([],y,e),E=1/x[3]/r*h;return function(k,S,M){return k[0]=S[0]*M[0],k[1]=S[1]*M[1],k[2]=S[2]*M[2],k[3]=S[3]*M[3],k}(x,x,[E,E,a?1/x[3]:E,E])}),m=[[0,1,2],[6,5,4],[0,3,7],[2,1,5],[3,2,6],[0,4,5]].map(y=>{let x=Wi([],Bp([],Gr([],d[y[0]],d[y[1]]),Gr([],d[y[2]],d[y[1]]))),E=-Nr(x,d[y[1]]);return x.concat(E)});return new Op(d,m)}}class Ir{constructor(e,r){this.min=e,this.max=r,this.center=vn([],Io([],this.min,this.max),.5)}quadrant(e){let r=[e%2==0,e<2],n=gm(this.min),a=gm(this.max);for(let h=0;h<r.length;h++)n[h]=r[h]?this.min[h]:this.center[h],a[h]=r[h]?this.center[h]:this.max[h];return a[2]=this.max[2],new Ir(n,a)}distanceX(e){return Math.max(Math.min(this.max[0],e[0]),this.min[0])-e[0]}distanceY(e){return Math.max(Math.min(this.max[1],e[1]),this.min[1])-e[1]}distanceZ(e){return Math.max(Math.min(this.max[2],e[2]),this.min[2])-e[2]}getCorners(){let e=this.min,r=this.max;return[[e[0],e[1],e[2]],[r[0],e[1],e[2]],[r[0],r[1],e[2]],[e[0],r[1],e[2]],[e[0],e[1],r[2]],[r[0],e[1],r[2]],[r[0],r[1],r[2]],[e[0],r[1],r[2]]]}intersects(e){let r=this.getCorners(),n=!0;for(let a=0;a<e.planes.length;a++){let h=e.planes[a],d=0;for(let m=0;m<r.length;m++)d+=Nr(h,r[m])+h[3]>=0;if(d===0)return 0;d!==r.length&&(n=!1)}if(n)return 2;for(let a=0;a<3;a++){let h=Number.MAX_VALUE,d=-Number.MAX_VALUE;for(let m=0;m<e.points.length;m++){let y=e.points[m][a]-this.min[a];h=Math.min(h,y),d=Math.max(d,y)}if(d<0||h>this.max[a]-this.min[a])return 0}return 1}}function Tm(i,e,r,n,a,h,d,m,y){if(h&&i.queryGeometry.isAboveHorizon)return!1;h&&(y*=i.pixelToTileUnitsFactor);let x=i.tileID.canonical,E=r.projection.upVectorScale(x,r.center.lat,r.worldSize).metersToTile;for(let k of e)for(let S of k){let M=S.add(m),P=a&&r.elevation?r.elevation.exaggeration()*a.getElevationAt(M.x,M.y,!0):0,F=r.projection.projectTilePoint(M.x,M.y,x);if(P>0){let re=r.projection.upVector(x,M.x,M.y);F.x+=re[0]*E*P,F.y+=re[1]*E*P,F.z+=re[2]*E*P}let G=h?M:c0(F.x,F.y,F.z,n),X=h?i.tilespaceRays.map(re=>u0(re,P)):i.queryGeometry.screenGeometry,ne=Ms([],[F.x,F.y,F.z,1],n);if(!d&&h?y*=ne[3]/r.cameraToCenterDistance:d&&!h&&(y*=r.cameraToCenterDistance/ne[3]),h){let re=wi((S.y/lt+x.y)/(1<<x.z));y/=r.projection.pixelsPerMeter(re,1)/Vr(1,re)}if(e0(X,G,y))return!0}return!1}function c0(i,e,r,n){let a=Ms([],[i,e,r,1],n);return new Y(a[0]/a[3],a[1]/a[3])}let Cm=$a(0,0,0),h0=$a(0,0,1);function u0(i,e){let r=Dp();return Cm[2]=e,i.intersectsPlane(Cm,h0,r),new Y(r[0],r[1])}class km extends Ip{}function Sm(i,{width:e,height:r},n,a){if(a){if(a instanceof Uint8ClampedArray)a=new Uint8Array(a.buffer);else if(a.length!==e*r*n)throw new RangeError("mismatched image size")}else a=new Uint8Array(e*r*n);return i.width=e,i.height=r,i.data=a,i}function Am(i,e,r){let{width:n,height:a}=e;n===i.width&&a===i.height||(jp(i,e,{x:0,y:0},{x:0,y:0},{width:Math.min(i.width,n),height:Math.min(i.height,a)},r),i.width=n,i.height=a,i.data=e.data)}function jp(i,e,r,n,a,h){if(a.width===0||a.height===0)return e;if(a.width>i.width||a.height>i.height||r.x>i.width-a.width||r.y>i.height-a.height)throw new RangeError("out of range source coordinates for image copy");if(a.width>e.width||a.height>e.height||n.x>e.width-a.width||n.y>e.height-a.height)throw new RangeError("out of range destination coordinates for image copy");let d=i.data,m=e.data;for(let y=0;y<a.height;y++){let x=((r.y+y)*i.width+r.x)*h,E=((n.y+y)*e.width+n.x)*h;for(let k=0;k<a.width*h;k++)m[E+k]=d[x+k]}return e}He(km,"HeatmapBucket",{omit:["layers"]});class Wn{constructor(e,r){Sm(this,e,1,r)}resize(e){Am(this,new Wn(e),1)}clone(){return new Wn({width:this.width,height:this.height},new Uint8Array(this.data))}static copy(e,r,n,a,h){jp(e,r,n,a,h,1)}}class vr{constructor(e,r){Sm(this,e,4,r)}resize(e){Am(this,new vr(e),4)}replace(e,r){r?this.data.set(e):this.data=e instanceof Uint8ClampedArray?new Uint8Array(e.buffer):e}clone(){return new vr({width:this.width,height:this.height},new Uint8Array(this.data))}static copy(e,r,n,a,h){jp(e,r,n,a,h,4)}}He(Wn,"AlphaImage"),He(vr,"RGBAImage");var p0={paint:new Te({"heatmap-radius":new te(de.paint_heatmap["heatmap-radius"]),"heatmap-weight":new te(de.paint_heatmap["heatmap-weight"]),"heatmap-intensity":new _e(de.paint_heatmap["heatmap-intensity"]),"heatmap-color":new Ve(de.paint_heatmap["heatmap-color"]),"heatmap-opacity":new _e(de.paint_heatmap["heatmap-opacity"])})};function Up(i){let e={},r=i.resolution||256,n=i.clips?i.clips.length:1,a=i.image||new vr({width:r,height:n}),h=(d,m,y)=>{e[i.evaluationKey]=y;let x=i.expression.evaluate(e);a.data[d+m+0]=Math.floor(255*x.r/x.a),a.data[d+m+1]=Math.floor(255*x.g/x.a),a.data[d+m+2]=Math.floor(255*x.b/x.a),a.data[d+m+3]=Math.floor(255*x.a)};if(i.clips)for(let d=0,m=0;d<n;++d,m+=4*r)for(let y=0,x=0;y<r;y++,x+=4){let E=y/(r-1),{start:k,end:S}=i.clips[d];h(m,x,k*(1-E)+S*E)}else for(let d=0,m=0;d<r;d++,m+=4)h(0,m,d/(r-1));return a}var d0={paint:new Te({"hillshade-illumination-direction":new _e(de.paint_hillshade["hillshade-illumination-direction"]),"hillshade-illumination-anchor":new _e(de.paint_hillshade["hillshade-illumination-anchor"]),"hillshade-exaggeration":new _e(de.paint_hillshade["hillshade-exaggeration"]),"hillshade-shadow-color":new _e(de.paint_hillshade["hillshade-shadow-color"]),"hillshade-highlight-color":new _e(de.paint_hillshade["hillshade-highlight-color"]),"hillshade-accent-color":new _e(de.paint_hillshade["hillshade-accent-color"])})};let f0=Oe([{name:"a_pos",components:2,type:"Int16"}],4),{members:m0}=f0;var Xh=Kh,g0=Kh;function Kh(i,e,r){r=r||2;var n,a,h,d,m,y,x,E=e&&e.length,k=E?e[0]*r:i.length,S=Mm(i,0,k,r,!0),M=[];if(!S||S.next===S.prev)return M;if(E&&(S=function(F,G,X,ne){var re,se,ce,ue=[];for(re=0,se=G.length;re<se;re++)(ce=Mm(F,G[re]*ne,re<se-1?G[re+1]*ne:F.length,ne,!1))===ce.next&&(ce.steiner=!0),ue.push(T0(ce));for(ue.sort(b0),re=0;re<ue.length;re++)X=zo(X=w0(ue[re],X),X.next);return X}(i,e,S,r)),i.length>80*r){n=h=i[0],a=d=i[1];for(var P=r;P<k;P+=r)(m=i[P])<n&&(n=m),(y=i[P+1])<a&&(a=y),m>h&&(h=m),y>d&&(d=y);x=(x=Math.max(h-n,d-a))!==0?1/x:0}return Ql(S,M,r,n,a,x),M}function Mm(i,e,r,n,a){var h,d;if(a===Gp(i,e,r,n)>0)for(h=e;h<r;h+=n)d=Pm(h,i[h],i[h+1],d);else for(h=r-n;h>=e;h-=n)d=Pm(h,i[h],i[h+1],d);return d&&Yh(d,d.next)&&(tc(d),d=d.next),d}function zo(i,e){if(!i)return i;e||(e=i);var r,n=i;do if(r=!1,n.steiner||!Yh(n,n.next)&&xi(n.prev,n,n.next)!==0)n=n.next;else{if(tc(n),(n=e=n.prev)===n.next)break;r=!0}while(r||n!==e);return e}function Ql(i,e,r,n,a,h,d){if(i){!d&&h&&function(E,k,S,M){var P=E;do P.z===null&&(P.z=Vp(P.x,P.y,k,S,M)),P.prevZ=P.prev,P.nextZ=P.next,P=P.next;while(P!==E);P.prevZ.nextZ=null,P.prevZ=null,function(F){var G,X,ne,re,se,ce,ue,ve,we=1;do{for(X=F,F=null,se=null,ce=0;X;){for(ce++,ne=X,ue=0,G=0;G<we&&(ue++,ne=ne.nextZ);G++);for(ve=we;ue>0||ve>0&&ne;)ue!==0&&(ve===0||!ne||X.z<=ne.z)?(re=X,X=X.nextZ,ue--):(re=ne,ne=ne.nextZ,ve--),se?se.nextZ=re:F=re,re.prevZ=se,se=re;X=ne}se.nextZ=null,we*=2}while(ce>1)}(P)}(i,n,a,h);for(var m,y,x=i;i.prev!==i.next;)if(m=i.prev,y=i.next,h?y0(i,n,a,h):_0(i))e.push(m.i/r),e.push(i.i/r),e.push(y.i/r),tc(i),i=y.next,x=y.next;else if((i=y)===x){d?d===1?Ql(i=x0(zo(i),e,r),e,r,n,a,h,2):d===2&&v0(i,e,r,n,a,h):Ql(zo(i),e,r,n,a,h,1);break}}}function _0(i){var e=i.prev,r=i,n=i.next;if(xi(e,r,n)>=0)return!1;for(var a=i.next.next;a!==i.prev;){if(qa(e.x,e.y,r.x,r.y,n.x,n.y,a.x,a.y)&&xi(a.prev,a,a.next)>=0)return!1;a=a.next}return!0}function y0(i,e,r,n){var a=i.prev,h=i,d=i.next;if(xi(a,h,d)>=0)return!1;for(var m=a.x>h.x?a.x>d.x?a.x:d.x:h.x>d.x?h.x:d.x,y=a.y>h.y?a.y>d.y?a.y:d.y:h.y>d.y?h.y:d.y,x=Vp(a.x<h.x?a.x<d.x?a.x:d.x:h.x<d.x?h.x:d.x,a.y<h.y?a.y<d.y?a.y:d.y:h.y<d.y?h.y:d.y,e,r,n),E=Vp(m,y,e,r,n),k=i.prevZ,S=i.nextZ;k&&k.z>=x&&S&&S.z<=E;){if(k!==i.prev&&k!==i.next&&qa(a.x,a.y,h.x,h.y,d.x,d.y,k.x,k.y)&&xi(k.prev,k,k.next)>=0||(k=k.prevZ,S!==i.prev&&S!==i.next&&qa(a.x,a.y,h.x,h.y,d.x,d.y,S.x,S.y)&&xi(S.prev,S,S.next)>=0))return!1;S=S.nextZ}for(;k&&k.z>=x;){if(k!==i.prev&&k!==i.next&&qa(a.x,a.y,h.x,h.y,d.x,d.y,k.x,k.y)&&xi(k.prev,k,k.next)>=0)return!1;k=k.prevZ}for(;S&&S.z<=E;){if(S!==i.prev&&S!==i.next&&qa(a.x,a.y,h.x,h.y,d.x,d.y,S.x,S.y)&&xi(S.prev,S,S.next)>=0)return!1;S=S.nextZ}return!0}function x0(i,e,r){var n=i;do{var a=n.prev,h=n.next.next;!Yh(a,h)&&Im(a,n,n.next,h)&&ec(a,h)&&ec(h,a)&&(e.push(a.i/r),e.push(n.i/r),e.push(h.i/r),tc(n),tc(n.next),n=i=h),n=n.next}while(n!==i);return zo(n)}function v0(i,e,r,n,a,h){var d=i;do{for(var m=d.next.next;m!==d.prev;){if(d.i!==m.i&&C0(d,m)){var y=zm(d,m);return d=zo(d,d.next),y=zo(y,y.next),Ql(d,e,r,n,a,h),void Ql(y,e,r,n,a,h)}m=m.next}d=d.next}while(d!==i)}function b0(i,e){return i.x-e.x}function w0(i,e){var r=function(h,d){var m,y=d,x=h.x,E=h.y,k=-1/0;do{if(E<=y.y&&E>=y.next.y&&y.next.y!==y.y){var S=y.x+(E-y.y)*(y.next.x-y.x)/(y.next.y-y.y);if(S<=x&&S>k){if(k=S,S===x){if(E===y.y)return y;if(E===y.next.y)return y.next}m=y.x<y.next.x?y:y.next}}y=y.next}while(y!==d);if(!m)return null;if(x===k)return m;var M,P=m,F=m.x,G=m.y,X=1/0;y=m;do x>=y.x&&y.x>=F&&x!==y.x&&qa(E<G?x:k,E,F,G,E<G?k:x,E,y.x,y.y)&&(M=Math.abs(E-y.y)/(x-y.x),ec(y,h)&&(M<X||M===X&&(y.x>m.x||y.x===m.x&&E0(m,y)))&&(m=y,X=M)),y=y.next;while(y!==P);return m}(i,e);if(!r)return e;var n=zm(r,i),a=zo(r,r.next);return zo(n,n.next),e===r?a:e}function E0(i,e){return xi(i.prev,i,e.prev)<0&&xi(e.next,i,i.next)<0}function Vp(i,e,r,n,a){return(i=1431655765&((i=858993459&((i=252645135&((i=16711935&((i=32767*(i-r)*a)|i<<8))|i<<4))|i<<2))|i<<1))|(e=1431655765&((e=858993459&((e=252645135&((e=16711935&((e=32767*(e-n)*a)|e<<8))|e<<4))|e<<2))|e<<1))<<1}function T0(i){var e=i,r=i;do(e.x<r.x||e.x===r.x&&e.y<r.y)&&(r=e),e=e.next;while(e!==i);return r}function qa(i,e,r,n,a,h,d,m){return(a-d)*(e-m)-(i-d)*(h-m)>=0&&(i-d)*(n-m)-(r-d)*(e-m)>=0&&(r-d)*(h-m)-(a-d)*(n-m)>=0}function C0(i,e){return i.next.i!==e.i&&i.prev.i!==e.i&&!function(r,n){var a=r;do{if(a.i!==r.i&&a.next.i!==r.i&&a.i!==n.i&&a.next.i!==n.i&&Im(a,a.next,r,n))return!0;a=a.next}while(a!==r);return!1}(i,e)&&(ec(i,e)&&ec(e,i)&&function(r,n){var a=r,h=!1,d=(r.x+n.x)/2,m=(r.y+n.y)/2;do a.y>m!=a.next.y>m&&a.next.y!==a.y&&d<(a.next.x-a.x)*(m-a.y)/(a.next.y-a.y)+a.x&&(h=!h),a=a.next;while(a!==r);return h}(i,e)&&(xi(i.prev,i,e.prev)||xi(i,e.prev,e))||Yh(i,e)&&xi(i.prev,i,i.next)>0&&xi(e.prev,e,e.next)>0)}function xi(i,e,r){return(e.y-i.y)*(r.x-e.x)-(e.x-i.x)*(r.y-e.y)}function Yh(i,e){return i.x===e.x&&i.y===e.y}function Im(i,e,r,n){var a=Qh(xi(i,e,r)),h=Qh(xi(i,e,n)),d=Qh(xi(r,n,i)),m=Qh(xi(r,n,e));return a!==h&&d!==m||!(a!==0||!Jh(i,r,e))||!(h!==0||!Jh(i,n,e))||!(d!==0||!Jh(r,i,n))||!(m!==0||!Jh(r,e,n))}function Jh(i,e,r){return e.x<=Math.max(i.x,r.x)&&e.x>=Math.min(i.x,r.x)&&e.y<=Math.max(i.y,r.y)&&e.y>=Math.min(i.y,r.y)}function Qh(i){return i>0?1:i<0?-1:0}function ec(i,e){return xi(i.prev,i,i.next)<0?xi(i,e,i.next)>=0&&xi(i,i.prev,e)>=0:xi(i,e,i.prev)<0||xi(i,i.next,e)<0}function zm(i,e){var r=new Np(i.i,i.x,i.y),n=new Np(e.i,e.x,e.y),a=i.next,h=e.prev;return i.next=e,e.prev=i,r.next=a,a.prev=r,n.next=r,r.prev=n,h.next=n,n.prev=h,n}function Pm(i,e,r,n){var a=new Np(i,e,r);return n?(a.next=n.next,a.prev=n,n.next.prev=a,n.next=a):(a.prev=a,a.next=a),a}function tc(i){i.next.prev=i.prev,i.prev.next=i.next,i.prevZ&&(i.prevZ.nextZ=i.nextZ),i.nextZ&&(i.nextZ.prevZ=i.prevZ)}function Np(i,e,r){this.i=i,this.x=e,this.y=r,this.prev=null,this.next=null,this.z=null,this.prevZ=null,this.nextZ=null,this.steiner=!1}function Gp(i,e,r,n){for(var a=0,h=e,d=r-n;h<r;h+=n)a+=(i[d]-i[h])*(i[h+1]+i[d+1]),d=h;return a}function k0(i,e,r,n,a){Dm(i,e,r||0,n||i.length-1,a||S0)}function Dm(i,e,r,n,a){for(;n>r;){if(n-r>600){var h=n-r+1,d=e-r+1,m=Math.log(h),y=.5*Math.exp(2*m/3),x=.5*Math.sqrt(m*y*(h-y)/h)*(d-h/2<0?-1:1);Dm(i,e,Math.max(r,Math.floor(e-d*y/h+x)),Math.min(n,Math.floor(e+(h-d)*y/h+x)),a)}var E=i[e],k=r,S=n;for(ic(i,r,e),a(i[n],E)>0&&ic(i,r,n);k<S;){for(ic(i,k,S),k++,S--;a(i[k],E)<0;)k++;for(;a(i[S],E)>0;)S--}a(i[r],E)===0?ic(i,r,S):ic(i,++S,n),S<=e&&(r=S+1),e<=S&&(n=S-1)}}function ic(i,e,r){var n=i[e];i[e]=i[r],i[r]=n}function S0(i,e){return i<e?-1:i>e?1:0}function $p(i,e){let r=i.length;if(r<=1)return[i];let n=[],a,h;for(let d=0;d<r;d++){let m=Wr(i[d]);m!==0&&(i[d].area=Math.abs(m),h===void 0&&(h=m<0),h===m<0?(a&&n.push(a),a=[i[d]]):a.push(i[d]))}if(a&&n.push(a),e>1)for(let d=0;d<n.length;d++)n[d].length<=e||(k0(n[d],e,1,n[d].length-1,A0),n[d]=n[d].slice(0,e));return n}function A0(i,e){return e.area-i.area}function qp(i,e,r){let n=r.patternDependencies,a=!1;for(let h of e){let d=h.paint.get(`${i}-pattern`);d.isConstant()||(a=!0);let m=d.constantOr(null);m&&(a=!0,n[m.to]=!0,n[m.from]=!0)}return a}function Zp(i,e,r,n,a){let h=a.patternDependencies;for(let d of e){let m=d.paint.get(`${i}-pattern`).value;if(m.kind!=="constant"){let y=m.evaluate({zoom:n-1},r,{},a.availableImages),x=m.evaluate({zoom:n},r,{},a.availableImages),E=m.evaluate({zoom:n+1},r,{},a.availableImages);y=y&&y.name?y.name:y,x=x&&x.name?x.name:x,E=E&&E.name?E.name:E,h[y]=!0,h[x]=!0,h[E]=!0,r.patterns[d.id]={min:y,mid:x,max:E}}}return r}Kh.deviation=function(i,e,r,n){var a=e&&e.length,h=Math.abs(Gp(i,0,a?e[0]*r:i.length,r));if(a)for(var d=0,m=e.length;d<m;d++)h-=Math.abs(Gp(i,e[d]*r,d<m-1?e[d+1]*r:i.length,r));var y=0;for(d=0;d<n.length;d+=3){var x=n[d]*r,E=n[d+1]*r,k=n[d+2]*r;y+=Math.abs((i[x]-i[k])*(i[E+1]-i[x+1])-(i[x]-i[E])*(i[k+1]-i[x+1]))}return h===0&&y===0?0:Math.abs((y-h)/h)},Kh.flatten=function(i){for(var e=i[0][0].length,r={vertices:[],holes:[],dimensions:e},n=0,a=0;a<i.length;a++){for(var h=0;h<i[a].length;h++)for(var d=0;d<e;d++)r.vertices.push(i[a][h][d]);a>0&&r.holes.push(n+=i[a-1].length)}return r},Xh.default=g0;class eu{constructor(e){this.zoom=e.zoom,this.overscaling=e.overscaling,this.layers=e.layers,this.layerIds=this.layers.map(r=>r.id),this.index=e.index,this.hasPattern=!1,this.patternFeatures=[],this.layoutVertexArray=new rt,this.indexArray=new Mt,this.indexArray2=new yi,this.programConfigurations=new Es(e.layers,e.zoom),this.segments=new fi,this.segments2=new fi,this.stateDependentLayerIds=this.layers.filter(r=>r.isStateDependent()).map(r=>r.id),this.projection=e.projection}populate(e,r,n,a){this.hasPattern=qp("fill",this.layers,r);let h=this.layers[0].layout.get("fill-sort-key"),d=[];for(let{feature:m,id:y,index:x,sourceLayerIndex:E}of e){let k=this.layers[0]._featureFilter.needGeometry,S=ks(m,k);if(!this.layers[0]._featureFilter.filter(new $(this.zoom),S,n))continue;let M=h?h.evaluate(S,{},n,r.availableImages):void 0,P={id:y,properties:m.properties,type:m.type,sourceLayerIndex:E,index:x,geometry:k?S.geometry:Zn(m,n,a),patterns:{},sortKey:M};d.push(P)}h&&d.sort((m,y)=>m.sortKey-y.sortKey);for(let m of d){let{geometry:y,index:x,sourceLayerIndex:E}=m;if(this.hasPattern){let k=Zp("fill",this.layers,m,this.zoom,r);this.patternFeatures.push(k)}else this.addFeature(m,y,x,n,{},r.availableImages);r.featureIndex.insert(e[x].feature,y,x,E,this.index)}}update(e,r,n,a){this.stateDependentLayers.length&&this.programConfigurations.updatePaintArrays(e,r,this.stateDependentLayers,n,a)}addFeatures(e,r,n,a,h){for(let d of this.patternFeatures)this.addFeature(d,d.geometry,d.index,r,n,a)}isEmpty(){return this.layoutVertexArray.length===0}uploadPending(){return!this.uploaded||this.programConfigurations.needsUpload}upload(e){this.uploaded||(this.layoutVertexBuffer=e.createVertexBuffer(this.layoutVertexArray,m0),this.indexBuffer=e.createIndexBuffer(this.indexArray),this.indexBuffer2=e.createIndexBuffer(this.indexArray2)),this.programConfigurations.upload(e),this.uploaded=!0}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.indexBuffer2.destroy(),this.programConfigurations.destroy(),this.segments.destroy(),this.segments2.destroy())}addFeature(e,r,n,a,h,d=[]){for(let m of $p(r,500)){let y=0;for(let P of m)y+=P.length;let x=this.segments.prepareSegment(y,this.layoutVertexArray,this.indexArray),E=x.vertexLength,k=[],S=[];for(let P of m){if(P.length===0)continue;P!==m[0]&&S.push(k.length/2);let F=this.segments2.prepareSegment(P.length,this.layoutVertexArray,this.indexArray2),G=F.vertexLength;this.layoutVertexArray.emplaceBack(P[0].x,P[0].y),this.indexArray2.emplaceBack(G+P.length-1,G),k.push(P[0].x),k.push(P[0].y);for(let X=1;X<P.length;X++)this.layoutVertexArray.emplaceBack(P[X].x,P[X].y),this.indexArray2.emplaceBack(G+X-1,G+X),k.push(P[X].x),k.push(P[X].y);F.vertexLength+=P.length,F.primitiveLength+=P.length}let M=Xh(k,S);for(let P=0;P<M.length;P+=3)this.indexArray.emplaceBack(E+M[P],E+M[P+1],E+M[P+2]);x.vertexLength+=y,x.primitiveLength+=M.length/3}this.programConfigurations.populatePaintArrays(this.layoutVertexArray.length,e,n,h,d,a)}}He(eu,"FillBucket",{omit:["layers","patternFeatures"]});let M0=new Te({"fill-sort-key":new te(de.layout_fill["fill-sort-key"])});var I0={paint:new Te({"fill-antialias":new _e(de.paint_fill["fill-antialias"]),"fill-opacity":new te(de.paint_fill["fill-opacity"]),"fill-color":new te(de.paint_fill["fill-color"]),"fill-outline-color":new te(de.paint_fill["fill-outline-color"]),"fill-translate":new _e(de.paint_fill["fill-translate"]),"fill-translate-anchor":new _e(de.paint_fill["fill-translate-anchor"]),"fill-pattern":new Ie(de.paint_fill["fill-pattern"])}),layout:M0};let z0=Oe([{name:"a_pos_normal_ed",components:4,type:"Int16"}]),P0=Oe([{name:"a_centroid_pos",components:2,type:"Uint16"}]),D0=Oe([{name:"a_pos_3",components:3,type:"Int16"},{name:"a_pos_normal_3",components:3,type:"Int16"}]),{members:L0}=z0;var Lm=Za;function Za(i,e,r,n,a){this.properties={},this.extent=r,this.type=0,this._pbf=i,this._geometry=-1,this._keys=n,this._values=a,i.readFields(B0,this,e)}function B0(i,e,r){i==1?e.id=r.readVarint():i==2?function(n,a){for(var h=n.readVarint()+n.pos;n.pos<h;){var d=a._keys[n.readVarint()],m=a._values[n.readVarint()];a.properties[d]=m}}(r,e):i==3?e.type=r.readVarint():i==4&&(e._geometry=r.pos)}function R0(i){for(var e,r,n=0,a=0,h=i.length,d=h-1;a<h;d=a++)n+=((r=i[d]).x-(e=i[a]).x)*(e.y+r.y);return n}Za.types=["Unknown","Point","LineString","Polygon"],Za.prototype.loadGeometry=function(){var i=this._pbf;i.pos=this._geometry;for(var e,r=i.readVarint()+i.pos,n=1,a=0,h=0,d=0,m=[];i.pos<r;){if(a<=0){var y=i.readVarint();n=7&y,a=y>>3}if(a--,n===1||n===2)h+=i.readSVarint(),d+=i.readSVarint(),n===1&&(e&&m.push(e),e=[]),e.push(new Y(h,d));else{if(n!==7)throw new Error("unknown command "+n);e&&e.push(e[0].clone())}}return e&&m.push(e),m},Za.prototype.bbox=function(){var i=this._pbf;i.pos=this._geometry;for(var e=i.readVarint()+i.pos,r=1,n=0,a=0,h=0,d=1/0,m=-1/0,y=1/0,x=-1/0;i.pos<e;){if(n<=0){var E=i.readVarint();r=7&E,n=E>>3}if(n--,r===1||r===2)(a+=i.readSVarint())<d&&(d=a),a>m&&(m=a),(h+=i.readSVarint())<y&&(y=h),h>x&&(x=h);else if(r!==7)throw new Error("unknown command "+r)}return[d,y,m,x]},Za.prototype.toGeoJSON=function(i,e,r){var n,a,h=this.extent*Math.pow(2,r),d=this.extent*i,m=this.extent*e,y=this.loadGeometry(),x=Za.types[this.type];function E(M){for(var P=0;P<M.length;P++){var F=M[P];M[P]=[360*(F.x+d)/h-180,360/Math.PI*Math.atan(Math.exp((180-360*(F.y+m)/h)*Math.PI/180))-90]}}switch(this.type){case 1:var k=[];for(n=0;n<y.length;n++)k[n]=y[n][0];E(y=k);break;case 2:for(n=0;n<y.length;n++)E(y[n]);break;case 3:for(y=function(M){var P=M.length;if(P<=1)return[M];for(var F,G,X=[],ne=0;ne<P;ne++){var re=R0(M[ne]);re!==0&&(G===void 0&&(G=re<0),G===re<0?(F&&X.push(F),F=[M[ne]]):F.push(M[ne]))}return F&&X.push(F),X}(y),n=0;n<y.length;n++)for(a=0;a<y[n].length;a++)E(y[n][a])}y.length===1?y=y[0]:x="Multi"+x;var S={type:"Feature",geometry:{type:x,coordinates:y},properties:this.properties};return"id"in this&&(S.id=this.id),S};var Bm=Rm;function Rm(i,e){this.version=1,this.name=null,this.extent=4096,this.length=0,this._pbf=i,this._keys=[],this._values=[],this._features=[],i.readFields(F0,this,e),this.length=this._features.length}function F0(i,e,r){i===15?e.version=r.readVarint():i===1?e.name=r.readString():i===5?e.extent=r.readVarint():i===2?e._features.push(r.pos):i===3?e._keys.push(r.readString()):i===4&&e._values.push(function(n){for(var a=null,h=n.readVarint()+n.pos;n.pos<h;){var d=n.readVarint()>>3;a=d===1?n.readString():d===2?n.readFloat():d===3?n.readDouble():d===4?n.readVarint64():d===5?n.readVarint():d===6?n.readSVarint():d===7?n.readBoolean():null}return a}(r))}function O0(i,e,r){if(i===3){var n=new Bm(r,r.readVarint()+r.pos);n.length&&(e[n.name]=n)}}Rm.prototype.feature=function(i){if(i<0||i>=this._features.length)throw new Error("feature index out of bounds");this._pbf.pos=this._features[i];var e=this._pbf.readVarint()+this._pbf.pos;return new Lm(this._pbf,e,this.extent,this._keys,this._values)};var Is={VectorTile:function(i,e){this.layers=i.readFields(O0,{},e)},VectorTileFeature:Lm,VectorTileLayer:Bm};function tu(i,e,r,n){let a=[],h=n===0?(d,m,y,x,E,k)=>{d.push(new Y(k,y+(k-m)/(x-m)*(E-y)))}:(d,m,y,x,E,k)=>{d.push(new Y(m+(k-y)/(E-y)*(x-m),k))};for(let d of i){let m=[];for(let y of d){if(y.length<=2)continue;let x=[];for(let S=0;S<y.length-1;S++){let M=y[S].x,P=y[S].y,F=y[S+1].x,G=y[S+1].y,X=n===0?M:P,ne=n===0?F:G;X<e?ne>e&&h(x,M,P,F,G,e):X>r?ne<r&&h(x,M,P,F,G,r):x.push(y[S]),ne<e&&X>=e&&h(x,M,P,F,G,e),ne>r&&X<=r&&h(x,M,P,F,G,r)}let E=y[y.length-1],k=n===0?E.x:E.y;k>=e&&k<=r&&x.push(E),x.length&&(E=x[x.length-1],x[0].x===E.x&&x[0].y===E.y||x.push(x[0]),m.push(x))}m.length&&a.push(m)}return a}let j0=Is.VectorTileFeature.types,U0=Math.pow(2,13);function rc(i,e,r,n,a,h,d,m){i.emplaceBack((e<<1)+d,(r<<1)+h,(Math.floor(n*U0)<<1)+a,Math.round(m))}function nc(i,e,r){i.emplaceBack(e.x,e.y,e.z,r[0]*16384,r[1]*16384,r[2]*16384)}class Fm{constructor(){this.acc=new Y(0,0),this.polyCount=[]}startRing(e){this.currentPolyCount={edges:0,top:0},this.polyCount.push(this.currentPolyCount),this.min||(this.min=new Y(e.x,e.y),this.max=new Y(e.x,e.y))}append(e,r){this.currentPolyCount.edges++,this.acc._add(e);let n=this.min,a=this.max;e.x<n.x?n.x=e.x:e.x>a.x&&(a.x=e.x),e.y<n.y?n.y=e.y:e.y>a.y&&(a.y=e.y),((e.x===0||e.x===lt)&&e.x===r.x)!=((e.y===0||e.y===lt)&&e.y===r.y)&&this.processBorderOverlap(e,r),r.x<0!=e.x<0&&this.addBorderIntersection(0,Pt(r.y,e.y,(0-r.x)/(e.x-r.x))),r.x>lt!=e.x>lt&&this.addBorderIntersection(1,Pt(r.y,e.y,(lt-r.x)/(e.x-r.x))),r.y<0!=e.y<0&&this.addBorderIntersection(2,Pt(r.x,e.x,(0-r.y)/(e.y-r.y))),r.y>lt!=e.y>lt&&this.addBorderIntersection(3,Pt(r.x,e.x,(lt-r.y)/(e.y-r.y)))}addBorderIntersection(e,r){this.borders||(this.borders=[[Number.MAX_VALUE,-Number.MAX_VALUE],[Number.MAX_VALUE,-Number.MAX_VALUE],[Number.MAX_VALUE,-Number.MAX_VALUE],[Number.MAX_VALUE,-Number.MAX_VALUE]]);let n=this.borders[e];r<n[0]&&(n[0]=r),r>n[1]&&(n[1]=r)}processBorderOverlap(e,r){if(e.x===r.x){if(e.y===r.y)return;let n=e.x===0?0:1;this.addBorderIntersection(n,r.y),this.addBorderIntersection(n,e.y)}else{let n=e.y===0?2:3;this.addBorderIntersection(n,r.x),this.addBorderIntersection(n,e.x)}}centroid(){let e=this.polyCount.reduce((r,n)=>r+n.edges,0);return e!==0?this.acc.div(e)._round():new Y(0,0)}span(){return new Y(this.max.x-this.min.x,this.max.y-this.min.y)}intersectsCount(){return this.borders.reduce((e,r)=>e+ +(r[0]!==Number.MAX_VALUE),0)}}class oc{constructor(e){this.zoom=e.zoom,this.canonical=e.canonical,this.overscaling=e.overscaling,this.layers=e.layers,this.layerIds=this.layers.map(r=>r.id),this.index=e.index,this.hasPattern=!1,this.projection=e.projection,this.layoutVertexArray=new et,this.centroidVertexArray=new Xf,this.indexArray=new Mt,this.programConfigurations=new Es(e.layers,e.zoom),this.segments=new fi,this.stateDependentLayerIds=this.layers.filter(r=>r.isStateDependent()).map(r=>r.id),this.enableTerrain=e.enableTerrain}populate(e,r,n,a){this.features=[],this.hasPattern=qp("fill-extrusion",this.layers,r),this.featuresOnBorder=[],this.borders=[[],[],[],[]],this.borderDoneWithNeighborZ=[-1,-1,-1,-1],this.tileToMeter=function(h){let d=Math.exp(Math.PI*(1-h.y/(1<<h.z)*2));return 80150034*d/(d*d+1)/lt/(1<<h.z)}(n);for(let{feature:h,id:d,index:m,sourceLayerIndex:y}of e){let x=this.layers[0]._featureFilter.needGeometry,E=ks(h,x);if(!this.layers[0]._featureFilter.filter(new $(this.zoom),E,n))continue;let k={id:d,sourceLayerIndex:y,index:m,geometry:x?E.geometry:Zn(h,n,a),properties:h.properties,type:h.type,patterns:{}},S=this.layoutVertexArray.length;this.hasPattern?this.features.push(Zp("fill-extrusion",this.layers,k,this.zoom,r)):this.addFeature(k,k.geometry,m,n,{},r.availableImages,a),r.featureIndex.insert(h,k.geometry,m,y,this.index,S)}this.sortBorders()}addFeatures(e,r,n,a,h){for(let d of this.features){let{geometry:m}=d;this.addFeature(d,m,d.index,r,n,a,h)}this.sortBorders()}update(e,r,n,a){this.stateDependentLayers.length&&this.programConfigurations.updatePaintArrays(e,r,this.stateDependentLayers,n,a)}isEmpty(){return this.layoutVertexArray.length===0}uploadPending(){return!this.uploaded||this.programConfigurations.needsUpload}upload(e){this.uploaded||(this.layoutVertexBuffer=e.createVertexBuffer(this.layoutVertexArray,L0),this.indexBuffer=e.createIndexBuffer(this.indexArray),this.layoutVertexExtArray&&(this.layoutVertexExtBuffer=e.createVertexBuffer(this.layoutVertexExtArray,D0.members,!0))),this.programConfigurations.upload(e),this.uploaded=!0}uploadCentroid(e){this.centroidVertexArray.length!==0&&(this.centroidVertexBuffer?this.needsCentroidUpdate&&this.centroidVertexBuffer.updateData(this.centroidVertexArray):this.centroidVertexBuffer=e.createVertexBuffer(this.centroidVertexArray,P0.members,!0),this.needsCentroidUpdate=!1)}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.centroidVertexBuffer&&this.centroidVertexBuffer.destroy(),this.layoutVertexExtBuffer&&this.layoutVertexExtBuffer.destroy(),this.indexBuffer.destroy(),this.programConfigurations.destroy(),this.segments.destroy())}addFeature(e,r,n,a,h,d,m){let y=[new Y(0,0),new Y(lt,lt)],x=m.projection,E=x.name==="globe",k=this.enableTerrain&&!E?new Fm:null;E&&!this.layoutVertexExtArray&&(this.layoutVertexExtArray=new Of);let S=$p(r,500);for(let F=S.length-1;F>=0;F--){let G=S[F];(G.length===0||(M=G[0]).every(X=>X.x<=0)||M.every(X=>X.x>=lt)||M.every(X=>X.y<=0)||M.every(X=>X.y>=lt))&&S.splice(F,1)}var M;let P;if(E)P=jm(S,y,a);else{P=[];for(let F of S)P.push({polygon:F,bounds:y})}for(let F of P){let G=F.polygon,X=0,ne=this.segments.prepareSegment(4,this.layoutVertexArray,this.indexArray);for(let ve=0;ve<G.length;ve++){let we=G[ve];if(we.length===0)continue;X+=we.length;let Se=0;k&&k.startRing(we[0]);for(let Le=0;Le<we.length;Le++){let ge=we[Le];if(Le>=1){let ke=we[Le-1];if(!V0(ge,ke,F.bounds)){k&&k.append(ge,ke),ne.vertexLength+4>fi.MAX_VERTEX_ARRAY_LENGTH&&(ne=this.segments.prepareSegment(4,this.layoutVertexArray,this.indexArray));let Be=ge.sub(ke)._perp(),Re=Be.x/(Math.abs(Be.x)+Math.abs(Be.y)),qe=Be.y>0?1:0,Pe=ke.dist(ge);Se+Pe>32768&&(Se=0),rc(this.layoutVertexArray,ge.x,ge.y,Re,qe,0,0,Se),rc(this.layoutVertexArray,ge.x,ge.y,Re,qe,0,1,Se),Se+=Pe,rc(this.layoutVertexArray,ke.x,ke.y,Re,qe,0,0,Se),rc(this.layoutVertexArray,ke.x,ke.y,Re,qe,0,1,Se);let Ne=ne.vertexLength;if(this.indexArray.emplaceBack(Ne,Ne+2,Ne+1),this.indexArray.emplaceBack(Ne+1,Ne+2,Ne+3),ne.vertexLength+=4,ne.primitiveLength+=2,E){let dt=this.layoutVertexExtArray,xt=x.projectTilePoint(ge.x,ge.y,a),it=x.projectTilePoint(ke.x,ke.y,a),Xe=x.upVector(a,ge.x,ge.y),vt=x.upVector(a,ke.x,ke.y);nc(dt,xt,Xe),nc(dt,xt,Xe),nc(dt,it,vt),nc(dt,it,vt)}}}}}if(ne.vertexLength+X>fi.MAX_VERTEX_ARRAY_LENGTH&&(ne=this.segments.prepareSegment(X,this.layoutVertexArray,this.indexArray)),j0[e.type]!=="Polygon")continue;let re=[],se=[],ce=ne.vertexLength;for(let ve=0;ve<G.length;ve++){let we=G[ve];if(we.length!==0){we!==G[0]&&se.push(re.length/2);for(let Se=0;Se<we.length;Se++){let Le=we[Se];rc(this.layoutVertexArray,Le.x,Le.y,0,0,1,1,0),re.push(Le.x),re.push(Le.y),k&&k.currentPolyCount.top++,E&&nc(this.layoutVertexExtArray,x.projectTilePoint(Le.x,Le.y,a),x.upVector(a,Le.x,Le.y))}}}let ue=Xh(re,se);for(let ve=0;ve<ue.length;ve+=3)this.indexArray.emplaceBack(ce+ue[ve],ce+ue[ve+2],ce+ue[ve+1]);ne.primitiveLength+=ue.length/3,ne.vertexLength+=X}if(k&&k.polyCount.length>0){if(k.borders){k.vertexArrayOffset=this.centroidVertexArray.length;let F=k.borders,G=this.featuresOnBorder.push(k)-1;for(let X=0;X<4;X++)F[X][0]!==Number.MAX_VALUE&&this.borders[X].push(G)}this.encodeCentroid(k.borders?void 0:k.centroid(),k)}this.programConfigurations.populatePaintArrays(this.layoutVertexArray.length,e,n,h,d,a)}sortBorders(){for(let e=0;e<4;e++)this.borders[e].sort((r,n)=>this.featuresOnBorder[r].borders[e][0]-this.featuresOnBorder[n].borders[e][0])}encodeCentroid(e,r,n=!0){let a,h;if(e)if(e.y!==0){let m=r.span()._mult(this.tileToMeter);a=(Math.max(e.x,1)<<3)+Math.min(7,Math.round(m.x/10)),h=(Math.max(e.y,1)<<3)+Math.min(7,Math.round(m.y/10))}else a=Math.ceil(7*(e.x+450)),h=0;else a=0,h=+n;let d=n?this.centroidVertexArray.length:r.vertexArrayOffset;for(let m of r.polyCount){n&&this.centroidVertexArray.resize(this.centroidVertexArray.length+4*m.edges+m.top);for(let y=0;y<2*m.edges;y++)this.centroidVertexArray.emplace(d++,0,h),this.centroidVertexArray.emplace(d++,a,h);for(let y=0;y<m.top;y++)this.centroidVertexArray.emplace(d++,a,h)}}}function V0(i,e,r){return i.x===e.x&&(i.x<r[0].x||i.x>r[1].x)||i.y===e.y&&(i.y<r[0].y||i.y>r[1].y)}function Om(){let i=Math.PI/32,e=Math.tan(i),r=Cp;return r*Math.sqrt(1+2*e*e)-r}function jm(i,e,r){let n=1<<r.z,a=Zi(r.x/n),h=Zi((r.x+1)/n),d=wi(r.y/n),m=wi((r.y+1)/n);return function(y,x,E,k,S=0,M){let P=[];if(!y.length||!E||!k)return P;let F=(ue,ve)=>{for(let we of ue)P.push({polygon:we,bounds:ve})},G=Math.ceil(Math.log2(E)),X=Math.ceil(Math.log2(k)),ne=G-X,re=[];for(let ue=0;ue<Math.abs(ne);ue++)re.push(ne>0?0:1);for(let ue=0;ue<Math.min(G,X);ue++)re.push(0),re.push(1);let se=y;if(se=tu(se,x[0].y-S,x[1].y+S,1),se=tu(se,x[0].x-S,x[1].x+S,0),!se.length)return P;let ce=[];for(re.length?ce.push({polygons:se,bounds:x,depth:0}):F(se,x);ce.length;){let ue=ce.pop(),ve=ue.depth,we=re[ve],Se=ue.bounds[0],Le=ue.bounds[1],ge=we===0?Se.x:Se.y,ke=we===0?Le.x:Le.y,Be=M?M(we,ge,ke):.5*(ge+ke),Re=tu(ue.polygons,ge-S,Be+S,we),qe=tu(ue.polygons,Be-S,ke+S,we);if(Re.length){let Pe=[Se,new Y(we===0?Be:Le.x,we===1?Be:Le.y)];re.length>ve+1?ce.push({polygons:Re,bounds:Pe,depth:ve+1}):F(Re,Pe)}if(qe.length){let Pe=[new Y(we===0?Be:Se.x,we===1?Be:Se.y),Le];re.length>ve+1?ce.push({polygons:qe,bounds:Pe,depth:ve+1}):F(qe,Pe)}}return P}(i,e,Math.ceil((h-a)/11.25),Math.ceil((d-m)/11.25),1,(y,x,E)=>{if(y===0)return .5*(x+E);{let k=wi((r.y+x/lt)/n);return(Cs(.5*(wi((r.y+E/lt)/n)+k))*n-r.y)*lt}})}He(oc,"FillExtrusionBucket",{omit:["layers","features"]}),He(Fm,"PartMetadata");var N0={paint:new Te({"fill-extrusion-opacity":new _e(de["paint_fill-extrusion"]["fill-extrusion-opacity"]),"fill-extrusion-color":new te(de["paint_fill-extrusion"]["fill-extrusion-color"]),"fill-extrusion-translate":new _e(de["paint_fill-extrusion"]["fill-extrusion-translate"]),"fill-extrusion-translate-anchor":new _e(de["paint_fill-extrusion"]["fill-extrusion-translate-anchor"]),"fill-extrusion-pattern":new Ie(de["paint_fill-extrusion"]["fill-extrusion-pattern"]),"fill-extrusion-height":new te(de["paint_fill-extrusion"]["fill-extrusion-height"]),"fill-extrusion-base":new te(de["paint_fill-extrusion"]["fill-extrusion-base"]),"fill-extrusion-vertical-gradient":new _e(de["paint_fill-extrusion"]["fill-extrusion-vertical-gradient"])})};function Um(i,e,r){var n=2*Math.PI*6378137/256/Math.pow(2,r);return[i*n-2*Math.PI*6378137/2,e*n-2*Math.PI*6378137/2]}class iu{constructor(e,r,n){this.z=e,this.x=r,this.y=n,this.key=sc(0,e,e,r,n)}equals(e){return this.z===e.z&&this.x===e.x&&this.y===e.y}url(e,r){let n=function(h,d,m){var y=Um(256*h,256*(d=Math.pow(2,m)-d-1),m),x=Um(256*(h+1),256*(d+1),m);return y[0]+","+y[1]+","+x[0]+","+x[1]}(this.x,this.y,this.z),a=function(h,d,m){let y,x="";for(let E=h;E>0;E--)y=1<<E-1,x+=(d&y?1:0)+(m&y?2:0);return x}(this.z,this.x,this.y);return e[(this.x+this.y)%e.length].replace("{prefix}",(this.x%16).toString(16)+(this.y%16).toString(16)).replace(/{z}/g,String(this.z)).replace(/{x}/g,String(this.x)).replace(/{y}/g,String(r==="tms"?Math.pow(2,this.z)-this.y-1:this.y)).replace("{quadkey}",a).replace("{bbox-epsg-3857}",n)}toString(){return`${this.z}/${this.x}/${this.y}`}}class Vm{constructor(e,r){this.wrap=e,this.canonical=r,this.key=sc(e,r.z,r.z,r.x,r.y)}}class Hi{constructor(e,r,n,a,h){this.overscaledZ=e,this.wrap=r,this.canonical=new iu(n,+a,+h),this.key=r===0&&e===n?this.canonical.key:sc(r,e,n,a,h)}equals(e){return this.overscaledZ===e.overscaledZ&&this.wrap===e.wrap&&this.canonical.equals(e.canonical)}scaledTo(e){let r=this.canonical.z-e;return e>this.canonical.z?new Hi(e,this.wrap,this.canonical.z,this.canonical.x,this.canonical.y):new Hi(e,this.wrap,e,this.canonical.x>>r,this.canonical.y>>r)}calculateScaledKey(e,r=!0){if(this.overscaledZ===e&&r)return this.key;if(e>this.canonical.z)return sc(this.wrap*+r,e,this.canonical.z,this.canonical.x,this.canonical.y);{let n=this.canonical.z-e;return sc(this.wrap*+r,e,e,this.canonical.x>>n,this.canonical.y>>n)}}isChildOf(e){if(e.wrap!==this.wrap)return!1;let r=this.canonical.z-e.canonical.z;return e.overscaledZ===0||e.overscaledZ<this.overscaledZ&&e.canonical.x===this.canonical.x>>r&&e.canonical.y===this.canonical.y>>r}children(e){if(this.overscaledZ>=e)return[new Hi(this.overscaledZ+1,this.wrap,this.canonical.z,this.canonical.x,this.canonical.y)];let r=this.canonical.z+1,n=2*this.canonical.x,a=2*this.canonical.y;return[new Hi(r,this.wrap,r,n,a),new Hi(r,this.wrap,r,n+1,a),new Hi(r,this.wrap,r,n,a+1),new Hi(r,this.wrap,r,n+1,a+1)]}isLessThan(e){return this.wrap<e.wrap||!(this.wrap>e.wrap)&&(this.overscaledZ<e.overscaledZ||!(this.overscaledZ>e.overscaledZ)&&(this.canonical.x<e.canonical.x||!(this.canonical.x>e.canonical.x)&&this.canonical.y<e.canonical.y))}wrapped(){return new Hi(this.overscaledZ,0,this.canonical.z,this.canonical.x,this.canonical.y)}unwrapTo(e){return new Hi(this.overscaledZ,e,this.canonical.z,this.canonical.x,this.canonical.y)}overscaleFactor(){return Math.pow(2,this.overscaledZ-this.canonical.z)}toUnwrapped(){return new Vm(this.wrap,this.canonical)}toString(){return`${this.overscaledZ}/${this.canonical.x}/${this.canonical.y}`}}function sc(i,e,r,n,a){let h=1<<Math.min(r,22),d=h*(a%h)+n%h;return i&&r<22&&(d+=h*h*((i<0?-2*i-1:2*i)%(1<<2*(22-r)))),16*(32*d+r)+(e-r)}function ac(i,e){return i.x*e.x+i.y*e.y}function Nm(i,e){if(i.length===1){let r=0,n=e[r++],a;for(;!a||n.equals(a);)if(a=e[r++],!a)return 1/0;for(;r<e.length;r++){let h=e[r],d=i[0],m=a.sub(n),y=h.sub(n),x=d.sub(n),E=ac(m,m),k=ac(m,y),S=ac(y,y),M=ac(x,m),P=ac(x,y),F=E*S-k*k,G=(S*M-k*P)/F,X=(E*P-k*M)/F,ne=n.z*(1-G-X)+a.z*G+h.z*X;if(isFinite(ne))return ne}return 1/0}{let r=1/0;for(let n of e)r=Math.min(r,n.z);return r}}function ru(i){let e=new Y(i[0],i[1]);return e.z=i[2],e}function Gm(i,e,r,n,a,h,d,m){let y=d*a.getElevationAt(i,e,!0,!0),x=h[0]!==0,E=x?h[1]===0?d*(h[0]/7-450):d*function(k,S,M){let P=Math.floor(S[0]/8),F=Math.floor(S[1]/8),G=10*(S[0]-8*P),X=10*(S[1]-8*F),ne=k.getElevationAt(P,F,!0,!0),re=k.getMeterToDEM(M),se=Math.floor(.5*(G*re-1)),ce=Math.floor(.5*(X*re-1)),ue=k.tileCoordToPixel(P,F),ve=2*se+1,we=2*ce+1,Se=function(qe,Pe,Ne,dt,xt){return[qe.getElevationAtPixel(Pe,Ne,!0),qe.getElevationAtPixel(Pe+xt,Ne,!0),qe.getElevationAtPixel(Pe,Ne+xt,!0),qe.getElevationAtPixel(Pe+dt,Ne+xt,!0)]}(k,ue.x-se,ue.y-ce,ve,we),Le=Math.abs(Se[0]-Se[1]),ge=Math.abs(Se[2]-Se[3]),ke=Math.abs(Se[0]-Se[2])+Math.abs(Se[1]-Se[3]),Be=Math.min(.25,.5*re*(Le+ge)/ve),Re=Math.min(.25,.5*re*ke/we);return ne+Math.max(Be*G,Re*X)}(a,h,m):y;return{base:y+(r===0)?-1:r,top:x?Math.max(E+n,y+r+2):y+n}}He(iu,"CanonicalTileID"),He(Hi,"OverscaledTileID",{omit:["projMatrix"]});let G0=Oe([{name:"a_pos_normal",components:2,type:"Int16"},{name:"a_data",components:4,type:"Uint8"},{name:"a_linesofar",components:1,type:"Float32"}],4),{members:$0}=G0,q0=Oe([{name:"a_packed",components:4,type:"Float32"}]),{members:Z0}=q0,W0=Is.VectorTileFeature.types,H0=Math.cos(Math.PI/180*37.5);class nu{constructor(e){this.zoom=e.zoom,this.overscaling=e.overscaling,this.layers=e.layers,this.layerIds=this.layers.map(r=>r.id),this.index=e.index,this.projection=e.projection,this.hasPattern=!1,this.patternFeatures=[],this.lineClipsArray=[],this.gradients={},this.layers.forEach(r=>{this.gradients[r.id]={}}),this.layoutVertexArray=new pt,this.layoutVertexArray2=new Ot,this.indexArray=new Mt,this.programConfigurations=new Es(e.layers,e.zoom),this.segments=new fi,this.maxLineLength=0,this.stateDependentLayerIds=this.layers.filter(r=>r.isStateDependent()).map(r=>r.id)}populate(e,r,n,a){this.hasPattern=qp("line",this.layers,r);let h=this.layers[0].layout.get("line-sort-key"),d=[];for(let{feature:E,id:k,index:S,sourceLayerIndex:M}of e){let P=this.layers[0]._featureFilter.needGeometry,F=ks(E,P);if(!this.layers[0]._featureFilter.filter(new $(this.zoom),F,n))continue;let G=h?h.evaluate(F,{},n):void 0,X={id:k,properties:E.properties,type:E.type,sourceLayerIndex:M,index:S,geometry:P?F.geometry:Zn(E,n,a),patterns:{},sortKey:G};d.push(X)}h&&d.sort((E,k)=>E.sortKey-k.sortKey);let{lineAtlas:m,featureIndex:y}=r,x=this.addConstantDashes(m);for(let E of d){let{geometry:k,index:S,sourceLayerIndex:M}=E;if(x&&this.addFeatureDashes(E,m),this.hasPattern){let P=Zp("line",this.layers,E,this.zoom,r);this.patternFeatures.push(P)}else this.addFeature(E,k,S,n,m.positions,r.availableImages);y.insert(e[S].feature,k,S,M,this.index)}}addConstantDashes(e){let r=!1;for(let n of this.layers){let a=n.paint.get("line-dasharray").value,h=n.layout.get("line-cap").value;if(a.kind!=="constant"||h.kind!=="constant")r=!0;else{let d=h.value,m=a.value;if(!m)continue;e.addDash(m.from,d),e.addDash(m.to,d),m.other&&e.addDash(m.other,d)}}return r}addFeatureDashes(e,r){let n=this.zoom;for(let a of this.layers){let h=a.paint.get("line-dasharray").value,d=a.layout.get("line-cap").value;if(h.kind==="constant"&&d.kind==="constant")continue;let m,y,x,E,k,S;if(h.kind==="constant"){let G=h.value;if(!G)continue;m=G.other||G.to,y=G.to,x=G.from}else m=h.evaluate({zoom:n-1},e),y=h.evaluate({zoom:n},e),x=h.evaluate({zoom:n+1},e);d.kind==="constant"?E=k=S=d.value:(E=d.evaluate({zoom:n-1},e),k=d.evaluate({zoom:n},e),S=d.evaluate({zoom:n+1},e)),r.addDash(m,E),r.addDash(y,k),r.addDash(x,S);let M=r.getKey(m,E),P=r.getKey(y,k),F=r.getKey(x,S);e.patterns[a.id]={min:M,mid:P,max:F}}}update(e,r,n,a){this.stateDependentLayers.length&&this.programConfigurations.updatePaintArrays(e,r,this.stateDependentLayers,n,a)}addFeatures(e,r,n,a,h){for(let d of this.patternFeatures)this.addFeature(d,d.geometry,d.index,r,n,a)}isEmpty(){return this.layoutVertexArray.length===0}uploadPending(){return!this.uploaded||this.programConfigurations.needsUpload}upload(e){this.uploaded||(this.layoutVertexArray2.length!==0&&(this.layoutVertexBuffer2=e.createVertexBuffer(this.layoutVertexArray2,Z0)),this.layoutVertexBuffer=e.createVertexBuffer(this.layoutVertexArray,$0),this.indexBuffer=e.createIndexBuffer(this.indexArray)),this.programConfigurations.upload(e),this.uploaded=!0}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.programConfigurations.destroy(),this.segments.destroy())}lineFeatureClips(e){if(e.properties&&e.properties.hasOwnProperty("mapbox_clip_start")&&e.properties.hasOwnProperty("mapbox_clip_end"))return{start:+e.properties.mapbox_clip_start,end:+e.properties.mapbox_clip_end}}addFeature(e,r,n,a,h,d){let m=this.layers[0].layout,y=m.get("line-join").evaluate(e,{}),x=m.get("line-cap").evaluate(e,{}),E=m.get("line-miter-limit"),k=m.get("line-round-limit");this.lineClips=this.lineFeatureClips(e);for(let S of r)this.addLine(S,e,y,x,E,k);this.programConfigurations.populatePaintArrays(this.layoutVertexArray.length,e,n,h,d,a)}addLine(e,r,n,a,h,d){if(this.distance=0,this.scaledDistance=0,this.totalDistance=0,this.lineSoFar=0,this.lineClips){this.lineClipsArray.push(this.lineClips);for(let X=0;X<e.length-1;X++)this.totalDistance+=e[X].dist(e[X+1]);this.updateScaledDistance(),this.maxLineLength=Math.max(this.maxLineLength,this.totalDistance)}let m=W0[r.type]==="Polygon",y=e.length;for(;y>=2&&e[y-1].equals(e[y-2]);)y--;let x=0;for(;x<y-1&&e[x].equals(e[x+1]);)x++;if(y<(m?3:2))return;n==="bevel"&&(h=1.05);let E=this.overscaling<=16?122880/(512*this.overscaling):0,k=this.segments.prepareSegment(10*y,this.layoutVertexArray,this.indexArray),S,M,P,F,G;this.e1=this.e2=-1,m&&(S=e[y-2],G=e[x].sub(S)._unit()._perp());for(let X=x;X<y;X++){if(P=X===y-1?m?e[x+1]:void 0:e[X+1],P&&e[X].equals(P))continue;G&&(F=G),S&&(M=S),S=e[X],G=P?P.sub(S)._unit()._perp():F,F=F||G;let ne=F.add(G);ne.x===0&&ne.y===0||ne._unit();let re=F.x*G.x+F.y*G.y,se=ne.x*G.x+ne.y*G.y,ce=se!==0?1/se:1/0,ue=2*Math.sqrt(2-2*se),ve=se<H0&&M&&P,we=F.x*G.y-F.y*G.x>0;if(ve&&X>x){let ge=S.dist(M);if(ge>2*E){let ke=S.sub(S.sub(M)._mult(E/ge)._round());this.updateDistance(M,ke),this.addCurrentVertex(ke,F,0,0,k),M=ke}}let Se=M&&P,Le=Se?n:m?"butt":a;if(Se&&Le==="round"&&(ce<d?Le="miter":ce<=2&&(Le="fakeround")),Le==="miter"&&ce>h&&(Le="bevel"),Le==="bevel"&&(ce>2&&(Le="flipbevel"),ce<h&&(Le="miter")),M&&this.updateDistance(M,S),Le==="miter")ne._mult(ce),this.addCurrentVertex(S,ne,0,0,k);else if(Le==="flipbevel"){if(ce>100)ne=G.mult(-1);else{let ge=ce*F.add(G).mag()/F.sub(G).mag();ne._perp()._mult(ge*(we?-1:1))}this.addCurrentVertex(S,ne,0,0,k),this.addCurrentVertex(S,ne.mult(-1),0,0,k)}else if(Le==="bevel"||Le==="fakeround"){let ge=-Math.sqrt(ce*ce-1),ke=we?ge:0,Be=we?0:ge;if(M&&this.addCurrentVertex(S,F,ke,Be,k),Le==="fakeround"){let Re=Math.round(180*ue/Math.PI/20);for(let qe=1;qe<Re;qe++){let Pe=qe/Re;if(Pe!==.5){let dt=Pe-.5;Pe+=Pe*dt*(Pe-1)*((1.0904+re*(re*(3.55645-1.43519*re)-3.2452))*dt*dt+(.848013+re*(.215638*re-1.06021)))}let Ne=G.sub(F)._mult(Pe)._add(F)._unit()._mult(we?-1:1);this.addHalfVertex(S,Ne.x,Ne.y,!1,we,0,k)}}P&&this.addCurrentVertex(S,G,-ke,-Be,k)}else if(Le==="butt")this.addCurrentVertex(S,ne,0,0,k);else if(Le==="square"){let ge=M?1:-1;M||this.addCurrentVertex(S,ne,ge,ge,k),this.addCurrentVertex(S,ne,0,0,k),M&&this.addCurrentVertex(S,ne,ge,ge,k)}else Le==="round"&&(M&&(this.addCurrentVertex(S,F,0,0,k),this.addCurrentVertex(S,F,1,1,k,!0)),P&&(this.addCurrentVertex(S,G,-1,-1,k,!0),this.addCurrentVertex(S,G,0,0,k)));if(ve&&X<y-1){let ge=S.dist(P);if(ge>2*E){let ke=S.add(P.sub(S)._mult(E/ge)._round());this.updateDistance(S,ke),this.addCurrentVertex(ke,G,0,0,k),S=ke}}}}addCurrentVertex(e,r,n,a,h,d=!1){let m=r.y*a-r.x,y=-r.y-r.x*a;this.addHalfVertex(e,r.x+r.y*n,r.y-r.x*n,d,!1,n,h),this.addHalfVertex(e,m,y,d,!0,-a,h)}addHalfVertex({x:e,y:r},n,a,h,d,m,y){this.layoutVertexArray.emplaceBack((e<<1)+(h?1:0),(r<<1)+(d?1:0),Math.round(63*n)+128,Math.round(63*a)+128,1+(m===0?0:m<0?-1:1),0,this.lineSoFar),this.lineClips&&this.layoutVertexArray2.emplaceBack(this.scaledDistance,this.lineClipsArray.length,this.lineClips.start,this.lineClips.end);let x=y.vertexLength++;this.e1>=0&&this.e2>=0&&(this.indexArray.emplaceBack(this.e1,this.e2,x),y.primitiveLength++),d?this.e2=x:this.e1=x}updateScaledDistance(){if(this.lineClips){let e=this.totalDistance/(this.lineClips.end-this.lineClips.start);this.scaledDistance=this.distance/this.totalDistance,this.lineSoFar=e*this.lineClips.start+this.distance}else this.lineSoFar=this.distance}updateDistance(e,r){this.distance+=e.dist(r),this.updateScaledDistance()}}He(nu,"LineBucket",{omit:["layers","patternFeatures"]});let X0=new Te({"line-cap":new te(de.layout_line["line-cap"]),"line-join":new te(de.layout_line["line-join"]),"line-miter-limit":new _e(de.layout_line["line-miter-limit"]),"line-round-limit":new _e(de.layout_line["line-round-limit"]),"line-sort-key":new te(de.layout_line["line-sort-key"])});var $m={paint:new Te({"line-opacity":new te(de.paint_line["line-opacity"]),"line-color":new te(de.paint_line["line-color"]),"line-translate":new _e(de.paint_line["line-translate"]),"line-translate-anchor":new _e(de.paint_line["line-translate-anchor"]),"line-width":new te(de.paint_line["line-width"]),"line-gap-width":new te(de.paint_line["line-gap-width"]),"line-offset":new te(de.paint_line["line-offset"]),"line-blur":new te(de.paint_line["line-blur"]),"line-dasharray":new Ie(de.paint_line["line-dasharray"]),"line-pattern":new Ie(de.paint_line["line-pattern"]),"line-gradient":new Ve(de.paint_line["line-gradient"]),"line-trim-offset":new _e(de.paint_line["line-trim-offset"])}),layout:X0};let qm=new class extends te{possiblyEvaluate(i,e){return e=new $(Math.floor(e.zoom),{now:e.now,fadeDuration:e.fadeDuration,zoomHistory:e.zoomHistory,transition:e.transition}),super.possiblyEvaluate(i,e)}evaluate(i,e,r,n){return e=Bt({},e,{zoom:Math.floor(e.zoom)}),super.evaluate(i,e,r,n)}}($m.paint.properties["line-width"].specification);function Zm(i,e){return e>0?e+2*i:i}qm.useIntegerZoom=!0;let K0=Oe([{name:"a_pos_offset",components:4,type:"Int16"},{name:"a_tex_size",components:4,type:"Uint16"},{name:"a_pixeloffset",components:4,type:"Int16"}],4),Y0=Oe([{name:"a_globe_anchor",components:3,type:"Int16"},{name:"a_globe_normal",components:3,type:"Float32"}],4),J0=Oe([{name:"a_projected_pos",components:4,type:"Float32"}],4);Oe([{name:"a_fade_opacity",components:1,type:"Uint32"}],4);let Q0=Oe([{name:"a_placed",components:2,type:"Uint8"},{name:"a_shift",components:2,type:"Float32"}]),e1=Oe([{name:"a_size_scale",components:1,type:"Float32"},{name:"a_padding",components:2,type:"Float32"}]);Oe([{type:"Int16",name:"projectedAnchorX"},{type:"Int16",name:"projectedAnchorY"},{type:"Int16",name:"projectedAnchorZ"},{type:"Int16",name:"tileAnchorX"},{type:"Int16",name:"tileAnchorY"},{type:"Float32",name:"x1"},{type:"Float32",name:"y1"},{type:"Float32",name:"x2"},{type:"Float32",name:"y2"},{type:"Int16",name:"padding"},{type:"Uint32",name:"featureIndex"},{type:"Uint16",name:"sourceLayerIndex"},{type:"Uint16",name:"bucketIndex"}]);let Wm=Oe([{name:"a_pos",components:3,type:"Int16"},{name:"a_anchor_pos",components:2,type:"Int16"},{name:"a_extrude",components:2,type:"Int16"}],4),t1=Oe([{name:"a_pos_2f",components:2,type:"Float32"},{name:"a_radius",components:1,type:"Float32"},{name:"a_flags",components:2,type:"Int16"}],4);Oe([{name:"triangle",components:3,type:"Uint16"}]),Oe([{type:"Int16",name:"projectedAnchorX"},{type:"Int16",name:"projectedAnchorY"},{type:"Int16",name:"projectedAnchorZ"},{type:"Float32",name:"tileAnchorX"},{type:"Float32",name:"tileAnchorY"},{type:"Uint16",name:"glyphStartIndex"},{type:"Uint16",name:"numGlyphs"},{type:"Uint32",name:"vertexStartIndex"},{type:"Uint32",name:"lineStartIndex"},{type:"Uint32",name:"lineLength"},{type:"Uint16",name:"segment"},{type:"Uint16",name:"lowerSize"},{type:"Uint16",name:"upperSize"},{type:"Float32",name:"lineOffsetX"},{type:"Float32",name:"lineOffsetY"},{type:"Uint8",name:"writingMode"},{type:"Uint8",name:"placedOrientation"},{type:"Uint8",name:"hidden"},{type:"Uint32",name:"crossTileID"},{type:"Int16",name:"associatedIconIndex"},{type:"Uint8",name:"flipState"}]),Oe([{type:"Int16",name:"projectedAnchorX"},{type:"Int16",name:"projectedAnchorY"},{type:"Int16",name:"projectedAnchorZ"},{type:"Float32",name:"tileAnchorX"},{type:"Float32",name:"tileAnchorY"},{type:"Int16",name:"rightJustifiedTextSymbolIndex"},{type:"Int16",name:"centerJustifiedTextSymbolIndex"},{type:"Int16",name:"leftJustifiedTextSymbolIndex"},{type:"Int16",name:"verticalPlacedTextSymbolIndex"},{type:"Int16",name:"placedIconSymbolIndex"},{type:"Int16",name:"verticalPlacedIconSymbolIndex"},{type:"Uint16",name:"key"},{type:"Uint16",name:"textBoxStartIndex"},{type:"Uint16",name:"textBoxEndIndex"},{type:"Uint16",name:"verticalTextBoxStartIndex"},{type:"Uint16",name:"verticalTextBoxEndIndex"},{type:"Uint16",name:"iconBoxStartIndex"},{type:"Uint16",name:"iconBoxEndIndex"},{type:"Uint16",name:"verticalIconBoxStartIndex"},{type:"Uint16",name:"verticalIconBoxEndIndex"},{type:"Uint16",name:"featureIndex"},{type:"Uint16",name:"numHorizontalGlyphVertices"},{type:"Uint16",name:"numVerticalGlyphVertices"},{type:"Uint16",name:"numIconVertices"},{type:"Uint16",name:"numVerticalIconVertices"},{type:"Uint16",name:"useRuntimeCollisionCircles"},{type:"Uint32",name:"crossTileID"},{type:"Float32",components:2,name:"textOffset"},{type:"Float32",name:"collisionCircleDiameter"}]),Oe([{type:"Float32",name:"offsetX"}]),Oe([{type:"Int16",name:"x"},{type:"Int16",name:"y"},{type:"Int16",name:"tileUnitDistanceFromAnchor"}]);var Ui=24;let bn=128;function Wp(i,e){let{expression:r}=e;if(r.kind==="constant")return{kind:"constant",layoutSize:r.evaluate(new $(i+1))};if(r.kind==="source")return{kind:"source"};{let{zoomStops:n,interpolationType:a}=r,h=0;for(;h<n.length&&n[h]<=i;)h++;h=Math.max(0,h-1);let d=h;for(;d<n.length&&n[d]<i+1;)d++;d=Math.min(n.length-1,d);let m=n[h],y=n[d];return r.kind==="composite"?{kind:"composite",minZoom:m,maxZoom:y,interpolationType:a}:{kind:"camera",minZoom:m,maxZoom:y,minSize:r.evaluate(new $(m)),maxSize:r.evaluate(new $(y)),interpolationType:a}}}function ou(i,{uSize:e,uSizeT:r},{lowerSize:n,upperSize:a}){return i.kind==="source"?n/bn:i.kind==="composite"?Pt(n/bn,a/bn,r):e}function Wa(i,e){let r=0,n=0;if(i.kind==="constant")n=i.layoutSize;else if(i.kind!=="source"){let{interpolationType:a,minZoom:h,maxZoom:d}=i,m=a?Je(Fr.interpolationFactor(a,e,h,d),0,1):0;i.kind==="camera"?n=Pt(i.minSize,i.maxSize,m):r=m}return{uSizeT:r,uSize:n}}var i1=Object.freeze({__proto__:null,getSizeData:Wp,evaluateSizeForFeature:ou,evaluateSizeForZoom:Wa,SIZE_PACK_FACTOR:bn});function r1(i,e,r){return i.sections.forEach(n=>{n.text=function(a,h,d){let m=h.layout.get("text-transform").evaluate(d,{});return m==="uppercase"?a=a.toLocaleUpperCase():m==="lowercase"&&(a=a.toLocaleLowerCase()),U.applyArabicShaping&&(a=U.applyArabicShaping(a)),a}(n.text,e,r)}),i}let lc={"!":"\uFE15","#":"\uFF03",$:"\uFF04","%":"\uFF05","&":"\uFF06","(":"\uFE35",")":"\uFE36","*":"\uFF0A","+":"\uFF0B",",":"\uFE10","-":"\uFE32",".":"\u30FB","/":"\uFF0F",":":"\uFE13",";":"\uFE14","<":"\uFE3F","=":"\uFF1D",">":"\uFE40","?":"\uFE16","@":"\uFF20","[":"\uFE47","\\":"\uFF3C","]":"\uFE48","^":"\uFF3E",_:"\uFE33","`":"\uFF40","{":"\uFE37","|":"\u2015","}":"\uFE38","~":"\uFF5E","\xA2":"\uFFE0","\xA3":"\uFFE1","\xA5":"\uFFE5","\xA6":"\uFFE4","\xAC":"\uFFE2","\xAF":"\uFFE3","\u2013":"\uFE32","\u2014":"\uFE31","\u2018":"\uFE43","\u2019":"\uFE44","\u201C":"\uFE41","\u201D":"\uFE42","\u2026":"\uFE19","\u2027":"\u30FB","\u20A9":"\uFFE6","\u3001":"\uFE11","\u3002":"\uFE12","\u3008":"\uFE3F","\u3009":"\uFE40","\u300A":"\uFE3D","\u300B":"\uFE3E","\u300C":"\uFE41","\u300D":"\uFE42","\u300E":"\uFE43","\u300F":"\uFE44","\u3010":"\uFE3B","\u3011":"\uFE3C","\u3014":"\uFE39","\u3015":"\uFE3A","\u3016":"\uFE17","\u3017":"\uFE18","\uFF01":"\uFE15","\uFF08":"\uFE35","\uFF09":"\uFE36","\uFF0C":"\uFE10","\uFF0D":"\uFE32","\uFF0E":"\u30FB","\uFF1A":"\uFE13","\uFF1B":"\uFE14","\uFF1C":"\uFE3F","\uFF1E":"\uFE40","\uFF1F":"\uFE16","\uFF3B":"\uFE47","\uFF3D":"\uFE48","\uFF3F":"\uFE33","\uFF5B":"\uFE37","\uFF5C":"\u2015","\uFF5D":"\uFE38","\uFF5F":"\uFE35","\uFF60":"\uFE36","\uFF61":"\uFE12","\uFF62":"\uFE41","\uFF63":"\uFE42"};function n1(i){return i==="\uFE36"||i==="\uFE48"||i==="\uFE38"||i==="\uFE44"||i==="\uFE42"||i==="\uFE3E"||i==="\uFE3C"||i==="\uFE3A"||i==="\uFE18"||i==="\uFE40"||i==="\uFE10"||i==="\uFE13"||i==="\uFE14"||i==="\uFF40"||i==="\uFFE3"||i==="\uFE11"||i==="\uFE12"}function o1(i){return i==="\uFE35"||i==="\uFE47"||i==="\uFE37"||i==="\uFE43"||i==="\uFE41"||i==="\uFE3D"||i==="\uFE3B"||i==="\uFE39"||i==="\uFE17"||i==="\uFE3F"}var Hm=function(i,e,r,n,a){var h,d,m=8*a-n-1,y=(1<<m)-1,x=y>>1,E=-7,k=r?a-1:0,S=r?-1:1,M=i[e+k];for(k+=S,h=M&(1<<-E)-1,M>>=-E,E+=m;E>0;h=256*h+i[e+k],k+=S,E-=8);for(d=h&(1<<-E)-1,h>>=-E,E+=n;E>0;d=256*d+i[e+k],k+=S,E-=8);if(h===0)h=1-x;else{if(h===y)return d?NaN:1/0*(M?-1:1);d+=Math.pow(2,n),h-=x}return(M?-1:1)*d*Math.pow(2,h-n)},Xm=function(i,e,r,n,a,h){var d,m,y,x=8*h-a-1,E=(1<<x)-1,k=E>>1,S=a===23?Math.pow(2,-24)-Math.pow(2,-77):0,M=n?0:h-1,P=n?1:-1,F=e<0||e===0&&1/e<0?1:0;for(e=Math.abs(e),isNaN(e)||e===1/0?(m=isNaN(e)?1:0,d=E):(d=Math.floor(Math.log(e)/Math.LN2),e*(y=Math.pow(2,-d))<1&&(d--,y*=2),(e+=d+k>=1?S/y:S*Math.pow(2,1-k))*y>=2&&(d++,y/=2),d+k>=E?(m=0,d=E):d+k>=1?(m=(e*y-1)*Math.pow(2,a),d+=k):(m=e*Math.pow(2,k-1)*Math.pow(2,a),d=0));a>=8;i[r+M]=255&m,M+=P,m/=256,a-=8);for(d=d<<a|m,x+=a;x>0;i[r+M]=255&d,M+=P,d/=256,x-=8);i[r+M-P]|=128*F},cc=Xt;function Xt(i){this.buf=ArrayBuffer.isView&&ArrayBuffer.isView(i)?i:new Uint8Array(i||0),this.pos=0,this.type=0,this.length=this.buf.length}Xt.Varint=0,Xt.Fixed64=1,Xt.Bytes=2,Xt.Fixed32=5;var Hp=4294967296,Km=1/Hp,Ym=typeof TextDecoder>"u"?null:new TextDecoder("utf8");function Hn(i){return i.type===Xt.Bytes?i.readVarint()+i.pos:i.pos+1}function Ha(i,e,r){return r?4294967296*e+(i>>>0):4294967296*(e>>>0)+(i>>>0)}function Jm(i,e,r){var n=e<=16383?1:e<=2097151?2:e<=268435455?3:Math.floor(Math.log(e)/(7*Math.LN2));r.realloc(n);for(var a=r.pos-1;a>=i;a--)r.buf[a+n]=r.buf[a]}function s1(i,e){for(var r=0;r<i.length;r++)e.writeVarint(i[r])}function a1(i,e){for(var r=0;r<i.length;r++)e.writeSVarint(i[r])}function l1(i,e){for(var r=0;r<i.length;r++)e.writeFloat(i[r])}function c1(i,e){for(var r=0;r<i.length;r++)e.writeDouble(i[r])}function h1(i,e){for(var r=0;r<i.length;r++)e.writeBoolean(i[r])}function u1(i,e){for(var r=0;r<i.length;r++)e.writeFixed32(i[r])}function p1(i,e){for(var r=0;r<i.length;r++)e.writeSFixed32(i[r])}function d1(i,e){for(var r=0;r<i.length;r++)e.writeFixed64(i[r])}function f1(i,e){for(var r=0;r<i.length;r++)e.writeSFixed64(i[r])}function su(i,e){return(i[e]|i[e+1]<<8|i[e+2]<<16)+16777216*i[e+3]}function Xa(i,e,r){i[r]=e,i[r+1]=e>>>8,i[r+2]=e>>>16,i[r+3]=e>>>24}function Qm(i,e){return(i[e]|i[e+1]<<8|i[e+2]<<16)+(i[e+3]<<24)}function m1(i,e,r){e.glyphs=[],i===1&&r.readMessage(g1,e)}function g1(i,e,r){if(i===3){let{id:n,bitmap:a,width:h,height:d,left:m,top:y,advance:x}=r.readMessage(_1,{});e.glyphs.push({id:n,bitmap:new Wn({width:h+6,height:d+6},a),metrics:{width:h,height:d,left:m,top:y,advance:x}})}else i===4?e.ascender=r.readSVarint():i===5&&(e.descender=r.readSVarint())}function _1(i,e,r){i===1?e.id=r.readVarint():i===2?e.bitmap=r.readBytes():i===3?e.width=r.readVarint():i===4?e.height=r.readVarint():i===5?e.left=r.readSVarint():i===6?e.top=r.readSVarint():i===7&&(e.advance=r.readVarint())}function Xp(i){let e=0,r=0;for(let d of i)e+=d.w*d.h,r=Math.max(r,d.w);i.sort((d,m)=>m.h-d.h);let n=[{x:0,y:0,w:Math.max(Math.ceil(Math.sqrt(e/.95)),r),h:1/0}],a=0,h=0;for(let d of i)for(let m=n.length-1;m>=0;m--){let y=n[m];if(!(d.w>y.w||d.h>y.h)){if(d.x=y.x,d.y=y.y,h=Math.max(h,d.y+d.h),a=Math.max(a,d.x+d.w),d.w===y.w&&d.h===y.h){let x=n.pop();m<n.length&&(n[m]=x)}else d.h===y.h?(y.x+=d.w,y.w-=d.w):d.w===y.w?(y.y+=d.h,y.h-=d.h):(n.push({x:y.x+d.w,y:y.y,w:y.w-d.w,h:d.h}),y.y+=d.h,y.h-=d.h);break}}return{w:a,h,fill:e/(a*h)||0}}Xt.prototype={destroy:function(){this.buf=null},readFields:function(i,e,r){for(r=r||this.length;this.pos<r;){var n=this.readVarint(),a=n>>3,h=this.pos;this.type=7&n,i(a,e,this),this.pos===h&&this.skip(n)}return e},readMessage:function(i,e){return this.readFields(i,e,this.readVarint()+this.pos)},readFixed32:function(){var i=su(this.buf,this.pos);return this.pos+=4,i},readSFixed32:function(){var i=Qm(this.buf,this.pos);return this.pos+=4,i},readFixed64:function(){var i=su(this.buf,this.pos)+su(this.buf,this.pos+4)*Hp;return this.pos+=8,i},readSFixed64:function(){var i=su(this.buf,this.pos)+Qm(this.buf,this.pos+4)*Hp;return this.pos+=8,i},readFloat:function(){var i=Hm(this.buf,this.pos,!0,23,4);return this.pos+=4,i},readDouble:function(){var i=Hm(this.buf,this.pos,!0,52,8);return this.pos+=8,i},readVarint:function(i){var e,r,n=this.buf;return e=127&(r=n[this.pos++]),r<128?e:(e|=(127&(r=n[this.pos++]))<<7,r<128?e:(e|=(127&(r=n[this.pos++]))<<14,r<128?e:(e|=(127&(r=n[this.pos++]))<<21,r<128?e:function(a,h,d){var m,y,x=d.buf;if(m=(112&(y=x[d.pos++]))>>4,y<128||(m|=(127&(y=x[d.pos++]))<<3,y<128)||(m|=(127&(y=x[d.pos++]))<<10,y<128)||(m|=(127&(y=x[d.pos++]))<<17,y<128)||(m|=(127&(y=x[d.pos++]))<<24,y<128)||(m|=(1&(y=x[d.pos++]))<<31,y<128))return Ha(a,m,h);throw new Error("Expected varint not more than 10 bytes")}(e|=(15&(r=n[this.pos]))<<28,i,this))))},readVarint64:function(){return this.readVarint(!0)},readSVarint:function(){var i=this.readVarint();return i%2==1?(i+1)/-2:i/2},readBoolean:function(){return Boolean(this.readVarint())},readString:function(){var i=this.readVarint()+this.pos,e=this.pos;return this.pos=i,i-e>=12&&Ym?function(r,n,a){return Ym.decode(r.subarray(n,a))}(this.buf,e,i):function(r,n,a){for(var h="",d=n;d<a;){var m,y,x,E=r[d],k=null,S=E>239?4:E>223?3:E>191?2:1;if(d+S>a)break;S===1?E<128&&(k=E):S===2?(192&(m=r[d+1]))==128&&(k=(31&E)<<6|63&m)<=127&&(k=null):S===3?(y=r[d+2],(192&(m=r[d+1]))==128&&(192&y)==128&&((k=(15&E)<<12|(63&m)<<6|63&y)<=2047||k>=55296&&k<=57343)&&(k=null)):S===4&&(y=r[d+2],x=r[d+3],(192&(m=r[d+1]))==128&&(192&y)==128&&(192&x)==128&&((k=(15&E)<<18|(63&m)<<12|(63&y)<<6|63&x)<=65535||k>=1114112)&&(k=null)),k===null?(k=65533,S=1):k>65535&&(k-=65536,h+=String.fromCharCode(k>>>10&1023|55296),k=56320|1023&k),h+=String.fromCharCode(k),d+=S}return h}(this.buf,e,i)},readBytes:function(){var i=this.readVarint()+this.pos,e=this.buf.subarray(this.pos,i);return this.pos=i,e},readPackedVarint:function(i,e){if(this.type!==Xt.Bytes)return i.push(this.readVarint(e));var r=Hn(this);for(i=i||[];this.pos<r;)i.push(this.readVarint(e));return i},readPackedSVarint:function(i){if(this.type!==Xt.Bytes)return i.push(this.readSVarint());var e=Hn(this);for(i=i||[];this.pos<e;)i.push(this.readSVarint());return i},readPackedBoolean:function(i){if(this.type!==Xt.Bytes)return i.push(this.readBoolean());var e=Hn(this);for(i=i||[];this.pos<e;)i.push(this.readBoolean());return i},readPackedFloat:function(i){if(this.type!==Xt.Bytes)return i.push(this.readFloat());var e=Hn(this);for(i=i||[];this.pos<e;)i.push(this.readFloat());return i},readPackedDouble:function(i){if(this.type!==Xt.Bytes)return i.push(this.readDouble());var e=Hn(this);for(i=i||[];this.pos<e;)i.push(this.readDouble());return i},readPackedFixed32:function(i){if(this.type!==Xt.Bytes)return i.push(this.readFixed32());var e=Hn(this);for(i=i||[];this.pos<e;)i.push(this.readFixed32());return i},readPackedSFixed32:function(i){if(this.type!==Xt.Bytes)return i.push(this.readSFixed32());var e=Hn(this);for(i=i||[];this.pos<e;)i.push(this.readSFixed32());return i},readPackedFixed64:function(i){if(this.type!==Xt.Bytes)return i.push(this.readFixed64());var e=Hn(this);for(i=i||[];this.pos<e;)i.push(this.readFixed64());return i},readPackedSFixed64:function(i){if(this.type!==Xt.Bytes)return i.push(this.readSFixed64());var e=Hn(this);for(i=i||[];this.pos<e;)i.push(this.readSFixed64());return i},skip:function(i){var e=7&i;if(e===Xt.Varint)for(;this.buf[this.pos++]>127;);else if(e===Xt.Bytes)this.pos=this.readVarint()+this.pos;else if(e===Xt.Fixed32)this.pos+=4;else{if(e!==Xt.Fixed64)throw new Error("Unimplemented type: "+e);this.pos+=8}},writeTag:function(i,e){this.writeVarint(i<<3|e)},realloc:function(i){for(var e=this.length||16;e<this.pos+i;)e*=2;if(e!==this.length){var r=new Uint8Array(e);r.set(this.buf),this.buf=r,this.length=e}},finish:function(){return this.length=this.pos,this.pos=0,this.buf.subarray(0,this.length)},writeFixed32:function(i){this.realloc(4),Xa(this.buf,i,this.pos),this.pos+=4},writeSFixed32:function(i){this.realloc(4),Xa(this.buf,i,this.pos),this.pos+=4},writeFixed64:function(i){this.realloc(8),Xa(this.buf,-1&i,this.pos),Xa(this.buf,Math.floor(i*Km),this.pos+4),this.pos+=8},writeSFixed64:function(i){this.realloc(8),Xa(this.buf,-1&i,this.pos),Xa(this.buf,Math.floor(i*Km),this.pos+4),this.pos+=8},writeVarint:function(i){(i=+i||0)>268435455||i<0?function(e,r){var n,a;if(e>=0?(n=e%4294967296|0,a=e/4294967296|0):(a=~(-e/4294967296),4294967295^(n=~(-e%4294967296))?n=n+1|0:(n=0,a=a+1|0)),e>=18446744073709552e3||e<-18446744073709552e3)throw new Error("Given varint doesn't fit into 10 bytes");r.realloc(10),function(h,d,m){m.buf[m.pos++]=127&h|128,h>>>=7,m.buf[m.pos++]=127&h|128,h>>>=7,m.buf[m.pos++]=127&h|128,h>>>=7,m.buf[m.pos++]=127&h|128,m.buf[m.pos]=127&(h>>>=7)}(n,0,r),function(h,d){var m=(7&h)<<4;d.buf[d.pos++]|=m|((h>>>=3)?128:0),h&&(d.buf[d.pos++]=127&h|((h>>>=7)?128:0),h&&(d.buf[d.pos++]=127&h|((h>>>=7)?128:0),h&&(d.buf[d.pos++]=127&h|((h>>>=7)?128:0),h&&(d.buf[d.pos++]=127&h|((h>>>=7)?128:0),h&&(d.buf[d.pos++]=127&h)))))}(a,r)}(i,this):(this.realloc(4),this.buf[this.pos++]=127&i|(i>127?128:0),i<=127||(this.buf[this.pos++]=127&(i>>>=7)|(i>127?128:0),i<=127||(this.buf[this.pos++]=127&(i>>>=7)|(i>127?128:0),i<=127||(this.buf[this.pos++]=i>>>7&127))))},writeSVarint:function(i){this.writeVarint(i<0?2*-i-1:2*i)},writeBoolean:function(i){this.writeVarint(Boolean(i))},writeString:function(i){i=String(i),this.realloc(4*i.length),this.pos++;var e=this.pos;this.pos=function(n,a,h){for(var d,m,y=0;y<a.length;y++){if((d=a.charCodeAt(y))>55295&&d<57344){if(!m){d>56319||y+1===a.length?(n[h++]=239,n[h++]=191,n[h++]=189):m=d;continue}if(d<56320){n[h++]=239,n[h++]=191,n[h++]=189,m=d;continue}d=m-55296<<10|d-56320|65536,m=null}else m&&(n[h++]=239,n[h++]=191,n[h++]=189,m=null);d<128?n[h++]=d:(d<2048?n[h++]=d>>6|192:(d<65536?n[h++]=d>>12|224:(n[h++]=d>>18|240,n[h++]=d>>12&63|128),n[h++]=d>>6&63|128),n[h++]=63&d|128)}return h}(this.buf,i,this.pos);var r=this.pos-e;r>=128&&Jm(e,r,this),this.pos=e-1,this.writeVarint(r),this.pos+=r},writeFloat:function(i){this.realloc(4),Xm(this.buf,i,this.pos,!0,23,4),this.pos+=4},writeDouble:function(i){this.realloc(8),Xm(this.buf,i,this.pos,!0,52,8),this.pos+=8},writeBytes:function(i){var e=i.length;this.writeVarint(e),this.realloc(e);for(var r=0;r<e;r++)this.buf[this.pos++]=i[r]},writeRawMessage:function(i,e){this.pos++;var r=this.pos;i(e,this);var n=this.pos-r;n>=128&&Jm(r,n,this),this.pos=r-1,this.writeVarint(n),this.pos+=n},writeMessage:function(i,e,r){this.writeTag(i,Xt.Bytes),this.writeRawMessage(e,r)},writePackedVarint:function(i,e){e.length&&this.writeMessage(i,s1,e)},writePackedSVarint:function(i,e){e.length&&this.writeMessage(i,a1,e)},writePackedBoolean:function(i,e){e.length&&this.writeMessage(i,h1,e)},writePackedFloat:function(i,e){e.length&&this.writeMessage(i,l1,e)},writePackedDouble:function(i,e){e.length&&this.writeMessage(i,c1,e)},writePackedFixed32:function(i,e){e.length&&this.writeMessage(i,u1,e)},writePackedSFixed32:function(i,e){e.length&&this.writeMessage(i,p1,e)},writePackedFixed64:function(i,e){e.length&&this.writeMessage(i,d1,e)},writePackedSFixed64:function(i,e){e.length&&this.writeMessage(i,f1,e)},writeBytesField:function(i,e){this.writeTag(i,Xt.Bytes),this.writeBytes(e)},writeFixed32Field:function(i,e){this.writeTag(i,Xt.Fixed32),this.writeFixed32(e)},writeSFixed32Field:function(i,e){this.writeTag(i,Xt.Fixed32),this.writeSFixed32(e)},writeFixed64Field:function(i,e){this.writeTag(i,Xt.Fixed64),this.writeFixed64(e)},writeSFixed64Field:function(i,e){this.writeTag(i,Xt.Fixed64),this.writeSFixed64(e)},writeVarintField:function(i,e){this.writeTag(i,Xt.Varint),this.writeVarint(e)},writeSVarintField:function(i,e){this.writeTag(i,Xt.Varint),this.writeSVarint(e)},writeStringField:function(i,e){this.writeTag(i,Xt.Bytes),this.writeString(e)},writeFloatField:function(i,e){this.writeTag(i,Xt.Fixed32),this.writeFloat(e)},writeDoubleField:function(i,e){this.writeTag(i,Xt.Fixed64),this.writeDouble(e)},writeBooleanField:function(i,e){this.writeVarintField(i,Boolean(e))}};class Kp{constructor(e,{pixelRatio:r,version:n,stretchX:a,stretchY:h,content:d}){this.paddedRect=e,this.pixelRatio=r,this.stretchX=a,this.stretchY=h,this.content=d,this.version=n}get tl(){return[this.paddedRect.x+1,this.paddedRect.y+1]}get br(){return[this.paddedRect.x+this.paddedRect.w-1,this.paddedRect.y+this.paddedRect.h-1]}get displaySize(){return[(this.paddedRect.w-2)/this.pixelRatio,(this.paddedRect.h-2)/this.pixelRatio]}}class eg{constructor(e,r){let n={},a={};this.haveRenderCallbacks=[];let h=[];this.addImages(e,n,h),this.addImages(r,a,h);let{w:d,h:m}=Xp(h),y=new vr({width:d||1,height:m||1});for(let x in e){let E=e[x],k=n[x].paddedRect;vr.copy(E.data,y,{x:0,y:0},{x:k.x+1,y:k.y+1},E.data)}for(let x in r){let E=r[x],k=a[x].paddedRect,S=k.x+1,M=k.y+1,P=E.data.width,F=E.data.height;vr.copy(E.data,y,{x:0,y:0},{x:S,y:M},E.data),vr.copy(E.data,y,{x:0,y:F-1},{x:S,y:M-1},{width:P,height:1}),vr.copy(E.data,y,{x:0,y:0},{x:S,y:M+F},{width:P,height:1}),vr.copy(E.data,y,{x:P-1,y:0},{x:S-1,y:M},{width:1,height:F}),vr.copy(E.data,y,{x:0,y:0},{x:S+P,y:M},{width:1,height:F})}this.image=y,this.iconPositions=n,this.patternPositions=a}addImages(e,r,n){for(let a in e){let h=e[a],d={x:0,y:0,w:h.data.width+2,h:h.data.height+2};n.push(d),r[a]=new Kp(d,h),h.hasRenderCallback&&this.haveRenderCallbacks.push(a)}}patchUpdatedImages(e,r){this.haveRenderCallbacks=this.haveRenderCallbacks.filter(n=>e.hasImage(n)),e.dispatchRenderCallbacks(this.haveRenderCallbacks);for(let n in e.updatedImages)this.patchUpdatedImage(this.iconPositions[n],e.getImage(n),r),this.patchUpdatedImage(this.patternPositions[n],e.getImage(n),r)}patchUpdatedImage(e,r,n){if(!e||!r||e.version===r.version)return;e.version=r.version;let[a,h]=e.tl;n.update(r.data,void 0,{x:a,y:h})}}He(Kp,"ImagePosition"),He(eg,"ImageAtlas");let zr={horizontal:1,vertical:2,horizontalOnly:3};class hc{constructor(){this.scale=1,this.fontStack="",this.imageName=null}static forText(e,r){let n=new hc;return n.scale=e||1,n.fontStack=r,n}static forImage(e){let r=new hc;return r.imageName=e,r}}class Ka{constructor(){this.text="",this.sectionIndex=[],this.sections=[],this.imageSectionID=null}static fromFeature(e,r){let n=new Ka;for(let a=0;a<e.sections.length;a++){let h=e.sections[a];h.image?n.addImageSection(h):n.addTextSection(h,r)}return n}length(){return this.text.length}getSection(e){return this.sections[this.sectionIndex[e]]}getSections(){return this.sections}getSectionIndex(e){return this.sectionIndex[e]}getCharCode(e){return this.text.charCodeAt(e)}verticalizePunctuation(e){this.text=function(r,n){let a="";for(let h=0;h<r.length;h++){let d=r.charCodeAt(h+1)||null,m=r.charCodeAt(h-1)||null;a+=!n&&(d&&s(d)&&!lc[r[h+1]]||m&&s(m)&&!lc[r[h-1]])||!lc[r[h]]?r[h]:lc[r[h]]}return a}(this.text,e)}trim(){let e=0;for(let n=0;n<this.text.length&&au[this.text.charCodeAt(n)];n++)e++;let r=this.text.length;for(let n=this.text.length-1;n>=0&&n>=e&&au[this.text.charCodeAt(n)];n--)r--;this.text=this.text.substring(e,r),this.sectionIndex=this.sectionIndex.slice(e,r)}substring(e,r){let n=new Ka;return n.text=this.text.substring(e,r),n.sectionIndex=this.sectionIndex.slice(e,r),n.sections=this.sections,n}toString(){return this.text}getMaxScale(){return this.sectionIndex.reduce((e,r)=>Math.max(e,this.sections[r].scale),0)}addTextSection(e,r){this.text+=e.text,this.sections.push(hc.forText(e.scale,e.fontStack||r));let n=this.sections.length-1;for(let a=0;a<e.text.length;++a)this.sectionIndex.push(n)}addImageSection(e){let r=e.image?e.image.name:"";if(r.length===0)return void ci("Can't add FormattedSection with an empty image.");let n=this.getNextImageSectionCharCode();n?(this.text+=String.fromCharCode(n),this.sections.push(hc.forImage(r)),this.sectionIndex.push(this.sections.length-1)):ci("Reached maximum number of images 6401")}getNextImageSectionCharCode(){return this.imageSectionID?this.imageSectionID>=63743?null:++this.imageSectionID:(this.imageSectionID=57344,this.imageSectionID)}}function Yp(i,e,r,n,a,h,d,m,y,x,E,k,S,M,P,F){let G=Ka.fromFeature(i,a),X;k===zr.vertical&&G.verticalizePunctuation(S);let{processBidirectionalText:ne,processStyledBidirectionalText:re}=U;if(ne&&G.sections.length===1){X=[];let ue=ne(G.toString(),Jp(G,x,h,e,n,M,P));for(let ve of ue){let we=new Ka;we.text=ve,we.sections=G.sections;for(let Se=0;Se<ve.length;Se++)we.sectionIndex.push(0);X.push(we)}}else if(re){X=[];let ue=re(G.text,G.sectionIndex,Jp(G,x,h,e,n,M,P));for(let ve of ue){let we=new Ka;we.text=ve[0],we.sectionIndex=ve[1],we.sections=G.sections,X.push(we)}}else X=function(ue,ve){let we=[],Se=ue.text,Le=0;for(let ge of ve)we.push(ue.substring(Le,ge)),Le=ge;return Le<Se.length&&we.push(ue.substring(Le,Se.length)),we}(G,Jp(G,x,h,e,n,M,P));let se=[],ce={positionedLines:se,text:G.toString(),top:E[1],bottom:E[1],left:E[0],right:E[0],writingMode:k,iconsInText:!1,verticalizable:!1,hasBaseline:!1};return function(ue,ve,we,Se,Le,ge,ke,Be,Re,qe,Pe,Ne){let dt=0,xt=0,it=0,Xe=Be==="right"?1:Be==="left"?0:.5,vt=!1;for(let bt of Le){let Lt=bt.getSections();for(let Kt of Lt){if(Kt.imageName)continue;let Wt=ve[Kt.fontStack];if(Wt&&(vt=Wt.ascender!==void 0&&Wt.descender!==void 0,!vt))break}if(!vt)break}let gt=0;for(let bt of Le){bt.trim();let Lt=bt.getMaxScale(),Kt=(Lt-1)*Ui,Wt={positionedGlyphs:[],lineOffset:0};ue.positionedLines[gt]=Wt;let qt=Wt.positionedGlyphs,Qt=0;if(!bt.length()){xt+=ge,++gt;continue}let ni=0,Di=0;for(let Ct=0;Ct<bt.length();Ct++){let pi=bt.getSection(Ct),Gi=bt.getSectionIndex(Ct),Ut=bt.getCharCode(Ct),oi=pi.scale,Ki=null,ti=null,gi=null,Li=Ui,Ai=0,Vi=!(Re===zr.horizontal||!Pe&&!t(Ut)||Pe&&(au[Ut]||(Qe=Ut,Sh(Qe)||Ah(Qe)||vs(Qe)||$l(Qe)||Wl(Qe))));if(pi.imageName){let Yi=Se[pi.imageName];if(!Yi)continue;gi=pi.imageName,ue.iconsInText=ue.iconsInText||!0,ti=Yi.paddedRect;let Bi=Yi.displaySize;oi=oi*Ui/Ne,Ki={width:Bi[0],height:Bi[1],left:1,top:-3,advance:Vi?Bi[1]:Bi[0],localGlyph:!1},Ai=vt?-Ki.height*oi:Lt*Ui-17-Bi[1]*oi,Li=Ki.advance;let Kn=(Vi?Bi[0]:Bi[1])*oi-Ui*Lt;Kn>0&&Kn>Qt&&(Qt=Kn)}else{let Yi=we[pi.fontStack];if(!Yi)continue;Yi[Ut]&&(ti=Yi[Ut]);let Bi=ve[pi.fontStack];if(!Bi)continue;let Kn=Bi.glyphs[Ut];if(!Kn)continue;if(Ki=Kn.metrics,Li=Ut!==8203?Ui:0,vt){let il=Bi.ascender!==void 0?Math.abs(Bi.ascender):0,vc=Bi.descender!==void 0?Math.abs(Bi.descender):0,bc=(il+vc)*oi;ni<bc&&(ni=bc,Di=(il-vc)/2*oi),Ai=-il*oi}else Ai=(Lt-oi)*Ui-17}Vi?(ue.verticalizable=!0,qt.push({glyph:Ut,imageName:gi,x:dt,y:xt+Ai,vertical:Vi,scale:oi,localGlyph:Ki.localGlyph,fontStack:pi.fontStack,sectionIndex:Gi,metrics:Ki,rect:ti}),dt+=Li*oi+qe):(qt.push({glyph:Ut,imageName:gi,x:dt,y:xt+Ai,vertical:Vi,scale:oi,localGlyph:Ki.localGlyph,fontStack:pi.fontStack,sectionIndex:Gi,metrics:Ki,rect:ti}),dt+=Ki.advance*oi+qe)}qt.length!==0&&(it=Math.max(dt-qe,it),vt?og(qt,Xe,Qt,Di,ge*Lt/2):og(qt,Xe,Qt,0,ge/2)),dt=0;let or=ge*Lt+Qt;Wt.lineOffset=Math.max(Qt,Kt),xt+=or,++gt}var Qe;let Ei=xt,{horizontalAlign:mi,verticalAlign:ui}=Qp(ke);(function(bt,Lt,Kt,Wt,qt,Qt){let ni=(Lt-Kt)*qt,Di=-Qt*Wt;for(let or of bt)for(let Ct of or.positionedGlyphs)Ct.x+=ni,Ct.y+=Di})(ue.positionedLines,Xe,mi,ui,it,Ei),ue.top+=-ui*Ei,ue.bottom=ue.top+Ei,ue.left+=-mi*it,ue.right=ue.left+it,ue.hasBaseline=vt}(ce,e,r,n,X,d,m,y,k,x,S,F),!function(ue){for(let ve of ue)if(ve.positionedGlyphs.length!==0)return!1;return!0}(se)&&ce}let au={9:!0,10:!0,11:!0,12:!0,13:!0,32:!0},y1={10:!0,32:!0,38:!0,40:!0,41:!0,43:!0,45:!0,47:!0,173:!0,183:!0,8203:!0,8208:!0,8211:!0,8231:!0};function tg(i,e,r,n,a,h){if(e.imageName){let d=n[e.imageName];return d?d.displaySize[0]*e.scale*Ui/h+a:0}{let d=r[e.fontStack],m=d&&d.glyphs[i];return m?m.metrics.advance*e.scale+a:0}}function ig(i,e,r,n){let a=Math.pow(i-e,2);return n?i<e?a/2:2*a:a+Math.abs(r)*r}function x1(i,e,r){let n=0;return i===10&&(n-=1e4),r&&(n+=150),i!==40&&i!==65288||(n+=50),e!==41&&e!==65289||(n+=50),n}function rg(i,e,r,n,a,h){let d=null,m=ig(e,r,a,h);for(let y of n){let x=ig(e-y.x,r,a,h)+y.badness;x<=m&&(d=y,m=x)}return{index:i,x:e,priorBreak:d,badness:m}}function ng(i){return i?ng(i.priorBreak).concat(i.index):[]}function Jp(i,e,r,n,a,h,d){if(h!=="point")return[];if(!i)return[];let m=[],y=function(S,M,P,F,G,X){let ne=0;for(let re=0;re<S.length();re++){let se=S.getSection(re);ne+=tg(S.getCharCode(re),se,F,G,M,X)}return ne/Math.max(1,Math.ceil(ne/P))}(i,e,r,n,a,d),x=i.text.indexOf("\u200B")>=0,E=0;for(let S=0;S<i.length();S++){let M=i.getSection(S),P=i.getCharCode(S);if(au[P]||(E+=tg(P,M,n,a,e,d)),S<i.length()-1){let F=!((k=P)<11904||!(Ul(k)||jl(k)||ql(k)||Lh(k)||Fa(k)||Mh(k)||Vl(k)||Da(k)||zh(k)||Gl(k)||Ra(k)||Hl(k)||La(k)||bs(k)||Ih(k)||Nl(k)||Ba(k)||Bh(k)||Oa(k)||Ph(k)));(y1[P]||F||M.imageName)&&m.push(rg(S+1,E,y,m,x1(P,i.getCharCode(S+1),F&&x),!1))}}var k;return ng(rg(i.length(),E,y,m,0,!0))}function Qp(i){let e=.5,r=.5;switch(i){case"right":case"top-right":case"bottom-right":e=1;break;case"left":case"top-left":case"bottom-left":e=0}switch(i){case"bottom":case"bottom-right":case"bottom-left":r=1;break;case"top":case"top-right":case"top-left":r=0}return{horizontalAlign:e,verticalAlign:r}}function og(i,e,r,n,a){if(!(e||r||n||a))return;let h=i.length-1,d=i[h],m=(d.x+d.metrics.advance*d.scale)*e;for(let y=0;y<=h;y++)i[y].x-=m,i[y].y+=r+n+a}function v1(i,e,r){let{horizontalAlign:n,verticalAlign:a}=Qp(r),h=e[0]-i.displaySize[0]*n,d=e[1]-i.displaySize[1]*a;return{image:i,top:d,bottom:d+i.displaySize[1],left:h,right:h+i.displaySize[0]}}function sg(i,e,r,n,a,h){let d=i.image,m;if(d.content){let G=d.content,X=d.pixelRatio||1;m=[G[0]/X,G[1]/X,d.displaySize[0]-G[2]/X,d.displaySize[1]-G[3]/X]}let y=e.left*h,x=e.right*h,E,k,S,M;r==="width"||r==="both"?(M=a[0]+y-n[3],k=a[0]+x+n[1]):(M=a[0]+(y+x-d.displaySize[0])/2,k=M+d.displaySize[0]);let P=e.top*h,F=e.bottom*h;return r==="height"||r==="both"?(E=a[1]+P-n[0],S=a[1]+F+n[2]):(E=a[1]+(P+F-d.displaySize[1])/2,S=E+d.displaySize[1]),{image:d,top:E,right:k,bottom:S,left:M,collisionPadding:m}}class Xn extends Y{constructor(e,r,n,a,h){super(e,r),this.angle=a,this.z=n,h!==void 0&&(this.segment=h)}clone(){return new Xn(this.x,this.y,this.z,this.angle,this.segment)}}function ag(i,e,r,n,a){if(e.segment===void 0)return!0;let h=e,d=e.segment+1,m=0;for(;m>-r/2;){if(d--,d<0)return!1;m-=i[d].dist(h),h=i[d]}m+=i[d].dist(i[d+1]),d++;let y=[],x=0;for(;m<r/2;){let E=i[d],k=i[d+1];if(!k)return!1;let S=i[d-1].angleTo(E)-E.angleTo(k);for(S=Math.abs((S+3*Math.PI)%(2*Math.PI)-Math.PI),y.push({distance:m,angleDelta:S}),x+=S;m-y[0].distance>n;)x-=y.shift().angleDelta;if(x>a)return!1;d++,m+=E.dist(k)}return!0}function lg(i){let e=0;for(let r=0;r<i.length-1;r++)e+=i[r].dist(i[r+1]);return e}function cg(i,e,r){return i?.6*e*r:0}function hg(i,e){return Math.max(i?i.right-i.left:0,e?e.right-e.left:0)}function b1(i,e,r,n,a,h){let d=cg(r,a,h),m=hg(r,n)*h,y=0,x=lg(i)/2;for(let E=0;E<i.length-1;E++){let k=i[E],S=i[E+1],M=k.dist(S);if(y+M>x){let P=(x-y)/M,F=Pt(k.x,S.x,P),G=Pt(k.y,S.y,P),X=new Xn(F,G,0,S.angleTo(k),E);return!d||ag(i,X,m,d,e)?X:void 0}y+=M}}function w1(i,e,r,n,a,h,d,m,y){let x=cg(n,h,d),E=hg(n,a),k=E*d,S=i[0].x===0||i[0].x===y||i[0].y===0||i[0].y===y;return e-k<e/4&&(e=k+e/4),ug(i,S?e/2*m%e:(E/2+2*h)*d*m%e,e,x,r,k,S,!1,y)}function ug(i,e,r,n,a,h,d,m,y){let x=h/2,E=lg(i),k=0,S=e-r,M=[];for(let P=0;P<i.length-1;P++){let F=i[P],G=i[P+1],X=F.dist(G),ne=G.angleTo(F);for(;S+r<k+X;){S+=r;let re=(S-k)/X,se=Pt(F.x,G.x,re),ce=Pt(F.y,G.y,re);if(se>=0&&se<y&&ce>=0&&ce<y&&S-x>=0&&S+x<=E){let ue=new Xn(se,ce,0,ne,P);ue._round(),n&&!ag(i,ue,h,n,a)||M.push(ue)}}k+=X}return m||M.length||d||(M=ug(i,k/2,r,n,a,h,d,!0,y)),M}function pg(i,e,r,n,a){let h=[];for(let d=0;d<i.length;d++){let m=i[d],y;for(let x=0;x<m.length-1;x++){let E=m[x],k=m[x+1];E.x<e&&k.x<e||(E.x<e?E=new Y(e,E.y+(e-E.x)/(k.x-E.x)*(k.y-E.y))._round():k.x<e&&(k=new Y(e,E.y+(e-E.x)/(k.x-E.x)*(k.y-E.y))._round()),E.y<r&&k.y<r||(E.y<r?E=new Y(E.x+(r-E.y)/(k.y-E.y)*(k.x-E.x),r)._round():k.y<r&&(k=new Y(E.x+(r-E.y)/(k.y-E.y)*(k.x-E.x),r)._round()),E.x>=n&&k.x>=n||(E.x>=n?E=new Y(n,E.y+(n-E.x)/(k.x-E.x)*(k.y-E.y))._round():k.x>=n&&(k=new Y(n,E.y+(n-E.x)/(k.x-E.x)*(k.y-E.y))._round()),E.y>=a&&k.y>=a||(E.y>=a?E=new Y(E.x+(a-E.y)/(k.y-E.y)*(k.x-E.x),a)._round():k.y>=a&&(k=new Y(E.x+(a-E.y)/(k.y-E.y)*(k.x-E.x),a)._round()),y&&E.equals(y[y.length-1])||(y=[E],h.push(y)),y.push(k)))))}}return h}He(Xn,"Anchor");let uc=1e20;function dg(i,e,r,n,a,h,d,m,y){for(let x=e;x<e+n;x++)fg(i,r*h+x,h,a,d,m,y);for(let x=r;x<r+a;x++)fg(i,x*h+e,1,n,d,m,y)}function fg(i,e,r,n,a,h,d){h[0]=0,d[0]=-uc,d[1]=uc,a[0]=i[e];for(let m=1,y=0,x=0;m<n;m++){a[m]=i[e+m*r];let E=m*m;do{let k=h[y];x=(a[m]-a[k]+E-k*k)/(m-k)/2}while(x<=d[y]&&--y>-1);y++,h[y]=m,d[y]=x,d[y+1]=uc}for(let m=0,y=0;m<n;m++){for(;d[y+1]<m;)y++;let x=h[y],E=m-x;i[e+m*r]=a[x]+E*E}}let ed={none:0,ideographs:1,all:2};class Ya{constructor(e,r,n){this.requestManager=e,this.localGlyphMode=r,this.localFontFamily=n,this.entries={},this.localGlyphs={200:{},400:{},500:{},900:{}}}setURL(e){this.url=e}getGlyphs(e,r){let n=[];for(let a in e)for(let h of e[a])n.push({stack:a,id:h});Ht(n,({stack:a,id:h},d)=>{let m=this.entries[a];m||(m=this.entries[a]={glyphs:{},requests:{},ranges:{},ascender:void 0,descender:void 0});let y=m.glyphs[h];if(y!==void 0)return void d(null,{stack:a,id:h,glyph:y});if(y=this._tinySDF(m,a,h),y)return m.glyphs[h]=y,void d(null,{stack:a,id:h,glyph:y});let x=Math.floor(h/256);if(256*x>65535)return void d(new Error("glyphs > 65535 not supported"));if(m.ranges[x])return void d(null,{stack:a,id:h,glyph:y});let E=m.requests[x];E||(E=m.requests[x]=[],Ya.loadGlyphRange(a,x,this.url,this.requestManager,(k,S)=>{if(S){m.ascender=S.ascender,m.descender=S.descender;for(let M in S.glyphs)this._doesCharSupportLocalGlyph(+M)||(m.glyphs[+M]=S.glyphs[+M]);m.ranges[x]=!0}for(let M of E)M(k,S);delete m.requests[x]})),E.push((k,S)=>{k?d(k):S&&d(null,{stack:a,id:h,glyph:S.glyphs[h]||null})})},(a,h)=>{if(a)r(a);else if(h){let d={};for(let{stack:m,id:y,glyph:x}of h)d[m]===void 0&&(d[m]={}),d[m].glyphs===void 0&&(d[m].glyphs={}),d[m].glyphs[y]=x&&{id:x.id,bitmap:x.bitmap.clone(),metrics:x.metrics},d[m].ascender=this.entries[m].ascender,d[m].descender=this.entries[m].descender;r(null,d)}})}_doesCharSupportLocalGlyph(e){return this.localGlyphMode!==ed.none&&(this.localGlyphMode===ed.all?!!this.localFontFamily:!!this.localFontFamily&&(Gl(e)||Dh(e)||La(e)||Ba(e)||Da(e)))}_tinySDF(e,r,n){let a=this.localFontFamily;if(!a||!this._doesCharSupportLocalGlyph(n))return;let h=e.tinySDF;if(!h){let F="400";/bold/i.test(r)?F="900":/medium/i.test(r)?F="500":/light/i.test(r)&&(F="200"),h=e.tinySDF=new Ya.TinySDF({fontFamily:a,fontWeight:F,fontSize:48,buffer:6,radius:16}),h.fontWeight=F}if(this.localGlyphs[h.fontWeight][n])return this.localGlyphs[h.fontWeight][n];let d=String.fromCharCode(n),{data:m,width:y,height:x,glyphWidth:E,glyphHeight:k,glyphLeft:S,glyphTop:M,glyphAdvance:P}=h.draw(d);return this.localGlyphs[h.fontWeight][n]={id:n,bitmap:new Wn({width:y,height:x},m),metrics:{width:E/2,height:k/2,left:S/2,top:M/2-27,advance:P/2,localGlyph:!0}}}}function mg(i,e,r,n){let a=[],h=i.image,d=h.pixelRatio,m=h.paddedRect.w-2,y=h.paddedRect.h-2,x=i.right-i.left,E=i.bottom-i.top,k=h.stretchX||[[0,m]],S=h.stretchY||[[0,y]],M=(ge,ke)=>ge+ke[1]-ke[0],P=k.reduce(M,0),F=S.reduce(M,0),G=m-P,X=y-F,ne=0,re=P,se=0,ce=F,ue=0,ve=G,we=0,Se=X;if(h.content&&n){let ge=h.content;ne=lu(k,0,ge[0]),se=lu(S,0,ge[1]),re=lu(k,ge[0],ge[2]),ce=lu(S,ge[1],ge[3]),ue=ge[0]-ne,we=ge[1]-se,ve=ge[2]-ge[0]-re,Se=ge[3]-ge[1]-ce}let Le=(ge,ke,Be,Re)=>{let qe=cu(ge.stretch-ne,re,x,i.left),Pe=hu(ge.fixed-ue,ve,ge.stretch,P),Ne=cu(ke.stretch-se,ce,E,i.top),dt=hu(ke.fixed-we,Se,ke.stretch,F),xt=cu(Be.stretch-ne,re,x,i.left),it=hu(Be.fixed-ue,ve,Be.stretch,P),Xe=cu(Re.stretch-se,ce,E,i.top),vt=hu(Re.fixed-we,Se,Re.stretch,F),gt=new Y(qe,Ne),Qe=new Y(xt,Ne),Ei=new Y(xt,Xe),mi=new Y(qe,Xe),ui=new Y(Pe/d,dt/d),bt=new Y(it/d,vt/d),Lt=e*Math.PI/180;if(Lt){let qt=Math.sin(Lt),Qt=Math.cos(Lt),ni=[Qt,-qt,qt,Qt];gt._matMult(ni),Qe._matMult(ni),mi._matMult(ni),Ei._matMult(ni)}let Kt=ge.stretch+ge.fixed,Wt=ke.stretch+ke.fixed;return{tl:gt,tr:Qe,bl:mi,br:Ei,tex:{x:h.paddedRect.x+1+Kt,y:h.paddedRect.y+1+Wt,w:Be.stretch+Be.fixed-Kt,h:Re.stretch+Re.fixed-Wt},writingMode:void 0,glyphOffset:[0,0],sectionIndex:0,pixelOffsetTL:ui,pixelOffsetBR:bt,minFontScaleX:ve/d/x,minFontScaleY:Se/d/E,isSDF:r}};if(n&&(h.stretchX||h.stretchY)){let ge=gg(k,G,P),ke=gg(S,X,F);for(let Be=0;Be<ge.length-1;Be++){let Re=ge[Be],qe=ge[Be+1];for(let Pe=0;Pe<ke.length-1;Pe++)a.push(Le(Re,ke[Pe],qe,ke[Pe+1]))}}else a.push(Le({fixed:0,stretch:-1},{fixed:0,stretch:-1},{fixed:0,stretch:m+1},{fixed:0,stretch:y+1}));return a}function lu(i,e,r){let n=0;for(let a of i)n+=Math.max(e,Math.min(r,a[1]))-Math.max(e,Math.min(r,a[0]));return n}function gg(i,e,r){let n=[{fixed:-1,stretch:0}];for(let[a,h]of i){let d=n[n.length-1];n.push({fixed:a-d.stretch,stretch:d.stretch}),n.push({fixed:a-d.stretch,stretch:d.stretch+(h-a)})}return n.push({fixed:e+1,stretch:r}),n}function cu(i,e,r,n){return i/e*r+n}function hu(i,e,r,n){return i-e*r/n}function E1(i,e,r,n){let a=e+i.positionedLines[n].lineOffset;return n===0?r+a/2:r+(a+(e+i.positionedLines[n-1].lineOffset))/2}Ya.loadGlyphRange=function(i,e,r,n,a){let h=256*e,d=h+255,m=n.transformRequest(n.normalizeGlyphsURL(r).replace("{fontstack}",i).replace("{range}",`${h}-${d}`),ee.Glyphs);he(m,(y,x)=>{if(y)a(y);else if(x){let E={},k=function(S){return new cc(S).readFields(m1,{})}(x);for(let S of k.glyphs)E[S.id]=S;a(null,{glyphs:E,ascender:k.ascender,descender:k.descender})}})},Ya.TinySDF=class{constructor({fontSize:i=24,buffer:e=3,radius:r=8,cutoff:n=.25,fontFamily:a="sans-serif",fontWeight:h="normal",fontStyle:d="normal"}={}){this.buffer=e,this.cutoff=n,this.radius=r;let m=this.size=i+4*e,y=this._createCanvas(m),x=this.ctx=y.getContext("2d",{willReadFrequently:!0});x.font=`${d} ${h} ${i}px ${a}`,x.textBaseline="alphabetic",x.textAlign="left",x.fillStyle="black",this.gridOuter=new Float64Array(m*m),this.gridInner=new Float64Array(m*m),this.f=new Float64Array(m),this.z=new Float64Array(m+1),this.v=new Uint16Array(m)}_createCanvas(i){let e=document.createElement("canvas");return e.width=e.height=i,e}draw(i){let{width:e,actualBoundingBoxAscent:r,actualBoundingBoxDescent:n,actualBoundingBoxLeft:a,actualBoundingBoxRight:h}=this.ctx.measureText(i),d=Math.ceil(r),m=Math.min(this.size-this.buffer,Math.ceil(h-a)),y=Math.min(this.size-this.buffer,d+Math.ceil(n)),x=m+2*this.buffer,E=y+2*this.buffer,k=Math.max(x*E,0),S=new Uint8ClampedArray(k),M={data:S,width:x,height:E,glyphWidth:m,glyphHeight:y,glyphTop:d,glyphLeft:0,glyphAdvance:e};if(m===0||y===0)return M;let{ctx:P,buffer:F,gridInner:G,gridOuter:X}=this;P.clearRect(F,F,m,y),P.fillText(i,F,F+d);let ne=P.getImageData(F,F,m,y);X.fill(uc,0,k),G.fill(0,0,k);for(let re=0;re<y;re++)for(let se=0;se<m;se++){let ce=ne.data[4*(re*m+se)+3]/255;if(ce===0)continue;let ue=(re+F)*x+se+F;if(ce===1)X[ue]=0,G[ue]=uc;else{let ve=.5-ce;X[ue]=ve>0?ve*ve:0,G[ue]=ve<0?ve*ve:0}}dg(X,0,0,x,E,x,this.f,this.v,this.z),dg(G,F,F,m,y,x,this.f,this.v,this.z);for(let re=0;re<k;re++){let se=Math.sqrt(X[re])-Math.sqrt(G[re]);S[re]=Math.round(255-255*(se/this.radius+this.cutoff))}return M}};class T1{constructor(e=[],r=C1){if(this.data=e,this.length=this.data.length,this.compare=r,this.length>0)for(let n=(this.length>>1)-1;n>=0;n--)this._down(n)}push(e){this.data.push(e),this.length++,this._up(this.length-1)}pop(){if(this.length===0)return;let e=this.data[0],r=this.data.pop();return this.length--,this.length>0&&(this.data[0]=r,this._down(0)),e}peek(){return this.data[0]}_up(e){let{data:r,compare:n}=this,a=r[e];for(;e>0;){let h=e-1>>1,d=r[h];if(n(a,d)>=0)break;r[e]=d,e=h}r[e]=a}_down(e){let{data:r,compare:n}=this,a=this.length>>1,h=r[e];for(;e<a;){let d=1+(e<<1),m=r[d],y=d+1;if(y<this.length&&n(r[y],m)<0&&(d=y,m=r[y]),n(m,h)>=0)break;r[e]=m,e=d}r[e]=h}}function C1(i,e){return i<e?-1:i>e?1:0}function k1(i,e=1,r=!1){let n=1/0,a=1/0,h=-1/0,d=-1/0,m=i[0];for(let M=0;M<m.length;M++){let P=m[M];(!M||P.x<n)&&(n=P.x),(!M||P.y<a)&&(a=P.y),(!M||P.x>h)&&(h=P.x),(!M||P.y>d)&&(d=P.y)}let y=Math.min(h-n,d-a),x=y/2,E=new T1([],S1);if(y===0)return new Y(n,a);for(let M=n;M<h;M+=y)for(let P=a;P<d;P+=y)E.push(new Ja(M+x,P+x,x,i));let k=function(M){let P=0,F=0,G=0,X=M[0];for(let ne=0,re=X.length,se=re-1;ne<re;se=ne++){let ce=X[ne],ue=X[se],ve=ce.x*ue.y-ue.x*ce.y;F+=(ce.x+ue.x)*ve,G+=(ce.y+ue.y)*ve,P+=3*ve}return new Ja(F/P,G/P,0,M)}(i),S=E.length;for(;E.length;){let M=E.pop();(M.d>k.d||!k.d)&&(k=M,r&&console.log("found best %d after %d probes",Math.round(1e4*M.d)/1e4,S)),M.max-k.d<=e||(x=M.h/2,E.push(new Ja(M.p.x-x,M.p.y-x,x,i)),E.push(new Ja(M.p.x+x,M.p.y-x,x,i)),E.push(new Ja(M.p.x-x,M.p.y+x,x,i)),E.push(new Ja(M.p.x+x,M.p.y+x,x,i)),S+=4)}return r&&(console.log(`num probes: ${S}`),console.log(`best distance: ${k.d}`)),k.p}function S1(i,e){return e.max-i.max}function Ja(i,e,r,n){this.p=new Y(i,e),this.h=r,this.d=function(a,h){let d=!1,m=1/0;for(let y=0;y<h.length;y++){let x=h[y];for(let E=0,k=x.length,S=k-1;E<k;S=E++){let M=x[E],P=x[S];M.y>a.y!=P.y>a.y&&a.x<(P.x-M.x)*(a.y-M.y)/(P.y-M.y)+M.x&&(d=!d),m=Math.min(m,cm(a,M,P))}}return(d?1:-1)*Math.sqrt(m)}(this.p,n),this.max=this.d+this.h*Math.SQRT2}let td=Number.POSITIVE_INFINITY,A1=Math.sqrt(2);function _g(i,e){return e[1]!==td?function(r,n,a){let h=0,d=0;switch(n=Math.abs(n),a=Math.abs(a),r){case"top-right":case"top-left":case"top":d=a-7;break;case"bottom-right":case"bottom-left":case"bottom":d=7-a}switch(r){case"top-right":case"bottom-right":case"right":h=-n;break;case"top-left":case"bottom-left":case"left":h=n}return[h,d]}(i,e[0],e[1]):function(r,n){let a=0,h=0;n<0&&(n=0);let d=n/A1;switch(r){case"top-right":case"top-left":h=d-7;break;case"bottom-right":case"bottom-left":h=7-d;break;case"bottom":h=7-n;break;case"top":h=n-7}switch(r){case"top-right":case"bottom-right":a=-d;break;case"top-left":case"bottom-left":a=d;break;case"left":a=n;break;case"right":a=-n}return[a,h]}(i,e[0])}function M1(i,e,r,n,a,h,d,m,y,x){i.createArrays(),i.tilePixelRatio=lt/(512*i.overscaling),i.compareText={},i.iconsNeedLinear=!1;let E=i.layers[0].layout,k=i.layers[0]._unevaluatedLayout._values,S={};if(i.textSizeData.kind==="composite"){let{minZoom:F,maxZoom:G}=i.textSizeData;S.compositeTextSizes=[k["text-size"].possiblyEvaluate(new $(F),m),k["text-size"].possiblyEvaluate(new $(G),m)]}if(i.iconSizeData.kind==="composite"){let{minZoom:F,maxZoom:G}=i.iconSizeData;S.compositeIconSizes=[k["icon-size"].possiblyEvaluate(new $(F),m),k["icon-size"].possiblyEvaluate(new $(G),m)]}S.layoutTextSize=k["text-size"].possiblyEvaluate(new $(y+1),m),S.layoutIconSize=k["icon-size"].possiblyEvaluate(new $(y+1),m),S.textMaxSize=k["text-size"].possiblyEvaluate(new $(18),m);let M=E.get("text-rotation-alignment")==="map"&&E.get("symbol-placement")!=="point",P=E.get("text-size");for(let F of i.features){let G=E.get("text-font").evaluate(F,{},m).join(","),X=P.evaluate(F,{},m),ne=S.layoutTextSize.evaluate(F,{},m),re=(S.layoutIconSize.evaluate(F,{},m),{horizontal:{},vertical:void 0}),se=F.text,ce,ue=[0,0];if(se){let Se=se.toString(),Le=E.get("text-letter-spacing").evaluate(F,{},m)*Ui,ge=E.get("text-line-height").evaluate(F,{},m)*Ui,ke=Ua(Se)?Le:0,Be=E.get("text-anchor").evaluate(F,{},m),Re=E.get("text-variable-anchor");if(!Re){let it=E.get("text-radial-offset").evaluate(F,{},m);ue=it?_g(Be,[it*Ui,td]):E.get("text-offset").evaluate(F,{},m).map(Xe=>Xe*Ui)}let qe=M?"center":E.get("text-justify").evaluate(F,{},m),Pe=E.get("symbol-placement"),Ne=Pe==="point",dt=Pe==="point"?E.get("text-max-width").evaluate(F,{},m)*Ui:0,xt=it=>{i.allowVerticalPlacement&&ja(Se)&&(re.vertical=Yp(se,e,r,a,G,dt,ge,Be,it,ke,ue,zr.vertical,!0,Pe,ne,X))};if(!M&&Re){let it=qe==="auto"?Re.map(vt=>id(vt)):[qe],Xe=!1;for(let vt=0;vt<it.length;vt++){let gt=it[vt];if(!re.horizontal[gt])if(Xe)re.horizontal[gt]=re.horizontal[0];else{let Qe=Yp(se,e,r,a,G,dt,ge,"center",gt,ke,ue,zr.horizontal,!1,Pe,ne,X);Qe&&(re.horizontal[gt]=Qe,Xe=Qe.positionedLines.length===1)}}xt("left")}else{if(qe==="auto"&&(qe=id(Be)),Ne||E.get("text-writing-mode").indexOf("horizontal")>=0||!ja(Se)){let it=Yp(se,e,r,a,G,dt,ge,Be,qe,ke,ue,zr.horizontal,!1,Pe,ne,X);it&&(re.horizontal[qe]=it)}xt(Pe==="point"?"left":qe)}}let ve=!1;if(F.icon&&F.icon.name){let Se=n[F.icon.name];Se&&(ce=v1(a[F.icon.name],E.get("icon-offset").evaluate(F,{},m),E.get("icon-anchor").evaluate(F,{},m)),ve=Se.sdf,i.sdfIcons===void 0?i.sdfIcons=Se.sdf:i.sdfIcons!==Se.sdf&&ci("Style sheet warning: Cannot mix SDF and non-SDF icons in one buffer"),(Se.pixelRatio!==i.pixelRatio||E.get("icon-rotate").constantOr(1)!==0)&&(i.iconsNeedLinear=!0))}let we=xg(re.horizontal)||re.vertical;i.iconsInText||(i.iconsInText=!!we&&we.iconsInText),(we||ce)&&I1(i,F,re,ce,n,S,ne,0,ue,ve,d,m,x)}h&&i.generateCollisionDebugBuffers(y,i.collisionBoxArray)}function id(i){switch(i){case"right":case"top-right":case"bottom-right":return"right";case"left":case"top-left":case"bottom-left":return"left"}return"center"}function I1(i,e,r,n,a,h,d,m,y,x,E,k,S){let M=h.textMaxSize.evaluate(e,{},k);M===void 0&&(M=d);let P=i.layers[0].layout,F=P.get("icon-offset").evaluate(e,{},k),G=xg(r.horizontal)||r.vertical,X=S.name==="globe",ne=d/24,re=i.tilePixelRatio*M/24,se=(ke=i.overscaling,i.zoom>18&&ke>2&&(ke>>=1),Math.max(lt/(512*ke),1)*P.get("symbol-spacing")),ce=P.get("text-padding")*i.tilePixelRatio,ue=P.get("icon-padding")*i.tilePixelRatio,ve=Ce(P.get("text-max-angle")),we=P.get("text-rotation-alignment")==="map"&&P.get("symbol-placement")!=="point",Se=P.get("icon-rotation-alignment")==="map"&&P.get("symbol-placement")!=="point",Le=P.get("symbol-placement"),ge=se/2;var ke;let Be=P.get("icon-text-fit"),Re;n&&Be!=="none"&&(i.allowVerticalPlacement&&r.vertical&&(Re=sg(n,r.vertical,Be,P.get("icon-text-fit-padding"),F,ne)),G&&(n=sg(n,G,Be,P.get("icon-text-fit-padding"),F,ne)));let qe=(Pe,Ne,dt)=>{if(Ne.x<0||Ne.x>=lt||Ne.y<0||Ne.y>=lt)return;let xt=null;if(X){let{x:it,y:Xe,z:vt}=S.projectTilePoint(Ne.x,Ne.y,dt);xt={anchor:new Xn(it,Xe,vt,0,void 0),up:S.upVector(dt,Ne.x,Ne.y)}}(function(it,Xe,vt,gt,Qe,Ei,mi,ui,bt,Lt,Kt,Wt,qt,Qt,ni,Di,or,Ct,pi,Gi,Ut,oi,Ki,ti,gi){let Li=it.addToLineVertexArray(Xe,gt),Ai,Vi,Yi,Bi,Kn,il,vc,bc=0,i_=0,r_=0,n_=0,xd=-1,vd=-1,kn={},o_=Xl(""),Ls=vt?vt.anchor:Xe,bd=0,wd=0;if(bt._unevaluatedLayout.getValue("text-radial-offset")===void 0?[bd,wd]=bt.layout.get("text-offset").evaluate(Ut,{},gi).map(Er=>Er*Ui):(bd=bt.layout.get("text-radial-offset").evaluate(Ut,{},gi)*Ui,wd=td),it.allowVerticalPlacement&&Qe.vertical){let Er=Qe.vertical;if(ni)il=rd(Er),ui&&(vc=rd(ui));else{let Tr=bt.layout.get("text-rotate").evaluate(Ut,{},gi)+90;Yi=uu(Lt,Ls,Xe,Kt,Wt,qt,Er,Qt,Tr,Di),ui&&(Bi=uu(Lt,Ls,Xe,Kt,Wt,qt,ui,Ct,Tr))}}if(Ei){let Er=bt.layout.get("icon-rotate").evaluate(Ut,{},gi),Tr=bt.layout.get("icon-text-fit")!=="none",wc=mg(Ei,Er,Ki,Tr),Td=ui?mg(ui,Er,Ki,Tr):void 0;Vi=uu(Lt,Ls,Xe,Kt,Wt,qt,Ei,Ct,Er),bc=4*wc.length;let s_=it.iconSizeData,Bs=null;s_.kind==="source"?(Bs=[bn*bt.layout.get("icon-size").evaluate(Ut,{},gi)],Bs[0]>Po&&ci(`${it.layerIds[0]}: Value for "icon-size" is >= 255. Reduce your "icon-size".`)):s_.kind==="composite"&&(Bs=[bn*oi.compositeIconSizes[0].evaluate(Ut,{},gi),bn*oi.compositeIconSizes[1].evaluate(Ut,{},gi)],(Bs[0]>Po||Bs[1]>Po)&&ci(`${it.layerIds[0]}: Value for "icon-size" is >= 255. Reduce your "icon-size".`)),it.addSymbols(it.icon,wc,Bs,Gi,pi,Ut,!1,vt,Xe,Li.lineStartIndex,Li.lineLength,-1,ti,gi),xd=it.icon.placedSymbolArray.length-1,Td&&(i_=4*Td.length,it.addSymbols(it.icon,Td,Bs,Gi,pi,Ut,zr.vertical,vt,Xe,Li.lineStartIndex,Li.lineLength,-1,ti,gi),vd=it.icon.placedSymbolArray.length-1)}for(let Er in Qe.horizontal){let Tr=Qe.horizontal[Er];Ai||(o_=Xl(Tr.text),ni?Kn=rd(Tr):Ai=uu(Lt,Ls,Xe,Kt,Wt,qt,Tr,Qt,bt.layout.get("text-rotate").evaluate(Ut,{},gi),Di));let wc=Tr.positionedLines.length===1;if(r_+=yg(it,vt,Xe,Tr,mi,bt,ni,Ut,Di,Li,Qe.vertical?zr.horizontal:zr.horizontalOnly,wc?Object.keys(Qe.horizontal):[Er],kn,xd,oi,ti,gi),wc)break}Qe.vertical&&(n_+=yg(it,vt,Xe,Qe.vertical,mi,bt,ni,Ut,Di,Li,zr.vertical,["vertical"],kn,vd,oi,ti,gi));let Oo=-1,Ed=(Er,Tr)=>Er?Math.max(Er,Tr):Tr;Oo=Ed(Kn,Oo),Oo=Ed(il,Oo),Oo=Ed(vc,Oo);let lx=Oo>-1?1:0;it.glyphOffsetArray.length>=Lo.MAX_GLYPHS&&ci("Too many glyphs being rendered in a tile. See https://github.com/mapbox/mapbox-gl-js/issues/2907"),Ut.sortKey!==void 0&&it.addToSortKeyRanges(it.symbolInstances.length,Ut.sortKey),it.symbolInstances.emplaceBack(Ls.x,Ls.y,Ls.z,Xe.x,Xe.y,kn.right>=0?kn.right:-1,kn.center>=0?kn.center:-1,kn.left>=0?kn.left:-1,kn.vertical>=0?kn.vertical:-1,xd,vd,o_,Ai!==void 0?Ai:it.collisionBoxArray.length,Ai!==void 0?Ai+1:it.collisionBoxArray.length,Yi!==void 0?Yi:it.collisionBoxArray.length,Yi!==void 0?Yi+1:it.collisionBoxArray.length,Vi!==void 0?Vi:it.collisionBoxArray.length,Vi!==void 0?Vi+1:it.collisionBoxArray.length,Bi||it.collisionBoxArray.length,Bi?Bi+1:it.collisionBoxArray.length,Kt,r_,n_,bc,i_,lx,0,bd,wd,Oo)})(i,Ne,xt,Pe,r,n,a,Re,i.layers[0],i.collisionBoxArray,e.index,e.sourceLayerIndex,i.index,ce,we,y,0,ue,Se,F,e,h,x,E,k)};if(Le==="line")for(let Pe of pg(e.geometry,0,0,lt,lt)){let Ne=w1(Pe,se,ve,r.vertical||G,n,24,re,i.overscaling,lt);for(let dt of Ne){let xt=G;xt&&z1(i,xt.text,ge,dt)||qe(Pe,dt,k)}}else if(Le==="line-center"){for(let Pe of e.geometry)if(Pe.length>1){let Ne=b1(Pe,ve,r.vertical||G,n,24,re);Ne&&qe(Pe,Ne,k)}}else if(e.type==="Polygon")for(let Pe of $p(e.geometry,0)){let Ne=k1(Pe,16);qe(Pe[0],new Xn(Ne.x,Ne.y,0,0,void 0),k)}else if(e.type==="LineString")for(let Pe of e.geometry)qe(Pe,new Xn(Pe[0].x,Pe[0].y,0,0,void 0),k);else if(e.type==="Point")for(let Pe of e.geometry)for(let Ne of Pe)qe([Ne],new Xn(Ne.x,Ne.y,0,0,void 0),k)}let Po=32640;function yg(i,e,r,n,a,h,d,m,y,x,E,k,S,M,P,F,G){let X=function(se,ce,ue,ve,we,Se,Le,ge){let ke=[];if(ce.positionedLines.length===0)return ke;let Be=ve.layout.get("text-rotate").evaluate(Se,{})*Math.PI/180,Re=function(xt){let it=xt[0],Xe=xt[1],vt=it*Xe;return vt>0?[it,-Xe]:vt<0?[-it,Xe]:it===0?[Xe,it]:[Xe,-it]}(ue),qe=Math.abs(ce.top-ce.bottom);for(let xt of ce.positionedLines)qe-=xt.lineOffset;let Pe=ce.positionedLines.length,Ne=qe/Pe,dt=ce.top-ue[1];for(let xt=0;xt<Pe;++xt){let it=ce.positionedLines[xt];dt=E1(ce,Ne,dt,xt);for(let Xe of it.positionedGlyphs){if(!Xe.rect)continue;let vt=Xe.rect||{},gt=4,Qe=!0,Ei=1,mi=0;if(Xe.imageName){let ti=Le[Xe.imageName];if(!ti)continue;if(ti.sdf){ci("SDF images are not supported in formatted text and will be ignored.");continue}Qe=!1,Ei=ti.pixelRatio,gt=1/Ei}let ui=(we||ge)&&Xe.vertical,bt=Xe.metrics.advance*Xe.scale/2,Lt=Xe.metrics,Kt=Xe.rect;if(Kt===null)continue;ge&&ce.verticalizable&&(mi=Xe.imageName?bt-Xe.metrics.width*Xe.scale/2:0);let Wt=we?[Xe.x+bt,Xe.y]:[0,0],qt=[0,0],Qt=[0,0],ni=!1;we||(ui?(Qt=[Xe.x+bt+Re[0],Xe.y+Re[1]-mi],ni=!0):qt=[Xe.x+bt+ue[0],Xe.y+ue[1]-mi]);let Di=Kt.w*Xe.scale/(Ei*(Xe.localGlyph?2:1)),or=Kt.h*Xe.scale/(Ei*(Xe.localGlyph?2:1)),Ct,pi,Gi,Ut;if(ui){let ti=Xe.y-dt,gi=new Y(-bt,bt-ti),Li=-Math.PI/2,Ai=new Y(...Qt);Ct=new Y(-bt+qt[0],qt[1]),Ct._rotateAround(Li,gi)._add(Ai),Ct.x+=-ti+bt,Ct.y-=(Lt.left-gt)*Xe.scale;let Vi=Xe.imageName?Lt.advance*Xe.scale:Ui*Xe.scale,Yi=String.fromCharCode(Xe.glyph);n1(Yi)?Ct.x+=(1-gt)*Xe.scale:o1(Yi)?Ct.x+=Vi-Lt.height*Xe.scale+(-gt-1)*Xe.scale:Ct.x+=Xe.imageName||Lt.width+2*gt===Kt.w&&Lt.height+2*gt===Kt.h?(Vi-or)/2:(Vi-(Lt.height+2*gt)*Xe.scale)/2,pi=new Y(Ct.x,Ct.y-Di),Gi=new Y(Ct.x+or,Ct.y),Ut=new Y(Ct.x+or,Ct.y-Di)}else{let ti=(Lt.left-gt)*Xe.scale-bt+qt[0],gi=(-Lt.top-gt)*Xe.scale+qt[1],Li=ti+Di,Ai=gi+or;Ct=new Y(ti,gi),pi=new Y(Li,gi),Gi=new Y(ti,Ai),Ut=new Y(Li,Ai)}if(Be){let ti;ti=we?new Y(0,0):ni?new Y(Re[0],Re[1]):new Y(ue[0],ue[1]),Ct._rotateAround(Be,ti),pi._rotateAround(Be,ti),Gi._rotateAround(Be,ti),Ut._rotateAround(Be,ti)}let oi=new Y(0,0),Ki=new Y(0,0);ke.push({tl:Ct,tr:pi,bl:Gi,br:Ut,tex:vt,writingMode:ce.writingMode,glyphOffset:Wt,sectionIndex:Xe.sectionIndex,isSDF:Qe,pixelOffsetTL:oi,pixelOffsetBR:Ki,minFontScaleX:0,minFontScaleY:0})}}return ke}(0,n,y,h,d,m,a,i.allowVerticalPlacement),ne=i.textSizeData,re=null;ne.kind==="source"?(re=[bn*h.layout.get("text-size").evaluate(m,{},G)],re[0]>Po&&ci(`${i.layerIds[0]}: Value for "text-size" is >= 255. Reduce your "text-size".`)):ne.kind==="composite"&&(re=[bn*P.compositeTextSizes[0].evaluate(m,{},G),bn*P.compositeTextSizes[1].evaluate(m,{},G)],(re[0]>Po||re[1]>Po)&&ci(`${i.layerIds[0]}: Value for "text-size" is >= 255. Reduce your "text-size".`)),i.addSymbols(i.text,X,re,y,d,m,E,e,r,x.lineStartIndex,x.lineLength,M,F,G);for(let se of k)S[se]=i.text.placedSymbolArray.length-1;return 4*X.length}function xg(i){for(let e in i)return i[e];return null}function uu(i,e,r,n,a,h,d,m,y,x){let E=d.top,k=d.bottom,S=d.left,M=d.right,P=d.collisionPadding;if(P&&(S-=P[0],E-=P[1],M+=P[2],k+=P[3]),y){let F=new Y(S,E),G=new Y(M,E),X=new Y(S,k),ne=new Y(M,k),re=Ce(y),se=new Y(0,0);x&&(se=new Y(x[0],x[1])),F._rotateAround(re,se),G._rotateAround(re,se),X._rotateAround(re,se),ne._rotateAround(re,se),S=Math.min(F.x,G.x,X.x,ne.x),M=Math.max(F.x,G.x,X.x,ne.x),E=Math.min(F.y,G.y,X.y,ne.y),k=Math.max(F.y,G.y,X.y,ne.y)}return i.emplaceBack(e.x,e.y,e.z,r.x,r.y,S,E,M,k,m,n,a,h),i.length-1}function rd(i){i.collisionPadding&&(i.top-=i.collisionPadding[1],i.bottom+=i.collisionPadding[3]);let e=i.bottom-i.top;return e>0?Math.max(10,e):null}function z1(i,e,r,n){let a=i.compareText;if(e in a){let h=a[e];for(let d=h.length-1;d>=0;d--)if(n.dist(h[d])<r)return!0}else a[e]=[];return a[e].push(n),!1}let P1=Oe([{type:"Float32",name:"a_globe_pos",components:3},{type:"Float32",name:"a_merc_pos",components:2},{type:"Float32",name:"a_uv",components:2}]),{members:vg}=P1,bg=Oe([{name:"a_pos_3",components:3,type:"Int16"}]);var pc=Oe([{name:"a_pos",type:"Int16",components:2}]);let zs=lt/Math.PI/2,nd=2*Vr(1,0)*zs*Math.PI,Qa=[64,32,16],br=-zs,wr=zs,D1=[new Ir([br,br,br],[wr,wr,wr]),new Ir([br,br,br],[0,0,wr]),new Ir([0,br,br],[wr,0,wr]),new Ir([br,0,br],[0,wr,wr]),new Ir([0,0,br],[wr,wr,wr])];function wg(i,e,r,n=!0){let a=vn([],i._camera.position,i.worldSize),h=[e,r,1,1];Ms(h,h,i.pixelMatrixInverse),xm(h,h,1/h[3]);let d=Wi([],Gr([],h,a)),m=i.globeMatrix,y=[m[12],m[13],m[14]],x=Gr([],y,a),E=Yl(x),k=Wi([],x),S=i.worldSize/(2*Math.PI),M=Nr(k,d),P=Math.asin(S/E);if(P<Math.acos(M)){if(!n)return null;let Le=[],ge=[];vn(Le,d,E/M),Wi(ge,Gr(ge,Le,x)),Wi(d,Io(d,x,vn(d,ge,Math.tan(P)*E)))}let F=[];new Rp(a,d).closestPointOnSphere(y,S,F);let G=Wi([],Kr(m,0)),X=Wi([],Kr(m,1)),ne=Wi([],Kr(m,2)),re=Nr(G,F),se=Nr(X,F),ce=Nr(ne,F),ue=Ge(Math.asin(-se/S)),ve=Ge(Math.atan2(re,ce));ve=i.center.lng+function(Le,ge){let ke=(ge-Le+180)%360-180;return ke<-180?ke+360:ke}(i.center.lng,ve);let we=Ts(ve),Se=Je(Cs(ue),0,1);return new Na(we,Se)}class L1{constructor(e,r,n){this.a=Gr([],e,n),this.b=Gr([],r,n),this.center=n;let a=Wi([],this.a),h=Wi([],this.b);this.angle=Math.acos(Nr(a,h))}}function od(i,e){if(i.angle===0)return null;let r;return r=i.a[e]===0?1/i.angle*.5*Math.PI:1/i.angle*Math.atan(i.b[e]/i.a[e]/Math.sin(i.angle)-1/Math.tan(i.angle)),r<0||r>1?null:function(n,a,h,d){let m=Math.sin(h);return n*(Math.sin((1-d)*h)/m)+a*(Math.sin(d*h)/m)}(i.a[e],i.b[e],i.angle,Je(r,0,1))+i.center[e]}function wn(i){if(i.z<=1)return D1[i.z+2*i.y+i.x];let[e,r]=sd(i),n=[Xi(e[0],e[1]),Xi(e[0],r[1]),Xi(r[0],e[1]),Xi(r[0],r[1])],a=[wr,wr,wr],h=[br,br,br];for(let d of n)a[0]=Math.min(a[0],d[0]),a[1]=Math.min(a[1],d[1]),a[2]=Math.min(a[2],d[2]),h[0]=Math.max(h[0],d[0]),h[1]=Math.max(h[1],d[1]),h[2]=Math.max(h[2],d[2]);return new Ir(a,h)}function B1(i,e,r){let n=e/i.worldSize,a=Number.MAX_VALUE,h=[-a,-a,-a],d=[a,a,a],m=xr(new Float64Array(16));if(xn(m,m,[n,n,n]),Mo(m,m,i.globeMatrix),r.z<=1){let ge=wn(r).getCorners();for(let ke=0;ke<ge.length;ke++)ji(ge[ke],ge[ke],m),Zh(d,d,ge[ke]),Wh(h,h,ge[ke]);return new Ir(d,h)}let[y,x]=sd(r),E=new Ao;E.setSouthWest([y[1],x[0]]),E.setNorthEast([x[1],y[0]]);let k=[Xi(E.getSouth(),E.getWest()),Xi(E.getSouth(),E.getEast()),Xi(E.getNorth(),E.getEast()),Xi(E.getNorth(),E.getWest())];for(let ge=0;ge<k.length;ge++)ji(k[ge],k[ge],m),Zh(d,d,k[ge]),Wh(h,h,k[ge]);if(E.contains(i.center)){h[2]=0;let ge=i.point,ke=[ge.x*n,ge.y*n,0];return Zh(d,d,ke),Wh(h,h,ke),new Ir(d,h)}let S=[m[12],m[13],m[14]],M=i.center.lng,P=Je(i.center.lat,-85.051129,yn),F=[Ts(M),Cs(P)],G=E.getCenter().lng,X=Je(E.getCenter().lat,-85.051129,yn),ne=[Ts(G),Cs(X)],re=new Array(3),se=0,ce=F[0]-ne[0],ue=F[1]-ne[1];if(ce>.5?ce-=1:ce<-.5&&(ce+=1),Math.abs(ce)>Math.abs(ue))se=ce>=0?1:3,re=S;else{se=ue>=0?0:2;let ge=[m[4],m[5],m[6]],ke;ke=ue>=0?-Math.sin(Ce(E.getSouth()))*zs:-Math.sin(Ce(E.getNorth()))*zs,re=Hh(re,S,ge,ke)}let ve=k[se],we=k[(se+1)%4],Se=new L1(ve,we,re),Le=[od(Se,0)||ve[0],od(Se,1)||ve[1],od(Se,2)||ve[2]];return d[2]=Math.min(ve[2],we[2]),Zh(d,d,Le),Wh(h,h,Le),new Ir(d,h)}function sd(i){let e=1<<i.z,r=i.x/e,n=(i.x+1)/e,a=(i.y+1)/e;return[[wi(i.y/e),Zi(r)],[wi(a),Zi(n)]]}function Eg(i,e,r,n=zs){return r=Ce(r),[i*Math.sin(r)*n,-e*n,i*Math.cos(r)*n]}function Xi(i,e,r){return Eg(Math.cos(Ce(i)),Math.sin(Ce(i)),e,r)}function Tg(i,e,r){let n=Math.pow(2,r.z),a=(i/lt+r.x)/n;return Xi(wi((e/lt+r.y)/n),Zi(a))}function pu(i){return 16383/Math.max(...Gr([],i.max,i.min))}function dc(i){let e=xr(new Float64Array(16)),r=pu(i);var n,a;return xn(e,e,[r,r,r]),As(e,e,((n=[])[0]=-(a=i.min)[0],n[1]=-a[1],n[2]=-a[2],n)),e}function Cg(i){let e=xr(new Float64Array(16)),r=1/pu(i);return As(e,e,i.min),xn(e,e,[r,r,r]),e}function kg(i,e,r,n,a){let h=function(y){let x=lt/(2*Math.PI);return y/(2*Math.PI)/x}(r),d=[i,e,-r/(2*Math.PI)],m=xr(new Float64Array(16));return As(m,m,d),xn(m,m,[h,h,h]),$h(m,m,Ce(-a)),qh(m,m,Ce(-n)),m}function ad(i){return Et(5,6,i)}function Sg(i,e){let r=Xi(e.lat,e.lng);return h=(n=Lp([],function(M){let P=Xi(M._center.lat,M._center.lng),F=Bp([],$a(0,1,0),P),G=mm([],-M.angle,P);F=ji(F,F,G),mm(G,-M._pitch,F);let X=Wi([],P);return vn(X,X,M.cameraToCenterDistance/M.pixelsPerMeter*nd),ji(X,X,G),Io([],P,X)}(i),r))[0],d=n[1],m=n[2],y=(a=r)[0],x=a[1],E=a[2],S=(k=Math.sqrt(h*h+d*d+m*m)*Math.sqrt(y*y+x*x+E*E))&&Nr(n,a)/k,Math.acos(Math.min(Math.max(S,-1),1));var n,a,h,d,m,y,x,E,k,S}let Ag=Ce(85),R1=Math.cos(Ag),F1=Math.sin(Ag);function Mg(i,e){let r=i.fovAboveCenter,n=i.elevation?i.elevation.getMinElevationBelowMSL()*e:0,a=(i._camera.position[2]*i.worldSize-n)/Math.cos(i._pitch),h=Math.sin(r)*a/Math.sin(Math.max(Math.PI/2-i._pitch-r,.01)),d=Math.sin(i._pitch)*h+a;return Math.min(1.01*d,a*(1/i._horizonShift))}function Ps(i,e){if(!e.isReprojectedInTileSpace)return{scale:1<<i.z,x:i.x,y:i.y,x2:i.x+1,y2:i.y+1,projection:e};let r=Math.pow(2,-i.z),n=i.x*r,a=(i.x+1)*r,h=i.y*r,d=(i.y+1)*r,m=Zi(n),y=Zi(a),x=wi(h),E=wi(d),k=e.project(m,x),S=e.project(y,x),M=e.project(y,E),P=e.project(m,E),F=Math.min(k.x,S.x,M.x,P.x),G=Math.min(k.y,S.y,M.y,P.y),X=Math.max(k.x,S.x,M.x,P.x),ne=Math.max(k.y,S.y,M.y,P.y),re=r/16;function se(ue,ve,we,Se,Le,ge){let ke=(we+Le)/2,Be=(Se+ge)/2,Re=e.project(Zi(ke),wi(Be)),qe=Math.max(0,F-Re.x,G-Re.y,Re.x-X,Re.y-ne);F=Math.min(F,Re.x),X=Math.max(X,Re.x),G=Math.min(G,Re.y),ne=Math.max(ne,Re.y),qe>re&&(se(ue,Re,we,Se,ke,Be),se(Re,ve,ke,Be,Le,ge))}se(k,S,n,h,a,h),se(S,M,a,h,a,d),se(M,P,a,d,n,d),se(P,k,n,d,n,h),F-=re,G-=re,X+=re,ne+=re;let ce=1/Math.max(X-F,ne-G);return{scale:ce,x:F*ce,y:G*ce,x2:X*ce,y2:ne*ce,projection:e}}let O1=xr(new Float32Array(16));class Do{constructor(e){this.spec=e,this.name=e.name,this.wrap=!1,this.requiresDraping=!1,this.supportsWorldCopies=!1,this.supportsTerrain=!1,this.supportsFog=!1,this.supportsFreeCamera=!1,this.zAxisUnit="meters",this.isReprojectedInTileSpace=!0,this.unsupportedLayers=["custom"],this.center=[0,0],this.range=[3.5,7]}project(e,r){return{x:0,y:0,z:0}}unproject(e,r){return new $t(0,0)}projectTilePoint(e,r,n){return{x:e,y:r,z:0}}locationPoint(e,r,n=!0){return e._coordinatePoint(e.locationCoordinate(r),n)}pixelsPerMeter(e,r){return Vr(1,e)*r}pixelSpaceConversion(e,r,n){return 1}farthestPixelDistance(e){return Mg(e,e.pixelsPerMeter)}pointCoordinate(e,r,n,a){let h=e.horizonLineFromTop(!1),d=new Y(r,Math.max(h,n));return e.rayIntersectionCoordinate(e.pointRayIntersection(d,a))}pointCoordinate3D(e,r,n){let a=new Y(r,n);if(e.elevation)return e.elevation.pointCoordinate(a);{let h=this.pointCoordinate(e,a.x,a.y,0);return[h.x,h.y,h.z]}}isPointAboveHorizon(e,r){if(e.elevation)return!this.pointCoordinate3D(e,r.x,r.y);let n=e.horizonLineFromTop();return r.y<n}createInversionMatrix(e,r){return O1}createTileMatrix(e,r,n){let a,h,d,m=n.canonical,y=xr(new Float64Array(16));if(this.isReprojectedInTileSpace){let x=Ps(m,this);a=1,h=x.x+n.wrap*x.scale,d=x.y,xn(y,y,[a/x.scale,a/x.scale,e.pixelsPerMeter/r])}else a=r/e.zoomScale(m.z),h=(m.x+Math.pow(2,m.z)*n.wrap)*a,d=m.y*a;return As(y,y,[h,d,0]),xn(y,y,[a/lt,a/lt,1]),y}upVector(e,r,n){return[0,0,1]}upVectorScale(e,r,n){return{metersToTile:1}}}class j1 extends Do{constructor(e){super(e),this.range=[4,7],this.center=e.center||[-96,37.5];let[r,n]=this.parallels=e.parallels||[29.5,45.5],a=Math.sin(Ce(r));this.n=(a+Math.sin(Ce(n)))/2,this.c=1+a*(2*this.n-a),this.r0=Math.sqrt(this.c)/this.n}project(e,r){let{n,c:a,r0:h}=this,d=Ce(e-this.center[0]),m=Ce(r),y=Math.sqrt(a-2*n*Math.sin(m))/n;return{x:y*Math.sin(d*n),y:y*Math.cos(d*n)-h,z:0}}unproject(e,r){let{n,c:a,r0:h}=this,d=h+r,m=Math.atan2(e,Math.abs(d))*Math.sign(d);d*n<0&&(m-=Math.PI*Math.sign(e)*Math.sign(d));let y=Ce(this.center[0])*n;m=It(m,-Math.PI-y,Math.PI-y);let x=Ge(m/n)+this.center[0],E=Math.asin(Je((a-(e*e+d*d)*n*n)/(2*n),-1,1)),k=Je(Ge(E),-85.051129,yn);return new $t(x,k)}}let fc=1.340264,mc=-.081106,gc=893e-6,_c=.003796,du=Math.sqrt(3)/2;class U1 extends Do{project(e,r){r=r/180*Math.PI,e=e/180*Math.PI;let n=Math.asin(du*Math.sin(r)),a=n*n,h=a*a*a;return{x:.5*(e*Math.cos(n)/(du*(fc+3*mc*a+h*(7*gc+9*_c*a)))/Math.PI+.5),y:1-.5*(n*(fc+mc*a+h*(gc+_c*a))/Math.PI+1),z:0}}unproject(e,r){e=(2*e-.5)*Math.PI;let n=r=(2*(1-r)-1)*Math.PI,a=n*n,h=a*a*a;for(let E,k,S,M=0;M<12&&(k=n*(fc+mc*a+h*(gc+_c*a))-r,S=fc+3*mc*a+h*(7*gc+9*_c*a),E=k/S,n=Je(n-E,-Math.PI/3,Math.PI/3),a=n*n,h=a*a*a,!(Math.abs(E)<1e-12));++M);let d=du*e*(fc+3*mc*a+h*(7*gc+9*_c*a))/Math.cos(n),m=Math.asin(Math.sin(n)/du),y=Je(180*d/Math.PI,-180,180),x=Je(180*m/Math.PI,-85.051129,yn);return new $t(y,x)}}class V1 extends Do{constructor(e){super(e),this.wrap=!0,this.supportsWorldCopies=!0}project(e,r){return{x:.5+e/360,y:.5-r/360,z:0}}unproject(e,r){let n=360*(e-.5),a=Je(360*(.5-r),-85.051129,yn);return new $t(n,a)}}let el=Math.PI/2;function fu(i){return Math.tan((el+i)/2)}class N1 extends Do{constructor(e){super(e),this.center=e.center||[0,30];let[r,n]=this.parallels=e.parallels||[30,30],a=Ce(r),h=Ce(n),d=Math.cos(a);this.n=a===h?Math.sin(a):Math.log(d/Math.cos(h))/Math.log(fu(h)/fu(a)),this.f=d*Math.pow(fu(a),this.n)/this.n}project(e,r){r=Ce(r),e=Ce(e-this.center[0]);let n=1e-6,{n:a,f:h}=this;h>0?r<-el+n&&(r=-el+n):r>el-n&&(r=el-n);let d=h/Math.pow(fu(r),a),m=d*Math.sin(a*e),y=h-d*Math.cos(a*e);return{x:.5*(m/Math.PI+.5),y:1-.5*(y/Math.PI+.5),z:0}}unproject(e,r){e=(2*e-.5)*Math.PI,r=(2*(1-r)-.5)*Math.PI;let{n,f:a}=this,h=a-r,d=Math.sign(h),m=Math.sign(n)*Math.sqrt(e*e+h*h),y=Math.atan2(e,Math.abs(h))*d;h*n<0&&(y-=Math.PI*Math.sign(e)*d);let x=Je(Ge(y/n)+this.center[0],-180,180),E=Je(Ge(2*Math.atan(Math.pow(a/m,1/n))-el),-85.051129,yn);return new $t(x,E)}}class Ig extends Do{constructor(e){super(e),this.wrap=!0,this.supportsWorldCopies=!0,this.supportsTerrain=!0,this.supportsFog=!0,this.supportsFreeCamera=!0,this.isReprojectedInTileSpace=!1,this.unsupportedLayers=[],this.range=null}project(e,r){return{x:Ts(e),y:Cs(r),z:0}}unproject(e,r){let n=Zi(e),a=wi(r);return new $t(n,a)}}let zg=Ce(yn);class G1 extends Do{project(e,r){let n=(r=Ce(r))*r,a=n*n;return{x:.5*((e=Ce(e))*(.8707-.131979*n+a*(a*(.003971*n-.001529*a)-.013791))/Math.PI+.5),y:1-.5*(r*(1.007226+n*(.015085+a*(.028874*n-.044475-.005916*a)))/Math.PI+1),z:0}}unproject(e,r){e=(2*e-.5)*Math.PI;let n=r=(2*(1-r)-1)*Math.PI,a=25,h=0,d=n*n;do{d=n*n;let x=d*d;h=(n*(1.007226+d*(.015085+x*(.028874*d-.044475-.005916*x)))-r)/(1.007226+d*(.045255+x*(.259866*d-.311325-.005916*11*x))),n=Je(n-h,-zg,zg)}while(Math.abs(h)>1e-6&&--a>0);d=n*n;let m=Je(Ge(e/(.8707+d*(d*(d*d*d*(.003971-.001529*d)-.013791)-.131979))),-180,180),y=Ge(n);return new $t(m,y)}}let Pg=Ce(yn);class $1 extends Do{project(e,r){r=Ce(r),e=Ce(e);let n=Math.cos(r),a=2/Math.PI,h=Math.acos(n*Math.cos(e/2)),d=Math.sin(h)/h,m=.5*(e*a+2*n*Math.sin(e/2)/d)||0,y=.5*(r+Math.sin(r)/d)||0;return{x:.5*(m/Math.PI+.5),y:1-.5*(y/Math.PI+1),z:0}}unproject(e,r){let n=e=(2*e-.5)*Math.PI,a=r=(2*(1-r)-1)*Math.PI,h=25,d=1e-6,m=0,y=0;do{let x=Math.cos(a),E=Math.sin(a),k=2*E*x,S=E*E,M=x*x,P=Math.cos(n/2),F=Math.sin(n/2),G=2*P*F,X=F*F,ne=1-M*P*P,re=ne?1/ne:0,se=ne?Math.acos(x*P)*Math.sqrt(1/ne):0,ce=.5*(2*se*x*F+2*n/Math.PI)-e,ue=.5*(se*E+a)-r,ve=.5*re*(M*X+se*x*P*S)+1/Math.PI,we=re*(G*k/4-se*E*F),Se=.125*re*(k*F-se*E*M*G),Le=.5*re*(S*P+se*X*x)+.5,ge=we*Se-Le*ve;m=(ue*we-ce*Le)/ge,y=(ce*Se-ue*ve)/ge,n=Je(n-m,-Math.PI,Math.PI),a=Je(a-y,-Pg,Pg)}while((Math.abs(m)>d||Math.abs(y)>d)&&--h>0);return new $t(Ge(n),Ge(a))}}class Dg extends Do{constructor(e){super(e),this.center=e.center||[0,0],this.parallels=e.parallels||[0,0],this.cosPhi=Math.max(.01,Math.cos(Ce(this.parallels[0]))),this.scale=1/(2*Math.max(Math.PI*this.cosPhi,1/this.cosPhi)),this.wrap=!0,this.supportsWorldCopies=!0}project(e,r){let{scale:n,cosPhi:a}=this;return{x:Ce(e)*a*n+.5,y:-Math.sin(Ce(r))/a*n+.5,z:0}}unproject(e,r){let{scale:n,cosPhi:a}=this,h=-(r-.5)/n,d=Je(Ge((e-.5)/n)/a,-180,180),m=Math.asin(Je(h*a,-1,1)),y=Je(Ge(m),-85.051129,yn);return new $t(d,y)}}class q1 extends Ig{constructor(e){super(e),this.requiresDraping=!0,this.supportsWorldCopies=!1,this.supportsFog=!0,this.zAxisUnit="pixels",this.unsupportedLayers=["debug","custom"],this.range=[3,5]}projectTilePoint(e,r,n){let a=Math.pow(2,n.z),h=(e/lt+n.x)/a,d=Xi(wi((r/lt+n.y)/a),Zi(h));return ji(d,d,dc(wn(n))),{x:d[0],y:d[1],z:d[2]}}locationPoint(e,r){let n=Xi(r.lat,r.lng),a=Wi([],n),h=e.elevation?e.elevation.getAtPointOrZero(e.locationCoordinate(r),e._centerAltitude):e._centerAltitude;Hh(n,n,a,Vr(1,0)*lt*h);let d=xr(new Float64Array(16));return Mo(d,e.pixelMatrix,e.globeMatrix),ji(n,n,d),new Y(n[0],n[1])}pixelsPerMeter(e,r){return Vr(1,0)*r}pixelSpaceConversion(e,r,n){let a=Pt(Vr(1,45)*r,Vr(1,e)*r,n);return this.pixelsPerMeter(e,r)/a}createTileMatrix(e,r,n){let a=Cg(wn(n.canonical));return Mo(new Float64Array(16),e.globeMatrix,a)}createInversionMatrix(e,r){let{center:n}=e,a=xr(new Float64Array(16));return Mo(a,a,dc(wn(r))),qh(a,a,Ce(n.lng)),$h(a,a,Ce(n.lat)),xn(a,a,[e._projectionScaler,e._projectionScaler,1]),Float32Array.from(a)}pointCoordinate(e,r,n,a){return wg(e,r,n,!0)||new Na(0,0)}pointCoordinate3D(e,r,n){let a=this.pointCoordinate(e,r,n,0);return[a.x,a.y,a.z]}isPointAboveHorizon(e,r){return!wg(e,r.x,r.y,!1)}farthestPixelDistance(e){let r=function(a,h){let d=a.cameraToCenterDistance,m=a._centerAltitude*h,y=a._camera,x=a._camera.forward(),E=Io([],vn([],x,-d),[0,0,m]),k=a.worldSize/(2*Math.PI),S=[0,0,-k],M=a.width/a.height,P=Math.tan(a.fovAboveCenter),F=vn([],y.up(),P),G=vn([],y.right(),P*M),X=Wi([],Io([],Io([],x,F),G)),ne=[],re;if(new Rp(E,X).closestPointOnSphere(S,k,ne)){let se=Io([],ne,S),ce=Gr([],se,E);re=Math.cos(a.fovAboveCenter)*Yl(ce)}else{let se=Gr([],E,S),ce=Gr([],S,E);Wi(ce,ce);let ue=Yl(se)-k;re=Math.sqrt(ue*(ue+2*k));let ve=Math.acos(re/(k+ue))-Math.acos(Nr(x,ce));re*=Math.cos(ve)}return 1.01*re}(e,this.pixelsPerMeter(e.center.lat,e.worldSize)),n=ad(e.zoom);if(n>0){let a=Mg(e,Vr(1,e.center.lat)*e.worldSize),h=e.worldSize/(2*Math.PI),d=Math.max(e.width,e.height)/e.worldSize*Math.PI;return Pt(r,a+h*(1-Math.cos(d)),Math.pow(n,10))}return r}upVector(e,r,n){let a=1<<e.z,h=(r/lt+e.x)/a;return Xi(wi((n/lt+e.y)/a),Zi(h),1)}upVectorScale(e){return{metersToTile:nd*pu(wn(e))}}}function Lg(i){let e=i.parallels,r=!!e&&Math.abs(e[0]+e[1])<.01;switch(i.name){case"mercator":return new Ig(i);case"equirectangular":return new V1(i);case"naturalEarth":return new G1(i);case"equalEarth":return new U1(i);case"winkelTripel":return new $1(i);case"albers":return r?new Dg(i):new j1(i);case"lambertConformalConic":return r?new Dg(i):new N1(i);case"globe":return new q1(i)}throw new Error(`Invalid projection name: ${i.name}`)}let Z1=Is.VectorTileFeature.types,W1=[{name:"a_fade_opacity",components:1,type:"Uint8",offset:0}];function mu(i,e,r,n,a,h,d,m,y,x,E,k,S){let M=m?Math.min(Po,Math.round(m[0])):0,P=m?Math.min(Po,Math.round(m[1])):0;i.emplaceBack(e,r,Math.round(32*n),Math.round(32*a),h,d,(M<<1)+(y?1:0),P,16*x,16*E,256*k,256*S)}function gu(i,e,r,n,a,h,d){i.emplaceBack(e,r,n,a,h,d)}function _u(i,e,r,n,a){i.emplaceBack(e,r,n,a),i.emplaceBack(e,r,n,a),i.emplaceBack(e,r,n,a),i.emplaceBack(e,r,n,a)}function H1(i){for(let e of i.sections)if(_(e.text))return!0;return!1}class ld{constructor(e){this.layoutVertexArray=new nr,this.indexArray=new Mt,this.programConfigurations=e,this.segments=new fi,this.dynamicLayoutVertexArray=new Ot,this.opacityVertexArray=new an,this.placedSymbolArray=new Vf,this.globeExtVertexArray=new jr}isEmpty(){return this.layoutVertexArray.length===0&&this.indexArray.length===0&&this.dynamicLayoutVertexArray.length===0&&this.opacityVertexArray.length===0}upload(e,r,n,a){this.isEmpty()||(n&&(this.layoutVertexBuffer=e.createVertexBuffer(this.layoutVertexArray,K0.members),this.indexBuffer=e.createIndexBuffer(this.indexArray,r),this.dynamicLayoutVertexBuffer=e.createVertexBuffer(this.dynamicLayoutVertexArray,J0.members,!0),this.opacityVertexBuffer=e.createVertexBuffer(this.opacityVertexArray,W1,!0),this.globeExtVertexArray.length>0&&(this.globeExtVertexBuffer=e.createVertexBuffer(this.globeExtVertexArray,Y0.members,!0)),this.opacityVertexBuffer.itemSize=1),(n||a)&&this.programConfigurations.upload(e))}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.programConfigurations.destroy(),this.segments.destroy(),this.dynamicLayoutVertexBuffer.destroy(),this.opacityVertexBuffer.destroy(),this.globeExtVertexBuffer&&this.globeExtVertexBuffer.destroy())}}He(ld,"SymbolBuffers");class cd{constructor(e,r,n){this.layoutVertexArray=new e,this.layoutAttributes=r,this.indexArray=new n,this.segments=new fi,this.collisionVertexArray=new _i,this.collisionVertexArrayExt=new Pi}upload(e){this.layoutVertexBuffer=e.createVertexBuffer(this.layoutVertexArray,this.layoutAttributes),this.indexBuffer=e.createIndexBuffer(this.indexArray),this.collisionVertexBuffer=e.createVertexBuffer(this.collisionVertexArray,Q0.members,!0),this.collisionVertexBufferExt=e.createVertexBuffer(this.collisionVertexArrayExt,e1.members,!0)}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.segments.destroy(),this.collisionVertexBuffer.destroy(),this.collisionVertexBufferExt.destroy())}}He(cd,"CollisionBuffers");class Lo{constructor(e){this.collisionBoxArray=e.collisionBoxArray,this.zoom=e.zoom,this.overscaling=e.overscaling,this.layers=e.layers,this.layerIds=this.layers.map(d=>d.id),this.index=e.index,this.pixelRatio=e.pixelRatio,this.sourceLayerIndex=e.sourceLayerIndex,this.hasPattern=!1,this.hasRTLText=!1,this.fullyClipped=!1,this.sortKeyRanges=[],this.collisionCircleArray=[],this.placementInvProjMatrix=xr([]),this.placementViewportMatrix=xr([]);let r=this.layers[0]._unevaluatedLayout._values;this.textSizeData=Wp(this.zoom,r["text-size"]),this.iconSizeData=Wp(this.zoom,r["icon-size"]);let n=this.layers[0].layout,a=n.get("symbol-sort-key"),h=n.get("symbol-z-order");this.canOverlap=n.get("text-allow-overlap")||n.get("icon-allow-overlap")||n.get("text-ignore-placement")||n.get("icon-ignore-placement"),this.sortFeaturesByKey=h!=="viewport-y"&&a.constantOr(1)!==void 0,this.sortFeaturesByY=(h==="viewport-y"||h==="auto"&&!this.sortFeaturesByKey)&&this.canOverlap,this.writingModes=n.get("text-writing-mode").map(d=>zr[d]),this.stateDependentLayerIds=this.layers.filter(d=>d.isStateDependent()).map(d=>d.id),this.sourceID=e.sourceID,this.projection=e.projection}createArrays(){this.text=new ld(new Es(this.layers,this.zoom,e=>/^text/.test(e))),this.icon=new ld(new Es(this.layers,this.zoom,e=>/^icon/.test(e))),this.glyphOffsetArray=new $f,this.lineVertexArray=new qf,this.symbolInstances=new Gf}calculateGlyphDependencies(e,r,n,a,h){for(let d=0;d<e.length;d++)if(r[e.charCodeAt(d)]=!0,a&&h){let m=lc[e.charAt(d)];m&&(r[m.charCodeAt(0)]=!0)}}populate(e,r,n,a){let h=this.layers[0],d=h.layout,m=this.projection.name==="globe",y=d.get("text-font"),x=d.get("text-field"),E=d.get("icon-image"),k=(x.value.kind!=="constant"||x.value.value instanceof Oi&&!x.value.value.isEmpty()||x.value.value.toString().length>0)&&(y.value.kind!=="constant"||y.value.value.length>0),S=E.value.kind!=="constant"||!!E.value.value||Object.keys(E.parameters).length>0,M=d.get("symbol-sort-key");if(this.features=[],!k&&!S)return;let P=r.iconDependencies,F=r.glyphDependencies,G=r.availableImages,X=new $(this.zoom);for(let{feature:ne,id:re,index:se,sourceLayerIndex:ce}of e){let ue=h._featureFilter.needGeometry,ve=ks(ne,ue);if(!h._featureFilter.filter(X,ve,n))continue;if(ue||(ve.geometry=Zn(ne,n,a)),m&&ne.type!==1&&n.z<=5){let ge=ve.geometry,ke=1<<n.z,Be=n.x,Re=n.y,qe=.98078528056;for(let Pe=0;Pe<ge.length;Pe++)ge[Pe]=Jy(ge[Pe],Ne=>Ne,(Ne,dt)=>Nr(Xi(wi((Ne.y/lt+Re)/ke),Zi((Ne.x/lt+Be)/ke),1),Xi(wi((dt.y/lt+Re)/ke),Zi((dt.x/lt+Be)/ke),1))<qe)}let we,Se;if(k){let ge=h.getValueAndResolveTokens("text-field",ve,n,G),ke=Oi.factory(ge);H1(ke)&&(this.hasRTLText=!0),(!this.hasRTLText||j()==="unavailable"||this.hasRTLText&&U.isParsed())&&(we=r1(ke,h,ve))}if(S){let ge=h.getValueAndResolveTokens("icon-image",ve,n,G);Se=ge instanceof mr?ge:mr.fromString(ge)}if(!we&&!Se)continue;let Le=this.sortFeaturesByKey?M.evaluate(ve,{},n):void 0;if(this.features.push({id:re,text:we,icon:Se,index:se,sourceLayerIndex:ce,geometry:ve.geometry,properties:ne.properties,type:Z1[ne.type],sortKey:Le}),Se&&(P[Se.name]=!0),we){let ge=y.evaluate(ve,{},n).join(","),ke=d.get("text-rotation-alignment")==="map"&&d.get("symbol-placement")!=="point";this.allowVerticalPlacement=this.writingModes&&this.writingModes.indexOf(zr.vertical)>=0;for(let Be of we.sections)if(Be.image)P[Be.image.name]=!0;else{let Re=ja(we.toString()),qe=Be.fontStack||ge,Pe=F[qe]=F[qe]||{};this.calculateGlyphDependencies(Be.text,Pe,ke,this.allowVerticalPlacement,Re)}}}d.get("symbol-placement")==="line"&&(this.features=function(ne){let re={},se={},ce=[],ue=0;function ve(ge){ce.push(ne[ge]),ue++}function we(ge,ke,Be){let Re=se[ge];return delete se[ge],se[ke]=Re,ce[Re].geometry[0].pop(),ce[Re].geometry[0]=ce[Re].geometry[0].concat(Be[0]),Re}function Se(ge,ke,Be){let Re=re[ke];return delete re[ke],re[ge]=Re,ce[Re].geometry[0].shift(),ce[Re].geometry[0]=Be[0].concat(ce[Re].geometry[0]),Re}function Le(ge,ke,Be){let Re=Be?ke[0][ke[0].length-1]:ke[0][0];return`${ge}:${Re.x}:${Re.y}`}for(let ge=0;ge<ne.length;ge++){let ke=ne[ge],Be=ke.geometry,Re=ke.text?ke.text.toString():null;if(!Re){ve(ge);continue}let qe=Le(Re,Be),Pe=Le(Re,Be,!0);if(qe in se&&Pe in re&&se[qe]!==re[Pe]){let Ne=Se(qe,Pe,Be),dt=we(qe,Pe,ce[Ne].geometry);delete re[qe],delete se[Pe],se[Le(Re,ce[dt].geometry,!0)]=dt,ce[Ne].geometry=null}else qe in se?we(qe,Pe,Be):Pe in re?Se(qe,Pe,Be):(ve(ge),re[qe]=ue-1,se[Pe]=ue-1)}return ce.filter(ge=>ge.geometry)}(this.features)),this.sortFeaturesByKey&&this.features.sort((ne,re)=>ne.sortKey-re.sortKey)}update(e,r,n,a){this.stateDependentLayers.length&&(this.text.programConfigurations.updatePaintArrays(e,r,this.layers,n,a),this.icon.programConfigurations.updatePaintArrays(e,r,this.layers,n,a))}isEmpty(){return this.symbolInstances.length===0&&!this.hasRTLText}uploadPending(){return!this.uploaded||this.text.programConfigurations.needsUpload||this.icon.programConfigurations.needsUpload}upload(e){!this.uploaded&&this.hasDebugData()&&(this.textCollisionBox.upload(e),this.iconCollisionBox.upload(e)),this.text.upload(e,this.sortFeaturesByY,!this.uploaded,this.text.programConfigurations.needsUpload),this.icon.upload(e,this.sortFeaturesByY,!this.uploaded,this.icon.programConfigurations.needsUpload),this.uploaded=!0}destroyDebugData(){this.textCollisionBox.destroy(),this.iconCollisionBox.destroy()}getProjection(){return this.projectionInstance||(this.projectionInstance=Lg(this.projection)),this.projectionInstance}destroy(){this.text.destroy(),this.icon.destroy(),this.hasDebugData()&&this.destroyDebugData()}addToLineVertexArray(e,r){let n=this.lineVertexArray.length,a=e.segment;if(a!==void 0){let h=e.dist(r[a+1]),d=e.dist(r[a]),m={};for(let y=a+1;y<r.length;y++)m[y]={x:r[y].x,y:r[y].y,tileUnitDistanceFromAnchor:h},y<r.length-1&&(h+=r[y+1].dist(r[y]));for(let y=a||0;y>=0;y--)m[y]={x:r[y].x,y:r[y].y,tileUnitDistanceFromAnchor:d},y>0&&(d+=r[y-1].dist(r[y]));for(let y=0;y<r.length;y++){let x=m[y];this.lineVertexArray.emplaceBack(x.x,x.y,x.tileUnitDistanceFromAnchor)}}return{lineStartIndex:n,lineLength:this.lineVertexArray.length-n}}addSymbols(e,r,n,a,h,d,m,y,x,E,k,S,M,P){let F=e.indexArray,G=e.layoutVertexArray,X=e.globeExtVertexArray,ne=e.segments.prepareSegment(4*r.length,G,F,this.canOverlap?d.sortKey:void 0),re=this.glyphOffsetArray.length,se=ne.vertexLength,ce=this.allowVerticalPlacement&&m===zr.vertical?Math.PI/2:0,ue=d.text&&d.text.sections;for(let we=0;we<r.length;we++){let{tl:Se,tr:Le,bl:ge,br:ke,tex:Be,pixelOffsetTL:Re,pixelOffsetBR:qe,minFontScaleX:Pe,minFontScaleY:Ne,glyphOffset:dt,isSDF:xt,sectionIndex:it}=r[we],Xe=ne.vertexLength,vt=dt[1];if(mu(G,x.x,x.y,Se.x,vt+Se.y,Be.x,Be.y,n,xt,Re.x,Re.y,Pe,Ne),mu(G,x.x,x.y,Le.x,vt+Le.y,Be.x+Be.w,Be.y,n,xt,qe.x,Re.y,Pe,Ne),mu(G,x.x,x.y,ge.x,vt+ge.y,Be.x,Be.y+Be.h,n,xt,Re.x,qe.y,Pe,Ne),mu(G,x.x,x.y,ke.x,vt+ke.y,Be.x+Be.w,Be.y+Be.h,n,xt,qe.x,qe.y,Pe,Ne),y){let gt=y.anchor,Qe=y.up;gu(X,gt.x,gt.y,gt.z,Qe[0],Qe[1],Qe[2]),gu(X,gt.x,gt.y,gt.z,Qe[0],Qe[1],Qe[2]),gu(X,gt.x,gt.y,gt.z,Qe[0],Qe[1],Qe[2]),gu(X,gt.x,gt.y,gt.z,Qe[0],Qe[1],Qe[2]),_u(e.dynamicLayoutVertexArray,gt.x,gt.y,gt.z,ce)}else _u(e.dynamicLayoutVertexArray,x.x,x.y,x.z,ce);F.emplaceBack(Xe,Xe+1,Xe+2),F.emplaceBack(Xe+1,Xe+2,Xe+3),ne.vertexLength+=4,ne.primitiveLength+=2,this.glyphOffsetArray.emplaceBack(dt[0]),we!==r.length-1&&it===r[we+1].sectionIndex||e.programConfigurations.populatePaintArrays(G.length,d,d.index,{},M,P,ue&&ue[it])}let ve=y?y.anchor:x;e.placedSymbolArray.emplaceBack(ve.x,ve.y,ve.z,x.x,x.y,re,this.glyphOffsetArray.length-re,se,E,k,x.segment,n?n[0]:0,n?n[1]:0,a[0],a[1],m,0,!1,0,S,0)}_commitLayoutVertex(e,r,n,a,h,d,m){e.emplaceBack(r,n,a,h,d,Math.round(m.x),Math.round(m.y))}_addCollisionDebugVertices(e,r,n,a,h,d,m){let y=n.segments.prepareSegment(4,n.layoutVertexArray,n.indexArray),x=y.vertexLength,E=m.tileAnchorX,k=m.tileAnchorY;for(let M=0;M<4;M++)n.collisionVertexArray.emplaceBack(0,0,0,0);n.collisionVertexArrayExt.emplaceBack(r,-e.padding,-e.padding),n.collisionVertexArrayExt.emplaceBack(r,e.padding,-e.padding),n.collisionVertexArrayExt.emplaceBack(r,e.padding,e.padding),n.collisionVertexArrayExt.emplaceBack(r,-e.padding,e.padding),this._commitLayoutVertex(n.layoutVertexArray,a,h,d,E,k,new Y(e.x1,e.y1)),this._commitLayoutVertex(n.layoutVertexArray,a,h,d,E,k,new Y(e.x2,e.y1)),this._commitLayoutVertex(n.layoutVertexArray,a,h,d,E,k,new Y(e.x2,e.y2)),this._commitLayoutVertex(n.layoutVertexArray,a,h,d,E,k,new Y(e.x1,e.y2)),y.vertexLength+=4;let S=n.indexArray;S.emplaceBack(x,x+1),S.emplaceBack(x+1,x+2),S.emplaceBack(x+2,x+3),S.emplaceBack(x+3,x),y.primitiveLength+=4}_addTextDebugCollisionBoxes(e,r,n,a,h,d){for(let m=a;m<h;m++){let y=n.get(m),x=this.getSymbolInstanceTextSize(e,d,r,m);this._addCollisionDebugVertices(y,x,this.textCollisionBox,y.projectedAnchorX,y.projectedAnchorY,y.projectedAnchorZ,d)}}_addIconDebugCollisionBoxes(e,r,n,a,h,d){for(let m=a;m<h;m++){let y=n.get(m),x=this.getSymbolInstanceIconSize(e,r,m);this._addCollisionDebugVertices(y,x,this.iconCollisionBox,y.projectedAnchorX,y.projectedAnchorY,y.projectedAnchorZ,d)}}generateCollisionDebugBuffers(e,r){this.hasDebugData()&&this.destroyDebugData(),this.textCollisionBox=new cd(ei,Wm.members,yi),this.iconCollisionBox=new cd(ei,Wm.members,yi);let n=Wa(this.iconSizeData,e),a=Wa(this.textSizeData,e);for(let h=0;h<this.symbolInstances.length;h++){let d=this.symbolInstances.get(h);this._addTextDebugCollisionBoxes(a,e,r,d.textBoxStartIndex,d.textBoxEndIndex,d),this._addTextDebugCollisionBoxes(a,e,r,d.verticalTextBoxStartIndex,d.verticalTextBoxEndIndex,d),this._addIconDebugCollisionBoxes(n,e,r,d.iconBoxStartIndex,d.iconBoxEndIndex,d),this._addIconDebugCollisionBoxes(n,e,r,d.verticalIconBoxStartIndex,d.verticalIconBoxEndIndex,d)}}getSymbolInstanceTextSize(e,r,n,a){let h=this.text.placedSymbolArray.get(r.rightJustifiedTextSymbolIndex>=0?r.rightJustifiedTextSymbolIndex:r.centerJustifiedTextSymbolIndex>=0?r.centerJustifiedTextSymbolIndex:r.leftJustifiedTextSymbolIndex>=0?r.leftJustifiedTextSymbolIndex:r.verticalPlacedTextSymbolIndex>=0?r.verticalPlacedTextSymbolIndex:a),d=ou(this.textSizeData,e,h)/Ui;return this.tilePixelRatio*d}getSymbolInstanceIconSize(e,r,n){let a=this.icon.placedSymbolArray.get(n),h=ou(this.iconSizeData,e,a);return this.tilePixelRatio*h}_commitDebugCollisionVertexUpdate(e,r,n){e.emplaceBack(r,-n,-n),e.emplaceBack(r,n,-n),e.emplaceBack(r,n,n),e.emplaceBack(r,-n,n)}_updateTextDebugCollisionBoxes(e,r,n,a,h,d){for(let m=a;m<h;m++){let y=n.get(m),x=this.getSymbolInstanceTextSize(e,d,r,m);this._commitDebugCollisionVertexUpdate(this.textCollisionBox.collisionVertexArrayExt,x,y.padding)}}_updateIconDebugCollisionBoxes(e,r,n,a,h){for(let d=a;d<h;d++){let m=n.get(d),y=this.getSymbolInstanceIconSize(e,r,d);this._commitDebugCollisionVertexUpdate(this.iconCollisionBox.collisionVertexArrayExt,y,m.padding)}}updateCollisionDebugBuffers(e,r){if(!this.hasDebugData())return;this.hasTextCollisionBoxData()&&this.textCollisionBox.collisionVertexArrayExt.clear(),this.hasIconCollisionBoxData()&&this.iconCollisionBox.collisionVertexArrayExt.clear();let n=Wa(this.iconSizeData,e),a=Wa(this.textSizeData,e);for(let h=0;h<this.symbolInstances.length;h++){let d=this.symbolInstances.get(h);this._updateTextDebugCollisionBoxes(a,e,r,d.textBoxStartIndex,d.textBoxEndIndex,d),this._updateTextDebugCollisionBoxes(a,e,r,d.verticalTextBoxStartIndex,d.verticalTextBoxEndIndex,d),this._updateIconDebugCollisionBoxes(n,e,r,d.iconBoxStartIndex,d.iconBoxEndIndex),this._updateIconDebugCollisionBoxes(n,e,r,d.verticalIconBoxStartIndex,d.verticalIconBoxEndIndex)}this.hasTextCollisionBoxData()&&this.textCollisionBox.collisionVertexBufferExt&&this.textCollisionBox.collisionVertexBufferExt.updateData(this.textCollisionBox.collisionVertexArrayExt),this.hasIconCollisionBoxData()&&this.iconCollisionBox.collisionVertexBufferExt&&this.iconCollisionBox.collisionVertexBufferExt.updateData(this.iconCollisionBox.collisionVertexArrayExt)}_deserializeCollisionBoxesForSymbol(e,r,n,a,h,d,m,y,x){let E={};for(let k=r;k<n;k++){let S=e.get(k);E.textBox={x1:S.x1,y1:S.y1,x2:S.x2,y2:S.y2,padding:S.padding,projectedAnchorX:S.projectedAnchorX,projectedAnchorY:S.projectedAnchorY,projectedAnchorZ:S.projectedAnchorZ,tileAnchorX:S.tileAnchorX,tileAnchorY:S.tileAnchorY},E.textFeatureIndex=S.featureIndex;break}for(let k=a;k<h;k++){let S=e.get(k);E.verticalTextBox={x1:S.x1,y1:S.y1,x2:S.x2,y2:S.y2,padding:S.padding,projectedAnchorX:S.projectedAnchorX,projectedAnchorY:S.projectedAnchorY,projectedAnchorZ:S.projectedAnchorZ,tileAnchorX:S.tileAnchorX,tileAnchorY:S.tileAnchorY},E.verticalTextFeatureIndex=S.featureIndex;break}for(let k=d;k<m;k++){let S=e.get(k);E.iconBox={x1:S.x1,y1:S.y1,x2:S.x2,y2:S.y2,padding:S.padding,projectedAnchorX:S.projectedAnchorX,projectedAnchorY:S.projectedAnchorY,projectedAnchorZ:S.projectedAnchorZ,tileAnchorX:S.tileAnchorX,tileAnchorY:S.tileAnchorY},E.iconFeatureIndex=S.featureIndex;break}for(let k=y;k<x;k++){let S=e.get(k);E.verticalIconBox={x1:S.x1,y1:S.y1,x2:S.x2,y2:S.y2,padding:S.padding,projectedAnchorX:S.projectedAnchorX,projectedAnchorY:S.projectedAnchorY,projectedAnchorZ:S.projectedAnchorZ,tileAnchorX:S.tileAnchorX,tileAnchorY:S.tileAnchorY},E.verticalIconFeatureIndex=S.featureIndex;break}return E}deserializeCollisionBoxes(e){this.collisionArrays=[];for(let r=0;r<this.symbolInstances.length;r++){let n=this.symbolInstances.get(r);this.collisionArrays.push(this._deserializeCollisionBoxesForSymbol(e,n.textBoxStartIndex,n.textBoxEndIndex,n.verticalTextBoxStartIndex,n.verticalTextBoxEndIndex,n.iconBoxStartIndex,n.iconBoxEndIndex,n.verticalIconBoxStartIndex,n.verticalIconBoxEndIndex))}}hasTextData(){return this.text.segments.get().length>0}hasIconData(){return this.icon.segments.get().length>0}hasDebugData(){return this.textCollisionBox&&this.iconCollisionBox}hasTextCollisionBoxData(){return this.hasDebugData()&&this.textCollisionBox.segments.get().length>0}hasIconCollisionBoxData(){return this.hasDebugData()&&this.iconCollisionBox.segments.get().length>0}addIndicesForPlacedSymbol(e,r){let n=e.placedSymbolArray.get(r),a=n.vertexStartIndex+4*n.numGlyphs;for(let h=n.vertexStartIndex;h<a;h+=4)e.indexArray.emplaceBack(h,h+1,h+2),e.indexArray.emplaceBack(h+1,h+2,h+3)}getSortedSymbolIndexes(e){if(this.sortedAngle===e&&this.symbolInstanceIndexes!==void 0)return this.symbolInstanceIndexes;let r=Math.sin(e),n=Math.cos(e),a=[],h=[],d=[];for(let m=0;m<this.symbolInstances.length;++m){d.push(m);let y=this.symbolInstances.get(m);a.push(0|Math.round(r*y.tileAnchorX+n*y.tileAnchorY)),h.push(y.featureIndex)}return d.sort((m,y)=>a[m]-a[y]||h[y]-h[m]),d}addToSortKeyRanges(e,r){let n=this.sortKeyRanges[this.sortKeyRanges.length-1];n&&n.sortKey===r?n.symbolInstanceEnd=e+1:this.sortKeyRanges.push({sortKey:r,symbolInstanceStart:e,symbolInstanceEnd:e+1})}sortFeatures(e){if(this.sortFeaturesByY&&this.sortedAngle!==e&&!(this.text.segments.get().length>1||this.icon.segments.get().length>1)){this.symbolInstanceIndexes=this.getSortedSymbolIndexes(e),this.sortedAngle=e,this.text.indexArray.clear(),this.icon.indexArray.clear(),this.featureSortOrder=[];for(let r of this.symbolInstanceIndexes){let n=this.symbolInstances.get(r);this.featureSortOrder.push(n.featureIndex),[n.rightJustifiedTextSymbolIndex,n.centerJustifiedTextSymbolIndex,n.leftJustifiedTextSymbolIndex].forEach((a,h,d)=>{a>=0&&d.indexOf(a)===h&&this.addIndicesForPlacedSymbol(this.text,a)}),n.verticalPlacedTextSymbolIndex>=0&&this.addIndicesForPlacedSymbol(this.text,n.verticalPlacedTextSymbolIndex),n.placedIconSymbolIndex>=0&&this.addIndicesForPlacedSymbol(this.icon,n.placedIconSymbolIndex),n.verticalPlacedIconSymbolIndex>=0&&this.addIndicesForPlacedSymbol(this.icon,n.verticalPlacedIconSymbolIndex)}this.text.indexBuffer&&this.text.indexBuffer.updateData(this.text.indexArray),this.icon.indexBuffer&&this.icon.indexBuffer.updateData(this.icon.indexArray)}}}He(Lo,"SymbolBucket",{omit:["layers","collisionBoxArray","features","compareText"]}),Lo.MAX_GLYPHS=65535,Lo.addDynamicAttributes=_u;let X1=new Te({"symbol-placement":new _e(de.layout_symbol["symbol-placement"]),"symbol-spacing":new _e(de.layout_symbol["symbol-spacing"]),"symbol-avoid-edges":new _e(de.layout_symbol["symbol-avoid-edges"]),"symbol-sort-key":new te(de.layout_symbol["symbol-sort-key"]),"symbol-z-order":new _e(de.layout_symbol["symbol-z-order"]),"icon-allow-overlap":new _e(de.layout_symbol["icon-allow-overlap"]),"icon-ignore-placement":new _e(de.layout_symbol["icon-ignore-placement"]),"icon-optional":new _e(de.layout_symbol["icon-optional"]),"icon-rotation-alignment":new _e(de.layout_symbol["icon-rotation-alignment"]),"icon-size":new te(de.layout_symbol["icon-size"]),"icon-text-fit":new _e(de.layout_symbol["icon-text-fit"]),"icon-text-fit-padding":new _e(de.layout_symbol["icon-text-fit-padding"]),"icon-image":new te(de.layout_symbol["icon-image"]),"icon-rotate":new te(de.layout_symbol["icon-rotate"]),"icon-padding":new _e(de.layout_symbol["icon-padding"]),"icon-keep-upright":new _e(de.layout_symbol["icon-keep-upright"]),"icon-offset":new te(de.layout_symbol["icon-offset"]),"icon-anchor":new te(de.layout_symbol["icon-anchor"]),"icon-pitch-alignment":new _e(de.layout_symbol["icon-pitch-alignment"]),"text-pitch-alignment":new _e(de.layout_symbol["text-pitch-alignment"]),"text-rotation-alignment":new _e(de.layout_symbol["text-rotation-alignment"]),"text-field":new te(de.layout_symbol["text-field"]),"text-font":new te(de.layout_symbol["text-font"]),"text-size":new te(de.layout_symbol["text-size"]),"text-max-width":new te(de.layout_symbol["text-max-width"]),"text-line-height":new te(de.layout_symbol["text-line-height"]),"text-letter-spacing":new te(de.layout_symbol["text-letter-spacing"]),"text-justify":new te(de.layout_symbol["text-justify"]),"text-radial-offset":new te(de.layout_symbol["text-radial-offset"]),"text-variable-anchor":new _e(de.layout_symbol["text-variable-anchor"]),"text-anchor":new te(de.layout_symbol["text-anchor"]),"text-max-angle":new _e(de.layout_symbol["text-max-angle"]),"text-writing-mode":new _e(de.layout_symbol["text-writing-mode"]),"text-rotate":new te(de.layout_symbol["text-rotate"]),"text-padding":new _e(de.layout_symbol["text-padding"]),"text-keep-upright":new _e(de.layout_symbol["text-keep-upright"]),"text-transform":new te(de.layout_symbol["text-transform"]),"text-offset":new te(de.layout_symbol["text-offset"]),"text-allow-overlap":new _e(de.layout_symbol["text-allow-overlap"]),"text-ignore-placement":new _e(de.layout_symbol["text-ignore-placement"]),"text-optional":new _e(de.layout_symbol["text-optional"])});var hd={paint:new Te({"icon-opacity":new te(de.paint_symbol["icon-opacity"]),"icon-color":new te(de.paint_symbol["icon-color"]),"icon-halo-color":new te(de.paint_symbol["icon-halo-color"]),"icon-halo-width":new te(de.paint_symbol["icon-halo-width"]),"icon-halo-blur":new te(de.paint_symbol["icon-halo-blur"]),"icon-translate":new _e(de.paint_symbol["icon-translate"]),"icon-translate-anchor":new _e(de.paint_symbol["icon-translate-anchor"]),"text-opacity":new te(de.paint_symbol["text-opacity"]),"text-color":new te(de.paint_symbol["text-color"],{runtimeType:kr,getOverride:i=>i.textColor,hasOverride:i=>!!i.textColor}),"text-halo-color":new te(de.paint_symbol["text-halo-color"]),"text-halo-width":new te(de.paint_symbol["text-halo-width"]),"text-halo-blur":new te(de.paint_symbol["text-halo-blur"]),"text-translate":new _e(de.paint_symbol["text-translate"]),"text-translate-anchor":new _e(de.paint_symbol["text-translate-anchor"])}),layout:X1};class Bg{constructor(e){this.type=e.property.overrides?e.property.overrides.runtimeType:Jo,this.defaultValue=e}evaluate(e){if(e.formattedSection){let r=this.defaultValue.property.overrides;if(r&&r.hasOverride(e.formattedSection))return r.getOverride(e.formattedSection)}return e.feature&&e.featureState?this.defaultValue.evaluate(e.feature,e.featureState):this.defaultValue.property.specification.default}eachChild(e){this.defaultValue.isConstant()||e(this.defaultValue.value._styleExpression.expression)}outputDefined(){return!1}serialize(){return null}}He(Bg,"FormatSectionOverride",{omit:["defaultValue"]});class yu extends hn{constructor(e){super(e,hd)}recalculate(e,r){super.recalculate(e,r),this.layout.get("icon-rotation-alignment")==="auto"&&(this.layout._values["icon-rotation-alignment"]=this.layout.get("symbol-placement")!=="point"?"map":"viewport"),this.layout.get("text-rotation-alignment")==="auto"&&(this.layout._values["text-rotation-alignment"]=this.layout.get("symbol-placement")!=="point"?"map":"viewport"),this.layout.get("text-pitch-alignment")==="auto"&&(this.layout._values["text-pitch-alignment"]=this.layout.get("text-rotation-alignment")),this.layout.get("icon-pitch-alignment")==="auto"&&(this.layout._values["icon-pitch-alignment"]=this.layout.get("icon-rotation-alignment"));let n=this.layout.get("text-writing-mode");if(n){let a=[];for(let h of n)a.indexOf(h)<0&&a.push(h);this.layout._values["text-writing-mode"]=a}else this.layout._values["text-writing-mode"]=this.layout.get("symbol-placement")==="point"?["horizontal"]:["horizontal","vertical"];this._setPaintOverrides()}getValueAndResolveTokens(e,r,n,a){let h=this.layout.get(e).evaluate(r,{},n,a),d=this._unevaluatedLayout._values[e];return d.isDataDriven()||Ea(d.value)||!h?h:function(m,y){return y.replace(/{([^{}]+)}/g,(x,E)=>E in m?String(m[E]):"")}(r.properties,h)}createBucket(e){return new Lo(e)}queryRadius(){return 0}queryIntersectsFeature(){return!1}_setPaintOverrides(){for(let e of hd.paint.overridableProperties){if(!yu.hasPaintOverride(this.layout,e))continue;let r=this.paint.get(e),n=new Bg(r),a=new wa(n,r.property.specification),h=null;h=r.value.kind==="constant"||r.value.kind==="source"?new Ta("source",a):new ps("composite",a,r.value.zoomStops,r.value._interpolationType),this.paint._values[e]=new be(r.property,h,r.parameters)}}_handleOverridablePaintPropertyUpdate(e,r,n){return!(!this.layout||r.isDataDriven()||n.isDataDriven())&&yu.hasPaintOverride(this.layout,e)}static hasPaintOverride(e,r){let n=e.get("text-field"),a=hd.paint.properties[r],h=!1,d=m=>{for(let y of m)if(a.overrides&&a.overrides.hasOverride(y))return void(h=!0)};if(n.value.kind==="constant"&&n.value.value instanceof Oi)d(n.value.value.sections);else if(n.value.kind==="source"){let m=x=>{h||(x instanceof ts&&si(x.value)===so?d(x.value.sections):x instanceof mn?d(x.sections):x.eachChild(m))},y=n.value;y._styleExpression&&m(y._styleExpression.expression)}return h}getProgramConfiguration(e){return new So(this,e)}}var K1={paint:new Te({"background-color":new _e(de.paint_background["background-color"]),"background-pattern":new Me(de.paint_background["background-pattern"]),"background-opacity":new _e(de.paint_background["background-opacity"])})},Y1={paint:new Te({"raster-opacity":new _e(de.paint_raster["raster-opacity"]),"raster-hue-rotate":new _e(de.paint_raster["raster-hue-rotate"]),"raster-brightness-min":new _e(de.paint_raster["raster-brightness-min"]),"raster-brightness-max":new _e(de.paint_raster["raster-brightness-max"]),"raster-saturation":new _e(de.paint_raster["raster-saturation"]),"raster-contrast":new _e(de.paint_raster["raster-contrast"]),"raster-resampling":new _e(de.paint_raster["raster-resampling"]),"raster-fade-duration":new _e(de.paint_raster["raster-fade-duration"])})};class J1 extends hn{constructor(e){super(e,{}),this.implementation=e}is3D(){return this.implementation.renderingMode==="3d"}hasOffscreenPass(){return this.implementation.prerender!==void 0}recalculate(){}updateTransitions(){}hasTransition(){return!1}serialize(){}onAdd(e){this.implementation.onAdd&&this.implementation.onAdd(e,e.painter.context.gl)}onRemove(e){this.implementation.onRemove&&this.implementation.onRemove(e,e.painter.context.gl)}}var Q1={paint:new Te({"sky-type":new _e(de.paint_sky["sky-type"]),"sky-atmosphere-sun":new _e(de.paint_sky["sky-atmosphere-sun"]),"sky-atmosphere-sun-intensity":new _e(de.paint_sky["sky-atmosphere-sun-intensity"]),"sky-gradient-center":new _e(de.paint_sky["sky-gradient-center"]),"sky-gradient-radius":new _e(de.paint_sky["sky-gradient-radius"]),"sky-gradient":new Ve(de.paint_sky["sky-gradient"]),"sky-atmosphere-halo-color":new _e(de.paint_sky["sky-atmosphere-halo-color"]),"sky-atmosphere-color":new _e(de.paint_sky["sky-atmosphere-color"]),"sky-opacity":new _e(de.paint_sky["sky-opacity"])})};function ud(i,e,r){let n=[0,0,1],a=bm([]);return Em(a,a,r?-Ce(i)+Math.PI:Ce(i)),wm(a,a,-Ce(e)),ym(n,n,a),Wi(n,n)}let ex={circle:class extends hn{constructor(i){super(i,o0)}createBucket(i){return new Ip(i)}queryRadius(i){let e=i;return Ga("circle-radius",this,e)+Ga("circle-stroke-width",this,e)+Nh(this.paint.get("circle-translate"))}queryIntersectsFeature(i,e,r,n,a,h,d,m){let y=dm(this.paint.get("circle-translate"),this.paint.get("circle-translate-anchor"),h.angle,i.pixelToTileUnitsFactor),x=this.paint.get("circle-radius").evaluate(e,r)+this.paint.get("circle-stroke-width").evaluate(e,r);return Tm(i,n,h,d,m,this.paint.get("circle-pitch-alignment")==="map",this.paint.get("circle-pitch-scale")==="map",y,x)}getProgramIds(){return["circle"]}getProgramConfiguration(i){return new So(this,i)}},heatmap:class extends hn{createBucket(i){return new km(i)}constructor(i){super(i,p0),this._updateColorRamp()}_handleSpecialPaintPropertyUpdate(i){i==="heatmap-color"&&this._updateColorRamp()}_updateColorRamp(){this.colorRamp=Up({expression:this._transitionablePaint._values["heatmap-color"].value.expression,evaluationKey:"heatmapDensity",image:this.colorRamp}),this.colorRampTexture=null}resize(){this.heatmapFbo&&(this.heatmapFbo.destroy(),this.heatmapFbo=null)}queryRadius(i){return Ga("heatmap-radius",this,i)}queryIntersectsFeature(i,e,r,n,a,h,d,m){let y=this.paint.get("heatmap-radius").evaluate(e,r);return Tm(i,n,h,d,m,!0,!0,new Y(0,0),y)}hasOffscreenPass(){return this.paint.get("heatmap-opacity")!==0&&this.visibility!=="none"}getProgramIds(){return["heatmap","heatmapTexture"]}getProgramConfiguration(i){return new So(this,i)}},hillshade:class extends hn{constructor(i){super(i,d0)}hasOffscreenPass(){return this.paint.get("hillshade-exaggeration")!==0&&this.visibility!=="none"}getProgramIds(){return["hillshade","hillshadePrepare"]}},fill:class extends hn{constructor(i){super(i,I0)}getProgramIds(){let i=this.paint.get("fill-pattern"),e=i&&i.constantOr(1),r=[e?"fillPattern":"fill"];return this.paint.get("fill-antialias")&&r.push(e&&!this.getPaintProperty("fill-outline-color")?"fillOutlinePattern":"fillOutline"),r}getProgramConfiguration(i){return new So(this,i)}recalculate(i,e){super.recalculate(i,e);let r=this.paint._values["fill-outline-color"];r.value.kind==="constant"&&r.value.value===void 0&&(this.paint._values["fill-outline-color"]=this.paint._values["fill-color"])}createBucket(i){return new eu(i)}queryRadius(){return Nh(this.paint.get("fill-translate"))}queryIntersectsFeature(i,e,r,n,a,h){return!i.queryGeometry.isAboveHorizon&&lm(pm(i.tilespaceGeometry,this.paint.get("fill-translate"),this.paint.get("fill-translate-anchor"),h.angle,i.pixelToTileUnitsFactor),n)}isTileClipped(){return!0}},"fill-extrusion":class extends hn{constructor(i){super(i,N0)}createBucket(i){return new oc(i)}queryRadius(){return Nh(this.paint.get("fill-extrusion-translate"))}is3D(){return!0}getProgramIds(){return[this.paint.get("fill-extrusion-pattern").constantOr(1)?"fillExtrusionPattern":"fillExtrusion"]}getProgramConfiguration(i){return new So(this,i)}queryIntersectsFeature(i,e,r,n,a,h,d,m,y){let x=dm(this.paint.get("fill-extrusion-translate"),this.paint.get("fill-extrusion-translate-anchor"),h.angle,i.pixelToTileUnitsFactor),E=this.paint.get("fill-extrusion-height").evaluate(e,r),k=this.paint.get("fill-extrusion-base").evaluate(e,r),S=[0,0],M=m&&h.elevation,P=h.elevation?h.elevation.exaggeration():1,F=i.tile.getBucket(this);if(M&&F instanceof oc){let ne=F.centroidVertexArray,re=y+1;if(re<ne.length){let se=ne.get(re);S[0]=se.a_centroid_pos0,S[1]=se.a_centroid_pos1}}if(S[0]===0&&S[1]===1)return!1;h.projection.name==="globe"&&(n=jm([n],[new Y(0,0),new Y(lt,lt)],i.tileID.canonical).map(ne=>ne.polygon).flat());let G=function(ne,re,se,ce,ue,ve,we,Se,Le,ge,ke){return ne.projection.name==="globe"?function(Be,Re,qe,Pe,Ne,dt,xt,it,Xe,vt,gt){let Qe=[],Ei=[],mi=Be.projection.upVectorScale(gt,Be.center.lat,Be.worldSize).metersToTile,ui=[0,0,0,1],bt=[0,0,0,1],Lt=(Wt,qt,Qt,ni)=>{Wt[0]=qt,Wt[1]=Qt,Wt[2]=ni,Wt[3]=1},Kt=Om();qe>0&&(qe+=Kt),Pe+=Kt;for(let Wt of Re){let qt=[],Qt=[];for(let ni of Wt){let Di=ni.x+Ne.x,or=ni.y+Ne.y,Ct=Be.projection.projectTilePoint(Di,or,gt),pi=Be.projection.upVector(gt,ni.x,ni.y),Gi=qe,Ut=Pe;if(xt){let oi=Gm(Di,or,qe,Pe,xt,it,Xe,vt);Gi+=oi.base,Ut+=oi.top}qe!==0?Lt(ui,Ct.x+pi[0]*mi*Gi,Ct.y+pi[1]*mi*Gi,Ct.z+pi[2]*mi*Gi):Lt(ui,Ct.x,Ct.y,Ct.z),Lt(bt,Ct.x+pi[0]*mi*Ut,Ct.y+pi[1]*mi*Ut,Ct.z+pi[2]*mi*Ut),ji(ui,ui,dt),ji(bt,bt,dt),qt.push(ru(ui)),Qt.push(ru(bt))}Qe.push(qt),Ei.push(Qt)}return[Qe,Ei]}(ne,re,se,ce,ue,ve,we,Se,Le,ge,ke):we?function(Be,Re,qe,Pe,Ne,dt,xt,it,Xe){let vt=[],gt=[],Qe=[0,0,0,1];for(let Ei of Be){let mi=[],ui=[];for(let bt of Ei){let Lt=bt.x+Pe.x,Kt=bt.y+Pe.y,Wt=Gm(Lt,Kt,Re,qe,dt,xt,it,Xe);Qe[0]=Lt,Qe[1]=Kt,Qe[2]=Wt.base,Qe[3]=1,Ms(Qe,Qe,Ne),Qe[3]=Math.max(Qe[3],1e-5);let qt=ru([Qe[0]/Qe[3],Qe[1]/Qe[3],Qe[2]/Qe[3]]);Qe[0]=Lt,Qe[1]=Kt,Qe[2]=Wt.top,Qe[3]=1,Ms(Qe,Qe,Ne),Qe[3]=Math.max(Qe[3],1e-5);let Qt=ru([Qe[0]/Qe[3],Qe[1]/Qe[3],Qe[2]/Qe[3]]);mi.push(qt),ui.push(Qt)}vt.push(mi),gt.push(ui)}return[vt,gt]}(re,se,ce,ue,ve,we,Se,Le,ge):function(Be,Re,qe,Pe,Ne){let dt=[],xt=[],it=Ne[8]*Re,Xe=Ne[9]*Re,vt=Ne[10]*Re,gt=Ne[11]*Re,Qe=Ne[8]*qe,Ei=Ne[9]*qe,mi=Ne[10]*qe,ui=Ne[11]*qe;for(let bt of Be){let Lt=[],Kt=[];for(let Wt of bt){let qt=Wt.x+Pe.x,Qt=Wt.y+Pe.y,ni=Ne[0]*qt+Ne[4]*Qt+Ne[12],Di=Ne[1]*qt+Ne[5]*Qt+Ne[13],or=Ne[2]*qt+Ne[6]*Qt+Ne[14],Ct=Ne[3]*qt+Ne[7]*Qt+Ne[15],pi=ni+it,Gi=Di+Xe,Ut=or+vt,oi=Math.max(Ct+gt,1e-5),Ki=ni+Qe,ti=Di+Ei,gi=or+mi,Li=Math.max(Ct+ui,1e-5),Ai=new Y(pi/oi,Gi/oi);Ai.z=Ut/oi,Lt.push(Ai);let Vi=new Y(Ki/Li,ti/Li);Vi.z=gi/Li,Kt.push(Vi)}dt.push(Lt),xt.push(Kt)}return[dt,xt]}(re,se,ce,ue,ve)}(h,n,k,E,x,d,M?m:null,S,P,h.center.lat,i.tileID.canonical),X=i.queryGeometry;return function(ne,re,se){let ce=1/0;lm(se,re)&&(ce=Nm(se,re[0]));for(let ue=0;ue<re.length;ue++){let ve=re[ue],we=ne[ue];for(let Se=0;Se<ve.length-1;Se++){let Le=ve[Se],ge=[Le,ve[Se+1],we[Se+1],we[Se],Le];am(se,ge)&&(ce=Math.min(ce,Nm(se,ge)))}}return ce!==1/0&&ce}(G[0],G[1],X.isPointQuery()?X.screenBounds:X.screenGeometry)}},line:class extends hn{constructor(i){super(i,$m),this.gradientVersion=0}_handleSpecialPaintPropertyUpdate(i){if(i==="line-gradient"){let e=this._transitionablePaint._values["line-gradient"].value.expression;this.stepInterpolant=e._styleExpression&&e._styleExpression.expression instanceof ua,this.gradientVersion=(this.gradientVersion+1)%Number.MAX_SAFE_INTEGER}}gradientExpression(){return this._transitionablePaint._values["line-gradient"].value.expression}recalculate(i,e){super.recalculate(i,e),this.paint._values["line-floorwidth"]=qm.possiblyEvaluate(this._transitioningPaint._values["line-width"].value,i)}createBucket(i){return new nu(i)}getProgramIds(){return[this.paint.get("line-pattern").constantOr(1)?"linePattern":"line"]}getProgramConfiguration(i){return new So(this,i)}queryRadius(i){let e=i,r=Zm(Ga("line-width",this,e),Ga("line-gap-width",this,e)),n=Ga("line-offset",this,e);return r/2+Math.abs(n)+Nh(this.paint.get("line-translate"))}queryIntersectsFeature(i,e,r,n,a,h){if(i.queryGeometry.isAboveHorizon)return!1;let d=pm(i.tilespaceGeometry,this.paint.get("line-translate"),this.paint.get("line-translate-anchor"),h.angle,i.pixelToTileUnitsFactor),m=i.pixelToTileUnitsFactor/2*Zm(this.paint.get("line-width").evaluate(e,r),this.paint.get("line-gap-width").evaluate(e,r)),y=this.paint.get("line-offset").evaluate(e,r);return y&&(n=function(x,E){let k=[],S=new Y(0,0);for(let M=0;M<x.length;M++){let P=x[M],F=[];for(let G=0;G<P.length;G++){let X=P[G-1],ne=P[G],re=P[G+1],se=G===0?S:ne.sub(X)._unit()._perp(),ce=G===P.length-1?S:re.sub(ne)._unit()._perp(),ue=se._add(ce)._unit();ue._mult(1/(ue.x*ce.x+ue.y*ce.y)),F.push(ue._mult(E)._add(ne))}k.push(F)}return k}(n,y*i.pixelToTileUnitsFactor)),function(x,E,k){for(let S=0;S<E.length;S++){let M=E[S];if(x.length>=3){for(let P=0;P<M.length;P++)if(Ss(x,M[P]))return!0}if(t0(x,M,k))return!0}return!1}(d,n,m)}isTileClipped(){return!0}},symbol:yu,background:class extends hn{constructor(i){super(i,K1)}getProgramIds(){return[this.paint.get("background-pattern")?"backgroundPattern":"background"]}},raster:class extends hn{constructor(i){super(i,Y1)}getProgramIds(){return["raster"]}},sky:class extends hn{constructor(i){super(i,Q1),this._updateColorRamp()}_handleSpecialPaintPropertyUpdate(i){i==="sky-gradient"?this._updateColorRamp():i!=="sky-atmosphere-sun"&&i!=="sky-atmosphere-halo-color"&&i!=="sky-atmosphere-color"&&i!=="sky-atmosphere-sun-intensity"||(this._skyboxInvalidated=!0)}_updateColorRamp(){this.colorRamp=Up({expression:this._transitionablePaint._values["sky-gradient"].value.expression,evaluationKey:"skyRadialProgress"}),this.colorRampTexture&&(this.colorRampTexture.destroy(),this.colorRampTexture=null)}needsSkyboxCapture(i){if(this._skyboxInvalidated||!this.skyboxTexture||!this.skyboxGeometry)return!0;if(!this.paint.get("sky-atmosphere-sun")){let e=i.style.light.properties.get("position");return this._lightPosition.azimuthal!==e.azimuthal||this._lightPosition.polar!==e.polar}return!1}getCenter(i,e){if(this.paint.get("sky-type")==="atmosphere"){let n=this.paint.get("sky-atmosphere-sun"),a=!n,h=i.style.light,d=h.properties.get("position");return a&&h.properties.get("anchor")==="viewport"&&ci("The sun direction is attached to a light with viewport anchor, lighting may behave unexpectedly."),a?ud(d.azimuthal,90-d.polar,e):ud(n[0],90-n[1],e)}let r=this.paint.get("sky-gradient-center");return ud(r[0],90-r[1],e)}is3D(){return!1}isSky(){return!0}markSkyboxValid(i){this._skyboxInvalidated=!1,this._lightPosition=i.style.light.properties.get("position")}hasOffscreenPass(){return!0}getProgramIds(){let i=this.paint.get("sky-type");return i==="atmosphere"?["skyboxCapture","skybox"]:i==="gradient"?["skyboxGradient"]:null}}};class yc{constructor(e,r,n,a){this.context=e,this.format=n,this.texture=e.gl.createTexture(),this.update(r,a)}update(e,r,n){let{width:a,height:h}=e,{context:d}=this,{gl:m}=d,{HTMLImageElement:y,HTMLCanvasElement:x,HTMLVideoElement:E,ImageData:k,ImageBitmap:S}=z;if(m.bindTexture(m.TEXTURE_2D,this.texture),d.pixelStoreUnpackFlipY.set(!1),d.pixelStoreUnpack.set(1),d.pixelStoreUnpackPremultiplyAlpha.set(this.format===m.RGBA&&(!r||r.premultiply!==!1)),n||this.size&&this.size[0]===a&&this.size[1]===h){let{x:M,y:P}=n||{x:0,y:0};e instanceof y||e instanceof x||e instanceof E||e instanceof k||S&&e instanceof S?m.texSubImage2D(m.TEXTURE_2D,0,M,P,m.RGBA,m.UNSIGNED_BYTE,e):m.texSubImage2D(m.TEXTURE_2D,0,M,P,a,h,m.RGBA,m.UNSIGNED_BYTE,e.data)}else this.size=[a,h],e instanceof y||e instanceof x||e instanceof E||e instanceof k||S&&e instanceof S?m.texImage2D(m.TEXTURE_2D,0,this.format,this.format,m.UNSIGNED_BYTE,e):m.texImage2D(m.TEXTURE_2D,0,this.format,a,h,0,this.format,m.UNSIGNED_BYTE,e.data);this.useMipmap=Boolean(r&&r.useMipmap&&this.isSizePowerOfTwo()),this.useMipmap&&m.generateMipmap(m.TEXTURE_2D)}bind(e,r){let{context:n}=this,{gl:a}=n;a.bindTexture(a.TEXTURE_2D,this.texture),e!==this.filter&&(a.texParameteri(a.TEXTURE_2D,a.TEXTURE_MAG_FILTER,e),a.texParameteri(a.TEXTURE_2D,a.TEXTURE_MIN_FILTER,this.useMipmap?e===a.NEAREST?a.NEAREST_MIPMAP_NEAREST:a.LINEAR_MIPMAP_NEAREST:e),this.filter=e),r!==this.wrap&&(a.texParameteri(a.TEXTURE_2D,a.TEXTURE_WRAP_S,r),a.texParameteri(a.TEXTURE_2D,a.TEXTURE_WRAP_T,r),this.wrap=r)}isSizePowerOfTwo(){return this.size[0]===this.size[1]&&Math.log(this.size[0])/Math.LN2%1==0}destroy(){let{gl:e}=this.context;e.deleteTexture(this.texture),this.texture=null}}class pd{constructor(e,r){this.width=e,this.height=r,this.nextRow=0,this.image=new Wn({width:e,height:r}),this.positions={},this.uploaded=!1}getDash(e,r){let n=this.getKey(e,r);return this.positions[n]}trim(){let e=this.width,r=this.height=lr(this.nextRow);this.image.resize({width:e,height:r})}getKey(e,r){return e.join(",")+r}getDashRanges(e,r,n){let a=[],h=e.length%2==1?-e[e.length-1]*n:0,d=e[0]*n,m=!0;a.push({left:h,right:d,isDash:m,zeroLength:e[0]===0});let y=e[0];for(let x=1;x<e.length;x++){m=!m;let E=e[x];h=y*n,y+=E,d=y*n,a.push({left:h,right:d,isDash:m,zeroLength:E===0})}return a}addRoundDash(e,r,n){let a=r/2;for(let h=-n;h<=n;h++){let d=this.width*(this.nextRow+n+h),m=0,y=e[m];for(let x=0;x<this.width;x++){x/y.right>1&&(y=e[++m]);let E=Math.abs(x-y.left),k=Math.abs(x-y.right),S=Math.min(E,k),M,P=h/n*(a+1);if(y.isDash){let F=a-Math.abs(P);M=Math.sqrt(S*S+F*F)}else M=a-Math.sqrt(S*S+P*P);this.image.data[d+x]=Math.max(0,Math.min(255,M+128))}}}addRegularDash(e,r){for(let y=e.length-1;y>=0;--y){let x=e[y],E=e[y+1];x.zeroLength?e.splice(y,1):E&&E.isDash===x.isDash&&(E.left=x.left,e.splice(y,1))}let n=e[0],a=e[e.length-1];n.isDash===a.isDash&&(n.left=a.left-this.width,a.right=n.right+this.width);let h=this.width*this.nextRow,d=0,m=e[d];for(let y=0;y<this.width;y++){y/m.right>1&&(m=e[++d]);let x=Math.abs(y-m.left),E=Math.abs(y-m.right),k=Math.min(x,E);this.image.data[h+y]=Math.max(0,Math.min(255,(m.isDash?k:-k)+r+128))}}addDash(e,r){let n=this.getKey(e,r);if(this.positions[n])return this.positions[n];let a=r==="round",h=a?7:0,d=2*h+1;if(this.nextRow+d>this.height)return ci("LineAtlas out of space"),null;e.length===0&&e.push(1);let m=0;for(let E=0;E<e.length;E++)e[E]<0&&(ci("Negative value is found in line dasharray, replacing values with 0"),e[E]=0),m+=e[E];if(m!==0){let E=this.width/m,k=this.getDashRanges(e,this.width,E);a?this.addRoundDash(k,E,h):this.addRegularDash(k,r==="square"?.5*E:0)}let y=this.nextRow+h;this.nextRow+=d;let x={tl:[y,h],br:[m,0]};return this.positions[n]=x,x}}He(pd,"LineAtlas");class tx{constructor(e){this._callback=e,this._triggered=!1,typeof MessageChannel<"u"&&(this._channel=new MessageChannel,this._channel.port2.onmessage=()=>{this._triggered=!1,this._callback()})}trigger(){this._triggered||(this._triggered=!0,this._channel?this._channel.port1.postMessage(!0):setTimeout(()=>{this._triggered=!1,this._callback()},0))}remove(){this._channel=void 0,this._callback=()=>{}}}class ix{constructor(){this.tasks={},this.taskQueue=[],vi(["process"],this),this.invoker=new tx(this.process),this.nextId=0}add(e,r){let n=this.nextId++,a=function({type:h,isSymbolTile:d,zoom:m}){return m=m||0,h==="message"?0:h!=="maybePrepare"||d?h!=="parseTile"||d?h==="parseTile"&&d?300-m:h==="maybePrepare"&&d?400-m:500:200-m:100-m}(r);if(a===0){Qi();try{e()}finally{}return{cancel:()=>{}}}return this.tasks[n]={fn:e,metadata:r,priority:a,id:n},this.taskQueue.push(n),this.invoker.trigger(),{cancel:()=>{delete this.tasks[n]}}}process(){Qi();try{if(this.taskQueue=this.taskQueue.filter(n=>!!this.tasks[n]),!this.taskQueue.length)return;let e=this.pick();if(e===null)return;let r=this.tasks[e];if(delete this.tasks[e],this.taskQueue.length&&this.invoker.trigger(),!r)return;r.fn()}finally{}}pick(){let e=null,r=1/0;for(let a=0;a<this.taskQueue.length;a++){let h=this.tasks[this.taskQueue[a]];h.priority<r&&(r=h.priority,e=a)}if(e===null)return null;let n=this.taskQueue[e];return this.taskQueue.splice(e,1),n}remove(){this.invoker.remove()}}class Rg{constructor(e){this._stringToNumber={},this._numberToString=[];for(let r=0;r<e.length;r++){let n=e[r];this._stringToNumber[n]=r,this._numberToString[r]=n}}encode(e){return this._stringToNumber[e]}decode(e){return this._numberToString[e]}}let rx=["tile","layer","source","sourceLayer","state"];class Fg{constructor(e,r,n,a,h){this.type="Feature",this._vectorTileFeature=e,this._z=r,this._x=n,this._y=a,this.properties=e.properties,this.id=h}get geometry(){return this._geometry===void 0&&(this._geometry=this._vectorTileFeature.toGeoJSON(this._x,this._y,this._z).geometry),this._geometry}set geometry(e){this._geometry=e}toJSON(){let e={type:"Feature",geometry:this.geometry,properties:this.properties};this.id!==void 0&&(e.id=this.id);for(let r of rx)this[r]!==void 0&&(e[r]=this[r]);return e}}let $r=32,En=33,Bo=new Uint16Array(8184);for(let i=0;i<2046;i++){let e=i+2,r=0,n=0,a=0,h=0,d=0,m=0;for(1&e?a=h=d=$r:r=n=m=$r;(e>>=1)>1;){let x=r+a>>1,E=n+h>>1;1&e?(a=r,h=n,r=d,n=m):(r=a,n=h,a=d,h=m),d=x,m=E}let y=4*i;Bo[y+0]=r,Bo[y+1]=n,Bo[y+2]=a,Bo[y+3]=h}let Tn=new Uint16Array(2178),Ro=new Uint8Array(1089),xu=new Uint16Array(1089);function Og(i){return i===0?-.03125:i===32?.03125:0}var jg=Oe([{name:"a_pos",type:"Int16",components:2},{name:"a_texture_pos",type:"Int16",components:2}]);let Ug={type:2,extent:lt,loadGeometry:()=>[[new Y(0,0),new Y(8193,0),new Y(8193,8193),new Y(0,8193),new Y(0,0)]]};class dd{constructor(e,r,n,a,h){this.tileID=e,this.uid=ki(),this.uses=0,this.tileSize=r,this.tileZoom=n,this.buckets={},this.expirationTime=null,this.queryPadding=0,this.hasSymbolBuckets=!1,this.hasRTLText=!1,this.dependencies={},this.isRaster=h,this.expiredRequestCount=0,this.state="loading",a&&a.transform&&(this.projection=a.transform.projection)}registerFadeDuration(e){let r=e+this.timeAdded;r<ur.now()||this.fadeEndTime&&r<this.fadeEndTime||(this.fadeEndTime=r)}wasRequested(){return this.state==="errored"||this.state==="loaded"||this.state==="reloading"}get tileTransform(){return this._tileTransform||(this._tileTransform=Ps(this.tileID.canonical,this.projection)),this._tileTransform}loadVectorData(e,r,n){if(this.unloadVectorData(),this.state="loaded",e){e.featureIndex&&(this.latestFeatureIndex=e.featureIndex,e.rawTileData?(this.latestRawTileData=e.rawTileData,this.latestFeatureIndex.rawTileData=e.rawTileData):this.latestRawTileData&&(this.latestFeatureIndex.rawTileData=this.latestRawTileData)),this.collisionBoxArray=e.collisionBoxArray,this.buckets=function(a,h){let d={};if(!h)return d;for(let m of a){let y=m.layerIds.map(x=>h.getLayer(x)).filter(Boolean);if(y.length!==0){m.layers=y,m.stateDependentLayerIds&&(m.stateDependentLayers=m.stateDependentLayerIds.map(x=>y.filter(E=>E.id===x)[0]));for(let x of y)d[x.id]=m}}return d}(e.buckets,r.style),this.hasSymbolBuckets=!1;for(let a in this.buckets){let h=this.buckets[a];if(h instanceof Lo){if(this.hasSymbolBuckets=!0,!n)break;h.justReloaded=!0}}if(this.hasRTLText=!1,this.hasSymbolBuckets)for(let a in this.buckets){let h=this.buckets[a];if(h instanceof Lo&&h.hasRTLText){this.hasRTLText=!0,U.isLoading()||U.isLoaded()||j()!=="deferred"||J();break}}this.queryPadding=0;for(let a in this.buckets){let h=this.buckets[a];this.queryPadding=Math.max(this.queryPadding,r.style.getLayer(a).queryRadius(h))}e.imageAtlas&&(this.imageAtlas=e.imageAtlas),e.glyphAtlasImage&&(this.glyphAtlasImage=e.glyphAtlasImage),e.lineAtlas&&(this.lineAtlas=e.lineAtlas)}else this.collisionBoxArray=new wp}unloadVectorData(){if(this.hasData()){for(let e in this.buckets)this.buckets[e].destroy();this.buckets={},this.imageAtlas&&(this.imageAtlas=null),this.lineAtlas&&(this.lineAtlas=null),this.imageAtlasTexture&&this.imageAtlasTexture.destroy(),this.glyphAtlasTexture&&this.glyphAtlasTexture.destroy(),this.lineAtlasTexture&&this.lineAtlasTexture.destroy(),this._tileBoundsBuffer&&(this._tileBoundsBuffer.destroy(),this._tileBoundsIndexBuffer.destroy(),this._tileBoundsSegments.destroy(),this._tileBoundsBuffer=null),this._tileDebugBuffer&&(this._tileDebugBuffer.destroy(),this._tileDebugIndexBuffer.destroy(),this._tileDebugSegments.destroy(),this._tileDebugBuffer=null),this._globeTileDebugBorderBuffer&&(this._globeTileDebugBorderBuffer.destroy(),this._globeTileDebugBorderBuffer=null),this._tileDebugTextBuffer&&(this._tileDebugTextBuffer.destroy(),this._tileDebugTextSegments.destroy(),this._tileDebugTextIndexBuffer.destroy(),this._tileDebugTextBuffer=null),this._globeTileDebugTextBuffer&&(this._globeTileDebugTextBuffer.destroy(),this._globeTileDebugTextBuffer=null),this.latestFeatureIndex=null,this.state="unloaded"}}getBucket(e){return this.buckets[e.id]}upload(e){for(let n in this.buckets){let a=this.buckets[n];a.uploadPending()&&a.upload(e)}let r=e.gl;this.imageAtlas&&!this.imageAtlas.uploaded&&(this.imageAtlasTexture=new yc(e,this.imageAtlas.image,r.RGBA),this.imageAtlas.uploaded=!0),this.glyphAtlasImage&&(this.glyphAtlasTexture=new yc(e,this.glyphAtlasImage,r.ALPHA),this.glyphAtlasImage=null),this.lineAtlas&&!this.lineAtlas.uploaded&&(this.lineAtlasTexture=new yc(e,this.lineAtlas.image,r.ALPHA),this.lineAtlas.uploaded=!0)}prepare(e){this.imageAtlas&&this.imageAtlas.patchUpdatedImages(e,this.imageAtlasTexture)}queryRenderedFeatures(e,r,n,a,h,d,m,y){return this.latestFeatureIndex&&this.latestFeatureIndex.rawTileData?this.latestFeatureIndex.query({tileResult:a,pixelPosMatrix:m,transform:d,params:h,tileTransform:this.tileTransform},e,r,n):{}}querySourceFeatures(e,r){let n=this.latestFeatureIndex;if(!n||!n.rawTileData)return;let a=n.loadVTLayers(),h=r?r.sourceLayer:"",d=a._geojsonTileLayer||a[h];if(!d)return;let m=Vn(r&&r.filter),{z:y,x,y:E}=this.tileID.canonical,k={z:y,x,y:E};for(let S=0;S<d.length;S++){let M=d.feature(S);if(m.needGeometry){let G=ks(M,!0);if(!m.filter(new $(this.tileID.overscaledZ),G,this.tileID.canonical))continue}else if(!m.filter(new $(this.tileID.overscaledZ),M))continue;let P=n.getId(M,h),F=new Fg(M,y,x,E,P);F.tile=k,e.push(F)}}hasData(){return this.state==="loaded"||this.state==="reloading"||this.state==="expired"}patternsLoaded(){return!!this.imageAtlas&&!!Object.keys(this.imageAtlas.patternPositions).length}setExpiryData(e){let r=this.expirationTime;if(e.cacheControl){let n=Hr(e.cacheControl);n["max-age"]&&(this.expirationTime=Date.now()+1e3*n["max-age"])}else e.expires&&(this.expirationTime=new Date(e.expires).getTime());if(this.expirationTime){let n=Date.now(),a=!1;if(this.expirationTime>n)a=!1;else if(r)if(this.expirationTime<r)a=!0;else{let h=this.expirationTime-r;h?this.expirationTime=n+Math.max(h,3e4):a=!0}else a=!0;a?(this.expiredRequestCount++,this.state="expired"):this.expiredRequestCount=0}}getExpiryTimeout(){if(this.expirationTime)return this.expiredRequestCount?1e3*(1<<Math.min(this.expiredRequestCount-1,31)):Math.min(this.expirationTime-new Date().getTime(),Math.pow(2,31)-1)}setFeatureState(e,r){if(!this.latestFeatureIndex||!this.latestFeatureIndex.rawTileData||Object.keys(e).length===0||!r)return;let n=this.latestFeatureIndex.loadVTLayers(),a=r.style.listImages();for(let h in this.buckets){if(!r.style.hasLayer(h))continue;let d=this.buckets[h],m=d.layers[0].sourceLayer||"_geojsonTileLayer",y=n[m],x=e[m];if(!y||!x||Object.keys(x).length===0)continue;if(d.update(x,y,a,this.imageAtlas&&this.imageAtlas.patternPositions||{}),d instanceof nu||d instanceof eu){let k=r.style._getSourceCache(d.layers[0].source);r._terrain&&r._terrain.enabled&&k&&d.programConfigurations.needsUpload&&r._terrain._clearRenderCacheForTile(k.id,this.tileID)}let E=r&&r.style&&r.style.getLayer(h);E&&(this.queryPadding=Math.max(this.queryPadding,E.queryRadius(d)))}}holdingForFade(){return this.symbolFadeHoldUntil!==void 0}symbolFadeFinished(){return!this.symbolFadeHoldUntil||this.symbolFadeHoldUntil<ur.now()}clearFadeHold(){this.symbolFadeHoldUntil=void 0}setHoldDuration(e){this.symbolFadeHoldUntil=ur.now()+e}setTexture(e,r){let n=r.context,a=n.gl;this.texture=r.getTileTexture(e.width),this.texture?this.texture.update(e,{useMipmap:!0}):(this.texture=new yc(n,e,a.RGBA,{useMipmap:!0}),this.texture.bind(a.LINEAR,a.CLAMP_TO_EDGE),n.extTextureFilterAnisotropic&&a.texParameterf(a.TEXTURE_2D,n.extTextureFilterAnisotropic.TEXTURE_MAX_ANISOTROPY_EXT,n.extTextureFilterAnisotropicMax))}setDependencies(e,r){let n={};for(let a of r)n[a]=!0;this.dependencies[e]=n}hasDependency(e,r){for(let n of e){let a=this.dependencies[n];if(a){for(let h of r)if(a[h])return!0}}return!1}clearQueryDebugViz(){}_makeDebugTileBoundsBuffers(e,r){if(!r||r.name==="mercator"||this._tileDebugBuffer)return;let n=Zn(Ug,this.tileID.canonical,this.tileTransform)[0],a=new rt,h=new Ur;for(let d=0;d<n.length;d++){let{x:m,y}=n[d];a.emplaceBack(m,y),h.emplaceBack(d)}h.emplaceBack(0),this._tileDebugIndexBuffer=e.createIndexBuffer(h),this._tileDebugBuffer=e.createVertexBuffer(a,pc.members),this._tileDebugSegments=fi.simpleSegment(0,0,a.length,h.length)}_makeTileBoundsBuffers(e,r){if(this._tileBoundsBuffer||!r||r.name==="mercator")return;let n=Zn(Ug,this.tileID.canonical,this.tileTransform)[0],a,h;if(this.isRaster){let d=function(m,y){let x=Ps(m,y),E=Math.pow(2,m.z);for(let G=0;G<En;G++)for(let X=0;X<En;X++){let ne=Zi((m.x+(X+Og(X))/$r)/E),re=wi((m.y+(G+Og(G))/$r)/E),se=y.project(ne,re),ce=G*En+X;Tn[2*ce+0]=Math.round((se.x*x.scale-x.x)*lt),Tn[2*ce+1]=Math.round((se.y*x.scale-x.y)*lt)}Ro.fill(0),xu.fill(0);for(let G=2045;G>=0;G--){let X=4*G,ne=Bo[X+0],re=Bo[X+1],se=Bo[X+2],ce=Bo[X+3],ue=ne+se>>1,ve=re+ce>>1,we=ue+ve-re,Se=ve+ne-ue,Le=re*En+ne,ge=ce*En+se,ke=ve*En+ue,Be=Math.hypot((Tn[2*Le+0]+Tn[2*ge+0])/2-Tn[2*ke+0],(Tn[2*Le+1]+Tn[2*ge+1])/2-Tn[2*ke+1])>=16;if(Ro[ke]=Ro[ke]||(Be?1:0),G<1022){let Re=(re+Se>>1)*En+(ne+we>>1),qe=(ce+Se>>1)*En+(se+we>>1);Ro[ke]=Ro[ke]||Ro[Re]||Ro[qe]}}let k=new et,S=new Mt,M=0;function P(G,X){let ne=X*En+G;return xu[ne]===0&&(k.emplaceBack(Tn[2*ne+0],Tn[2*ne+1],G*lt/$r,X*lt/$r),xu[ne]=++M),xu[ne]-1}function F(G,X,ne,re,se,ce){let ue=G+ne>>1,ve=X+re>>1;if(Math.abs(G-se)+Math.abs(X-ce)>1&&Ro[ve*En+ue])F(se,ce,G,X,ue,ve),F(ne,re,se,ce,ue,ve);else{let we=P(G,X),Se=P(ne,re),Le=P(se,ce);S.emplaceBack(we,Se,Le)}}return F(0,0,$r,$r,$r,0),F($r,$r,0,0,0,$r),{vertices:k,indices:S}}(this.tileID.canonical,r);a=d.vertices,h=d.indices}else{a=new et,h=new Mt;for(let{x:m,y}of n)a.emplaceBack(m,y,0,0);let d=Xh(a.int16,void 0,4);for(let m=0;m<d.length;m+=3)h.emplaceBack(d[m],d[m+1],d[m+2])}this._tileBoundsBuffer=e.createVertexBuffer(a,jg.members),this._tileBoundsIndexBuffer=e.createIndexBuffer(h),this._tileBoundsSegments=fi.simpleSegment(0,0,a.length,h.length)}_makeGlobeTileDebugBuffers(e,r){if(this._globeTileDebugBorderBuffer||this._globeTileDebugTextBuffer||!r||r.name!=="globe")return;let n=this.tileID.canonical,a=dc(wn(n));this._makeGlobeTileDebugBorderBuffer(e,n,a),this._makeGlobeTileDebugTextBuffer(e,n,a)}_makeGlobeTileDebugBorderBuffer(e,r,n){let a=new rt,h=new Ur,d=new mt,m=(x,E,k,S,M)=>{let P=(k-x)/(M-1),F=(S-E)/(M-1),G=a.length;for(let X=0;X<M;X++){let ne=x+X*P,re=E+X*F;a.emplaceBack(ne,re);let se=Tg(ne,re,r),ce=ji(se,se,n);d.emplaceBack(ce[0],ce[1],ce[2]),h.emplaceBack(G+X)}},y=lt;m(0,0,y,0,16),m(y,0,y,y,16),m(y,y,0,y,16),m(0,y,0,0,16),this._tileDebugIndexBuffer=e.createIndexBuffer(h),this._tileDebugBuffer=e.createVertexBuffer(a,pc.members),this._globeTileDebugBorderBuffer=e.createVertexBuffer(d,bg.members),this._tileDebugSegments=fi.simpleSegment(0,0,a.length,h.length)}_makeGlobeTileDebugTextBuffer(e,r,n){let a=new rt,h=new Mt,d=new mt,m=25;h.reserve(32),a.reserve(m),d.reserve(m);let y=(x,E)=>m*x+E;for(let x=0;x<m;x++){let E=2048*x;for(let k=0;k<m;k++){let S=2048*k;a.emplaceBack(S,E);let M=Tg(S,E,r),P=ji(M,M,n);d.emplaceBack(P[0],P[1],P[2])}}for(let x=0;x<4;x++)for(let E=0;E<4;E++){let k=y(x,E),S=y(x,E+1),M=y(x+1,E),P=y(x+1,E+1);h.emplaceBack(k,S,M),h.emplaceBack(M,S,P)}this._tileDebugTextIndexBuffer=e.createIndexBuffer(h),this._tileDebugTextBuffer=e.createVertexBuffer(a,pc.members),this._globeTileDebugTextBuffer=e.createVertexBuffer(d,bg.members),this._tileDebugTextSegments=fi.simpleSegment(0,0,m,32)}}class nx{constructor(){this.state={},this.stateChanges={},this.deletedStates={}}updateState(e,r,n){let a=String(r);if(this.stateChanges[e]=this.stateChanges[e]||{},this.stateChanges[e][a]=this.stateChanges[e][a]||{},Bt(this.stateChanges[e][a],n),this.deletedStates[e]===null){this.deletedStates[e]={};for(let h in this.state[e])h!==a&&(this.deletedStates[e][h]=null)}else if(this.deletedStates[e]&&this.deletedStates[e][a]===null){this.deletedStates[e][a]={};for(let h in this.state[e][a])n[h]||(this.deletedStates[e][a][h]=null)}else for(let h in n)this.deletedStates[e]&&this.deletedStates[e][a]&&this.deletedStates[e][a][h]===null&&delete this.deletedStates[e][a][h]}removeFeatureState(e,r,n){if(this.deletedStates[e]===null)return;let a=String(r);if(this.deletedStates[e]=this.deletedStates[e]||{},n&&r!==void 0)this.deletedStates[e][a]!==null&&(this.deletedStates[e][a]=this.deletedStates[e][a]||{},this.deletedStates[e][a][n]=null);else if(r!==void 0)if(this.stateChanges[e]&&this.stateChanges[e][a])for(n in this.deletedStates[e][a]={},this.stateChanges[e][a])this.deletedStates[e][a][n]=null;else this.deletedStates[e][a]=null;else this.deletedStates[e]=null}getState(e,r){let n=String(r),a=Bt({},(this.state[e]||{})[n],(this.stateChanges[e]||{})[n]);if(this.deletedStates[e]===null)return{};if(this.deletedStates[e]){let h=this.deletedStates[e][r];if(h===null)return{};for(let d in h)delete a[d]}return a}initializeTileState(e,r){e.setFeatureState(this.state,r)}coalesceChanges(e,r){let n={};for(let a in this.stateChanges){this.state[a]=this.state[a]||{};let h={};for(let d in this.stateChanges[a])this.state[a][d]||(this.state[a][d]={}),Bt(this.state[a][d],this.stateChanges[a][d]),h[d]=this.state[a][d];n[a]=h}for(let a in this.deletedStates){this.state[a]=this.state[a]||{};let h={};if(this.deletedStates[a]===null)for(let d in this.state[a])h[d]={},this.state[a][d]={};else for(let d in this.deletedStates[a]){if(this.deletedStates[a][d]===null)this.state[a][d]={};else for(let m of Object.keys(this.deletedStates[a][d]))delete this.state[a][d][m];h[d]=this.state[a][d]}n[a]=n[a]||{},Bt(n[a],h)}if(this.stateChanges={},this.deletedStates={},Object.keys(n).length!==0)for(let a in e)e[a].setFeatureState(n,r)}}class Vg{constructor(e){this.size=e,this.minimums=[],this.maximums=[],this.leaves=[]}getElevation(e,r){let n=this.toIdx(e,r);return{min:this.minimums[n],max:this.maximums[n]}}isLeaf(e,r){return this.leaves[this.toIdx(e,r)]}toIdx(e,r){return r*this.size+e}}function Ng(i,e,r,n){let a=0,h=Number.MAX_VALUE;for(let d=0;d<3;d++)if(Math.abs(n[d])<1e-15){if(r[d]<i[d]||r[d]>e[d])return null}else{let m=1/n[d],y=(i[d]-r[d])*m,x=(e[d]-r[d])*m;if(y>x){let E=y;y=x,x=E}if(y>a&&(a=y),x<h&&(h=x),a>h)return null}return a}function Gg(i,e,r,n,a,h,d,m,y,x,E){let k=n-i,S=a-e,M=h-r,P=d-i,F=m-e,G=y-r,X=E[1]*G-E[2]*F,ne=E[2]*P-E[0]*G,re=E[0]*F-E[1]*P,se=k*X+S*ne+M*re;if(Math.abs(se)<1e-15)return null;let ce=1/se,ue=x[0]-i,ve=x[1]-e,we=x[2]-r,Se=(ue*X+ve*ne+we*re)*ce;if(Se<0||Se>1)return null;let Le=ve*M-we*S,ge=we*k-ue*M,ke=ue*S-ve*k,Be=(E[0]*Le+E[1]*ge+E[2]*ke)*ce;return Be<0||Se+Be>1?null:(P*Le+F*ge+G*ke)*ce}function $g(i,e,r){return(i-e)/(r-e)}function qg(i,e,r,n,a,h,d,m,y){let x=1<<r,E=h-n,k=d-a,S=(i+1)/x*E+n,M=(e+0)/x*k+a,P=(e+1)/x*k+a;m[0]=(i+0)/x*E+n,m[1]=M,y[0]=S,y[1]=P}class Zg{constructor(e){if(this.maximums=[],this.minimums=[],this.leaves=[],this.childOffsets=[],this.nodeCount=0,this.dem=e,this._siblingOffset=[[0,0],[1,0],[0,1],[1,1]],!this.dem)return;let r=function(h){let d=Math.ceil(Math.log2(h.dim/8)),m=[],y=Math.ceil(Math.pow(2,d)),x=1/y,E=(M,P,F,G,X)=>{let ne=G?1:0,re=(M+1)*F-ne,se=P*F,ce=(P+1)*F-ne;X[0]=M*F,X[1]=se,X[2]=re,X[3]=ce},k=new Vg(y),S=[];for(let M=0;M<y*y;M++){E(M%y,Math.floor(M/y),x,!1,S);let P=Fo(S[0],S[1],h),F=Fo(S[2],S[1],h),G=Fo(S[2],S[3],h),X=Fo(S[0],S[3],h);k.minimums.push(Math.min(P,F,G,X)),k.maximums.push(Math.max(P,F,G,X)),k.leaves.push(1)}for(m.push(k),y/=2;y>=1;y/=2){let M=m[m.length-1];k=new Vg(y);for(let P=0;P<y*y;P++){E(P%y,Math.floor(P/y),2,!0,S);let F=M.getElevation(S[0],S[1]),G=M.getElevation(S[2],S[1]),X=M.getElevation(S[2],S[3]),ne=M.getElevation(S[0],S[3]),re=M.isLeaf(S[0],S[1]),se=M.isLeaf(S[2],S[1]),ce=M.isLeaf(S[2],S[3]),ue=M.isLeaf(S[0],S[3]),ve=Math.min(F.min,G.min,X.min,ne.min),we=Math.max(F.max,G.max,X.max,ne.max),Se=re&&se&&ce&&ue;k.maximums.push(we),k.minimums.push(ve),k.leaves.push(we-ve<=5&&Se?1:0)}m.push(k)}return m}(this.dem),n=r.length-1,a=r[n];this._addNode(a.minimums[0],a.maximums[0],a.leaves[0]),this._construct(r,0,0,n,0)}raycastRoot(e,r,n,a,h,d,m=1){return Ng([e,r,-100],[n,a,this.maximums[0]*m],h,d)}raycast(e,r,n,a,h,d,m=1){if(!this.nodeCount)return null;let y=this.raycastRoot(e,r,n,a,h,d,m);if(y==null)return null;let x=[],E=[],k=[],S=[],M=[{idx:0,t:y,nodex:0,nodey:0,depth:0}];for(;M.length>0;){let{idx:P,t:F,nodex:G,nodey:X,depth:ne}=M.pop();if(this.leaves[P]){qg(G,X,ne,e,r,n,a,k,S);let se=1<<ne,ce=(G+0)/se,ue=(G+1)/se,ve=(X+0)/se,we=(X+1)/se,Se=Fo(ce,ve,this.dem)*m,Le=Fo(ue,ve,this.dem)*m,ge=Fo(ue,we,this.dem)*m,ke=Fo(ce,we,this.dem)*m,Be=Gg(k[0],k[1],Se,S[0],k[1],Le,S[0],S[1],ge,h,d),Re=Gg(S[0],S[1],ge,k[0],S[1],ke,k[0],k[1],Se,h,d),qe=Math.min(Be!==null?Be:Number.MAX_VALUE,Re!==null?Re:Number.MAX_VALUE);if(qe!==Number.MAX_VALUE)return qe;{let Pe=Hh([],h,d,F);if(Wg(Se,Le,ke,ge,$g(Pe[0],k[0],S[0]),$g(Pe[1],k[1],S[1]))>=Pe[2])return F}continue}let re=0;for(let se=0;se<this._siblingOffset.length;se++){qg((G<<1)+this._siblingOffset[se][0],(X<<1)+this._siblingOffset[se][1],ne+1,e,r,n,a,k,S),k[2]=-100,S[2]=this.maximums[this.childOffsets[P]+se]*m;let ce=Ng(k,S,h,d);if(ce!=null){let ue=ce;x[se]=ue;let ve=!1;for(let we=0;we<re&&!ve;we++)ue>=x[E[we]]&&(E.splice(we,0,se),ve=!0);ve||(E[re]=se),re++}}for(let se=0;se<re;se++){let ce=E[se];M.push({idx:this.childOffsets[P]+ce,t:x[ce],nodex:(G<<1)+this._siblingOffset[ce][0],nodey:(X<<1)+this._siblingOffset[ce][1],depth:ne+1})}}return null}_addNode(e,r,n){return this.minimums.push(e),this.maximums.push(r),this.leaves.push(n),this.childOffsets.push(0),this.nodeCount++}_construct(e,r,n,a,h){if(e[a].isLeaf(r,n)===1)return;this.childOffsets[h]||(this.childOffsets[h]=this.nodeCount);let d=a-1,m=e[d],y=0,x=0;for(let E=0;E<this._siblingOffset.length;E++){let k=2*r+this._siblingOffset[E][0],S=2*n+this._siblingOffset[E][1],M=m.getElevation(k,S),P=m.isLeaf(k,S),F=this._addNode(M.min,M.max,P);P&&(y|=1<<E),x||(x=F)}for(let E=0;E<this._siblingOffset.length;E++)y&1<<E||this._construct(e,2*r+this._siblingOffset[E][0],2*n+this._siblingOffset[E][1],d,x+E)}}function Wg(i,e,r,n,a,h){return Pt(Pt(i,r,h),Pt(e,n,h),a)}function Fo(i,e,r){let n=r.dim,a=Je(i*n-.5,0,n-1),h=Je(e*n-.5,0,n-1),d=Math.floor(a),m=Math.floor(h),y=Math.min(d+1,n-1),x=Math.min(m+1,n-1);return Wg(r.get(d,m),r.get(y,m),r.get(d,x),r.get(y,x),a-d,h-m)}let Hg={mapbox:[6553.6,25.6,.1,1e4],terrarium:[256,1,1/256,32768]};class vu{get tree(){return this._tree||this._buildQuadTree(),this._tree}constructor(e,r,n,a=!1,h=!1){if(this.uid=e,r.height!==r.width)throw new RangeError("DEM tiles must be square");if(n&&n!=="mapbox"&&n!=="terrarium")return ci(`"${n}" is not a valid encoding type. Valid types include "mapbox" and "terrarium".`);this.stride=r.height;let d=this.dim=r.height-2,m=new Uint32Array(r.data.buffer);if(this.pixels=new Uint8Array(r.data.buffer),this.encoding=n||"mapbox",this.borderReady=a,!a){for(let y=0;y<d;y++)m[this._idx(-1,y)]=m[this._idx(0,y)],m[this._idx(d,y)]=m[this._idx(d-1,y)],m[this._idx(y,-1)]=m[this._idx(y,0)],m[this._idx(y,d)]=m[this._idx(y,d-1)];m[this._idx(-1,-1)]=m[this._idx(0,0)],m[this._idx(d,-1)]=m[this._idx(d-1,0)],m[this._idx(-1,d)]=m[this._idx(0,d-1)],m[this._idx(d,d)]=m[this._idx(d-1,d-1)],h&&this._buildQuadTree()}}_buildQuadTree(){this._tree=new Zg(this)}get(e,r,n=!1){n&&(e=Je(e,-1,this.dim),r=Je(r,-1,this.dim));let a=4*this._idx(e,r);return(this.encoding==="terrarium"?this._unpackTerrarium:this._unpackMapbox)(this.pixels[a],this.pixels[a+1],this.pixels[a+2])}static getUnpackVector(e){return Hg[e]}get unpackVector(){return Hg[this.encoding]}_idx(e,r){if(e<-1||e>=this.dim+1||r<-1||r>=this.dim+1)throw new RangeError("out of range source coordinates for DEM data");return(r+1)*this.stride+(e+1)}_unpackMapbox(e,r,n){return(256*e*256+256*r+n)/10-1e4}_unpackTerrarium(e,r,n){return 256*e+r+n/256-32768}static pack(e,r){let n=[0,0,0,0],a=vu.getUnpackVector(r),h=Math.floor((e+a[3])/a[2]);return n[2]=h%256,h=Math.floor(h/256),n[1]=h%256,h=Math.floor(h/256),n[0]=h,n}getPixels(){return new vr({width:this.stride,height:this.stride},this.pixels)}backfillBorder(e,r,n){if(this.dim!==e.dim)throw new Error("dem dimension mismatch");let a=r*this.dim,h=r*this.dim+this.dim,d=n*this.dim,m=n*this.dim+this.dim;switch(r){case-1:a=h-1;break;case 1:h=a+1}switch(n){case-1:d=m-1;break;case 1:m=d+1}let y=-r*this.dim,x=-n*this.dim;for(let E=d;E<m;E++)for(let k=a;k<h;k++){let S=4*this._idx(k,E),M=4*this._idx(k+y,E+x);this.pixels[S+0]=e.pixels[M+0],this.pixels[S+1]=e.pixels[M+1],this.pixels[S+2]=e.pixels[M+2],this.pixels[S+3]=e.pixels[M+3]}}onDeserialize(){this._tree&&(this._tree.dem=this)}}He(vu,"DEMData"),He(Zg,"DemMinMaxQuadTree",{omit:["dem"]});class ox{constructor(e,r){this.max=e,this.onRemove=r,this.reset()}reset(){for(let e in this.data)for(let r of this.data[e])r.timeout&&clearTimeout(r.timeout),this.onRemove(r.value);return this.data={},this.order=[],this}add(e,r,n){let a=e.wrapped().key;this.data[a]===void 0&&(this.data[a]=[]);let h={value:r,timeout:void 0};if(n!==void 0&&(h.timeout=setTimeout(()=>{this.remove(e,h)},n)),this.data[a].push(h),this.order.push(a),this.order.length>this.max){let d=this._getAndRemoveByKey(this.order[0]);d&&this.onRemove(d)}return this}has(e){return e.wrapped().key in this.data}getAndRemove(e){return this.has(e)?this._getAndRemoveByKey(e.wrapped().key):null}_getAndRemoveByKey(e){let r=this.data[e].shift();return r.timeout&&clearTimeout(r.timeout),this.data[e].length===0&&delete this.data[e],this.order.splice(this.order.indexOf(e),1),r.value}getByKey(e){let r=this.data[e];return r?r[0].value:null}get(e){return this.has(e)?this.data[e.wrapped().key][0].value:null}remove(e,r){if(!this.has(e))return this;let n=e.wrapped().key,a=r===void 0?0:this.data[n].indexOf(r),h=this.data[n][a];return this.data[n].splice(a,1),h.timeout&&clearTimeout(h.timeout),this.data[n].length===0&&delete this.data[n],this.onRemove(h.value),this.order.splice(this.order.indexOf(n),1),this}setMaxSize(e){for(this.max=e;this.order.length>this.max;){let r=this._getAndRemoveByKey(this.order[0]);r&&this.onRemove(r)}return this}filter(e){let r=[];for(let n in this.data)for(let a of this.data[n])e(a.value)||r.push(a);for(let n of r)this.remove(n.value.tileID,n)}}class tl{constructor(e,r,n){this.func=e,this.mask=r,this.range=n}}tl.ReadOnly=!1,tl.ReadWrite=!0,tl.disabled=new tl(519,tl.ReadOnly,[0,1]);let fd=7680;class md{constructor(e,r,n,a,h,d){this.test=e,this.ref=r,this.mask=n,this.fail=a,this.depthFail=h,this.pass=d}}md.disabled=new md({func:519,mask:0},0,0,fd,fd,fd);class Cn{constructor(e,r,n){this.blendFunction=e,this.blendColor=r,this.mask=n}}Cn.Replace=[1,0],Cn.disabled=new Cn(Cn.Replace,hi.transparent,[!1,!1,!1,!1]),Cn.unblended=new Cn(Cn.Replace,hi.transparent,[!0,!0,!0,!0]),Cn.alphaBlended=new Cn([1,771],hi.transparent,[!0,!0,!0,!0]);let gd=1029,_d=2305;class un{constructor(e,r,n){this.enable=e,this.mode=r,this.frontFace=n}}un.disabled=new un(!1,gd,_d),un.backCCW=new un(!0,gd,_d),un.backCW=new un(!0,gd,2304),un.frontCW=new un(!0,1028,2304),un.frontCCW=new un(!0,1028,_d);class Ds extends Vt{constructor(e,r,n){super(),this.id=e,this._onlySymbols=n,r.on("data",a=>{a.dataType==="source"&&a.sourceDataType==="metadata"&&(this._sourceLoaded=!0),this._sourceLoaded&&!this._paused&&a.dataType==="source"&&a.sourceDataType==="content"&&(this.reload(),this.transform&&this.update(this.transform))}),r.on("error",()=>{this._sourceErrored=!0}),this._source=r,this._tiles={},this._cache=new ox(0,this._unloadTile.bind(this)),this._timers={},this._cacheTimers={},this._minTileCacheSize=r.minTileCacheSize,this._maxTileCacheSize=r.maxTileCacheSize,this._loadedParentTiles={},this._coveredTiles={},this._state=new nx,this._isRaster=this._source.type==="raster"||this._source.type==="raster-dem"||this._source.type==="custom"&&this._source._dataType==="raster"}onAdd(e){this.map=e,this._minTileCacheSize=this._minTileCacheSize===void 0&&e?e._minTileCacheSize:this._minTileCacheSize,this._maxTileCacheSize=this._maxTileCacheSize===void 0&&e?e._maxTileCacheSize:this._maxTileCacheSize}loaded(){if(this._sourceErrored)return!0;if(!this._sourceLoaded||!this._source.loaded())return!1;for(let e in this._tiles){let r=this._tiles[e];if(r.state!=="loaded"&&r.state!=="errored")return!1}return!0}getSource(){return this._source}pause(){this._paused=!0}resume(){if(!this._paused)return;let e=this._shouldReloadOnResume;this._paused=!1,this._shouldReloadOnResume=!1,e&&this.reload(),this.transform&&this.update(this.transform)}_loadTile(e,r){return e.isSymbolTile=this._onlySymbols,this._source.loadTile(e,r)}_unloadTile(e){if(this._source.unloadTile)return this._source.unloadTile(e,()=>{})}_abortTile(e){if(this._source.abortTile)return this._source.abortTile(e,()=>{})}serialize(){return this._source.serialize()}prepare(e){if(this._source.prepare&&this._source.prepare(),this._state.coalesceChanges(this._tiles,this.map?this.map.painter:null),this._source.prepareTile)for(let r in this._tiles){let n=this._tiles[r];this._source.prepareTile(n)&&this.map.painter.terrain&&this.map.painter.terrain._clearRenderCacheForTile(this.id,n.tileID),n.upload(e),n.prepare(this.map.style.imageManager)}else for(let r in this._tiles){let n=this._tiles[r];n.upload(e),n.prepare(this.map.style.imageManager)}}getIds(){return li(this._tiles).map(e=>e.tileID).sort(Xg).map(e=>e.key)}getRenderableIds(e){let r=[];for(let n in this._tiles)this._isIdRenderable(+n,e)&&r.push(this._tiles[n]);return e?r.sort((n,a)=>{let h=n.tileID,d=a.tileID,m=new Y(h.canonical.x,h.canonical.y)._rotate(this.transform.angle),y=new Y(d.canonical.x,d.canonical.y)._rotate(this.transform.angle);return h.overscaledZ-d.overscaledZ||y.y-m.y||y.x-m.x}).map(n=>n.tileID.key):r.map(n=>n.tileID).sort(Xg).map(n=>n.key)}hasRenderableParent(e){let r=this.findLoadedParent(e,0);return!!r&&this._isIdRenderable(r.tileID.key)}_isIdRenderable(e,r){return this._tiles[e]&&this._tiles[e].hasData()&&!this._coveredTiles[e]&&(r||!this._tiles[e].holdingForFade())}reload(){if(this._paused)this._shouldReloadOnResume=!0;else{this._cache.reset();for(let e in this._tiles)this._tiles[e].state!=="errored"&&this._reloadTile(+e,"reloading")}}_reloadTile(e,r){let n=this._tiles[e];n&&(n.state!=="loading"&&(n.state=r),this._loadTile(n,this._tileLoaded.bind(this,n,e,r)))}_tileLoaded(e,r,n,a){if(a)if(e.state="errored",a.status!==404)this._source.fire(new Yt(a,{tile:e}));else if(this._source.type==="raster-dem"&&this.usedForTerrain&&this.map.painter.terrain){let h=this.map.painter.terrain;this.update(this.transform,h.getScaledDemTileSize(),!0),h.resetTileLookupCache(this.id)}else this.update(this.transform);else e.timeAdded=ur.now(),n==="expired"&&(e.refreshedUponExpiration=!0),this._setTileReloadTimer(r,e),this._source.type==="raster-dem"&&e.dem&&this._backfillDEM(e),this._state.initializeTileState(e,this.map?this.map.painter:null),this._source.fire(new Rt("data",{dataType:"source",tile:e,coord:e.tileID,sourceCacheId:this.id}))}_backfillDEM(e){let r=this.getRenderableIds();for(let a=0;a<r.length;a++){let h=r[a];if(e.neighboringTiles&&e.neighboringTiles[h]){let d=this.getTileByID(h);n(e,d),n(d,e)}}function n(a,h){if(!a.dem||a.dem.borderReady)return;a.needsHillshadePrepare=!0,a.needsDEMTextureUpload=!0;let d=h.tileID.canonical.x-a.tileID.canonical.x,m=h.tileID.canonical.y-a.tileID.canonical.y,y=Math.pow(2,a.tileID.canonical.z),x=h.tileID.key;d===0&&m===0||Math.abs(m)>1||(Math.abs(d)>1&&(Math.abs(d+y)===1?d+=y:Math.abs(d-y)===1&&(d-=y)),h.dem&&a.dem&&(a.dem.backfillBorder(h.dem,d,m),a.neighboringTiles&&a.neighboringTiles[x]&&(a.neighboringTiles[x].backfilled=!0)))}}getTile(e){return this.getTileByID(e.key)}getTileByID(e){return this._tiles[e]}_retainLoadedChildren(e,r,n,a){for(let h in this._tiles){let d=this._tiles[h];if(a[h]||!d.hasData()||d.tileID.overscaledZ<=r||d.tileID.overscaledZ>n)continue;let m=d.tileID;for(;d&&d.tileID.overscaledZ>r+1;){let x=d.tileID.scaledTo(d.tileID.overscaledZ-1);d=this._tiles[x.key],d&&d.hasData()&&(m=x)}let y=m;for(;y.overscaledZ>r;)if(y=y.scaledTo(y.overscaledZ-1),e[y.key]){a[m.key]=m;break}}}findLoadedParent(e,r){if(e.key in this._loadedParentTiles){let n=this._loadedParentTiles[e.key];return n&&n.tileID.overscaledZ>=r?n:null}for(let n=e.overscaledZ-1;n>=r;n--){let a=e.scaledTo(n),h=this._getLoadedTile(a);if(h)return h}}_getLoadedTile(e){let r=this._tiles[e.key];return r&&r.hasData()?r:this._cache.getByKey(this._source.reparseOverscaled?e.wrapped().key:e.canonical.key)}updateCacheSize(e,r){r=r||this._source.tileSize;let n=Math.ceil(e.width/r)+1,a=Math.ceil(e.height/r)+1,h=Math.floor(n*a*5),d=typeof this._minTileCacheSize=="number"?Math.max(this._minTileCacheSize,h):h,m=typeof this._maxTileCacheSize=="number"?Math.min(this._maxTileCacheSize,d):d;this._cache.setMaxSize(m)}handleWrapJump(e){let r=Math.round((e-(this._prevLng===void 0?e:this._prevLng))/360);if(this._prevLng=e,r){let n={};for(let a in this._tiles){let h=this._tiles[a];h.tileID=h.tileID.unwrapTo(h.tileID.wrap+r),n[h.tileID.key]=h}this._tiles=n;for(let a in this._timers)clearTimeout(this._timers[a]),delete this._timers[a];for(let a in this._tiles)this._setTileReloadTimer(+a,this._tiles[a])}}update(e,r,n){if(this.transform=e,!this._sourceLoaded||this._paused||this.transform.freezeTileCoverage||this.usedForTerrain&&!n)return;let a;this.updateCacheSize(e,r),this.transform.projection.name!=="globe"&&this.handleWrapJump(this.transform.center.lng),this._coveredTiles={},this.used||this.usedForTerrain?this._source.tileID?a=e.getVisibleUnwrappedCoordinates(this._source.tileID).map(m=>new Hi(m.canonical.z,m.wrap,m.canonical.z,m.canonical.x,m.canonical.y)):(a=e.coveringTiles({tileSize:r||this._source.tileSize,minzoom:this._source.minzoom,maxzoom:this._source.maxzoom,roundZoom:this._source.roundZoom&&!n,reparseOverscaled:this._source.reparseOverscaled,isTerrainDEM:this.usedForTerrain}),this._source.hasTile&&(a=a.filter(m=>this._source.hasTile(m)))):a=[];let h=this._updateRetainedTiles(a);if(Kg(this._source.type)&&a.length!==0){let m={},y={},x=Object.keys(h);for(let k of x){let S=h[k],M=this._tiles[k];if(!M||M.fadeEndTime&&M.fadeEndTime<=ur.now())continue;let P=this.findLoadedParent(S,Math.max(S.overscaledZ-Ds.maxOverzooming,this._source.minzoom));P&&(this._addTile(P.tileID),m[P.tileID.key]=P.tileID),y[k]=S}let E=a[a.length-1].overscaledZ;for(let k in this._tiles){let S=this._tiles[k];if(h[k]||!S.hasData())continue;let M=S.tileID;for(;M.overscaledZ>E;){M=M.scaledTo(M.overscaledZ-1);let P=this._tiles[M.key];if(P&&P.hasData()&&y[M.key]){h[k]=S.tileID;break}}}for(let k in m)h[k]||(this._coveredTiles[k]=!0,h[k]=m[k])}for(let m in h)this._tiles[m].clearFadeHold();let d=function(m,y){let x=[];for(let E in m)E in y||x.push(E);return x}(this._tiles,h);for(let m of d){let y=this._tiles[m];y.hasSymbolBuckets&&!y.holdingForFade()?y.setHoldDuration(this.map._fadeDuration):y.hasSymbolBuckets&&!y.symbolFadeFinished()||this._removeTile(+m)}this._updateLoadedParentTileCache(),this._onlySymbols&&this._source.afterUpdate&&this._source.afterUpdate()}releaseSymbolFadeTiles(){for(let e in this._tiles)this._tiles[e].holdingForFade()&&this._removeTile(+e)}_updateRetainedTiles(e){let r={};if(e.length===0)return r;let n={},a=e.reduce((x,E)=>Math.min(x,E.overscaledZ),1/0),h=e[0].overscaledZ,d=Math.max(h-Ds.maxOverzooming,this._source.minzoom),m=Math.max(h+Ds.maxUnderzooming,this._source.minzoom),y={};for(let x of e){let E=this._addTile(x);r[x.key]=x,E.hasData()||a<this._source.maxzoom&&(y[x.key]=x)}this._retainLoadedChildren(y,a,m,r);for(let x of e){let E=this._tiles[x.key];if(E.hasData())continue;if(x.canonical.z>=this._source.maxzoom){let S=x.children(this._source.maxzoom)[0],M=this.getTile(S);if(M&&M.hasData()){r[S.key]=S;continue}}else{let S=x.children(this._source.maxzoom);if(r[S[0].key]&&r[S[1].key]&&r[S[2].key]&&r[S[3].key])continue}let k=E.wasRequested();for(let S=x.overscaledZ-1;S>=d;--S){let M=x.scaledTo(S);if(n[M.key]||(n[M.key]=!0,E=this.getTile(M),!E&&k&&(E=this._addTile(M)),E&&(r[M.key]=M,k=E.wasRequested(),E.hasData())))break}}return r}_updateLoadedParentTileCache(){this._loadedParentTiles={};for(let e in this._tiles){let r=[],n,a=this._tiles[e].tileID;for(;a.overscaledZ>0;){if(a.key in this._loadedParentTiles){n=this._loadedParentTiles[a.key];break}r.push(a.key);let h=a.scaledTo(a.overscaledZ-1);if(n=this._getLoadedTile(h),n)break;a=h}for(let h of r)this._loadedParentTiles[h]=n}}_addTile(e){let r=this._tiles[e.key];if(r)return this._source.prepareTile&&this._source.prepareTile(r),r;r=this._cache.getAndRemove(e),r&&(this._setTileReloadTimer(e.key,r),r.tileID=e,this._state.initializeTileState(r,this.map?this.map.painter:null),this._cacheTimers[e.key]&&(clearTimeout(this._cacheTimers[e.key]),delete this._cacheTimers[e.key],this._setTileReloadTimer(e.key,r)));let n=Boolean(r);if(!n){let a=this.map?this.map.painter:null;r=new dd(e,this._source.tileSize*e.overscaleFactor(),this.transform.tileZoom,a,this._isRaster),this._source.prepareTile&&this._source.prepareTile(r)||this._loadTile(r,this._tileLoaded.bind(this,r,e.key,r.state))}return r?(r.uses++,this._tiles[e.key]=r,n||this._source.fire(new Rt("dataloading",{tile:r,coord:r.tileID,dataType:"source"})),r):null}_setTileReloadTimer(e,r){e in this._timers&&(clearTimeout(this._timers[e]),delete this._timers[e]);let n=r.getExpiryTimeout();n&&(this._timers[e]=setTimeout(()=>{this._reloadTile(e,"expired"),delete this._timers[e]},n))}_removeTile(e){let r=this._tiles[e];r&&(r.uses--,delete this._tiles[e],this._timers[e]&&(clearTimeout(this._timers[e]),delete this._timers[e]),r.uses>0||(r.hasData()&&r.state!=="reloading"?this._cache.add(r.tileID,r,r.getExpiryTimeout()):(r.aborted=!0,this._abortTile(r),this._unloadTile(r))))}clearTiles(){this._shouldReloadOnResume=!1,this._paused=!1;for(let e in this._tiles)this._removeTile(+e);this._source._clear&&this._source._clear(),this._cache.reset(),this.map&&this.usedForTerrain&&this.map.painter.terrain&&this.map.painter.terrain.resetTileLookupCache(this.id)}tilesIn(e,r,n){let a=[],h=this.transform;if(!h)return a;let d=h.projection.name==="globe",m=Ts(h.center.lng);for(let y in this._tiles){let x=this._tiles[y];if(n&&x.clearQueryDebugViz(),x.holdingForFade())continue;let E;if(d){let k=x.tileID.canonical;if(k.z===0){let S=[Math.abs(Je(m,...xc(k,-1))-m),Math.abs(Je(m,...xc(k,1))-m)];E=[0,2*S.indexOf(Math.min(...S))-1]}else{let S=[Math.abs(Je(m,...xc(k,-1))-m),Math.abs(Je(m,...xc(k,0))-m),Math.abs(Je(m,...xc(k,1))-m)];E=[S.indexOf(Math.min(...S))-1]}}else E=[0];for(let k of E){let S=e.containsTile(x,h,r,k);S&&a.push(S)}}return a}getVisibleCoordinates(e){let r=this.getRenderableIds(e).map(n=>this._tiles[n].tileID);for(let n of r)n.projMatrix=this.transform.calculateProjMatrix(n.toUnwrapped());return r}hasTransition(){if(this._source.hasTransition())return!0;if(Kg(this._source.type))for(let e in this._tiles){let r=this._tiles[e];if(r.fadeEndTime!==void 0&&r.fadeEndTime>=ur.now())return!0}return!1}setFeatureState(e,r,n){this._state.updateState(e=e||"_geojsonTileLayer",r,n)}removeFeatureState(e,r,n){this._state.removeFeatureState(e=e||"_geojsonTileLayer",r,n)}getFeatureState(e,r){return this._state.getState(e=e||"_geojsonTileLayer",r)}setDependencies(e,r,n){let a=this._tiles[e];a&&a.setDependencies(r,n)}reloadTilesForDependencies(e,r){for(let n in this._tiles)this._tiles[n].hasDependency(e,r)&&this._reloadTile(+n,"reloading");this._cache.filter(n=>!n.hasDependency(e,r))}_preloadTiles(e,r){let n=new Map,a=Array.isArray(e)?e:[e],h=this.map.painter.terrain,d=this.usedForTerrain&&h?h.getScaledDemTileSize():this._source.tileSize;for(let m of a){let y=m.coveringTiles({tileSize:d,minzoom:this._source.minzoom,maxzoom:this._source.maxzoom,roundZoom:this._source.roundZoom&&!this.usedForTerrain,reparseOverscaled:this._source.reparseOverscaled,isTerrainDEM:this.usedForTerrain});for(let x of y)n.set(x.key,x);this.usedForTerrain&&m.updateElevation(!1)}Ht(Array.from(n.values()),(m,y)=>{let x=new dd(m,this._source.tileSize*m.overscaleFactor(),this.transform.tileZoom,this.map.painter,this._isRaster);this._loadTile(x,E=>{this._source.type==="raster-dem"&&x.dem&&this._backfillDEM(x),y(E,x)})},r)}}function Xg(i,e){let r=Math.abs(2*i.wrap)-+(i.wrap<0),n=Math.abs(2*e.wrap)-+(e.wrap<0);return i.overscaledZ-e.overscaledZ||n-r||e.canonical.y-i.canonical.y||e.canonical.x-i.canonical.x}function Kg(i){return i==="raster"||i==="image"||i==="video"}function xc(i,e){let r=1<<i.z;return[i.x/r+e,(i.x+1)/r+e]}Ds.maxOverzooming=10,Ds.maxUnderzooming=3;class bu{constructor(e,r,n){this._demTile=e,this._dem=this._demTile.dem,this._scale=r,this._offset=n}static create(e,r,n){let a=n||e.findDEMTileFor(r);if(!a||!a.dem)return;let h=a.dem,d=a.tileID,m=1<<r.canonical.z-d.canonical.z;return new bu(a,a.tileSize/lt/m,[(r.canonical.x/m-d.canonical.x)*h.dim,(r.canonical.y/m-d.canonical.y)*h.dim])}tileCoordToPixel(e,r){let n=r*this._scale+this._offset[1],a=Math.floor(e*this._scale+this._offset[0]),h=Math.floor(n);return new Y(a,h)}getElevationAt(e,r,n,a){let h=e*this._scale+this._offset[0],d=r*this._scale+this._offset[1],m=Math.floor(h),y=Math.floor(d),x=this._dem;return a=!!a,n?Pt(Pt(x.get(m,y,a),x.get(m,y+1,a),d-y),Pt(x.get(m+1,y,a),x.get(m+1,y+1,a),d-y),h-m):x.get(m,y,a)}getElevationAtPixel(e,r,n){return this._dem.get(e,r,!!n)}getMeterToDEM(e){return(1<<this._demTile.tileID.canonical.z)*Vr(1,e)*this._dem.stride}}class Yg{constructor(e,r){this.tileID=e,this.x=e.canonical.x,this.y=e.canonical.y,this.z=e.canonical.z,this.grid=new Eo(lt,16,0),this.featureIndexArray=new Wf,this.promoteId=r}insert(e,r,n,a,h,d=0){let m=this.featureIndexArray.length;this.featureIndexArray.emplaceBack(n,a,h,d);let y=this.grid;for(let x=0;x<r.length;x++){let E=r[x],k=[1/0,1/0,-1/0,-1/0];for(let S=0;S<E.length;S++){let M=E[S];k[0]=Math.min(k[0],M.x),k[1]=Math.min(k[1],M.y),k[2]=Math.max(k[2],M.x),k[3]=Math.max(k[3],M.y)}k[0]<lt&&k[1]<lt&&k[2]>=0&&k[3]>=0&&y.insert(m,k[0],k[1],k[2],k[3])}}loadVTLayers(){if(!this.vtLayers){this.vtLayers=new Is.VectorTile(new cc(this.rawTileData)).layers,this.sourceLayerCoder=new Rg(this.vtLayers?Object.keys(this.vtLayers).sort():["_geojsonTileLayer"]),this.vtFeatures={};for(let e in this.vtLayers)this.vtFeatures[e]=[]}return this.vtLayers}query(e,r,n,a){this.loadVTLayers();let h=e.params||{},d=Vn(h.filter),m=e.tileResult,y=e.transform,x=m.bufferedTilespaceBounds,E=this.grid.query(x.min.x,x.min.y,x.max.x,x.max.y,(P,F,G,X)=>um(m.bufferedTilespaceGeometry,P,F,G,X));E.sort(sx);let k=null;y.elevation&&E.length>0&&(k=bu.create(y.elevation,this.tileID));let S={},M;for(let P=0;P<E.length;P++){let F=E[P];if(F===M)continue;M=F;let G=this.featureIndexArray.get(F),X=null;this.loadMatchingFeature(S,G,d,h.layers,h.availableImages,r,n,a,(ne,re,se,ce=0)=>(X||(X=Zn(ne,this.tileID.canonical,e.tileTransform)),re.queryIntersectsFeature(m,ne,se,X,this.z,e.transform,e.pixelPosMatrix,k,ce)))}return S}loadMatchingFeature(e,r,n,a,h,d,m,y,x){let{featureIndex:E,bucketIndex:k,sourceLayerIndex:S,layoutVertexArrayOffset:M}=r,P=this.bucketLayerIDs[k];if(a&&!function(ne,re){for(let se=0;se<ne.length;se++)if(re.indexOf(ne[se])>=0)return!0;return!1}(a,P))return;let F=this.sourceLayerCoder.decode(S),G=this.vtLayers[F].feature(E);if(n.needGeometry){let ne=ks(G,!0);if(!n.filter(new $(this.tileID.overscaledZ),ne,this.tileID.canonical))return}else if(!n.filter(new $(this.tileID.overscaledZ),G))return;let X=this.getId(G,F);for(let ne=0;ne<P.length;ne++){let re=P[ne];if(a&&a.indexOf(re)<0)continue;let se=d[re];if(!se)continue;let ce={};X!==void 0&&y&&(ce=y.getState(se.sourceLayer||"_geojsonTileLayer",X));let ue=Bt({},m[re]);ue.paint=Jg(ue.paint,se.paint,G,ce,h),ue.layout=Jg(ue.layout,se.layout,G,ce,h);let ve=!x||x(G,se,ce,M);if(!ve)continue;let we=new Fg(G,this.z,this.x,this.y,X);we.layer=ue;let Se=e[re];Se===void 0&&(Se=e[re]=[]),Se.push({featureIndex:E,feature:we,intersectionZ:ve})}}lookupSymbolFeatures(e,r,n,a,h,d,m,y){let x={};this.loadVTLayers();let E=Vn(h);for(let k of e)this.loadMatchingFeature(x,{bucketIndex:n,sourceLayerIndex:a,featureIndex:k,layoutVertexArrayOffset:0},E,d,m,y,r);return x}loadFeature(e){let{featureIndex:r,sourceLayerIndex:n}=e;this.loadVTLayers();let a=this.sourceLayerCoder.decode(n),h=this.vtFeatures[a];if(h[r])return h[r];let d=this.vtLayers[a].feature(r);return h[r]=d,d}hasLayer(e){for(let r of this.bucketLayerIDs)for(let n of r)if(e===n)return!0;return!1}getId(e,r){let n=e.id;return this.promoteId&&(n=e.properties[typeof this.promoteId=="string"?this.promoteId:this.promoteId[r]],typeof n=="boolean"&&(n=Number(n))),n}}function Jg(i,e,r,n,a){return Ri(i,(h,d)=>{let m=e instanceof xe?e.get(d):null;return m&&m.evaluate?m.evaluate(r,n,a):m})}function sx(i,e){return e-i}He(Yg,"FeatureIndex",{omit:["rawTileData","sourceLayerCoder"]});class Qg{constructor(e){let r={},n=[];for(let m in e){let y=e[m],x=r[m]={};for(let E in y.glyphs){let k=y.glyphs[+E];if(!k||k.bitmap.width===0||k.bitmap.height===0)continue;let S=k.metrics.localGlyph?2:1,M={x:0,y:0,w:k.bitmap.width+2*S,h:k.bitmap.height+2*S};n.push(M),x[E]=M}}let{w:a,h}=Xp(n),d=new Wn({width:a||1,height:h||1});for(let m in e){let y=e[m];for(let x in y.glyphs){let E=y.glyphs[+x];if(!E||E.bitmap.width===0||E.bitmap.height===0)continue;let k=r[m][x],S=E.metrics.localGlyph?2:1;Wn.copy(E.bitmap,d,{x:0,y:0},{x:k.x+S,y:k.y+S},E.bitmap)}}this.image=d,this.positions=r}}He(Qg,"GlyphAtlas");class ax{constructor(e){this.tileID=new Hi(e.tileID.overscaledZ,e.tileID.wrap,e.tileID.canonical.z,e.tileID.canonical.x,e.tileID.canonical.y),this.tileZoom=e.tileZoom,this.uid=e.uid,this.zoom=e.zoom,this.canonical=e.tileID.canonical,this.pixelRatio=e.pixelRatio,this.tileSize=e.tileSize,this.source=e.source,this.overscaling=this.tileID.overscaleFactor(),this.showCollisionBoxes=e.showCollisionBoxes,this.collectResourceTiming=!!e.collectResourceTiming,this.returnDependencies=!!e.returnDependencies,this.promoteId=e.promoteId,this.enableTerrain=!!e.enableTerrain,this.isSymbolTile=e.isSymbolTile,this.tileTransform=Ps(e.tileID.canonical,e.projection),this.projection=e.projection}parse(e,r,n,a,h){this.status="parsing",this.data=e,this.collisionBoxArray=new wp;let d=new Rg(Object.keys(e.layers).sort()),m=new Yg(this.tileID,this.promoteId);m.bucketLayerIDs=[];let y={},x=new pd(256,256),E={featureIndex:m,iconDependencies:{},patternDependencies:{},glyphDependencies:{},lineAtlas:x,availableImages:n},k=r.familiesBySource[this.source];for(let ce in k){let ue=e.layers[ce];if(!ue)continue;let ve=!1,we=!1;for(let ge of k[ce])ge[0].type==="symbol"?ve=!0:we=!0;if(this.isSymbolTile===!0&&!ve||this.isSymbolTile===!1&&!we)continue;ue.version===1&&ci(`Vector tile source "${this.source}" layer "${ce}" does not use vector tile spec v2 and therefore may have some rendering errors.`);let Se=d.encode(ce),Le=[];for(let ge=0;ge<ue.length;ge++){let ke=ue.feature(ge),Be=m.getId(ke,ce);Le.push({feature:ke,id:Be,index:ge,sourceLayerIndex:Se})}for(let ge of k[ce]){let ke=ge[0];this.isSymbolTile!==void 0&&ke.type==="symbol"!==this.isSymbolTile||ke.minzoom&&this.zoom<Math.floor(ke.minzoom)||ke.maxzoom&&this.zoom>=ke.maxzoom||ke.visibility!=="none"&&(yd(ge,this.zoom,n),(y[ke.id]=ke.createBucket({index:m.bucketLayerIDs.length,layers:ge,zoom:this.zoom,canonical:this.canonical,pixelRatio:this.pixelRatio,overscaling:this.overscaling,collisionBoxArray:this.collisionBoxArray,sourceLayerIndex:Se,sourceID:this.source,enableTerrain:this.enableTerrain,projection:this.projection.spec,availableImages:n})).populate(Le,E,this.tileID.canonical,this.tileTransform),m.bucketLayerIDs.push(ge.map(Be=>Be.id)))}}let S,M,P,F;x.trim();let G={type:"maybePrepare",isSymbolTile:this.isSymbolTile,zoom:this.zoom},X=Ri(E.glyphDependencies,ce=>Object.keys(ce).map(Number));Object.keys(X).length?a.send("getGlyphs",{uid:this.uid,stacks:X},(ce,ue)=>{S||(S=ce,M=ue,se.call(this))},void 0,!1,G):M={};let ne=Object.keys(E.iconDependencies);ne.length?a.send("getImages",{icons:ne,source:this.source,tileID:this.tileID,type:"icons"},(ce,ue)=>{S||(S=ce,P=ue,se.call(this))},void 0,!1,G):P={};let re=Object.keys(E.patternDependencies);function se(){if(S)return h(S);if(M&&P&&F){let ce=new Qg(M),ue=new eg(P,F);for(let ve in y){let we=y[ve];we instanceof Lo?(yd(we.layers,this.zoom,n),M1(we,M,ce.positions,P,ue.iconPositions,this.showCollisionBoxes,n,this.tileID.canonical,this.tileZoom,this.projection)):we.hasPattern&&(we instanceof nu||we instanceof eu||we instanceof oc)&&(yd(we.layers,this.zoom,n),we.addFeatures(E,this.tileID.canonical,ue.patternPositions,n,this.tileTransform))}this.status="done",h(null,{buckets:li(y).filter(ve=>!ve.isEmpty()),featureIndex:m,collisionBoxArray:this.collisionBoxArray,glyphAtlasImage:ce.image,lineAtlas:x,imageAtlas:ue,glyphMap:this.returnDependencies?M:null,iconMap:this.returnDependencies?P:null,glyphPositions:this.returnDependencies?ce.positions:null})}}re.length?a.send("getImages",{icons:re,source:this.source,tileID:this.tileID,type:"patterns"},(ce,ue)=>{S||(S=ce,F=ue,se.call(this))},void 0,!1,G):F={},se.call(this)}}function yd(i,e,r){let n=new $(e);for(let a of i)a.recalculate(n,r)}class e_{constructor(e){this.entries={},this.scheduler=e}request(e,r,n,a){let h=this.entries[e]=this.entries[e]||{callbacks:[]};if(h.result){let[d,m]=h.result;return this.scheduler?this.scheduler.add(()=>{a(d,m)},r):a(d,m),()=>{}}return h.callbacks.push(a),h.cancel||(h.cancel=n((d,m)=>{h.result=[d,m];for(let y of h.callbacks)this.scheduler?this.scheduler.add(()=>{y(d,m)},r):y(d,m);setTimeout(()=>delete this.entries[e],3e3)})),()=>{h.result||(h.callbacks=h.callbacks.filter(d=>d!==a),h.callbacks.length||(h.cancel(),delete this.entries[e]))}}}function t_(i,e,r){let n=JSON.stringify(i.request);return i.data&&(this.deduped.entries[n]={result:[null,i.data]}),this.deduped.request(n,{type:"parseTile",isSymbolTile:i.isSymbolTile,zoom:i.tileZoom},a=>{let h=he(i.request,(d,m,y,x)=>{d?a(d):m&&a(null,{vectorTile:r?void 0:new Is.VectorTile(new cc(m)),rawData:m,cacheControl:y,expires:x})});return()=>{h.cancel(),a()}},e)}o.ARRAY_TYPE=yr,o.AUTH_ERR_MSG=er,o.Aabb=Ir,o.Actor=class{constructor(i,e,r){this.target=i,this.parent=e,this.mapId=r,this.callbacks={},this.cancelCallbacks={},vi(["receive"],this),this.target.addEventListener("message",this.receive,!1),this.globalScope=Qi()?i:z,this.scheduler=new ix}send(i,e,r,n,a=!1,h){let d=Math.round(1e18*Math.random()).toString(36).substring(0,10);r&&(r.metadata=h,this.callbacks[d]=r);let m=io(this.globalScope)?void 0:[];return this.target.postMessage({id:d,type:i,hasCallback:!!r,targetMapId:n,mustQueue:a,sourceMapId:this.mapId,data:ys(e,m)},m),{cancel:()=>{r&&delete this.callbacks[d],this.target.postMessage({id:d,type:"<cancel>",targetMapId:n,sourceMapId:this.mapId})}}}receive(i){let e=i.data,r=e.id;if(r&&(!e.targetMapId||this.mapId===e.targetMapId))if(e.type==="<cancel>"){let n=this.cancelCallbacks[r];delete this.cancelCallbacks[r],n&&n.cancel()}else if(e.mustQueue||Qi()){let n=this.callbacks[r];this.cancelCallbacks[r]=this.scheduler.add(()=>this.processTask(r,e),n&&n.metadata||{type:"message"})}else this.processTask(r,e)}processTask(i,e){if(e.type==="<response>"){let r=this.callbacks[i];delete this.callbacks[i],r&&(e.error?r(xs(e.error)):r(null,xs(e.data)))}else{let r=io(this.globalScope)?void 0:[],n=e.hasCallback?(h,d)=>{delete this.cancelCallbacks[i],this.target.postMessage({id:i,type:"<response>",sourceMapId:this.mapId,error:h?ys(h):null,data:ys(d,r)},r)}:h=>{},a=xs(e.data);if(this.parent[e.type])this.parent[e.type](e.sourceMapId,a,n);else if(this.parent.getWorkerSource){let h=e.type.split(".");this.parent.getWorkerSource(e.sourceMapId,h[0],a.source)[h[1]](a,n)}else n(new Error(`Could not find function ${e.type}`))}}remove(){this.scheduler.remove(),this.target.removeEventListener("message",this.receive,!1)}},o.CanonicalTileID=iu,o.Color=hi,o.ColorMode=Cn,o.CullFaceMode=un,o.DEMData=vu,o.DataConstantProperty=_e,o.DedupedRequest=e_,o.DepthMode=tl,o.EXTENT=lt,o.Elevation=class{isDataAvailableAtPoint(i){let e=this._source();if(!e||i.y<0||i.y>1)return!1;let r=e.getSource().maxzoom,n=1<<r,a=Math.floor(i.x),h=Math.floor((i.x-a)*n),d=Math.floor(i.y*n),m=this.findDEMTileFor(new Hi(r,a,r,h,d));return!(!m||!m.dem)}getAtPointOrZero(i,e=0){return this.getAtPoint(i,e)||0}getAtPoint(i,e,r=!0){e==null&&(e=null);let n=this._source();if(!n||i.y<0||i.y>1)return e;let a=n.getSource().maxzoom,h=1<<a,d=Math.floor(i.x),m=i.x-d,y=new Hi(a,d,a,Math.floor(m*h),Math.floor(i.y*h)),x=this.findDEMTileFor(y);if(!x||!x.dem)return e;let E=x.dem,k=1<<x.tileID.canonical.z,S=(m*k-x.tileID.canonical.x)*E.dim,M=(i.y*k-x.tileID.canonical.y)*E.dim,P=Math.floor(S),F=Math.floor(M);return(r?this.exaggeration():1)*Pt(Pt(E.get(P,F),E.get(P,F+1),M-F),Pt(E.get(P+1,F),E.get(P+1,F+1),M-F),S-P)}getAtTileOffset(i,e,r){let n=1<<i.canonical.z;return this.getAtPointOrZero(new Na(i.wrap+(i.canonical.x+e/lt)/n,(i.canonical.y+r/lt)/n))}getAtTileOffsetFunc(i,e,r,n){return a=>{let h=this.getAtTileOffset(i,a.x,a.y),d=n.upVector(i.canonical,a.x,a.y);return vn(d,d,h*n.upVectorScale(i.canonical,e,r).metersToTile),d}}getForTilePoints(i,e,r,n){let a=bu.create(this,i,n);return!!a&&(e.forEach(h=>{h[2]=this.exaggeration()*a.getElevationAt(h[0],h[1],r)}),!0)}getMinMaxForTile(i){let e=this.findDEMTileFor(i);if(!e||!e.dem)return null;let r=e.dem.tree,n=e.tileID,a=1<<i.canonical.z-n.canonical.z,h=i.canonical.x/a-n.canonical.x,d=i.canonical.y/a-n.canonical.y,m=0;for(let y=0;y<i.canonical.z-n.canonical.z&&!r.leaves[m];y++){h*=2,d*=2;let x=2*Math.floor(d)+Math.floor(h);m=r.childOffsets[m]+x,h%=1,d%=1}return{min:this.exaggeration()*r.minimums[m],max:this.exaggeration()*r.maximums[m]}}getMinElevationBelowMSL(){throw new Error("Pure virtual method called.")}raycast(i,e,r){throw new Error("Pure virtual method called.")}pointCoordinate(i){throw new Error("Pure virtual method called.")}_source(){throw new Error("Pure virtual method called.")}exaggeration(){throw new Error("Pure virtual method called.")}findDEMTileFor(i){throw new Error("Pure virtual method called.")}get visibleDemTiles(){throw new Error("Getter must be implemented in subclass.")}},o.ErrorEvent=Yt,o.EvaluationParameters=$,o.Event=Rt,o.Evented=Vt,o.FillExtrusionBucket=oc,o.Frustum=Op,o.FrustumCorners=Fp,o.GLOBE_METERS_TO_ECEF=nd,o.GLOBE_RADIUS=zs,o.GLOBE_SCALE_MATCH_LATITUDE=45,o.GLOBE_ZOOM_THRESHOLD_MAX=6,o.GLOBE_ZOOM_THRESHOLD_MIN=5,o.GlobeSharedBuffers=class{constructor(i){this._createGrid(i),this._createPoles(i)}destroy(){this._poleIndexBuffer.destroy(),this._gridBuffer.destroy(),this._gridIndexBuffer.destroy(),this._poleNorthVertexBuffer.destroy(),this._poleSouthVertexBuffer.destroy();for(let i of this._poleSegments)i.destroy();for(let i of this._gridSegments)i.destroy();if(this._wireframeIndexBuffer){this._wireframeIndexBuffer.destroy();for(let i of this._wireframeSegments)i.destroy()}}_createGrid(i){let e=new rt,r=new Mt,n=65;for(let a=0;a<n;a++)for(let h=0;h<n;h++)e.emplaceBack(h,a);this._gridSegments=[];for(let a=0,h=0;a<Qa.length;a++){let d=Qa[a];for(let y=0;y<d;y++)for(let x=0;x<64;x++){let E=y*n+x;r.emplaceBack(E+1,E,E+n),r.emplaceBack(E+n,E+n+1,E+1)}let m=64*d*2;this._gridSegments.push(fi.simpleSegment(0,h,(d+1)*n,m)),h+=m}this._gridBuffer=i.createVertexBuffer(e,pc.members),this._gridIndexBuffer=i.createIndexBuffer(r,!0)}_createPoles(i){let e=new Mt;for(let a=0;a<=64;a++)e.emplaceBack(0,a+1,a+2);this._poleIndexBuffer=i.createIndexBuffer(e,!0);let r=new To,n=new To;this._poleSegments=[];for(let a=0,h=0;a<5;a++){let d=1<<a,m=512*d/Math.PI/2,y=360/d;r.emplaceBack(0,-m,0,0,0,.5,0),n.emplaceBack(0,-m,0,0,0,.5,1);for(let x=0;x<=64;x++){let E=x/64,k=Pt(0,y,E),[S,M,P]=Eg(R1,F1,k,m);r.emplaceBack(S,M,P,0,0,E,0),n.emplaceBack(S,M,P,0,0,E,1)}this._poleSegments.push(fi.simpleSegment(h,0,66,64)),h+=66}this._poleNorthVertexBuffer=i.createVertexBuffer(r,vg,!1),this._poleSouthVertexBuffer=i.createVertexBuffer(n,vg,!1)}getGridBuffers(i){return[this._gridBuffer,this._gridIndexBuffer,this._gridSegments[i]]}getPoleBuffers(i){return[this._poleNorthVertexBuffer,this._poleSouthVertexBuffer,this._poleIndexBuffer,this._poleSegments[i]]}getWirefameBuffers(i,e){if(!this._wireframeSegments){let r=new yi,n=64,a=n+1;this._wireframeSegments=[];for(let h=0,d=0;h<Qa.length;h++){let m=Qa[h];for(let x=0;x<m;x++)for(let E=0;E<n;E++){let k=x*a+E;r.emplaceBack(k,k+1),r.emplaceBack(k,k+a),r.emplaceBack(k,k+a+1)}let y=m*n*3;this._wireframeSegments.push(fi.simpleSegment(0,d,(m+1)*a,y)),d+=y}this._wireframeIndexBuffer=i.createIndexBuffer(r)}return[this._gridBuffer,this._wireframeIndexBuffer,this._wireframeSegments[e]]}},o.GlyphManager=Ya,o.ImagePosition=Kp,o.LineAtlas=pd,o.LngLat=$t,o.LngLatBounds=Ao,o.LocalGlyphMode=ed,o.MAX_MERCATOR_LATITUDE=yn,o.MercatorCoordinate=Na,o.ONE_EM=Ui,o.OverscaledTileID=Hi,o.Properties=Te,o.RGBAImage=vr,o.Ray=Rp,o.RequestManager=class{constructor(i,e,r){this._transformRequestFn=i,this._customAccessToken=e,this._silenceAuthErrors=!!r,this._createSkuToken()}_createSkuToken(){let i=function(){let e="";for(let r=0;r<10;r++)e+="0123456789abcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWXYZ"[Math.floor(62*Math.random())];return{token:["1",Zo,e].join(""),tokenExpiresAt:Date.now()+432e5}}();this._skuToken=i.token,this._skuTokenExpiresAt=i.tokenExpiresAt}_isSkuTokenExpired(){return Date.now()>this._skuTokenExpiresAt}transformRequest(i,e){return this._transformRequestFn&&this._transformRequestFn(i,e)||{url:i}}normalizeStyleURL(i,e){if(!Rr(i))return i;let r=tr(i);return r.path=`/styles/v1${r.path}`,this._makeAPIURL(r,this._customAccessToken||e)}normalizeGlyphsURL(i,e){if(!Rr(i))return i;let r=tr(i);return r.path=`/fonts/v1${r.path}`,this._makeAPIURL(r,this._customAccessToken||e)}normalizeSourceURL(i,e,r,n){if(!Rr(i))return i;let a=tr(i);return a.path=`/v4/${a.authority}.json`,a.params.push("secure"),r&&a.params.push(`language=${r}`),n&&a.params.push(`worldview=${n}`),this._makeAPIURL(a,this._customAccessToken||e)}normalizeSpriteURL(i,e,r,n){let a=tr(i);return Rr(i)?(a.path=`/styles/v1${a.path}/sprite${e}${r}`,this._makeAPIURL(a,this._customAccessToken||n)):(a.path+=`${e}${r}`,en(a))}normalizeTileURL(i,e,r){if(this._isSkuTokenExpired()&&this._createSkuToken(),i&&!Rr(i))return i;let n=tr(i);n.path=n.path.replace(/(\.(png|jpg)\d*)(?=$)/,`${e||r&&n.authority!=="raster"&&r===512?"@2x":""}${dn.supported?".webp":"$1"}`),n.authority==="raster"?n.path=`/${At.RASTER_URL_PREFIX}${n.path}`:(n.path=n.path.replace(/^.+\/v4\//,"/"),n.path=`/${At.TILE_URL_VERSION}${n.path}`);let a=this._customAccessToken||function(h){for(let d of h){let m=d.match(/^access_token=(.*)$/);if(m)return m[1]}return null}(n.params)||At.ACCESS_TOKEN;return At.REQUIRE_ACCESS_TOKEN&&a&&this._skuToken&&n.params.push(`sku=${this._skuToken}`),this._makeAPIURL(n,a)}canonicalizeTileURL(i,e){let r=tr(i);if(!r.path.match(/^(\/v4\/|\/raster\/v1\/)/)||!r.path.match(/\.[\w]+$/))return i;let n="mapbox://";r.path.match(/^\/raster\/v1\//)?n+=`raster/${r.path.replace(`/${At.RASTER_URL_PREFIX}/`,"")}`:n+=`tiles/${r.path.replace(`/${At.TILE_URL_VERSION}/`,"")}`;let a=r.params;return e&&(a=a.filter(h=>!h.match(/^access_token=/))),a.length&&(n+=`?${a.join("&")}`),n}canonicalizeTileset(i,e){let r=!!e&&Rr(e),n=[];for(let a of i.tiles||[])Pn(a)?n.push(this.canonicalizeTileURL(a,r)):n.push(a);return n}_makeAPIURL(i,e){let r="See https://www.mapbox.com/api-documentation/#access-tokens-and-token-scopes",n=tr(At.API_URL);if(i.protocol=n.protocol,i.authority=n.authority,i.protocol==="http"){let a=i.params.indexOf("secure");a>=0&&i.params.splice(a,1)}if(n.path!=="/"&&(i.path=`${n.path}${i.path}`),!At.REQUIRE_ACCESS_TOKEN)return en(i);if(e=e||At.ACCESS_TOKEN,!this._silenceAuthErrors){if(!e)throw new Error(`An API access token is required to use Mapbox GL. ${r}`);if(e[0]==="s")throw new Error(`Use a public access token (pk.*) with Mapbox GL, not a secret access token (sk.*). ${r}`)}return i.params=i.params.filter(a=>a.indexOf("access_token")===-1),i.params.push(`access_token=${e||""}`),en(i)}},o.ResourceType=ee,o.SegmentVector=fi,o.SourceCache=Ds,o.StencilMode=md,o.StructArrayLayout1ui2=Ur,o.StructArrayLayout2f1f2i16=jt,o.StructArrayLayout2i4=rt,o.StructArrayLayout2ui4=yi,o.StructArrayLayout3f12=Pi,o.StructArrayLayout3ui6=Mt,o.StructArrayLayout4i8=et,o.StructArrayLayout5f20=Co,o.Texture=yc,o.Tile=dd,o.Transitionable=K,o.Uniform1f=Oh,o.Uniform1i=class extends $n{constructor(i,e){super(i,e),this.current=0}set(i){this.current!==i&&(this.current=i,this.gl.uniform1i(this.location,i))}},o.Uniform2f=class extends $n{constructor(i,e){super(i,e),this.current=[0,0]}set(i){i[0]===this.current[0]&&i[1]===this.current[1]||(this.current=i,this.gl.uniform2f(this.location,i[0],i[1]))}},o.Uniform3f=class extends $n{constructor(i,e){super(i,e),this.current=[0,0,0]}set(i){i[0]===this.current[0]&&i[1]===this.current[1]&&i[2]===this.current[2]||(this.current=i,this.gl.uniform3f(this.location,i[0],i[1],i[2]))}},o.Uniform4f=em,o.UniformColor=tm,o.UniformMatrix2f=class extends $n{constructor(i,e){super(i,e),this.current=qy}set(i){for(let e=0;e<4;e++)if(i[e]!==this.current[e]){this.current=i,this.gl.uniformMatrix2fv(this.location,!1,i);break}}},o.UniformMatrix3f=class extends $n{constructor(i,e){super(i,e),this.current=$y}set(i){for(let e=0;e<9;e++)if(i[e]!==this.current[e]){this.current=i,this.gl.uniformMatrix3fv(this.location,!1,i);break}}},o.UniformMatrix4f=class extends $n{constructor(i,e){super(i,e),this.current=Gy}set(i){if(i[12]!==this.current[12]||i[0]!==this.current[0])return this.current=i,void this.gl.uniformMatrix4fv(this.location,!1,i);for(let e=1;e<16;e++)if(i[e]!==this.current[e]){this.current=i,this.gl.uniformMatrix4fv(this.location,!1,i);break}}},o.UnwrappedTileID=Vm,o.ValidationError=We,o.VectorTileWorkerSource=class extends Vt{constructor(i,e,r,n,a){super(),this.actor=i,this.layerIndex=e,this.availableImages=r,this.loadVectorData=a||t_,this.loading={},this.loaded={},this.deduped=new e_(i.scheduler),this.isSpriteLoaded=n,this.scheduler=i.scheduler}loadTile(i,e){let r=i.uid,n=i&&i.request,a=n&&n.collectResourceTiming,h=this.loading[r]=new ax(i);h.abort=this.loadVectorData(i,(d,m)=>{let y=!this.loading[r];if(delete this.loading[r],y||d||!m)return h.status="done",y||(this.loaded[r]=h),e(d);let x=m.rawData,E={};m.expires&&(E.expires=m.expires),m.cacheControl&&(E.cacheControl=m.cacheControl),h.vectorTile=m.vectorTile||new Is.VectorTile(new cc(x));let k=()=>{h.parse(h.vectorTile,this.layerIndex,this.availableImages,this.actor,(S,M)=>{if(S||!M)return e(S);let P={};if(a){let F=An(n);F.length>0&&(P.resourceTiming=JSON.parse(JSON.stringify(F)))}e(null,Bt({rawTileData:x.slice(0)},M,E,P))})};this.isSpriteLoaded?k():this.once("isSpriteLoaded",()=>{this.scheduler?this.scheduler.add(k,{type:"parseTile",isSymbolTile:i.isSymbolTile,zoom:i.tileZoom}):k()}),this.loaded=this.loaded||{},this.loaded[r]=h})}reloadTile(i,e){let r=this.loaded,n=i.uid,a=this;if(r&&r[n]){let h=r[n];h.showCollisionBoxes=i.showCollisionBoxes,h.enableTerrain=!!i.enableTerrain,h.projection=i.projection,h.tileTransform=Ps(i.tileID.canonical,i.projection);let d=(m,y)=>{let x=h.reloadCallback;x&&(delete h.reloadCallback,h.parse(h.vectorTile,a.layerIndex,this.availableImages,a.actor,x)),e(m,y)};h.status==="parsing"?h.reloadCallback=d:h.status==="done"&&(h.vectorTile?h.parse(h.vectorTile,this.layerIndex,this.availableImages,this.actor,d):d())}}abortTile(i,e){let r=i.uid,n=this.loading[r];n&&(n.abort&&n.abort(),delete this.loading[r]),e()}removeTile(i,e){let r=this.loaded,n=i.uid;r&&r[n]&&delete r[n],e()}},o.WritingMode=zr,o.ZoomHistory=kh,o.add=Io,o.addDynamicAttributes=_u,o.adjoint=function(i,e){var r=e[0],n=e[1],a=e[2],h=e[3],d=e[4],m=e[5],y=e[6],x=e[7],E=e[8];return i[0]=d*E-m*x,i[1]=a*x-n*E,i[2]=n*m-a*d,i[3]=m*y-h*E,i[4]=r*E-a*y,i[5]=a*h-r*m,i[6]=h*x-d*y,i[7]=n*y-r*x,i[8]=r*d-n*h,i},o.asyncAll=Ht,o.bezier=ut,o.bindAll=vi,o.boundsAttributes=jg,o.bufferConvexPolygon=function(i,e){let r=[];for(let n=0;n<i.length;n++){let a=It(n-1,-1,i.length-1),h=It(n+1,-1,i.length-1),d=i[n],m=i[h],y=i[a].sub(d).unit(),x=m.sub(d).unit(),E=x.angleWithSep(y.x,y.y),k=y.add(x).unit().mult(-1*e/Math.sin(E/2));r.push(d.add(k))}return r},o.cacheEntryPossiblyAdded=function(i){Z++,Z>Qs&&(i.getActor().send("enforceCacheSizeLimit",oo),Z=0)},o.calculateGlobeLabelMatrix=function(i,e){let{x:r,y:n}=i.point,a=kg(r,n,i.worldSize/i._projectionScaler,0,0);return Mo(a,a,Cg(wn(e)))},o.calculateGlobeMatrix=function(i){let{x:e,y:r}=i.point,{lng:n,lat:a}=i._center;return kg(e,r,i.worldSize,n,a)},o.calculateGlobeMercatorMatrix=function(i){let e=i.worldSize,r=i.point,n=Vr(1,i.center.lat)*e,a=i.pixelsPerMeter,h=e/(n/i.pixelsPerMeter),d=xr(new Float64Array(16));return As(d,d,[r.x,r.y,0]),xn(d,d,[h,h,a]),Float32Array.from(d)},o.circumferenceAtLatitude=kp,o.clamp=Je,o.clearTileCache=function(i){let e=[];for(let r in $i)e.push(z.caches.delete(r)),delete $i[r];i&&Promise.all(e).catch(i).then(()=>i())},o.clipLine=pg,o.clone=function(i){var e=new yr(16);return e[0]=i[0],e[1]=i[1],e[2]=i[2],e[3]=i[3],e[4]=i[4],e[5]=i[5],e[6]=i[6],e[7]=i[7],e[8]=i[8],e[9]=i[9],e[10]=i[10],e[11]=i[11],e[12]=i[12],e[13]=i[13],e[14]=i[14],e[15]=i[15],e},o.clone$1=hr,o.collisionCircleLayout=t1,o.config=At,o.conjugate=function(i,e){return i[0]=-e[0],i[1]=-e[1],i[2]=-e[2],i[3]=e[3],i},o.create=function(){var i=new yr(16);return yr!=Float32Array&&(i[1]=0,i[2]=0,i[3]=0,i[4]=0,i[6]=0,i[7]=0,i[8]=0,i[9]=0,i[11]=0,i[12]=0,i[13]=0,i[14]=0),i[0]=1,i[5]=1,i[10]=1,i[15]=1,i},o.create$1=fm,o.createExpression=On,o.createLayout=Oe,o.createStyleLayer=function(i){return i.type==="custom"?new J1(i):new ex[i.type](i)},o.cross=Bp,o.degToRad=Ce,o.distance=function(i,e){return Math.hypot(e[0]-i[0],e[1]-i[1],e[2]-i[2])},o.div=function(i,e,r){return i[0]=e[0]/r[0],i[1]=e[1]/r[1],i[2]=e[2]/r[2],i},o.dot=Nr,o.ease=wt,o.easeCubicInOut=Ye,o.emitValidationErrors=Eh,o.endsWith=cr,o.enforceCacheSizeLimit=function(i){for(let e in $i)W(e),$i[e].then(r=>{r.keys().then(n=>{for(let a=0;a<n.length-i;a++)r.delete(n[a])})})},o.evaluateSizeForFeature=ou,o.evaluateSizeForZoom=Wa,o.evaluateVariableOffset=_g,o.evented=N,o.exactEquals=function(i,e){return i[0]===e[0]&&i[1]===e[1]&&i[2]===e[2]&&i[3]===e[3]},o.exactEquals$1=function(i,e){return i[0]===e[0]&&i[1]===e[1]&&i[2]===e[2]},o.exported=ur,o.exported$1=dn,o.extend=Bt,o.extend$1=ir,o.fillExtrusionHeightLift=Om,o.filterObject=Si,o.fromMat4=function(i,e){return i[0]=e[0],i[1]=e[1],i[2]=e[2],i[3]=e[4],i[4]=e[5],i[5]=e[6],i[6]=e[8],i[7]=e[9],i[8]=e[10],i},o.fromQuat=function(i,e){var r=e[0],n=e[1],a=e[2],h=e[3],d=r+r,m=n+n,y=a+a,x=r*d,E=n*d,k=n*m,S=a*d,M=a*m,P=a*y,F=h*d,G=h*m,X=h*y;return i[0]=1-k-P,i[1]=E+X,i[2]=S-G,i[3]=0,i[4]=E-X,i[5]=1-x-P,i[6]=M+F,i[7]=0,i[8]=S+G,i[9]=M-F,i[10]=1-x-k,i[11]=0,i[12]=0,i[13]=0,i[14]=0,i[15]=1,i},o.fromRotation=function(i,e){var r=Math.sin(e),n=Math.cos(e);return i[0]=n,i[1]=r,i[2]=0,i[3]=-r,i[4]=n,i[5]=0,i[6]=0,i[7]=0,i[8]=1,i},o.fromScaling=function(i,e){return i[0]=e[0],i[1]=0,i[2]=0,i[3]=0,i[4]=0,i[5]=e[1],i[6]=0,i[7]=0,i[8]=0,i[9]=0,i[10]=e[2],i[11]=0,i[12]=0,i[13]=0,i[14]=0,i[15]=1,i},o.furthestTileCorner=function(i){let e=Math.round((i+45+360)%360/90)%4;return Ke[e]},o.getAABBPointSquareDist=function(i,e,r){let n=0;for(let a=0;a<2;++a){let h=r?r[a]:0;i[a]>h&&(n+=(i[a]-h)*(i[a]-h)),e[a]<h&&(n+=(h-e[a])*(h-e[a]))}return n},o.getAnchorAlignment=Qp,o.getAnchorJustification=id,o.getBounds=function(i){let e=1/0,r=1/0,n=-1/0,a=-1/0;for(let h of i)e=Math.min(e,h.x),r=Math.min(r,h.y),n=Math.max(n,h.x),a=Math.max(a,h.y);return{min:new Y(e,r),max:new Y(n,a)}},o.getColumn=Kr,o.getGridMatrix=function(i,e,r){let[n,a]=e,h=.015625;return[0,(a[1]-n[1])*h,1<<i.z,(a[0]-n[0])/Qa[r],0,i.y,n[0],n[1],h]},o.getImage=ot,o.getJSON=function(i,e){return pe(Bt(i,{type:"json"}),e)},o.getLatitudinalLod=function(i){let e=80.051129;i=Je(i,-80.051129,e)/e*90;let r=Math.pow(Math.abs(Math.sin(Ce(i))),3);return Math.round(r*(Qa.length-1))},o.getMapSessionAPI=ll,o.getPerformanceMeasurement=An,o.getProjection=Lg,o.getRTLTextPluginStatus=j,o.getReferrer=fe,o.getTilePoint=function(i,{x:e,y:r},n=0){return new Y(((e-n)*i.scale-i.x)*lt,(r*i.scale-i.y)*lt)},o.getTileVec3=function(i,e,r=0){return $a(((e.x-r)*i.scale-i.x)*lt,(e.y*i.scale-i.y)*lt,nm(e.z,e.y))},o.getVideo=function(i,e){let r=z.document.createElement("video");r.muted=!0,r.onloadstart=function(){e(null,r)};for(let n=0;n<i.length;n++){let a=z.document.createElement("source");Ze(i[n])||(r.crossOrigin="Anonymous"),a.src=i[n],r.appendChild(a)}return{cancel:()=>{}}},o.globeCenterToScreenPoint=function(i){let e=[0,0,0],r=xr(new Float64Array(16));return Mo(r,i.pixelMatrix,i.globeMatrix),ji(e,e,r),new Y(e[0],e[1])},o.globeECEFOrigin=function(i,e){let r=[0,0,0];return ji(r,r,dc(wn(e.canonical))),ji(r,r,i),r},o.globeNormalizeECEF=dc,o.globePixelsToTileUnits=function(i,e){return lt/(512*Math.pow(2,i))*pu(wn(e))},o.globePoleMatrixForTile=function(i,e,r){let n=xr(new Float64Array(16)),a=1<<i,h=360*(e/a-.5),d=r.point,m=r.worldSize/(r.tileSize*a);return As(n,n,[d.x,d.y,-r.worldSize/Math.PI/2]),xn(n,n,[m,m,m]),$h(n,n,Ce(-r._center.lat)),qh(n,n,Ce(-r._center.lng+h)),Float32Array.from(n)},o.globeTileBounds=wn,o.globeTileLatLngCorners=sd,o.globeTiltAtLngLat=Sg,o.globeToMercatorTransition=ad,o.globeUseCustomAntiAliasing=function(i,e,r){let n=ad(r.zoom),a=i.style.map._antialias,h=!!e.extStandardDerivatives,d=e.extStandardDerivativesForceOff||i.terrain&&i.terrain.exaggeration()>0;return n===0&&!a&&!d&&h},o.identity=xr,o.identity$1=bm,o.invert=function(i,e){var r=e[0],n=e[1],a=e[2],h=e[3],d=e[4],m=e[5],y=e[6],x=e[7],E=e[8],k=e[9],S=e[10],M=e[11],P=e[12],F=e[13],G=e[14],X=e[15],ne=r*m-n*d,re=r*y-a*d,se=r*x-h*d,ce=n*y-a*m,ue=n*x-h*m,ve=a*x-h*y,we=E*F-k*P,Se=E*G-S*P,Le=E*X-M*P,ge=k*G-S*F,ke=k*X-M*F,Be=S*X-M*G,Re=ne*Be-re*ke+se*ge+ce*Le-ue*Se+ve*we;return Re?(i[0]=(m*Be-y*ke+x*ge)*(Re=1/Re),i[1]=(a*ke-n*Be-h*ge)*Re,i[2]=(F*ve-G*ue+X*ce)*Re,i[3]=(S*ue-k*ve-M*ce)*Re,i[4]=(y*Le-d*Be-x*Se)*Re,i[5]=(r*Be-a*Le+h*Se)*Re,i[6]=(G*se-P*ve-X*re)*Re,i[7]=(E*ve-S*se+M*re)*Re,i[8]=(d*ke-m*Le+x*we)*Re,i[9]=(n*Le-r*ke-h*we)*Re,i[10]=(P*ue-F*se+X*ne)*Re,i[11]=(k*se-E*ue-M*ne)*Re,i[12]=(m*Se-d*ge-y*we)*Re,i[13]=(r*ge-n*Se+a*we)*Re,i[14]=(F*re-P*ce-G*ne)*Re,i[15]=(E*ce-k*re+S*ne)*Re,i):null},o.isLngLatBehindGlobe=function(i,e){return Sg(i,e)>Math.PI/2*1.01},o.isMapAuthenticated=function(i){return fn.has(i)},o.isMapboxURL=Rr,o.isSafariWithAntialiasingBug=function(i){let e=i.navigator?i.navigator.userAgent:null;return!!io(i)&&e&&(e.match("Version/15.4")||e.match("Version/15.5")||e.match(/CPU (OS|iPhone OS) (15_4|15_5) like Mac OS X/))},o.latFromMercatorY=wi,o.len=l0,o.length=Yl,o.length$1=function(i){return Math.hypot(i[0],i[1],i[2],i[3])},o.loadVectorTile=t_,o.makeRequest=pe,o.mapValue=function(i,e,r,n,a){return Je((i-e)/(r-e)*(a-n)+n,n,a)},o.mercatorXfromLng=Ts,o.mercatorYfromLat=Cs,o.mercatorZfromAltitude=Vr,o.mul=s0,o.mul$1=a0,o.multiply=Mo,o.multiply$1=function(i,e,r){var n=e[0],a=e[1],h=e[2],d=e[3],m=e[4],y=e[5],x=e[6],E=e[7],k=e[8],S=r[0],M=r[1],P=r[2],F=r[3],G=r[4],X=r[5],ne=r[6],re=r[7],se=r[8];return i[0]=S*n+M*d+P*x,i[1]=S*a+M*m+P*E,i[2]=S*h+M*y+P*k,i[3]=F*n+G*d+X*x,i[4]=F*a+G*m+X*E,i[5]=F*h+G*y+X*k,i[6]=ne*n+re*d+se*x,i[7]=ne*a+re*m+se*E,i[8]=ne*h+re*y+se*k,i},o.multiply$2=_m,o.nextPowerOfTwo=lr,o.normalize=Wi,o.normalize$1=function(i,e){var r=e[0],n=e[1],a=e[2],h=e[3],d=r*r+n*n+a*a+h*h;return d>0&&(d=1/Math.sqrt(d)),i[0]=r*d,i[1]=n*d,i[2]=a*d,i[3]=h*d,i},o.number=Pt,o.ortho=function(i,e,r,n,a,h,d){var m=1/(e-r),y=1/(n-a),x=1/(h-d);return i[0]=-2*m,i[1]=0,i[2]=0,i[3]=0,i[4]=0,i[5]=-2*y,i[6]=0,i[7]=0,i[8]=0,i[9]=0,i[10]=2*x,i[11]=0,i[12]=(e+r)*m,i[13]=(a+n)*y,i[14]=(d+h)*x,i[15]=1,i},o.pbf=cc,o.perspective=function(i,e,r,n,a){var h,d=1/Math.tan(e/2);return i[0]=d/r,i[1]=0,i[2]=0,i[3]=0,i[4]=0,i[5]=d,i[6]=0,i[7]=0,i[8]=0,i[9]=0,i[11]=-1,i[12]=0,i[13]=0,i[15]=0,a!=null&&a!==1/0?(i[10]=(a+n)*(h=1/(n-a)),i[14]=2*a*n*h):(i[10]=-1,i[14]=-2*n),i},o.pick=function(i,e){let r={};for(let n=0;n<e.length;n++){let a=e[n];a in i&&(r[a]=i[a])}return r},o.plugin=U,o.pointGeometry=Y,o.polygonContainsPoint=Ss,o.polygonIntersectsBox=um,o.polygonIntersectsPolygon=am,o.polygonizeBounds=function(i,e,r=0,n=!0){let a=new Y(r,r),h=i.sub(a),d=e.add(a),m=[h,new Y(d.x,h.y),d,new Y(h.x,d.y)];return n&&m.push(h.clone()),m},o.posAttributes=pc,o.postMapLoadEvent=Ys,o.postTurnstileEvent=Xo,o.potpack=Xp,o.prevPowerOfTwo=function(i){return i<=1?1:Math.pow(2,Math.floor(Math.log(i)/Math.LN2))},o.radToDeg=Ge,o.refProperties=["type","source","source-layer","minzoom","maxzoom","filter","layout"],o.registerForPluginStateChange=function(i){return i({pluginStatus:I,pluginURL:L}),N.on("pluginStateChange",i),i},o.removeAuthState=function(i){fn.delete(i)},o.renderColorRamp=Up,o.resample=om,o.rotateX=$h,o.rotateX$1=wm,o.rotateY=qh,o.rotateY$1=Em,o.rotateZ=function(i,e,r){var n=Math.sin(r),a=Math.cos(r),h=e[0],d=e[1],m=e[2],y=e[3],x=e[4],E=e[5],k=e[6],S=e[7];return e!==i&&(i[8]=e[8],i[9]=e[9],i[10]=e[10],i[11]=e[11],i[12]=e[12],i[13]=e[13],i[14]=e[14],i[15]=e[15]),i[0]=h*a+x*n,i[1]=d*a+E*n,i[2]=m*a+k*n,i[3]=y*a+S*n,i[4]=x*a-h*n,i[5]=E*a-d*n,i[6]=k*a-m*n,i[7]=S*a-y*n,i},o.rotateZ$1=function(i,e,r){r*=.5;var n=e[0],a=e[1],h=e[2],d=e[3],m=Math.sin(r),y=Math.cos(r);return i[0]=n*y+a*m,i[1]=a*y-n*m,i[2]=h*y+d*m,i[3]=d*y-h*m,i},o.scale=xn,o.scale$1=xm,o.scale$2=vn,o.scaleAndAdd=Hh,o.setCacheLimits=function(i,e){oo=i,Qs=e},o.setColumn=function(i,e,r){i[4*e+0]=r[0],i[4*e+1]=r[1],i[4*e+2]=r[2],i[4*e+3]=r[3]},o.setRTLTextPlugin=function(i,e,r=!1){if(I===b||I===w||I===T)throw new Error("setRTLTextPlugin cannot be called multiple times.");L=ur.resolveURL(i),I=b,A=e,V(),r||J()},o.smoothstep=Et,o.spec=de,o.storeAuthState=function(i,e){e?fn.add(i):fn.delete(i)},o.sub=Gr,o.subtract=Lp,o.symbolSize=i1,o.tileAABB=function(i,e,r,n,a,h,d,m,y){if(y.name==="globe")return B1(i,e,new iu(r,n,a));let x=Ps({z:r,x:n,y:a},y);return new Ir([(h+x.x/x.scale)*e,e*(x.y/x.scale),d],[(h+x.x2/x.scale)*e,e*(x.y2/x.scale),m])},o.tileTransform=Ps,o.transformMat3=function(i,e,r){var n=e[0],a=e[1],h=e[2];return i[0]=n*r[0]+a*r[3]+h*r[6],i[1]=n*r[1]+a*r[4]+h*r[7],i[2]=n*r[2]+a*r[5]+h*r[8],i},o.transformMat4=ji,o.transformMat4$1=Ms,o.transformQuat=ym,o.translate=As,o.transpose=function(i,e){if(i===e){var r=e[1],n=e[2],a=e[5];i[1]=e[3],i[2]=e[6],i[3]=r,i[5]=e[7],i[6]=n,i[7]=a}else i[0]=e[0],i[1]=e[3],i[2]=e[6],i[3]=e[1],i[4]=e[4],i[5]=e[7],i[6]=e[2],i[7]=e[5],i[8]=e[8];return i},o.triggerPluginCompletionEvent=O,o.uniqueId=ki,o.updateGlobeVertexNormal=function(i,e,r,n,a){let h=5*e+2;i.float32[h+0]=r,i.float32[h+1]=n,i.float32[h+2]=a},o.validateCustomStyleLayer=function(i){let e=[],r=i.id;return r===void 0&&e.push({message:`layers.${r}: missing required property "id"`}),i.render===void 0&&e.push({message:`layers.${r}: missing required method "render"`}),i.renderingMode&&i.renderingMode!=="2d"&&i.renderingMode!=="3d"&&e.push({message:`layers.${r}: property "renderingMode" must be either "2d" or "3d"`}),e},o.validateFilter=i=>Ar(Rl(i)),o.validateFog=i=>Ar(xh(i)),o.validateLayer=i=>Ar(_h(i)),o.validateLight=i=>Ar(Fl(i)),o.validateSource=i=>Ar(yh(i)),o.validateStyle=bh,o.validateTerrain=i=>Ar(Ol(i)),o.values=li,o.vectorTile=Is,o.version=Mn,o.warnOnce=ci,o.window=z,o.wrap=It}),v(["./shared"],function(o){"use strict";function z(W){if(typeof W=="number"||typeof W=="boolean"||typeof W=="string"||W==null)return JSON.stringify(W);if(Array.isArray(W)){let R="[";for(let Z of W)R+=`${z(Z)},`;return`${R}]`}let D="{";for(let R of Object.keys(W).sort())D+=`${R}:${z(W[R])},`;return`${D}}`}function B(W){let D="";for(let R of o.refProperties)D+=`/${z(W[R])}`;return D}class H{constructor(D){this.keyCache={},D&&this.replace(D)}replace(D){this._layerConfigs={},this._layers={},this.update(D,[])}update(D,R){for(let ee of D)this._layerConfigs[ee.id]=ee,(this._layers[ee.id]=o.createStyleLayer(ee)).compileFilter(),this.keyCache[ee.id]&&delete this.keyCache[ee.id];for(let ee of R)delete this.keyCache[ee],delete this._layerConfigs[ee],delete this._layers[ee];this.familiesBySource={};let Z=function(ee,le){let fe={};for(let he=0;he<ee.length;he++){let me=le&&le[ee[he].id]||B(ee[he]);le&&(le[ee[he].id]=me);let ze=fe[me];ze||(ze=fe[me]=[]),ze.push(ee[he])}let pe=[];for(let he in fe)pe.push(fe[he]);return pe}(o.values(this._layerConfigs),this.keyCache);for(let ee of Z){let le=ee.map(Ze=>this._layers[Ze.id]),fe=le[0];if(fe.visibility==="none")continue;let pe=fe.source||"",he=this.familiesBySource[pe];he||(he=this.familiesBySource[pe]={});let me=fe.sourceLayer||"_geojsonTileLayer",ze=he[me];ze||(ze=he[me]=[]),ze.push(le)}}}class Y{loadTile(D,R){let{uid:Z,encoding:ee,rawImageData:le,padding:fe,buildQuadTree:pe}=D,he=o.window.ImageBitmap&&le instanceof o.window.ImageBitmap?this.getImageData(le,fe):le;R(null,new o.DEMData(Z,he,ee,fe<1,pe))}getImageData(D,R){this.offscreenCanvas&&this.offscreenCanvasContext||(this.offscreenCanvas=new OffscreenCanvas(D.width,D.height),this.offscreenCanvasContext=this.offscreenCanvas.getContext("2d")),this.offscreenCanvas.width=D.width,this.offscreenCanvas.height=D.height,this.offscreenCanvasContext.drawImage(D,0,0,D.width,D.height);let Z=this.offscreenCanvasContext.getImageData(-R,-R,D.width+2*R,D.height+2*R);return this.offscreenCanvasContext.clearRect(0,0,this.offscreenCanvas.width,this.offscreenCanvas.height),Z}}var oe=function W(D,R){var Z,ee=D&&D.type;if(ee==="FeatureCollection")for(Z=0;Z<D.features.length;Z++)W(D.features[Z],R);else if(ee==="GeometryCollection")for(Z=0;Z<D.geometries.length;Z++)W(D.geometries[Z],R);else if(ee==="Feature")W(D.geometry,R);else if(ee==="Polygon")Ee(D.coordinates,R);else if(ee==="MultiPolygon")for(Z=0;Z<D.coordinates.length;Z++)Ee(D.coordinates[Z],R);return D};function Ee(W,D){if(W.length!==0){Ae(W[0],D);for(var R=1;R<W.length;R++)Ae(W[R],!D)}}function Ae(W,D){for(var R=0,Z=0,ee=0,le=W.length,fe=le-1;ee<le;fe=ee++){var pe=(W[ee][0]-W[fe][0])*(W[fe][1]+W[ee][1]),he=R+pe;Z+=Math.abs(R)>=Math.abs(pe)?R-he+pe:pe-he+R,R=he}R+Z>=0!=!!D&&W.reverse()}let Ce=o.vectorTile.VectorTileFeature.prototype.toGeoJSON;class Ge{constructor(D){this._feature=D,this.extent=o.EXTENT,this.type=D.type,this.properties=D.tags,"id"in D&&!isNaN(D.id)&&(this.id=parseInt(D.id,10))}loadGeometry(){if(this._feature.type===1){let D=[];for(let R of this._feature.geometry)D.push([new o.pointGeometry(R[0],R[1])]);return D}{let D=[];for(let R of this._feature.geometry){let Z=[];for(let ee of R)Z.push(new o.pointGeometry(ee[0],ee[1]));D.push(Z)}return D}}toGeoJSON(D,R,Z){return Ce.call(this,D,R,Z)}}class Ke{constructor(D){this.layers={_geojsonTileLayer:this},this.name="_geojsonTileLayer",this.extent=o.EXTENT,this.length=D.length,this._features=D}feature(D){return new Ge(this._features[D])}}var Ye=o.vectorTile.VectorTileFeature,ut=wt;function wt(W,D){this.options=D||{},this.features=W,this.length=W.length}function Je(W,D){this.id=typeof W.id=="number"?W.id:void 0,this.type=W.type,this.rawGeometry=W.type===1?[W.geometry]:W.geometry,this.properties=W.tags,this.extent=D||4096}wt.prototype.feature=function(W){return new Je(this.features[W],this.options.extent)},Je.prototype.loadGeometry=function(){var W=this.rawGeometry;this.geometry=[];for(var D=0;D<W.length;D++){for(var R=W[D],Z=[],ee=0;ee<R.length;ee++)Z.push(new o.pointGeometry(R[ee][0],R[ee][1]));this.geometry.push(Z)}return this.geometry},Je.prototype.bbox=function(){this.geometry||this.loadGeometry();for(var W=this.geometry,D=1/0,R=-1/0,Z=1/0,ee=-1/0,le=0;le<W.length;le++)for(var fe=W[le],pe=0;pe<fe.length;pe++){var he=fe[pe];D=Math.min(D,he.x),R=Math.max(R,he.x),Z=Math.min(Z,he.y),ee=Math.max(ee,he.y)}return[D,Z,R,ee]},Je.prototype.toGeoJSON=Ye.prototype.toGeoJSON;var Et=Ht,It=ut;function Ht(W){var D=new o.pbf;return function(R,Z){for(var ee in R.layers)Z.writeMessage(3,li,R.layers[ee])}(W,D),D.finish()}function li(W,D){var R;D.writeVarintField(15,W.version||1),D.writeStringField(1,W.name||""),D.writeVarintField(5,W.extent||4096);var Z={keys:[],values:[],keycache:{},valuecache:{}};for(R=0;R<W.length;R++)Z.feature=W.feature(R),D.writeMessage(2,Bt,Z);var ee=Z.keys;for(R=0;R<ee.length;R++)D.writeStringField(3,ee[R]);var le=Z.values;for(R=0;R<le.length;R++)D.writeMessage(4,Ji,le[R])}function Bt(W,D){var R=W.feature;R.id!==void 0&&D.writeVarintField(1,R.id),D.writeMessage(2,Ci,W),D.writeVarintField(3,R.type),D.writeMessage(4,lr,R)}function Ci(W,D){var R=W.feature,Z=W.keys,ee=W.values,le=W.keycache,fe=W.valuecache;for(var pe in R.properties){var he=R.properties[pe],me=le[pe];if(he!==null){me===void 0&&(Z.push(pe),le[pe]=me=Z.length-1),D.writeVarint(me);var ze=typeof he;ze!=="string"&&ze!=="boolean"&&ze!=="number"&&(he=JSON.stringify(he));var Ze=ze+":"+he,De=fe[Ze];De===void 0&&(ee.push(he),fe[Ze]=De=ee.length-1),D.writeVarint(De)}}}function ki(W,D){return(D<<3)+(7&W)}function ar(W){return W<<1^W>>31}function lr(W,D){for(var R=W.loadGeometry(),Z=W.type,ee=0,le=0,fe=R.length,pe=0;pe<fe;pe++){var he=R[pe],me=1;Z===1&&(me=he.length),D.writeVarint(ki(1,me));for(var ze=Z===3?he.length-1:he.length,Ze=0;Ze<ze;Ze++){Ze===1&&Z!==1&&D.writeVarint(ki(2,ze-1));var De=he[Ze].x-ee,nt=he[Ze].y-le;D.writeVarint(ar(De)),D.writeVarint(ar(nt)),ee+=De,le+=nt}Z===3&&D.writeVarint(ki(7,1))}}function Ji(W,D){var R=typeof W;R==="string"?D.writeStringField(1,W):R==="boolean"?D.writeBooleanField(7,W):R==="number"&&(W%1!=0?D.writeDoubleField(3,W):W<0?D.writeSVarintField(6,W):D.writeVarintField(5,W))}function vi(W,D,R,Z,ee,le){if(ee-Z<=R)return;let fe=Z+ee>>1;cr(W,D,fe,Z,ee,le%2),vi(W,D,R,Z,fe-1,le+1),vi(W,D,R,fe+1,ee,le+1)}function cr(W,D,R,Z,ee,le){for(;ee>Z;){if(ee-Z>600){let me=ee-Z+1,ze=R-Z+1,Ze=Math.log(me),De=.5*Math.exp(2*Ze/3),nt=.5*Math.sqrt(Ze*De*(me-De)/me)*(ze-me/2<0?-1:1);cr(W,D,R,Math.max(Z,Math.floor(R-ze*De/me+nt)),Math.min(ee,Math.floor(R+(me-ze)*De/me+nt)),le)}let fe=D[2*R+le],pe=Z,he=ee;for(Ri(W,D,Z,R),D[2*ee+le]>fe&&Ri(W,D,Z,ee);pe<he;){for(Ri(W,D,pe,he),pe++,he--;D[2*pe+le]<fe;)pe++;for(;D[2*he+le]>fe;)he--}D[2*Z+le]===fe?Ri(W,D,Z,he):(he++,Ri(W,D,he,ee)),he<=R&&(Z=he+1),R<=he&&(ee=he-1)}}function Ri(W,D,R,Z){Si(W,R,Z),Si(D,2*R,2*Z),Si(D,2*R+1,2*Z+1)}function Si(W,D,R){let Z=W[D];W[D]=W[R],W[R]=Z}function hr(W,D,R,Z){let ee=W-R,le=D-Z;return ee*ee+le*le}Et.fromVectorTileJs=Ht,Et.fromGeojsonVt=function(W,D){D=D||{};var R={};for(var Z in W)R[Z]=new ut(W[Z].features,D),R[Z].name=Z,R[Z].version=D.version,R[Z].extent=D.extent;return Ht({layers:R})},Et.GeoJSONWrapper=It;let Go=W=>W[0],ci=W=>W[1];class Fi{constructor(D,R=Go,Z=ci,ee=64,le=Float64Array){this.nodeSize=ee,this.points=D;let fe=D.length<65536?Uint16Array:Uint32Array,pe=this.ids=new fe(D.length),he=this.coords=new le(2*D.length);for(let me=0;me<D.length;me++)pe[me]=me,he[2*me]=R(D[me]),he[2*me+1]=Z(D[me]);vi(pe,he,ee,0,pe.length-1,0)}range(D,R,Z,ee){return function(le,fe,pe,he,me,ze,Ze){let De=[0,le.length-1,0],nt=[],at,ot;for(;De.length;){let ct=De.pop(),_t=De.pop(),Rt=De.pop();if(_t-Rt<=Ze){for(let de=Rt;de<=_t;de++)at=fe[2*de],ot=fe[2*de+1],at>=pe&&at<=me&&ot>=he&&ot<=ze&&nt.push(le[de]);continue}let Yt=Math.floor((Rt+_t)/2);at=fe[2*Yt],ot=fe[2*Yt+1],at>=pe&&at<=me&&ot>=he&&ot<=ze&&nt.push(le[Yt]);let Vt=(ct+1)%2;(ct===0?pe<=at:he<=ot)&&(De.push(Rt),De.push(Yt-1),De.push(Vt)),(ct===0?me>=at:ze>=ot)&&(De.push(Yt+1),De.push(_t),De.push(Vt))}return nt}(this.ids,this.coords,D,R,Z,ee,this.nodeSize)}within(D,R,Z){return function(ee,le,fe,pe,he,me){let ze=[0,ee.length-1,0],Ze=[],De=he*he;for(;ze.length;){let nt=ze.pop(),at=ze.pop(),ot=ze.pop();if(at-ot<=me){for(let Vt=ot;Vt<=at;Vt++)hr(le[2*Vt],le[2*Vt+1],fe,pe)<=De&&Ze.push(ee[Vt]);continue}let ct=Math.floor((ot+at)/2),_t=le[2*ct],Rt=le[2*ct+1];hr(_t,Rt,fe,pe)<=De&&Ze.push(ee[ct]);let Yt=(nt+1)%2;(nt===0?fe-he<=_t:pe-he<=Rt)&&(ze.push(ot),ze.push(ct-1),ze.push(Yt)),(nt===0?fe+he>=_t:pe+he>=Rt)&&(ze.push(ct+1),ze.push(at),ze.push(Yt))}return Ze}(this.ids,this.coords,D,R,Z,this.nodeSize)}}let Wr={minZoom:0,maxZoom:16,minPoints:2,radius:40,extent:512,nodeSize:64,log:!1,generateId:!1,reduce:null,map:W=>W},Qi=Math.fround||(Hr=new Float32Array(1),W=>(Hr[0]=+W,Hr[0]));var Hr;class Xr{constructor(D){this.options=Yr(Object.create(Wr),D),this.trees=new Array(this.options.maxZoom+1)}load(D){let{log:R,minZoom:Z,maxZoom:ee,nodeSize:le}=this.options;R&&console.time("total time");let fe=`prepare ${D.length} points`;R&&console.time(fe),this.points=D;let pe=[];for(let he=0;he<D.length;he++)D[he].geometry&&pe.push($o(D[he],he));this.trees[ee+1]=new Fi(pe,In,Br,le,Float32Array),R&&console.timeEnd(fe);for(let he=ee;he>=Z;he--){let me=+Date.now();pe=this._cluster(pe,he),this.trees[he]=new Fi(pe,In,Br,le,Float32Array),R&&console.log("z%d: %d clusters in %dms",he,pe.length,+Date.now()-me)}return R&&console.timeEnd("total time"),this}getClusters(D,R){let Z=((D[0]+180)%360+360)%360-180,ee=Math.max(-90,Math.min(90,D[1])),le=D[2]===180?180:((D[2]+180)%360+360)%360-180,fe=Math.max(-90,Math.min(90,D[3]));if(D[2]-D[0]>=360)Z=-180,le=180;else if(Z>le){let ze=this.getClusters([Z,ee,180,fe],R),Ze=this.getClusters([-180,ee,le,fe],R);return ze.concat(Ze)}let pe=this.trees[this._limitZoom(R)],he=pe.range(An(Z),Mn(fe),An(le),Mn(ee)),me=[];for(let ze of he){let Ze=pe.points[ze];me.push(Ze.numPoints?Kr(Ze):this.points[Ze.index])}return me}getChildren(D){let R=this._getOriginId(D),Z=this._getOriginZoom(D),ee="No cluster with the specified id.",le=this.trees[Z];if(!le)throw new Error(ee);let fe=le.points[R];if(!fe)throw new Error(ee);let pe=this.options.radius/(this.options.extent*Math.pow(2,Z-1)),he=le.within(fe.x,fe.y,pe),me=[];for(let ze of he){let Ze=le.points[ze];Ze.parentId===D&&me.push(Ze.numPoints?Kr(Ze):this.points[Ze.index])}if(me.length===0)throw new Error(ee);return me}getLeaves(D,R,Z){let ee=[];return this._appendLeaves(ee,D,R=R||10,Z=Z||0,0),ee}getTile(D,R,Z){let ee=this.trees[this._limitZoom(D)],le=Math.pow(2,D),{extent:fe,radius:pe}=this.options,he=pe/fe,me=(Z-he)/le,ze=(Z+1+he)/le,Ze={features:[]};return this._addTileFeatures(ee.range((R-he)/le,me,(R+1+he)/le,ze),ee.points,R,Z,le,Ze),R===0&&this._addTileFeatures(ee.range(1-he/le,me,1,ze),ee.points,le,Z,le,Ze),R===le-1&&this._addTileFeatures(ee.range(0,me,he/le,ze),ee.points,-1,Z,le,Ze),Ze.features.length?Ze:null}getClusterExpansionZoom(D){let R=this._getOriginZoom(D)-1;for(;R<=this.options.maxZoom;){let Z=this.getChildren(D);if(R++,Z.length!==1)break;D=Z[0].properties.cluster_id}return R}_appendLeaves(D,R,Z,ee,le){let fe=this.getChildren(R);for(let pe of fe){let he=pe.properties;if(he&&he.cluster?le+he.point_count<=ee?le+=he.point_count:le=this._appendLeaves(D,he.cluster_id,Z,ee,le):le<ee?le++:D.push(pe),D.length===Z)break}return le}_addTileFeatures(D,R,Z,ee,le,fe){for(let pe of D){let he=R[pe],me=he.numPoints,ze,Ze,De;if(me)ze=Hs(he),Ze=he.x,De=he.y;else{let ot=this.points[he.index];ze=ot.properties,Ze=An(ot.geometry.coordinates[0]),De=Mn(ot.geometry.coordinates[1])}let nt={type:1,geometry:[[Math.round(this.options.extent*(Ze*le-Z)),Math.round(this.options.extent*(De*le-ee))]],tags:ze},at;me?at=he.id:this.options.generateId?at=he.index:this.points[he.index].id&&(at=this.points[he.index].id),at!==void 0&&(nt.id=at),fe.features.push(nt)}}_limitZoom(D){return Math.max(this.options.minZoom,Math.min(+D,this.options.maxZoom+1))}_cluster(D,R){let Z=[],{radius:ee,extent:le,reduce:fe,minPoints:pe}=this.options,he=ee/(le*Math.pow(2,R));for(let me=0;me<D.length;me++){let ze=D[me];if(ze.zoom<=R)continue;ze.zoom=R;let Ze=this.trees[R+1],De=Ze.within(ze.x,ze.y,he),nt=ze.numPoints||1,at=nt;for(let ot of De){let ct=Ze.points[ot];ct.zoom>R&&(at+=ct.numPoints||1)}if(at>nt&&at>=pe){let ot=ze.x*nt,ct=ze.y*nt,_t=fe&&nt>1?this._map(ze,!0):null,Rt=(me<<5)+(R+1)+this.points.length;for(let Yt of De){let Vt=Ze.points[Yt];if(Vt.zoom<=R)continue;Vt.zoom=R;let de=Vt.numPoints||1;ot+=Vt.x*de,ct+=Vt.y*de,Vt.parentId=Rt,fe&&(_t||(_t=this._map(ze,!0)),fe(_t,this._map(Vt)))}ze.parentId=Rt,Z.push(io(ot/at,ct/at,Rt,at,_t))}else if(Z.push(ze),at>1)for(let ot of De){let ct=Ze.points[ot];ct.zoom<=R||(ct.zoom=R,Z.push(ct))}}return Z}_getOriginId(D){return D-this.points.length>>5}_getOriginZoom(D){return(D-this.points.length)%32}_map(D,R){if(D.numPoints)return R?Yr({},D.properties):D.properties;let Z=this.points[D.index].properties,ee=this.options.map(Z);return R&&ee===Z?Yr({},ee):ee}}function io(W,D,R,Z,ee){return{x:Qi(W),y:Qi(D),zoom:1/0,id:R,parentId:-1,numPoints:Z,properties:ee}}function $o(W,D){let[R,Z]=W.geometry.coordinates;return{x:Qi(An(R)),y:Qi(Mn(Z)),zoom:1/0,index:D,parentId:-1}}function Kr(W){return{type:"Feature",id:W.id,properties:Hs(W),geometry:{type:"Point",coordinates:[(D=W.x,360*(D-.5)),zt(W.y)]}};var D}function Hs(W){let D=W.numPoints,R=D>=1e4?`${Math.round(D/1e3)}k`:D>=1e3?Math.round(D/100)/10+"k":D;return Yr(Yr({},W.properties),{cluster:!0,cluster_id:W.id,point_count:D,point_count_abbreviated:R})}function An(W){return W/360+.5}function Mn(W){let D=Math.sin(W*Math.PI/180),R=.5-.25*Math.log((1+D)/(1-D))/Math.PI;return R<0?0:R>1?1:R}function zt(W){let D=(180-360*W)*Math.PI/180;return 360*Math.atan(Math.exp(D))/Math.PI-90}function Yr(W,D){for(let R in D)W[R]=D[R];return W}function In(W){return W.x}function Br(W){return W.y}function ur(W,D,R,Z){for(var ee,le=Z,fe=R-D>>1,pe=R-D,he=W[D],me=W[D+1],ze=W[R],Ze=W[R+1],De=D+3;De<R;De+=3){var nt=ro(W[De],W[De+1],he,me,ze,Ze);if(nt>le)ee=De,le=nt;else if(nt===le){var at=Math.abs(De-fe);at<pe&&(ee=De,pe=at)}}le>Z&&(ee-D>3&&ur(W,D,ee,Z),W[ee+2]=le,R-ee>3&&ur(W,ee,R,Z))}function ro(W,D,R,Z,ee,le){var fe=ee-R,pe=le-Z;if(fe!==0||pe!==0){var he=((W-R)*fe+(D-Z)*pe)/(fe*fe+pe*pe);he>1?(R=ee,Z=le):he>0&&(R+=fe*he,Z+=pe*he)}return(fe=W-R)*fe+(pe=D-Z)*pe}function At(W,D,R,Z){var ee={id:W===void 0?null:W,type:D,geometry:R,tags:Z,minX:1/0,minY:1/0,maxX:-1/0,maxY:-1/0};return function(le){var fe=le.geometry,pe=le.type;if(pe==="Point"||pe==="MultiPoint"||pe==="LineString")dn(le,fe);else if(pe==="Polygon"||pe==="MultiLineString")for(var he=0;he<fe.length;he++)dn(le,fe[he]);else if(pe==="MultiPolygon")for(he=0;he<fe.length;he++)for(var me=0;me<fe[he].length;me++)dn(le,fe[he][me])}(ee),ee}function dn(W,D){for(var R=0;R<D.length;R+=3)W.minX=Math.min(W.minX,D[R]),W.minY=Math.min(W.minY,D[R+1]),W.maxX=Math.max(W.maxX,D[R]),W.maxY=Math.max(W.maxY,D[R+1])}function Jr(W,D,R,Z){if(D.geometry){var ee=D.geometry.coordinates,le=D.geometry.type,fe=Math.pow(R.tolerance/((1<<R.maxZoom)*R.extent),2),pe=[],he=D.id;if(R.promoteId?he=D.properties[R.promoteId]:R.generateId&&(he=Z||0),le==="Point")Qr(ee,pe);else if(le==="MultiPoint")for(var me=0;me<ee.length;me++)Qr(ee[me],pe);else if(le==="LineString")zn(ee,pe,fe,!1);else if(le==="MultiLineString"){if(R.lineMetrics){for(me=0;me<ee.length;me++)zn(ee[me],pe=[],fe,!1),W.push(At(he,"LineString",pe,D.properties));return}no(ee,pe,fe,!1)}else if(le==="Polygon")no(ee,pe,fe,!0);else{if(le!=="MultiPolygon"){if(le==="GeometryCollection"){for(me=0;me<D.geometry.geometries.length;me++)Jr(W,{id:he,geometry:D.geometry.geometries[me],properties:D.properties},R,Z);return}throw new Error("Input data is not a valid GeoJSON object.")}for(me=0;me<ee.length;me++){var ze=[];no(ee[me],ze,fe,!0),pe.push(ze)}}W.push(At(he,le,pe,D.properties))}}function Qr(W,D){D.push(qo(W[0])),D.push(Zo(W[1])),D.push(0)}function zn(W,D,R,Z){for(var ee,le,fe=0,pe=0;pe<W.length;pe++){var he=qo(W[pe][0]),me=Zo(W[pe][1]);D.push(he),D.push(me),D.push(0),pe>0&&(fe+=Z?(ee*me-he*le)/2:Math.sqrt(Math.pow(he-ee,2)+Math.pow(me-le,2))),ee=he,le=me}var ze=D.length-3;D[2]=1,ur(D,0,ze,R),D[ze+2]=1,D.size=Math.abs(fe),D.start=0,D.end=D.size}function no(W,D,R,Z){for(var ee=0;ee<W.length;ee++){var le=[];zn(W[ee],le,R,Z),D.push(le)}}function qo(W){return W/360+.5}function Zo(W){var D=Math.sin(W*Math.PI/180),R=.5-.25*Math.log((1+D)/(1-D))/Math.PI;return R<0?0:R>1?1:R}function er(W,D,R,Z,ee,le,fe,pe){if(Z/=D,le>=(R/=D)&&fe<Z)return W;if(fe<R||le>=Z)return null;for(var he=[],me=0;me<W.length;me++){var ze=W[me],Ze=ze.geometry,De=ze.type,nt=ee===0?ze.minX:ze.minY,at=ee===0?ze.maxX:ze.maxY;if(nt>=R&&at<Z)he.push(ze);else if(!(at<R||nt>=Z)){var ot=[];if(De==="Point"||De==="MultiPoint")Rr(Ze,ot,R,Z,ee);else if(De==="LineString")Pn(Ze,ot,R,Z,ee,!1,pe.lineMetrics);else if(De==="MultiLineString")tr(Ze,ot,R,Z,ee,!1);else if(De==="Polygon")tr(Ze,ot,R,Z,ee,!0);else if(De==="MultiPolygon")for(var ct=0;ct<Ze.length;ct++){var _t=[];tr(Ze[ct],_t,R,Z,ee,!0),_t.length&&ot.push(_t)}if(ot.length){if(pe.lineMetrics&&De==="LineString"){for(ct=0;ct<ot.length;ct++)he.push(At(ze.id,De,ot[ct],ze.tags));continue}De!=="LineString"&&De!=="MultiLineString"||(ot.length===1?(De="LineString",ot=ot[0]):De="MultiLineString"),De!=="Point"&&De!=="MultiPoint"||(De=ot.length===3?"Point":"MultiPoint"),he.push(At(ze.id,De,ot,ze.tags))}}}return he.length?he:null}function Rr(W,D,R,Z,ee){for(var le=0;le<W.length;le+=3){var fe=W[le+ee];fe>=R&&fe<=Z&&(D.push(W[le]),D.push(W[le+1]),D.push(W[le+2]))}}function Pn(W,D,R,Z,ee,le,fe){for(var pe,he,me=Xs(W),ze=ee===0?Ks:Wo,Ze=W.start,De=0;De<W.length-3;De+=3){var nt=W[De],at=W[De+1],ot=W[De+2],ct=W[De+3],_t=W[De+4],Rt=ee===0?nt:at,Yt=ee===0?ct:_t,Vt=!1;fe&&(pe=Math.sqrt(Math.pow(nt-ct,2)+Math.pow(at-_t,2))),Rt<R?Yt>R&&(he=ze(me,nt,at,ct,_t,R),fe&&(me.start=Ze+pe*he)):Rt>Z?Yt<Z&&(he=ze(me,nt,at,ct,_t,Z),fe&&(me.start=Ze+pe*he)):en(me,nt,at,ot),Yt<R&&Rt>=R&&(he=ze(me,nt,at,ct,_t,R),Vt=!0),Yt>Z&&Rt<=Z&&(he=ze(me,nt,at,ct,_t,Z),Vt=!0),!le&&Vt&&(fe&&(me.end=Ze+pe*he),D.push(me),me=Xs(W)),fe&&(Ze+=pe)}var de=W.length-3;nt=W[de],at=W[de+1],ot=W[de+2],(Rt=ee===0?nt:at)>=R&&Rt<=Z&&en(me,nt,at,ot),de=me.length-3,le&&de>=3&&(me[de]!==me[0]||me[de+1]!==me[1])&&en(me,me[0],me[1],me[2]),me.length&&D.push(me)}function Xs(W){var D=[];return D.size=W.size,D.start=W.start,D.end=W.end,D}function tr(W,D,R,Z,ee,le){for(var fe=0;fe<W.length;fe++)Pn(W[fe],D,R,Z,ee,le,!1)}function en(W,D,R,Z){W.push(D),W.push(R),W.push(Z)}function Ks(W,D,R,Z,ee,le){var fe=(le-D)/(Z-D);return W.push(le),W.push(R+(ee-R)*fe),W.push(1),fe}function Wo(W,D,R,Z,ee,le){var fe=(le-R)/(ee-R);return W.push(D+(Z-D)*fe),W.push(le),W.push(1),fe}function Ho(W,D){for(var R=[],Z=0;Z<W.length;Z++){var ee,le=W[Z],fe=le.type;if(fe==="Point"||fe==="MultiPoint"||fe==="LineString")ee=Xo(le.geometry,D);else if(fe==="MultiLineString"||fe==="Polygon"){ee=[];for(var pe=0;pe<le.geometry.length;pe++)ee.push(Xo(le.geometry[pe],D))}else if(fe==="MultiPolygon")for(ee=[],pe=0;pe<le.geometry.length;pe++){for(var he=[],me=0;me<le.geometry[pe].length;me++)he.push(Xo(le.geometry[pe][me],D));ee.push(he)}R.push(At(le.id,fe,ee,le.tags))}return R}function Xo(W,D){var R=[];R.size=W.size,W.start!==void 0&&(R.start=W.start,R.end=W.end);for(var Z=0;Z<W.length;Z+=3)R.push(W[Z]+D,W[Z+1],W[Z+2]);return R}function Ko(W,D){if(W.transformed)return W;var R,Z,ee,le=1<<W.z,fe=W.x,pe=W.y;for(R=0;R<W.features.length;R++){var he=W.features[R],me=he.geometry,ze=he.type;if(he.geometry=[],ze===1)for(Z=0;Z<me.length;Z+=2)he.geometry.push(Ys(me[Z],me[Z+1],D,le,fe,pe));else for(Z=0;Z<me.length;Z++){var Ze=[];for(ee=0;ee<me[Z].length;ee+=2)Ze.push(Ys(me[Z][ee],me[Z][ee+1],D,le,fe,pe));he.geometry.push(Ze)}}return W.transformed=!0,W}function Ys(W,D,R,Z,ee,le){return[Math.round(R*(W*Z-ee)),Math.round(R*(D*Z-le))]}function Js(W,D,R,Z,ee){for(var le=D===ee.maxZoom?0:ee.tolerance/((1<<D)*ee.extent),fe={features:[],numPoints:0,numSimplified:0,numFeatures:0,source:null,x:R,y:Z,z:D,transformed:!1,minX:2,minY:1,maxX:-1,maxY:0},pe=0;pe<W.length;pe++){fe.numFeatures++,ll(fe,W[pe],le,ee);var he=W[pe].minX,me=W[pe].minY,ze=W[pe].maxX,Ze=W[pe].maxY;he<fe.minX&&(fe.minX=he),me<fe.minY&&(fe.minY=me),ze>fe.maxX&&(fe.maxX=ze),Ze>fe.maxY&&(fe.maxY=Ze)}return fe}function ll(W,D,R,Z){var ee=D.geometry,le=D.type,fe=[];if(le==="Point"||le==="MultiPoint")for(var pe=0;pe<ee.length;pe+=3)fe.push(ee[pe]),fe.push(ee[pe+1]),W.numPoints++,W.numSimplified++;else if(le==="LineString")fn(fe,ee,W,R,!1,!1);else if(le==="MultiLineString"||le==="Polygon")for(pe=0;pe<ee.length;pe++)fn(fe,ee[pe],W,R,le==="Polygon",pe===0);else if(le==="MultiPolygon")for(var he=0;he<ee.length;he++){var me=ee[he];for(pe=0;pe<me.length;pe++)fn(fe,me[pe],W,R,!0,pe===0)}if(fe.length){var ze=D.tags||null;if(le==="LineString"&&Z.lineMetrics){for(var Ze in ze={},D.tags)ze[Ze]=D.tags[Ze];ze.mapbox_clip_start=ee.start/ee.size,ze.mapbox_clip_end=ee.end/ee.size}var De={geometry:fe,type:le==="Polygon"||le==="MultiPolygon"?3:le==="LineString"||le==="MultiLineString"?2:1,tags:ze};D.id!==null&&(De.id=D.id),W.features.push(De)}}function fn(W,D,R,Z,ee,le){var fe=Z*Z;if(Z>0&&D.size<(ee?fe:Z))R.numPoints+=D.length/3;else{for(var pe=[],he=0;he<D.length;he+=3)(Z===0||D[he+2]>fe)&&(R.numSimplified++,pe.push(D[he]),pe.push(D[he+1])),R.numPoints++;ee&&function(me,ze){for(var Ze=0,De=0,nt=me.length,at=nt-2;De<nt;at=De,De+=2)Ze+=(me[De]-me[at])*(me[De+1]+me[at+1]);if(Ze>0===ze)for(De=0,nt=me.length;De<nt/2;De+=2){var ot=me[De],ct=me[De+1];me[De]=me[nt-2-De],me[De+1]=me[nt-1-De],me[nt-2-De]=ot,me[nt-1-De]=ct}}(pe,le),W.push(pe)}}function tn(W,D){var R=(D=this.options=function(ee,le){for(var fe in le)ee[fe]=le[fe];return ee}(Object.create(this.options),D)).debug;if(R&&console.time("preprocess data"),D.maxZoom<0||D.maxZoom>24)throw new Error("maxZoom should be in the 0-24 range");if(D.promoteId&&D.generateId)throw new Error("promoteId and generateId cannot be used together.");var Z=function(ee,le){var fe=[];if(ee.type==="FeatureCollection")for(var pe=0;pe<ee.features.length;pe++)Jr(fe,ee.features[pe],le,pe);else Jr(fe,ee.type==="Feature"?ee:{geometry:ee},le);return fe}(W,D);this.tiles={},this.tileCoords=[],R&&(console.timeEnd("preprocess data"),console.log("index: maxZoom: %d, maxPoints: %d",D.indexMaxZoom,D.indexMaxPoints),console.time("generate tiles"),this.stats={},this.total=0),(Z=function(ee,le){var fe=le.buffer/le.extent,pe=ee,he=er(ee,1,-1-fe,fe,0,-1,2,le),me=er(ee,1,1-fe,2+fe,0,-1,2,le);return(he||me)&&(pe=er(ee,1,-fe,1+fe,0,-1,2,le)||[],he&&(pe=Ho(he,1).concat(pe)),me&&(pe=pe.concat(Ho(me,-1)))),pe}(Z,D)).length&&this.splitTile(Z,0,0,0),R&&(Z.length&&console.log("features: %d, points: %d",this.tiles[0].numFeatures,this.tiles[0].numPoints),console.timeEnd("generate tiles"),console.log("tiles generated:",this.total,JSON.stringify(this.stats)))}function oo(W,D,R){return 32*((1<<W)*R+D)+W}function Qs(W,D){let R=W.tileID.canonical;if(!this._geoJSONIndex)return D(null,null);let Z=this._geoJSONIndex.getTile(R.z,R.x,R.y);if(!Z)return D(null,null);let ee=new Ke(Z.features),le=Et(ee);le.byteOffset===0&&le.byteLength===le.buffer.byteLength||(le=new Uint8Array(le)),D(null,{vectorTile:ee,rawData:le.buffer})}tn.prototype.options={maxZoom:14,indexMaxZoom:5,indexMaxPoints:1e5,tolerance:3,extent:4096,buffer:64,lineMetrics:!1,promoteId:null,generateId:!1,debug:0},tn.prototype.splitTile=function(W,D,R,Z,ee,le,fe){for(var pe=[W,D,R,Z],he=this.options,me=he.debug;pe.length;){Z=pe.pop(),R=pe.pop(),D=pe.pop(),W=pe.pop();var ze=1<<D,Ze=oo(D,R,Z),De=this.tiles[Ze];if(!De&&(me>1&&console.time("creation"),De=this.tiles[Ze]=Js(W,D,R,Z,he),this.tileCoords.push({z:D,x:R,y:Z}),me)){me>1&&(console.log("tile z%d-%d-%d (features: %d, points: %d, simplified: %d)",D,R,Z,De.numFeatures,De.numPoints,De.numSimplified),console.timeEnd("creation"));var nt="z"+D;this.stats[nt]=(this.stats[nt]||0)+1,this.total++}if(De.source=W,ee){if(D===he.maxZoom||D===ee)continue;var at=1<<ee-D;if(R!==Math.floor(le/at)||Z!==Math.floor(fe/at))continue}else if(D===he.indexMaxZoom||De.numPoints<=he.indexMaxPoints)continue;if(De.source=null,W.length!==0){me>1&&console.time("clipping");var ot,ct,_t,Rt,Yt,Vt,de=.5*he.buffer/he.extent,ir=.5-de,ii=.5+de,pr=1+de;ot=ct=_t=Rt=null,Yt=er(W,ze,R-de,R+ii,0,De.minX,De.maxX,he),Vt=er(W,ze,R+ir,R+pr,0,De.minX,De.maxX,he),W=null,Yt&&(ot=er(Yt,ze,Z-de,Z+ii,1,De.minY,De.maxY,he),ct=er(Yt,ze,Z+ir,Z+pr,1,De.minY,De.maxY,he),Yt=null),Vt&&(_t=er(Vt,ze,Z-de,Z+ii,1,De.minY,De.maxY,he),Rt=er(Vt,ze,Z+ir,Z+pr,1,De.minY,De.maxY,he),Vt=null),me>1&&console.timeEnd("clipping"),pe.push(ot||[],D+1,2*R,2*Z),pe.push(ct||[],D+1,2*R,2*Z+1),pe.push(_t||[],D+1,2*R+1,2*Z),pe.push(Rt||[],D+1,2*R+1,2*Z+1)}}},tn.prototype.getTile=function(W,D,R){var Z=this.options,ee=Z.extent,le=Z.debug;if(W<0||W>24)return null;var fe=1<<W,pe=oo(W,D=(D%fe+fe)%fe,R);if(this.tiles[pe])return Ko(this.tiles[pe],ee);le>1&&console.log("drilling down to z%d-%d-%d",W,D,R);for(var he,me=W,ze=D,Ze=R;!he&&me>0;)me--,ze=Math.floor(ze/2),Ze=Math.floor(Ze/2),he=this.tiles[oo(me,ze,Ze)];return he&&he.source?(le>1&&console.log("found parent tile z%d-%d-%d",me,ze,Ze),le>1&&console.time("drilling down"),this.splitTile(he.source,me,ze,Ze,W,D,R),le>1&&console.timeEnd("drilling down"),this.tiles[pe]?Ko(this.tiles[pe],ee):null):null};class $i extends o.VectorTileWorkerSource{constructor(D,R,Z,ee,le){super(D,R,Z,ee,Qs),le&&(this.loadGeoJSON=le)}loadData(D,R){let Z=D&&D.request,ee=Z&&Z.collectResourceTiming;this.loadGeoJSON(D,(le,fe)=>{if(le||!fe)return R(le);if(typeof fe!="object")return R(new Error(`Input data given to '${D.source}' is not a valid GeoJSON object.`));{oe(fe,!0);try{if(D.filter){let he=o.createExpression(D.filter,{type:"boolean","property-type":"data-driven",overridable:!1,transition:!1});if(he.result==="error")throw new Error(he.value.map(ze=>`${ze.key}: ${ze.message}`).join(", "));let me=fe.features.filter(ze=>he.value.evaluate({zoom:0},ze));fe={type:"FeatureCollection",features:me}}this._geoJSONIndex=D.cluster?new Xr(function({superclusterOptions:he,clusterProperties:me}){if(!me||!he)return he;let ze={},Ze={},De={accumulated:null,zoom:0},nt={properties:null},at=Object.keys(me);for(let ot of at){let[ct,_t]=me[ot],Rt=o.createExpression(_t),Yt=o.createExpression(typeof ct=="string"?[ct,["accumulated"],["get",ot]]:ct);ze[ot]=Rt.value,Ze[ot]=Yt.value}return he.map=ot=>{nt.properties=ot;let ct={};for(let _t of at)ct[_t]=ze[_t].evaluate(De,nt);return ct},he.reduce=(ot,ct)=>{nt.properties=ct;for(let _t of at)De.accumulated=ot[_t],ot[_t]=Ze[_t].evaluate(De,nt)},he}(D)).load(fe.features):function(he,me){return new tn(he,me)}(fe,D.geojsonVtOptions)}catch(he){return R(he)}this.loaded={};let pe={};if(ee){let he=o.getPerformanceMeasurement(Z);he&&(pe.resourceTiming={},pe.resourceTiming[D.source]=JSON.parse(JSON.stringify(he)))}R(null,pe)}})}reloadTile(D,R){let Z=this.loaded;return Z&&Z[D.uid]?super.reloadTile(D,R):this.loadTile(D,R)}loadGeoJSON(D,R){if(D.request)o.getJSON(D.request,R);else{if(typeof D.data!="string")return R(new Error(`Input data given to '${D.source}' is not a valid GeoJSON object.`));try{return R(null,JSON.parse(D.data))}catch{return R(new Error(`Input data given to '${D.source}' is not a valid GeoJSON object.`))}}}getClusterExpansionZoom(D,R){try{R(null,this._geoJSONIndex.getClusterExpansionZoom(D.clusterId))}catch(Z){R(Z)}}getClusterChildren(D,R){try{R(null,this._geoJSONIndex.getChildren(D.clusterId))}catch(Z){R(Z)}}getClusterLeaves(D,R){try{R(null,this._geoJSONIndex.getLeaves(D.clusterId,D.limit,D.offset))}catch(Z){R(Z)}}}class Yo{constructor(D){this.self=D,this.actor=new o.Actor(D,this),this.layerIndexes={},this.availableImages={},this.isSpriteLoaded={},this.projections={},this.defaultProjection=o.getProjection({name:"mercator"}),this.workerSourceTypes={vector:o.VectorTileWorkerSource,geojson:$i},this.workerSources={},this.demWorkerSources={},this.self.registerWorkerSource=(R,Z)=>{if(this.workerSourceTypes[R])throw new Error(`Worker source with name "${R}" already registered.`);this.workerSourceTypes[R]=Z},this.self.registerRTLTextPlugin=R=>{if(o.plugin.isParsed())throw new Error("RTL text plugin already registered.");o.plugin.applyArabicShaping=R.applyArabicShaping,o.plugin.processBidirectionalText=R.processBidirectionalText,o.plugin.processStyledBidirectionalText=R.processStyledBidirectionalText}}clearCaches(D,R,Z){delete this.layerIndexes[D],delete this.availableImages[D],delete this.workerSources[D],delete this.demWorkerSources[D],Z()}checkIfReady(D,R,Z){Z()}setReferrer(D,R){this.referrer=R}spriteLoaded(D,R){this.isSpriteLoaded[D]=R;for(let Z in this.workerSources[D]){let ee=this.workerSources[D][Z];for(let le in ee)ee[le]instanceof o.VectorTileWorkerSource&&(ee[le].isSpriteLoaded=R,ee[le].fire(new o.Event("isSpriteLoaded")))}}setImages(D,R,Z){this.availableImages[D]=R;for(let ee in this.workerSources[D]){let le=this.workerSources[D][ee];for(let fe in le)le[fe].availableImages=R}Z()}enableTerrain(D,R,Z){this.terrain=R,Z()}setProjection(D,R){this.projections[D]=o.getProjection(R)}setLayers(D,R,Z){this.getLayerIndex(D).replace(R),Z()}updateLayers(D,R,Z){this.getLayerIndex(D).update(R.layers,R.removedIds),Z()}loadTile(D,R,Z){let ee=this.enableTerrain?o.extend({enableTerrain:this.terrain},R):R;ee.projection=this.projections[D]||this.defaultProjection,this.getWorkerSource(D,R.type,R.source).loadTile(ee,Z)}loadDEMTile(D,R,Z){let ee=this.enableTerrain?o.extend({buildQuadTree:this.terrain},R):R;this.getDEMWorkerSource(D,R.source).loadTile(ee,Z)}reloadTile(D,R,Z){let ee=this.enableTerrain?o.extend({enableTerrain:this.terrain},R):R;ee.projection=this.projections[D]||this.defaultProjection,this.getWorkerSource(D,R.type,R.source).reloadTile(ee,Z)}abortTile(D,R,Z){this.getWorkerSource(D,R.type,R.source).abortTile(R,Z)}removeTile(D,R,Z){this.getWorkerSource(D,R.type,R.source).removeTile(R,Z)}removeSource(D,R,Z){if(!this.workerSources[D]||!this.workerSources[D][R.type]||!this.workerSources[D][R.type][R.source])return;let ee=this.workerSources[D][R.type][R.source];delete this.workerSources[D][R.type][R.source],ee.removeSource!==void 0?ee.removeSource(R,Z):Z()}loadWorkerSource(D,R,Z){try{this.self.importScripts(R.url),Z()}catch(ee){Z(ee.toString())}}syncRTLPluginState(D,R,Z){try{o.plugin.setState(R);let ee=o.plugin.getPluginURL();if(o.plugin.isLoaded()&&!o.plugin.isParsed()&&ee!=null){this.self.importScripts(ee);let le=o.plugin.isParsed();Z(le?void 0:new Error(`RTL Text Plugin failed to import scripts from ${ee}`),le)}}catch(ee){Z(ee.toString())}}getAvailableImages(D){let R=this.availableImages[D];return R||(R=[]),R}getLayerIndex(D){let R=this.layerIndexes[D];return R||(R=this.layerIndexes[D]=new H),R}getWorkerSource(D,R,Z){return this.workerSources[D]||(this.workerSources[D]={}),this.workerSources[D][R]||(this.workerSources[D][R]={}),this.workerSources[D][R][Z]||(this.workerSources[D][R][Z]=new this.workerSourceTypes[R]({send:(ee,le,fe,pe,he,me)=>{this.actor.send(ee,le,fe,D,he,me)},scheduler:this.actor.scheduler},this.getLayerIndex(D),this.getAvailableImages(D),this.isSpriteLoaded[D])),this.workerSources[D][R][Z]}getDEMWorkerSource(D,R){return this.demWorkerSources[D]||(this.demWorkerSources[D]={}),this.demWorkerSources[D][R]||(this.demWorkerSources[D][R]=new Y),this.demWorkerSources[D][R]}enforceCacheSizeLimit(D,R){o.enforceCacheSizeLimit(R)}getWorkerPerformanceMetrics(D,R,Z){Z(void 0,void 0)}}return typeof WorkerGlobalScope<"u"&&typeof self<"u"&&self instanceof WorkerGlobalScope&&(self.worker=new Yo(self)),Yo}),v(["./shared"],function(o){"use strict";function z(l,t){if(Array.isArray(l)){if(!Array.isArray(t)||l.length!==t.length)return!1;for(let s=0;s<l.length;s++)if(!z(l[s],t[s]))return!1;return!0}if(typeof l=="object"&&l!==null&&t!==null){if(typeof t!="object"||Object.keys(l).length!==Object.keys(t).length)return!1;for(let s in l)if(!z(l[s],t[s]))return!1;return!0}return l===t}var B=H;function H(l){return!function(t){return typeof window>"u"||typeof document>"u"?"not a browser":Array.prototype&&Array.prototype.every&&Array.prototype.filter&&Array.prototype.forEach&&Array.prototype.indexOf&&Array.prototype.lastIndexOf&&Array.prototype.map&&Array.prototype.some&&Array.prototype.reduce&&Array.prototype.reduceRight&&Array.isArray?Function.prototype&&Function.prototype.bind?Object.keys&&Object.create&&Object.getPrototypeOf&&Object.getOwnPropertyNames&&Object.isSealed&&Object.isFrozen&&Object.isExtensible&&Object.getOwnPropertyDescriptor&&Object.defineProperty&&Object.defineProperties&&Object.seal&&Object.freeze&&Object.preventExtensions?"JSON"in window&&"parse"in JSON&&"stringify"in JSON?function(){if(!("Worker"in window&&"Blob"in window&&"URL"in window))return!1;var p,f,_=new Blob([""],{type:"text/javascript"}),b=URL.createObjectURL(_);try{f=new Worker(b),p=!0}catch{p=!1}return f&&f.terminate(),URL.revokeObjectURL(b),p}()?"Uint8ClampedArray"in window?ArrayBuffer.isView?function(){var p=document.createElement("canvas");p.width=p.height=1;var f=p.getContext("2d");if(!f)return!1;var _=f.getImageData(0,0,1,1);return _&&_.width===p.width}()?(Y[s=t&&t.failIfMajorPerformanceCaveat]===void 0&&(Y[s]=function(p){var f,_=function(b){var w=document.createElement("canvas"),T=Object.create(H.webGLContextAttributes);return T.failIfMajorPerformanceCaveat=b,w.getContext("webgl",T)||w.getContext("experimental-webgl",T)}(p);if(!_)return!1;try{f=_.createShader(_.VERTEX_SHADER)}catch{return!1}return!(!f||_.isContextLost())&&(_.shaderSource(f,"void main() {}"),_.compileShader(f),_.getShaderParameter(f,_.COMPILE_STATUS)===!0)}(s)),Y[s]?document.documentMode?"insufficient ECMAScript 6 support":void 0:"insufficient WebGL support"):"insufficient Canvas/getImageData support":"insufficient ArrayBuffer support":"insufficient Uint8ClampedArray support":"insufficient worker support":"insufficient JSON support":"insufficient Object support":"insufficient Function support":"insufficent Array support";var s}(l)}var Y={};function oe(l,t,s){let p=o.window.document.createElement(l);return t!==void 0&&(p.className=t),s&&s.appendChild(p),p}function Ee(l,t,s){let p=o.window.document.createElementNS("http://www.w3.org/2000/svg",l);for(let f of Object.keys(t))p.setAttributeNS(null,f,t[f]);return s&&s.appendChild(p),p}H.webGLContextAttributes={antialias:!1,alpha:!0,stencil:!0,depth:!0};let Ae=o.window.document&&o.window.document.documentElement.style,Ce=Ae&&Ae.userSelect!==void 0?"userSelect":"WebkitUserSelect",Ge;function Ke(){Ae&&Ce&&(Ge=Ae[Ce],Ae[Ce]="none")}function Ye(){Ae&&Ce&&(Ae[Ce]=Ge)}function ut(l){l.preventDefault(),l.stopPropagation(),o.window.removeEventListener("click",ut,!0)}function wt(){o.window.addEventListener("click",ut,!0),o.window.setTimeout(()=>{o.window.removeEventListener("click",ut,!0)},0)}function Je(l,t){let s=l.getBoundingClientRect();return Ht(l,s,t)}function Et(l,t){let s=l.getBoundingClientRect(),p=[];for(let f=0;f<t.length;f++)p.push(Ht(l,s,t[f]));return p}function It(l){return o.window.InstallTrigger!==void 0&&l.button===2&&l.ctrlKey&&o.window.navigator.platform.toUpperCase().indexOf("MAC")>=0?0:l.button}function Ht(l,t,s){let p=l.offsetWidth===t.width?1:l.offsetWidth/t.width;return new o.pointGeometry((s.clientX-t.left)*p,(s.clientY-t.top)*p)}function li(l,t){var s=t[0],p=t[1],f=t[2],_=t[3],b=s*_-f*p;return b?(l[0]=_*(b=1/b),l[1]=-p*b,l[2]=-f*b,l[3]=s*b,l):null}function Bt(l){let{userImage:t}=l;return!!(t&&t.render&&t.render())&&(l.data.replace(new Uint8Array(t.data.buffer)),!0)}class Ci extends o.Evented{constructor(){super(),this.images={},this.updatedImages={},this.callbackDispatchedThisFrame={},this.loaded=!1,this.requestors=[],this.patterns={},this.atlasImage=new o.RGBAImage({width:1,height:1}),this.dirty=!0}isLoaded(){return this.loaded}setLoaded(t){if(this.loaded!==t&&(this.loaded=t,t)){for(let{ids:s,callback:p}of this.requestors)this._notify(s,p);this.requestors=[]}}hasImage(t){return!!this.getImage(t)}getImage(t){return this.images[t]}addImage(t,s){this._validate(t,s)&&(this.images[t]=s)}_validate(t,s){let p=!0;return this._validateStretch(s.stretchX,s.data&&s.data.width)||(this.fire(new o.ErrorEvent(new Error(`Image "${t}" has invalid "stretchX" value`))),p=!1),this._validateStretch(s.stretchY,s.data&&s.data.height)||(this.fire(new o.ErrorEvent(new Error(`Image "${t}" has invalid "stretchY" value`))),p=!1),this._validateContent(s.content,s)||(this.fire(new o.ErrorEvent(new Error(`Image "${t}" has invalid "content" value`))),p=!1),p}_validateStretch(t,s){if(!t)return!0;let p=0;for(let f of t){if(f[0]<p||f[1]<f[0]||s<f[1])return!1;p=f[1]}return!0}_validateContent(t,s){return!(t&&(t.length!==4||t[0]<0||s.data.width<t[0]||t[1]<0||s.data.height<t[1]||t[2]<0||s.data.width<t[2]||t[3]<0||s.data.height<t[3]||t[2]<t[0]||t[3]<t[1]))}updateImage(t,s){s.version=this.images[t].version+1,this.images[t]=s,this.updatedImages[t]=!0}removeImage(t){let s=this.images[t];delete this.images[t],delete this.patterns[t],s.userImage&&s.userImage.onRemove&&s.userImage.onRemove()}listImages(){return Object.keys(this.images)}getImages(t,s){let p=!0;if(!this.isLoaded())for(let f of t)this.images[f]||(p=!1);this.isLoaded()||p?this._notify(t,s):this.requestors.push({ids:t,callback:s})}_notify(t,s){let p={};for(let f of t){this.images[f]||this.fire(new o.Event("styleimagemissing",{id:f}));let _=this.images[f];_?p[f]={data:_.data.clone(),pixelRatio:_.pixelRatio,sdf:_.sdf,version:_.version,stretchX:_.stretchX,stretchY:_.stretchY,content:_.content,hasRenderCallback:Boolean(_.userImage&&_.userImage.render)}:o.warnOnce(`Image "${f}" could not be loaded. Please make sure you have added the image with map.addImage() or a "sprite" property in your style. You can provide missing images by listening for the "styleimagemissing" map event.`)}s(null,p)}getPixelSize(){let{width:t,height:s}=this.atlasImage;return{width:t,height:s}}getPattern(t){let s=this.patterns[t],p=this.getImage(t);if(!p)return null;if(s&&s.position.version===p.version)return s.position;if(s)s.position.version=p.version;else{let f={w:p.data.width+2,h:p.data.height+2,x:0,y:0},_=new o.ImagePosition(f,p);this.patterns[t]={bin:f,position:_}}return this._updatePatternAtlas(),this.patterns[t].position}bind(t){let s=t.gl;this.atlasTexture?this.dirty&&(this.atlasTexture.update(this.atlasImage),this.dirty=!1):this.atlasTexture=new o.Texture(t,this.atlasImage,s.RGBA),this.atlasTexture.bind(s.LINEAR,s.CLAMP_TO_EDGE)}_updatePatternAtlas(){let t=[];for(let _ in this.patterns)t.push(this.patterns[_].bin);let{w:s,h:p}=o.potpack(t),f=this.atlasImage;f.resize({width:s||1,height:p||1});for(let _ in this.patterns){let{bin:b}=this.patterns[_],w=b.x+1,T=b.y+1,A=this.images[_].data,I=A.width,L=A.height;o.RGBAImage.copy(A,f,{x:0,y:0},{x:w,y:T},{width:I,height:L}),o.RGBAImage.copy(A,f,{x:0,y:L-1},{x:w,y:T-1},{width:I,height:1}),o.RGBAImage.copy(A,f,{x:0,y:0},{x:w,y:T+L},{width:I,height:1}),o.RGBAImage.copy(A,f,{x:I-1,y:0},{x:w-1,y:T},{width:1,height:L}),o.RGBAImage.copy(A,f,{x:0,y:0},{x:w+I,y:T},{width:1,height:L})}this.dirty=!0}beginFrame(){this.callbackDispatchedThisFrame={}}dispatchRenderCallbacks(t){for(let s of t){if(this.callbackDispatchedThisFrame[s])continue;this.callbackDispatchedThisFrame[s]=!0;let p=this.images[s];Bt(p)&&this.updateImage(s,p)}}}let ki=new o.Properties({anchor:new o.DataConstantProperty(o.spec.light.anchor),position:new class{constructor(){this.specification=o.spec.light.position}possiblyEvaluate(l,t){return function([s,p,f]){let _=o.degToRad(p+90),b=o.degToRad(f);return{x:s*Math.cos(_)*Math.sin(b),y:s*Math.sin(_)*Math.sin(b),z:s*Math.cos(b),azimuthal:p,polar:f}}(l.expression.evaluate(t))}interpolate(l,t,s){return{x:o.number(l.x,t.x,s),y:o.number(l.y,t.y,s),z:o.number(l.z,t.z,s),azimuthal:o.number(l.azimuthal,t.azimuthal,s),polar:o.number(l.polar,t.polar,s)}}},color:new o.DataConstantProperty(o.spec.light.color),intensity:new o.DataConstantProperty(o.spec.light.intensity)}),ar="-transition";class lr extends o.Evented{constructor(t){super(),this._transitionable=new o.Transitionable(ki),this.setLight(t),this._transitioning=this._transitionable.untransitioned()}getLight(){return this._transitionable.serialize()}setLight(t,s={}){if(!this._validate(o.validateLight,t,s))for(let p in t){let f=t[p];o.endsWith(p,ar)?this._transitionable.setTransition(p.slice(0,-ar.length),f):this._transitionable.setValue(p,f)}}updateTransitions(t){this._transitioning=this._transitionable.transitioned(t,this._transitioning)}hasTransition(){return this._transitioning.hasTransition()}recalculate(t){this.properties=this._transitioning.possiblyEvaluate(t)}_validate(t,s,p){return(!p||p.validate!==!1)&&o.emitValidationErrors(this,t.call(o.validateStyle,o.extend({value:s,style:{glyphs:!0,sprite:!0},styleSpec:o.spec})))}}let Ji=new o.Properties({source:new o.DataConstantProperty(o.spec.terrain.source),exaggeration:new o.DataConstantProperty(o.spec.terrain.exaggeration)}),vi="-transition";class cr extends o.Evented{constructor(t,s){super(),this._transitionable=new o.Transitionable(Ji),this.set(t),this._transitioning=this._transitionable.untransitioned(),this.drapeRenderMode=s}get(){return this._transitionable.serialize()}set(t){for(let s in t){let p=t[s];o.endsWith(s,vi)?this._transitionable.setTransition(s.slice(0,-vi.length),p):this._transitionable.setValue(s,p)}}updateTransitions(t){this._transitioning=this._transitionable.transitioned(t,this._transitioning)}hasTransition(){return this._transitioning.hasTransition()}recalculate(t){this.properties=this._transitioning.possiblyEvaluate(t)}}function Ri(l,t,s,p){let f=o.smoothstep(45,65,s),[_,b]=Si(l,p),w=o.length(t),T=1-Math.min(1,Math.exp((w-_)/(b-_)*-6));return T*=T*T,T=Math.min(1,1.00747*T),T*f*l.alpha}function Si(l,t){let s=.5/Math.tan(.5*t);return[l.range[0]+s,l.range[1]+s]}let hr=new o.Properties({range:new o.DataConstantProperty(o.spec.fog.range),color:new o.DataConstantProperty(o.spec.fog.color),"high-color":new o.DataConstantProperty(o.spec.fog["high-color"]),"space-color":new o.DataConstantProperty(o.spec.fog["space-color"]),"horizon-blend":new o.DataConstantProperty(o.spec.fog["horizon-blend"]),"star-intensity":new o.DataConstantProperty(o.spec.fog["star-intensity"])}),Go="-transition";class ci extends o.Evented{constructor(t,s){super(),this._transitionable=new o.Transitionable(hr),this.set(t),this._transitioning=this._transitionable.untransitioned(),this._transform=s}get state(){let t=this._transform,s=t.projection.name==="globe",p=o.globeToMercatorTransition(t.zoom),f=this.properties.get("range"),_=[.5,3];return{range:s?[o.number(_[0],f[0],p),o.number(_[1],f[1],p)]:f,horizonBlend:this.properties.get("horizon-blend"),alpha:this.properties.get("color").a}}get(){return this._transitionable.serialize()}set(t,s={}){if(!this._validate(o.validateFog,t,s)){for(let p of Object.keys(o.spec.fog))t&&t[p]===void 0&&(t[p]=o.spec.fog[p].default);for(let p in t){let f=t[p];o.endsWith(p,Go)?this._transitionable.setTransition(p.slice(0,-Go.length),f):this._transitionable.setValue(p,f)}}}getOpacity(t){if(!this._transform.projection.supportsFog)return 0;let s=this.properties&&this.properties.get("color")||1;return(this._transform.projection.name==="globe"?1:o.smoothstep(45,65,t))*s.a}getOpacityAtLatLng(t,s){return this._transform.projection.supportsFog?function(p,f,_){let b=o.MercatorCoordinate.fromLngLat(f),w=_.elevation?_.elevation.getAtPointOrZero(b):0,T=[b.x,b.y,w];return o.transformMat4(T,T,_.mercatorFogMatrix),Ri(p,T,_.pitch,_._fov)}(this.state,t,s):0}getFovAdjustedRange(t){return this._transform.projection.supportsFog?Si(this.state,t):[0,1]}updateTransitions(t){this._transitioning=this._transitionable.transitioned(t,this._transitioning)}hasTransition(){return this._transitioning.hasTransition()}recalculate(t){this.properties=this._transitioning.possiblyEvaluate(t)}_validate(t,s,p){return(!p||p.validate!==!1)&&o.emitValidationErrors(this,t.call(o.validateStyle,o.extend({value:s,style:{glyphs:!0,sprite:!0},styleSpec:o.spec})))}}class Fi{constructor(t,s){this.workerPool=t,this.actors=[],this.currentActor=0,this.id=o.uniqueId();let p=this.workerPool.acquire(this.id);for(let f=0;f<p.length;f++){let _=new Fi.Actor(p[f],s,this.id);_.name=`Worker ${f}`,this.actors.push(_)}this.ready=!1,this.broadcast("checkIfReady",null,()=>{this.ready=!0})}broadcast(t,s,p){o.asyncAll(this.actors,(f,_)=>{f.send(t,s,_)},p=p||function(){})}getActor(){return this.currentActor=(this.currentActor+1)%this.actors.length,this.actors[this.currentActor]}remove(){this.actors.forEach(t=>{t.remove()}),this.actors=[],this.workerPool.release(this.id)}}function Wr(l,t,s){return t*(o.EXTENT/(l.tileSize*Math.pow(2,s-l.tileID.overscaledZ)))}Fi.Actor=o.Actor;class Qi{constructor(t,s,p,f){this.screenBounds=t,this.cameraPoint=s,this._screenRaycastCache={},this._cameraRaycastCache={},this.isAboveHorizon=p,this.screenGeometry=this.bufferedScreenGeometry(0),this.screenGeometryMercator=this._bufferedScreenMercator(0,f)}static createFromScreenPoints(t,s){let p,f;if(t instanceof o.pointGeometry||typeof t[0]=="number"){let _=o.pointGeometry.convert(t);p=[o.pointGeometry.convert(t)],f=s.isPointAboveHorizon(_)}else{let _=o.pointGeometry.convert(t[0]),b=o.pointGeometry.convert(t[1]);p=[_,b],f=o.polygonizeBounds(_,b).every(w=>s.isPointAboveHorizon(w))}return new Qi(p,s.getCameraPoint(),f,s)}isPointQuery(){return this.screenBounds.length===1}bufferedScreenGeometry(t){return o.polygonizeBounds(this.screenBounds[0],this.screenBounds.length===1?this.screenBounds[0]:this.screenBounds[1],t)}bufferedCameraGeometry(t){let s=this.screenBounds[0],p=this.screenBounds.length===1?this.screenBounds[0].add(new o.pointGeometry(1,1)):this.screenBounds[1],f=o.polygonizeBounds(s,p,0,!1);return this.cameraPoint.y>p.y&&(this.cameraPoint.x>s.x&&this.cameraPoint.x<p.x?f.splice(3,0,this.cameraPoint):this.cameraPoint.x>=p.x?f[2]=this.cameraPoint:this.cameraPoint.x<=s.x&&(f[3]=this.cameraPoint)),o.bufferConvexPolygon(f,t)}bufferedCameraGeometryGlobe(t){let s=this.screenBounds[0],p=this.screenBounds.length===1?this.screenBounds[0].add(new o.pointGeometry(1,1)):this.screenBounds[1],f=o.polygonizeBounds(s,p,t),_=this.cameraPoint.clone();switch(3*((_.y>s.y)+(_.y>p.y))+((_.x>s.x)+(_.x>p.x))){case 0:f[0]=_,f[4]=_.clone();break;case 1:f.splice(1,0,_);break;case 2:f[1]=_;break;case 3:f.splice(4,0,_);break;case 5:f.splice(2,0,_);break;case 6:f[3]=_;break;case 7:f.splice(3,0,_);break;case 8:f[2]=_}return f}containsTile(t,s,p,f=0){let _=t.queryPadding/s._projectionScaler+1,b=p?this._bufferedCameraMercator(_,s):this._bufferedScreenMercator(_,s),w=t.tileID.wrap+(b.unwrapped?f:0),T=b.polygon.map(J=>o.getTilePoint(t.tileTransform,J,w));if(!o.polygonIntersectsBox(T,0,0,o.EXTENT,o.EXTENT))return;w=t.tileID.wrap+(this.screenGeometryMercator.unwrapped?f:0);let A=this.screenGeometryMercator.polygon.map(J=>o.getTileVec3(t.tileTransform,J,w)),I=A.map(J=>new o.pointGeometry(J[0],J[1])),L=s.getFreeCameraOptions().position||new o.MercatorCoordinate(0,0,0),O=o.getTileVec3(t.tileTransform,L,w),V=A.map(J=>{let U=o.sub(J,J,O);return o.normalize(U,U),new o.Ray(O,U)}),N=Wr(t,1,s.zoom)*s._projectionScaler;return{queryGeometry:this,tilespaceGeometry:I,tilespaceRays:V,bufferedTilespaceGeometry:T,bufferedTilespaceBounds:(j=o.getBounds(T),j.min.x=o.clamp(j.min.x,0,o.EXTENT),j.min.y=o.clamp(j.min.y,0,o.EXTENT),j.max.x=o.clamp(j.max.x,0,o.EXTENT),j.max.y=o.clamp(j.max.y,0,o.EXTENT),j),tile:t,tileID:t.tileID,pixelToTileUnitsFactor:N};var j}_bufferedScreenMercator(t,s){let p=io(t);if(this._screenRaycastCache[p])return this._screenRaycastCache[p];{let f;return f=s.projection.name==="globe"?this._projectAndResample(this.bufferedScreenGeometry(t),s):{polygon:this.bufferedScreenGeometry(t).map(_=>s.pointCoordinate3D(_)),unwrapped:!0},this._screenRaycastCache[p]=f,f}}_bufferedCameraMercator(t,s){let p=io(t);if(this._cameraRaycastCache[p])return this._cameraRaycastCache[p];{let f;return f=s.projection.name==="globe"?this._projectAndResample(this.bufferedCameraGeometryGlobe(t),s):{polygon:this.bufferedCameraGeometry(t).map(_=>s.pointCoordinate3D(_)),unwrapped:!0},this._cameraRaycastCache[p]=f,f}}_projectAndResample(t,s){let p=function(_,b){let w=o.multiply([],b.pixelMatrix,b.globeMatrix),T=[0,-o.GLOBE_RADIUS,0,1],A=[0,o.GLOBE_RADIUS,0,1],I=[0,0,0,1];o.transformMat4$1(T,T,w),o.transformMat4$1(A,A,w),o.transformMat4$1(I,I,w);let L=new o.pointGeometry(T[0]/T[3],T[1]/T[3]),O=new o.pointGeometry(A[0]/A[3],A[1]/A[3]),V=o.polygonContainsPoint(_,L)&&T[3]<I[3],N=o.polygonContainsPoint(_,O)&&A[3]<I[3];if(!V&&!N)return null;let j=function(ae,ye,be){for(let xe=1;xe<ae.length;xe++){let _e=Xr(ye.pointCoordinate3D(ae[xe-1]).x),te=Xr(ye.pointCoordinate3D(ae[xe]).x);if(be<0){if(_e<te)return{idx:xe,t:-_e/(te-1-_e)}}else if(te<_e)return{idx:xe,t:(1-_e)/(te+1-_e)}}return null}(_,b,V?-1:1);if(!j)return null;let{idx:J,t:U}=j,$=J>1?Hr(_.slice(0,J),b):[],q=J<_.length?Hr(_.slice(J),b):[];$=$.map(ae=>new o.pointGeometry(Xr(ae.x),ae.y)),q=q.map(ae=>new o.pointGeometry(Xr(ae.x),ae.y));let ie=[...$];ie.length===0&&ie.push(q[q.length-1]);let K=o.number(ie[ie.length-1].y,(q.length===0?$[0]:q[0]).y,U),Q;return Q=V?[new o.pointGeometry(0,K),new o.pointGeometry(0,0),new o.pointGeometry(1,0),new o.pointGeometry(1,K)]:[new o.pointGeometry(1,K),new o.pointGeometry(1,1),new o.pointGeometry(0,1),new o.pointGeometry(0,K)],ie.push(...Q),q.length===0?ie.push($[0]):ie.push(...q),{polygon:ie.map(ae=>new o.MercatorCoordinate(ae.x,ae.y)),unwrapped:!1}}(t,s);if(p)return p;let f=function(_,b){let w=!1,T=-1/0,A=0;for(let L=0;L<_.length-1;L++)_[L].x>T&&(T=_[L].x,A=L);for(let L=0;L<_.length-1;L++){let O=(A+L)%(_.length-1),V=_[O],N=_[O+1];Math.abs(V.x-N.x)>.5&&(V.x<N.x?(V.x+=1,O===0&&(_[_.length-1].x+=1)):(N.x+=1,O+1===_.length-1&&(_[0].x+=1)),w=!0)}let I=o.mercatorXfromLng(b.center.lng);return w&&I<Math.abs(I-1)&&_.forEach(L=>{L.x-=1}),{polygon:_,unwrapped:w}}(Hr(t,s).map(_=>new o.pointGeometry(Xr(_.x),_.y)),s);return{polygon:f.polygon.map(_=>new o.MercatorCoordinate(_.x,_.y)),unwrapped:f.unwrapped}}}function Hr(l,t){return o.resample(l,s=>{let p=t.pointCoordinate3D(s);s.x=p.x,s.y=p.y},1/256)}function Xr(l){return l<0?1+l%1:l%1}function io(l){return 100*l|0}function $o(l,t,s,p,f){let _=function(b,w){if(b)return f(b);if(w){let T=o.pick(o.extend(w,l),["tiles","minzoom","maxzoom","attribution","mapbox_logo","bounds","scheme","tileSize","encoding"]);w.vector_layers&&(T.vectorLayers=w.vector_layers,T.vectorLayerIds=T.vectorLayers.map(A=>A.id)),w.language_options&&(T.languageOptions=w.language_options),w.language&&w.language[w.id]&&(T.language=w.language[w.id]),w.worldview_options&&(T.worldviewOptions=w.worldview_options),w.worldview?T.worldview=w.worldview[w.id]:w.worldview_default&&(T.worldview=w.worldview_default),T.tiles=t.canonicalizeTileset(T,l.url),f(null,T)}};return l.url?o.getJSON(t.transformRequest(t.normalizeSourceURL(l.url,null,s,p),o.ResourceType.Source),_):o.exported.frame(()=>_(null,l))}class Kr{constructor(t,s,p){this.bounds=o.LngLatBounds.convert(this.validateBounds(t)),this.minzoom=s||0,this.maxzoom=p||24}validateBounds(t){return Array.isArray(t)&&t.length===4?[Math.max(-180,t[0]),Math.max(-90,t[1]),Math.min(180,t[2]),Math.min(90,t[3])]:[-180,-90,180,90]}contains(t){let s=Math.pow(2,t.z),p=Math.floor(o.mercatorXfromLng(this.bounds.getWest())*s),f=Math.floor(o.mercatorYfromLat(this.bounds.getNorth())*s),_=Math.ceil(o.mercatorXfromLng(this.bounds.getEast())*s),b=Math.ceil(o.mercatorYfromLat(this.bounds.getSouth())*s);return t.x>=p&&t.x<_&&t.y>=f&&t.y<b}}class Hs{constructor(t,s,p){this.context=t;let f=t.gl;this.buffer=f.createBuffer(),this.dynamicDraw=Boolean(p),this.context.unbindVAO(),t.bindElementBuffer.set(this.buffer),f.bufferData(f.ELEMENT_ARRAY_BUFFER,s.arrayBuffer,this.dynamicDraw?f.DYNAMIC_DRAW:f.STATIC_DRAW),this.dynamicDraw||s.destroy()}bind(){this.context.bindElementBuffer.set(this.buffer)}updateData(t){let s=this.context.gl;this.context.unbindVAO(),this.bind(),s.bufferSubData(s.ELEMENT_ARRAY_BUFFER,0,t.arrayBuffer)}destroy(){this.buffer&&(this.context.gl.deleteBuffer(this.buffer),delete this.buffer)}}let An={Int8:"BYTE",Uint8:"UNSIGNED_BYTE",Int16:"SHORT",Uint16:"UNSIGNED_SHORT",Int32:"INT",Uint32:"UNSIGNED_INT",Float32:"FLOAT"};class Mn{constructor(t,s,p,f){this.length=s.length,this.attributes=p,this.itemSize=s.bytesPerElement,this.dynamicDraw=f,this.context=t;let _=t.gl;this.buffer=_.createBuffer(),t.bindVertexBuffer.set(this.buffer),_.bufferData(_.ARRAY_BUFFER,s.arrayBuffer,this.dynamicDraw?_.DYNAMIC_DRAW:_.STATIC_DRAW),this.dynamicDraw||s.destroy()}bind(){this.context.bindVertexBuffer.set(this.buffer)}updateData(t){let s=this.context.gl;this.bind(),s.bufferSubData(s.ARRAY_BUFFER,0,t.arrayBuffer)}enableAttributes(t,s){for(let p=0;p<this.attributes.length;p++){let f=s.attributes[this.attributes[p].name];f!==void 0&&t.enableVertexAttribArray(f)}}setVertexAttribPointers(t,s,p){for(let f=0;f<this.attributes.length;f++){let _=this.attributes[f],b=s.attributes[_.name];b!==void 0&&t.vertexAttribPointer(b,_.components,t[An[_.type]],!1,this.itemSize,_.offset+this.itemSize*(p||0))}}destroy(){this.buffer&&(this.context.gl.deleteBuffer(this.buffer),delete this.buffer)}}class zt{constructor(t){this.gl=t.gl,this.default=this.getDefault(),this.current=this.default,this.dirty=!1}get(){return this.current}set(t){}getDefault(){return this.default}setDefault(){this.set(this.default)}}class Yr extends zt{getDefault(){return o.Color.transparent}set(t){let s=this.current;(t.r!==s.r||t.g!==s.g||t.b!==s.b||t.a!==s.a||this.dirty)&&(this.gl.clearColor(t.r,t.g,t.b,t.a),this.current=t,this.dirty=!1)}}class In extends zt{getDefault(){return 1}set(t){(t!==this.current||this.dirty)&&(this.gl.clearDepth(t),this.current=t,this.dirty=!1)}}class Br extends zt{getDefault(){return 0}set(t){(t!==this.current||this.dirty)&&(this.gl.clearStencil(t),this.current=t,this.dirty=!1)}}class ur extends zt{getDefault(){return[!0,!0,!0,!0]}set(t){let s=this.current;(t[0]!==s[0]||t[1]!==s[1]||t[2]!==s[2]||t[3]!==s[3]||this.dirty)&&(this.gl.colorMask(t[0],t[1],t[2],t[3]),this.current=t,this.dirty=!1)}}class ro extends zt{getDefault(){return!0}set(t){(t!==this.current||this.dirty)&&(this.gl.depthMask(t),this.current=t,this.dirty=!1)}}class At extends zt{getDefault(){return 255}set(t){(t!==this.current||this.dirty)&&(this.gl.stencilMask(t),this.current=t,this.dirty=!1)}}class dn extends zt{getDefault(){return{func:this.gl.ALWAYS,ref:0,mask:255}}set(t){let s=this.current;(t.func!==s.func||t.ref!==s.ref||t.mask!==s.mask||this.dirty)&&(this.gl.stencilFunc(t.func,t.ref,t.mask),this.current=t,this.dirty=!1)}}class Jr extends zt{getDefault(){let t=this.gl;return[t.KEEP,t.KEEP,t.KEEP]}set(t){let s=this.current;(t[0]!==s[0]||t[1]!==s[1]||t[2]!==s[2]||this.dirty)&&(this.gl.stencilOp(t[0],t[1],t[2]),this.current=t,this.dirty=!1)}}class Qr extends zt{getDefault(){return!1}set(t){if(t===this.current&&!this.dirty)return;let s=this.gl;t?s.enable(s.STENCIL_TEST):s.disable(s.STENCIL_TEST),this.current=t,this.dirty=!1}}class zn extends zt{getDefault(){return[0,1]}set(t){let s=this.current;(t[0]!==s[0]||t[1]!==s[1]||this.dirty)&&(this.gl.depthRange(t[0],t[1]),this.current=t,this.dirty=!1)}}class no extends zt{getDefault(){return!1}set(t){if(t===this.current&&!this.dirty)return;let s=this.gl;t?s.enable(s.DEPTH_TEST):s.disable(s.DEPTH_TEST),this.current=t,this.dirty=!1}}class qo extends zt{getDefault(){return this.gl.LESS}set(t){(t!==this.current||this.dirty)&&(this.gl.depthFunc(t),this.current=t,this.dirty=!1)}}class Zo extends zt{getDefault(){return!1}set(t){if(t===this.current&&!this.dirty)return;let s=this.gl;t?s.enable(s.BLEND):s.disable(s.BLEND),this.current=t,this.dirty=!1}}class er extends zt{getDefault(){let t=this.gl;return[t.ONE,t.ZERO]}set(t){let s=this.current;(t[0]!==s[0]||t[1]!==s[1]||this.dirty)&&(this.gl.blendFunc(t[0],t[1]),this.current=t,this.dirty=!1)}}class Rr extends zt{getDefault(){return o.Color.transparent}set(t){let s=this.current;(t.r!==s.r||t.g!==s.g||t.b!==s.b||t.a!==s.a||this.dirty)&&(this.gl.blendColor(t.r,t.g,t.b,t.a),this.current=t,this.dirty=!1)}}class Pn extends zt{getDefault(){return this.gl.FUNC_ADD}set(t){(t!==this.current||this.dirty)&&(this.gl.blendEquation(t),this.current=t,this.dirty=!1)}}class Xs extends zt{getDefault(){return!1}set(t){if(t===this.current&&!this.dirty)return;let s=this.gl;t?s.enable(s.CULL_FACE):s.disable(s.CULL_FACE),this.current=t,this.dirty=!1}}class tr extends zt{getDefault(){return this.gl.BACK}set(t){(t!==this.current||this.dirty)&&(this.gl.cullFace(t),this.current=t,this.dirty=!1)}}class en extends zt{getDefault(){return this.gl.CCW}set(t){(t!==this.current||this.dirty)&&(this.gl.frontFace(t),this.current=t,this.dirty=!1)}}class Ks extends zt{getDefault(){return null}set(t){(t!==this.current||this.dirty)&&(this.gl.useProgram(t),this.current=t,this.dirty=!1)}}class Wo extends zt{getDefault(){return this.gl.TEXTURE0}set(t){(t!==this.current||this.dirty)&&(this.gl.activeTexture(t),this.current=t,this.dirty=!1)}}class Ho extends zt{getDefault(){let t=this.gl;return[0,0,t.drawingBufferWidth,t.drawingBufferHeight]}set(t){let s=this.current;(t[0]!==s[0]||t[1]!==s[1]||t[2]!==s[2]||t[3]!==s[3]||this.dirty)&&(this.gl.viewport(t[0],t[1],t[2],t[3]),this.current=t,this.dirty=!1)}}class Xo extends zt{getDefault(){return null}set(t){if(t===this.current&&!this.dirty)return;let s=this.gl;s.bindFramebuffer(s.FRAMEBUFFER,t),this.current=t,this.dirty=!1}}class Ko extends zt{getDefault(){return null}set(t){if(t===this.current&&!this.dirty)return;let s=this.gl;s.bindRenderbuffer(s.RENDERBUFFER,t),this.current=t,this.dirty=!1}}class Ys extends zt{getDefault(){return null}set(t){if(t===this.current&&!this.dirty)return;let s=this.gl;s.bindTexture(s.TEXTURE_2D,t),this.current=t,this.dirty=!1}}class Js extends zt{getDefault(){return null}set(t){if(t===this.current&&!this.dirty)return;let s=this.gl;s.bindBuffer(s.ARRAY_BUFFER,t),this.current=t,this.dirty=!1}}class ll extends zt{getDefault(){return null}set(t){let s=this.gl;s.bindBuffer(s.ELEMENT_ARRAY_BUFFER,t),this.current=t,this.dirty=!1}}class fn extends zt{constructor(t){super(t),this.vao=t.extVertexArrayObject}getDefault(){return null}set(t){this.vao&&(t!==this.current||this.dirty)&&(this.vao.bindVertexArrayOES(t),this.current=t,this.dirty=!1)}}class tn extends zt{getDefault(){return 4}set(t){if(t===this.current&&!this.dirty)return;let s=this.gl;s.pixelStorei(s.UNPACK_ALIGNMENT,t),this.current=t,this.dirty=!1}}class oo extends zt{getDefault(){return!1}set(t){if(t===this.current&&!this.dirty)return;let s=this.gl;s.pixelStorei(s.UNPACK_PREMULTIPLY_ALPHA_WEBGL,t),this.current=t,this.dirty=!1}}class Qs extends zt{getDefault(){return!1}set(t){if(t===this.current&&!this.dirty)return;let s=this.gl;s.pixelStorei(s.UNPACK_FLIP_Y_WEBGL,t),this.current=t,this.dirty=!1}}class $i extends zt{constructor(t,s){super(t),this.context=t,this.parent=s}getDefault(){return null}}class Yo extends $i{setDirty(){this.dirty=!0}set(t){if(t===this.current&&!this.dirty)return;this.context.bindFramebuffer.set(this.parent);let s=this.gl;s.framebufferTexture2D(s.FRAMEBUFFER,s.COLOR_ATTACHMENT0,s.TEXTURE_2D,t,0),this.current=t,this.dirty=!1}}class W extends $i{attachment(){return this.gl.DEPTH_ATTACHMENT}set(t){if(t===this.current&&!this.dirty)return;this.context.bindFramebuffer.set(this.parent);let s=this.gl;s.framebufferRenderbuffer(s.FRAMEBUFFER,this.attachment(),s.RENDERBUFFER,t),this.current=t,this.dirty=!1}}class D extends W{attachment(){return this.gl.DEPTH_STENCIL_ATTACHMENT}}class R{constructor(t,s,p,f){this.context=t,this.width=s,this.height=p;let _=this.framebuffer=t.gl.createFramebuffer();this.colorAttachment=new Yo(t,_),f&&(this.depthAttachment=new W(t,_))}destroy(){let t=this.context.gl,s=this.colorAttachment.get();if(s&&t.deleteTexture(s),this.depthAttachment){let p=this.depthAttachment.get();p&&t.deleteRenderbuffer(p)}t.deleteFramebuffer(this.framebuffer)}}class Z{constructor(t){this.gl=t,this.extVertexArrayObject=this.gl.getExtension("OES_vertex_array_object"),this.clearColor=new Yr(this),this.clearDepth=new In(this),this.clearStencil=new Br(this),this.colorMask=new ur(this),this.depthMask=new ro(this),this.stencilMask=new At(this),this.stencilFunc=new dn(this),this.stencilOp=new Jr(this),this.stencilTest=new Qr(this),this.depthRange=new zn(this),this.depthTest=new no(this),this.depthFunc=new qo(this),this.blend=new Zo(this),this.blendFunc=new er(this),this.blendColor=new Rr(this),this.blendEquation=new Pn(this),this.cullFace=new Xs(this),this.cullFaceSide=new tr(this),this.frontFace=new en(this),this.program=new Ks(this),this.activeTexture=new Wo(this),this.viewport=new Ho(this),this.bindFramebuffer=new Xo(this),this.bindRenderbuffer=new Ko(this),this.bindTexture=new Ys(this),this.bindVertexBuffer=new Js(this),this.bindElementBuffer=new ll(this),this.bindVertexArrayOES=this.extVertexArrayObject&&new fn(this),this.pixelStoreUnpack=new tn(this),this.pixelStoreUnpackPremultiplyAlpha=new oo(this),this.pixelStoreUnpackFlipY=new Qs(this),this.extTextureFilterAnisotropic=t.getExtension("EXT_texture_filter_anisotropic")||t.getExtension("MOZ_EXT_texture_filter_anisotropic")||t.getExtension("WEBKIT_EXT_texture_filter_anisotropic"),this.extTextureFilterAnisotropic&&(this.extTextureFilterAnisotropicMax=t.getParameter(this.extTextureFilterAnisotropic.MAX_TEXTURE_MAX_ANISOTROPY_EXT)),this.extTextureFilterAnisotropicForceOff=!1,this.extStandardDerivativesForceOff=!1,this.extTextureHalfFloat=t.getExtension("OES_texture_half_float"),this.extTextureHalfFloat&&(t.getExtension("OES_texture_half_float_linear"),this.extRenderToTextureHalfFloat=t.getExtension("EXT_color_buffer_half_float")),this.extStandardDerivatives=t.getExtension("OES_standard_derivatives"),this.extTimerQuery=t.getExtension("EXT_disjoint_timer_query"),this.maxTextureSize=t.getParameter(t.MAX_TEXTURE_SIZE)}setDefault(){this.unbindVAO(),this.clearColor.setDefault(),this.clearDepth.setDefault(),this.clearStencil.setDefault(),this.colorMask.setDefault(),this.depthMask.setDefault(),this.stencilMask.setDefault(),this.stencilFunc.setDefault(),this.stencilOp.setDefault(),this.stencilTest.setDefault(),this.depthRange.setDefault(),this.depthTest.setDefault(),this.depthFunc.setDefault(),this.blend.setDefault(),this.blendFunc.setDefault(),this.blendColor.setDefault(),this.blendEquation.setDefault(),this.cullFace.setDefault(),this.cullFaceSide.setDefault(),this.frontFace.setDefault(),this.program.setDefault(),this.activeTexture.setDefault(),this.bindFramebuffer.setDefault(),this.pixelStoreUnpack.setDefault(),this.pixelStoreUnpackPremultiplyAlpha.setDefault(),this.pixelStoreUnpackFlipY.setDefault()}setDirty(){this.clearColor.dirty=!0,this.clearDepth.dirty=!0,this.clearStencil.dirty=!0,this.colorMask.dirty=!0,this.depthMask.dirty=!0,this.stencilMask.dirty=!0,this.stencilFunc.dirty=!0,this.stencilOp.dirty=!0,this.stencilTest.dirty=!0,this.depthRange.dirty=!0,this.depthTest.dirty=!0,this.depthFunc.dirty=!0,this.blend.dirty=!0,this.blendFunc.dirty=!0,this.blendColor.dirty=!0,this.blendEquation.dirty=!0,this.cullFace.dirty=!0,this.cullFaceSide.dirty=!0,this.frontFace.dirty=!0,this.program.dirty=!0,this.activeTexture.dirty=!0,this.viewport.dirty=!0,this.bindFramebuffer.dirty=!0,this.bindRenderbuffer.dirty=!0,this.bindTexture.dirty=!0,this.bindVertexBuffer.dirty=!0,this.bindElementBuffer.dirty=!0,this.extVertexArrayObject&&(this.bindVertexArrayOES.dirty=!0),this.pixelStoreUnpack.dirty=!0,this.pixelStoreUnpackPremultiplyAlpha.dirty=!0,this.pixelStoreUnpackFlipY.dirty=!0}createIndexBuffer(t,s){return new Hs(this,t,s)}createVertexBuffer(t,s,p){return new Mn(this,t,s,p)}createRenderbuffer(t,s,p){let f=this.gl,_=f.createRenderbuffer();return this.bindRenderbuffer.set(_),f.renderbufferStorage(f.RENDERBUFFER,t,s,p),this.bindRenderbuffer.set(null),_}createFramebuffer(t,s,p){return new R(this,t,s,p)}clear({color:t,depth:s,stencil:p}){let f=this.gl,_=0;t&&(_|=f.COLOR_BUFFER_BIT,this.clearColor.set(t),this.colorMask.set([!0,!0,!0,!0])),s!==void 0&&(_|=f.DEPTH_BUFFER_BIT,this.depthRange.set([0,1]),this.clearDepth.set(s),this.depthMask.set(!0)),p!==void 0&&(_|=f.STENCIL_BUFFER_BIT,this.clearStencil.set(p),this.stencilMask.set(255)),f.clear(_)}setCullFace(t){t.enable===!1?this.cullFace.set(!1):(this.cullFace.set(!0),this.cullFaceSide.set(t.mode),this.frontFace.set(t.frontFace))}setDepthMode(t){t.func!==this.gl.ALWAYS||t.mask?(this.depthTest.set(!0),this.depthFunc.set(t.func),this.depthMask.set(t.mask),this.depthRange.set(t.range)):this.depthTest.set(!1)}setStencilMode(t){t.test.func!==this.gl.ALWAYS||t.mask?(this.stencilTest.set(!0),this.stencilMask.set(t.mask),this.stencilOp.set([t.fail,t.depthFail,t.pass]),this.stencilFunc.set({func:t.test.func,ref:t.ref,mask:t.test.mask})):this.stencilTest.set(!1)}setColorMode(t){z(t.blendFunction,o.ColorMode.Replace)?this.blend.set(!1):(this.blend.set(!0),this.blendFunc.set(t.blendFunction),this.blendColor.set(t.blendColor)),this.colorMask.set(t.mask)}unbindVAO(){this.extVertexArrayObject&&this.bindVertexArrayOES.set(null)}}class ee extends o.Evented{constructor(t,s,p,f){super(),this.id=t,this.dispatcher=p,this.setEventedParent(f),this.type="raster",this.minzoom=0,this.maxzoom=22,this.roundZoom=!0,this.scheme="xyz",this.tileSize=512,this._loaded=!1,this._options=o.extend({type:"raster"},s),o.extend(this,o.pick(s,["url","scheme","tileSize"]))}load(){this._loaded=!1,this.fire(new o.Event("dataloading",{dataType:"source"})),this._tileJSONRequest=$o(this._options,this.map._requestManager,null,null,(t,s)=>{this._tileJSONRequest=null,this._loaded=!0,t?this.fire(new o.ErrorEvent(t)):s&&(o.extend(this,s),s.bounds&&(this.tileBounds=new Kr(s.bounds,this.minzoom,this.maxzoom)),o.postTurnstileEvent(s.tiles),this.fire(new o.Event("data",{dataType:"source",sourceDataType:"metadata"})),this.fire(new o.Event("data",{dataType:"source",sourceDataType:"content"})))})}loaded(){return this._loaded}onAdd(t){this.map=t,this.load()}onRemove(){this._tileJSONRequest&&(this._tileJSONRequest.cancel(),this._tileJSONRequest=null)}serialize(){return o.extend({},this._options)}hasTile(t){return!this.tileBounds||this.tileBounds.contains(t.canonical)}loadTile(t,s){let p=o.exported.devicePixelRatio>=2,f=this.map._requestManager.normalizeTileURL(t.tileID.canonical.url(this.tiles,this.scheme),p,this.tileSize);t.request=o.getImage(this.map._requestManager.transformRequest(f,o.ResourceType.Tile),(_,b,w,T)=>(delete t.request,t.aborted?(t.state="unloaded",s(null)):_?(t.state="errored",s(_)):b?(this.map._refreshExpiredTiles&&t.setExpiryData({cacheControl:w,expires:T}),t.setTexture(b,this.map.painter),t.state="loaded",o.cacheEntryPossiblyAdded(this.dispatcher),void s(null)):s(null)))}static loadTileData(t,s,p){t.setTexture(s,p)}static unloadTileData(t,s){t.texture&&s.saveTileTexture(t.texture)}abortTile(t,s){t.request&&(t.request.cancel(),delete t.request),s()}unloadTile(t,s){t.texture&&this.map.painter.saveTileTexture(t.texture),s()}hasTransition(){return!1}}let le;function fe(l,t,s,p,f,_,b,w){let T=[l,s,f,t,p,_,1,1,1],A=[b,w,1],I=o.adjoint([],T),[L,O,V]=o.transformMat3(A,A,o.transpose(I,I));return o.multiply$1(T,[L,0,0,0,O,0,0,0,V],T)}class pe extends o.Evented{constructor(t,s,p,f){super(),this.id=t,this.dispatcher=p,this.coordinates=s.coordinates,this.type="image",this.minzoom=0,this.maxzoom=22,this.tileSize=512,this.tiles={},this._loaded=!1,this.setEventedParent(f),this.options=s}load(t,s){this._loaded=s||!1,this.fire(new o.Event("dataloading",{dataType:"source"})),this.url=this.options.url,o.getImage(this.map._requestManager.transformRequest(this.url,o.ResourceType.Image),(p,f)=>{if(this._loaded=!0,p)this.fire(new o.ErrorEvent(p));else if(f){let{HTMLImageElement:_}=o.window;this.image=f instanceof _?o.exported.getImageData(f):f,this.width=this.image.width,this.height=this.image.height,t&&(this.coordinates=t),this._finishLoading()}})}loaded(){return this._loaded}updateImage(t){return this.image&&t.url?(this.options.url=t.url,this.load(t.coordinates,this._loaded),this):this}_finishLoading(){this.map&&(this.setCoordinates(this.coordinates),this.fire(new o.Event("data",{dataType:"source",sourceDataType:"metadata"})))}onAdd(t){this.map=t,this.load()}onRemove(){this.texture&&this.texture.destroy()}setCoordinates(t){this.coordinates=t,this._boundsArray=void 0;let s=t.map(o.MercatorCoordinate.fromLngLat);return this.tileID=function(p){let f=1/0,_=1/0,b=-1/0,w=-1/0;for(let L of p)f=Math.min(f,L.x),_=Math.min(_,L.y),b=Math.max(b,L.x),w=Math.max(w,L.y);let T=Math.max(b-f,w-_),A=Math.max(0,Math.floor(-Math.log(T)/Math.LN2)),I=Math.pow(2,A);return new o.CanonicalTileID(A,Math.floor((f+b)/2*I),Math.floor((_+w)/2*I))}(s),this.minzoom=this.maxzoom=this.tileID.z,this.fire(new o.Event("data",{dataType:"source",sourceDataType:"content"})),this}_clear(){this._boundsArray=void 0}_prepareData(t){for(let T in this.tiles){let A=this.tiles[T];A.state!=="loaded"&&(A.state="loaded",A.texture=this.texture)}if(this._boundsArray)return;let s=o.tileTransform(this.tileID,this.map.transform.projection),[p,f,_,b]=this.coordinates.map(T=>{let A=s.projection.project(T[0],T[1]);return o.getTilePoint(s,A)._round()});this.perspectiveTransform=function(T,A,I,L,O,V,N,j,J,U){let $=fe(0,0,T,0,0,A,T,A),q=fe(I,L,O,V,N,j,J,U);return o.multiply$1(q,o.adjoint($,$),q),[q[6]/q[8]*T/o.EXTENT,q[7]/q[8]*A/o.EXTENT]}(this.width,this.height,p.x,p.y,f.x,f.y,b.x,b.y,_.x,_.y);let w=this._boundsArray=new o.StructArrayLayout4i8;w.emplaceBack(p.x,p.y,0,0),w.emplaceBack(f.x,f.y,o.EXTENT,0),w.emplaceBack(b.x,b.y,0,o.EXTENT),w.emplaceBack(_.x,_.y,o.EXTENT,o.EXTENT),this.boundsBuffer&&this.boundsBuffer.destroy(),this.boundsBuffer=t.createVertexBuffer(w,o.boundsAttributes.members),this.boundsSegments=o.SegmentVector.simpleSegment(0,0,4,2)}prepare(){if(Object.keys(this.tiles).length===0||!this.image)return;let t=this.map.painter.context,s=t.gl;this.texture?this.texture.update(this.image):(this.texture=new o.Texture(t,this.image,s.RGBA),this.texture.bind(s.LINEAR,s.CLAMP_TO_EDGE)),this._prepareData(t)}loadTile(t,s){this.tileID&&this.tileID.equals(t.tileID.canonical)?(this.tiles[String(t.tileID.wrap)]=t,t.buckets={},s(null)):(t.state="errored",s(null))}serialize(){return{type:"image",url:this.options.url,coordinates:this.coordinates}}hasTransition(){return!1}}let he={vector:class extends o.Evented{constructor(l,t,s,p){if(super(),this.id=l,this.dispatcher=s,this.type="vector",this.minzoom=0,this.maxzoom=22,this.scheme="xyz",this.tileSize=512,this.reparseOverscaled=!0,this.isTileClipped=!0,this._loaded=!1,o.extend(this,o.pick(t,["url","scheme","tileSize","promoteId"])),this._options=o.extend({type:"vector"},t),this._collectResourceTiming=t.collectResourceTiming,this.tileSize!==512)throw new Error("vector tile sources must have a tileSize of 512");this.setEventedParent(p),this._tileWorkers={},this._deduped=new o.DedupedRequest}load(l){this._loaded=!1,this.fire(new o.Event("dataloading",{dataType:"source"}));let t=this.language||this.map._language,s=this.worldview||this.map._worldview;this._tileJSONRequest=$o(this._options,this.map._requestManager,t,s,(p,f)=>{this._tileJSONRequest=null,this._loaded=!0,p?(t&&console.warn(`Ensure that your requested language string is a valid BCP-47 code. Found: ${t}`),s&&s.length!==2&&console.warn(`Requested worldview strings must be a valid ISO alpha-2 code. Found: ${s}`),this.fire(new o.ErrorEvent(p))):f&&(o.extend(this,f),f.bounds&&(this.tileBounds=new Kr(f.bounds,this.minzoom,this.maxzoom)),o.postTurnstileEvent(f.tiles,this.map._requestManager._customAccessToken),this.fire(new o.Event("data",{dataType:"source",sourceDataType:"metadata"})),this.fire(new o.Event("data",{dataType:"source",sourceDataType:"content"}))),l&&l(p)})}loaded(){return this._loaded}hasTile(l){return!this.tileBounds||this.tileBounds.contains(l.canonical)}onAdd(l){this.map=l,this.load()}setSourceProperty(l){this._tileJSONRequest&&this._tileJSONRequest.cancel(),l(),this.load(()=>{let t=this.map.style._getSourceCaches(this.id);for(let s of t)s.clearTiles()})}setTiles(l){return this.setSourceProperty(()=>{this._options.tiles=l}),this}setUrl(l){return this.setSourceProperty(()=>{this.url=l,this._options.url=l}),this}_setLanguage(l){return l===this.language||this.setSourceProperty(()=>{this.language=l}),this}_setWorldview(l){return l===this.worldview?this:this.worldviewOptions&&l&&!this.worldviewOptions[l]?(console.warn(`Vector tile source "${this.id}" does not support worldview "${l}".`),this):(this.setSourceProperty(()=>{this.worldview=l}),this)}onRemove(){this._tileJSONRequest&&(this._tileJSONRequest.cancel(),this._tileJSONRequest=null)}serialize(){return o.extend({},this._options)}loadTile(l,t){let s=this.map._requestManager.normalizeTileURL(l.tileID.canonical.url(this.tiles,this.scheme)),p={request:this.map._requestManager.transformRequest(s,o.ResourceType.Tile),data:void 0,uid:l.uid,tileID:l.tileID,tileZoom:l.tileZoom,zoom:l.tileID.overscaledZ,tileSize:this.tileSize*l.tileID.overscaleFactor(),type:this.type,source:this.id,pixelRatio:o.exported.devicePixelRatio,showCollisionBoxes:this.map.showCollisionBoxes,promoteId:this.promoteId,isSymbolTile:l.isSymbolTile};if(p.request.collectResourceTiming=this._collectResourceTiming,l.actor&&l.state!=="expired")l.state==="loading"?l.reloadCallback=t:l.request=l.actor.send("reloadTile",p,f.bind(this));else if(l.actor=this._tileWorkers[s]=this._tileWorkers[s]||this.dispatcher.getActor(),this.dispatcher.ready)l.request=l.actor.send("loadTile",p,f.bind(this),void 0,!0);else{let _=o.loadVectorTile.call({deduped:this._deduped},p,(b,w)=>{b||!w?f.call(this,b):(p.data={cacheControl:w.cacheControl,expires:w.expires,rawData:w.rawData.slice(0)},l.actor&&l.actor.send("loadTile",p,f.bind(this),void 0,!0))},!0);l.request={cancel:_}}function f(_,b){return delete l.request,l.aborted?t(null):_&&_.status!==404?t(_):(b&&b.resourceTiming&&(l.resourceTiming=b.resourceTiming),this.map._refreshExpiredTiles&&b&&l.setExpiryData(b),l.loadVectorData(b,this.map.painter),o.cacheEntryPossiblyAdded(this.dispatcher),t(null),void(l.reloadCallback&&(this.loadTile(l,l.reloadCallback),l.reloadCallback=null)))}}abortTile(l){l.request&&(l.request.cancel(),delete l.request),l.actor&&l.actor.send("abortTile",{uid:l.uid,type:this.type,source:this.id})}unloadTile(l){l.unloadVectorData(),l.actor&&l.actor.send("removeTile",{uid:l.uid,type:this.type,source:this.id})}hasTransition(){return!1}afterUpdate(){this._tileWorkers={}}},raster:ee,"raster-dem":class extends ee{constructor(l,t,s,p){super(l,t,s,p),this.type="raster-dem",this.maxzoom=22,this._options=o.extend({type:"raster-dem"},t),this.encoding=t.encoding||"mapbox"}loadTile(l,t){let s=this.map._requestManager.normalizeTileURL(l.tileID.canonical.url(this.tiles,this.scheme),!1,this.tileSize);function p(f,_){f&&(l.state="errored",t(f)),_&&(l.dem=_,l.dem.onDeserialize(),l.needsHillshadePrepare=!0,l.needsDEMTextureUpload=!0,l.state="loaded",t(null))}l.request=o.getImage(this.map._requestManager.transformRequest(s,o.ResourceType.Tile),function(f,_,b,w){if(delete l.request,l.aborted)l.state="unloaded",t(null);else if(f)l.state="errored",t(f);else if(_){this.map._refreshExpiredTiles&&l.setExpiryData({cacheControl:b,expires:w});let T=o.window.ImageBitmap&&_ instanceof o.window.ImageBitmap&&(le==null&&(le=o.window.OffscreenCanvas&&new o.window.OffscreenCanvas(1,1).getContext("2d")&&typeof o.window.createImageBitmap=="function"),le),A=1-(_.width-o.prevPowerOfTwo(_.width))/2;A<1||l.neighboringTiles||(l.neighboringTiles=this._getNeighboringTiles(l.tileID));let I=T?_:o.exported.getImageData(_,A),L={uid:l.uid,coord:l.tileID,source:this.id,rawImageData:I,encoding:this.encoding,padding:A};l.actor&&l.state!=="expired"||(l.actor=this.dispatcher.getActor(),l.actor.send("loadDEMTile",L,p.bind(this),void 0,!0))}}.bind(this))}_getNeighboringTiles(l){let t=l.canonical,s=Math.pow(2,t.z),p=(t.x-1+s)%s,f=t.x===0?l.wrap-1:l.wrap,_=(t.x+1+s)%s,b=t.x+1===s?l.wrap+1:l.wrap,w={};return w[new o.OverscaledTileID(l.overscaledZ,f,t.z,p,t.y).key]={backfilled:!1},w[new o.OverscaledTileID(l.overscaledZ,b,t.z,_,t.y).key]={backfilled:!1},t.y>0&&(w[new o.OverscaledTileID(l.overscaledZ,f,t.z,p,t.y-1).key]={backfilled:!1},w[new o.OverscaledTileID(l.overscaledZ,l.wrap,t.z,t.x,t.y-1).key]={backfilled:!1},w[new o.OverscaledTileID(l.overscaledZ,b,t.z,_,t.y-1).key]={backfilled:!1}),t.y+1<s&&(w[new o.OverscaledTileID(l.overscaledZ,f,t.z,p,t.y+1).key]={backfilled:!1},w[new o.OverscaledTileID(l.overscaledZ,l.wrap,t.z,t.x,t.y+1).key]={backfilled:!1},w[new o.OverscaledTileID(l.overscaledZ,b,t.z,_,t.y+1).key]={backfilled:!1}),w}unloadTile(l){l.demTexture&&this.map.painter.saveTileTexture(l.demTexture),l.fbo&&(l.fbo.destroy(),delete l.fbo),l.dem&&delete l.dem,delete l.neighboringTiles,l.state="unloaded"}},geojson:class extends o.Evented{constructor(l,t,s,p){super(),this.id=l,this.type="geojson",this.minzoom=0,this.maxzoom=18,this.tileSize=512,this.isTileClipped=!0,this.reparseOverscaled=!0,this._loaded=!1,this.actor=s.getActor(),this.setEventedParent(p),this._data=t.data,this._options=o.extend({},t),this._collectResourceTiming=t.collectResourceTiming,t.maxzoom!==void 0&&(this.maxzoom=t.maxzoom),t.type&&(this.type=t.type),t.attribution&&(this.attribution=t.attribution),this.promoteId=t.promoteId;let f=o.EXTENT/this.tileSize;this.workerOptions=o.extend({source:this.id,cluster:t.cluster||!1,geojsonVtOptions:{buffer:(t.buffer!==void 0?t.buffer:128)*f,tolerance:(t.tolerance!==void 0?t.tolerance:.375)*f,extent:o.EXTENT,maxZoom:this.maxzoom,lineMetrics:t.lineMetrics||!1,generateId:t.generateId||!1},superclusterOptions:{maxZoom:t.clusterMaxZoom!==void 0?t.clusterMaxZoom:this.maxzoom-1,minPoints:Math.max(2,t.clusterMinPoints||2),extent:o.EXTENT,radius:(t.clusterRadius!==void 0?t.clusterRadius:50)*f,log:!1,generateId:t.generateId||!1},clusterProperties:t.clusterProperties,filter:t.filter},t.workerOptions)}onAdd(l){this.map=l,this.setData(this._data)}setData(l){return this._data=l,this._updateWorkerData(),this}getClusterExpansionZoom(l,t){return this.actor.send("geojson.getClusterExpansionZoom",{clusterId:l,source:this.id},t),this}getClusterChildren(l,t){return this.actor.send("geojson.getClusterChildren",{clusterId:l,source:this.id},t),this}getClusterLeaves(l,t,s,p){return this.actor.send("geojson.getClusterLeaves",{source:this.id,clusterId:l,limit:t,offset:s},p),this}_updateWorkerData(){if(this._pendingLoad)return void(this._coalesce=!0);this.fire(new o.Event("dataloading",{dataType:"source"})),this._loaded=!1;let l=o.extend({},this.workerOptions),t=this._data;typeof t=="string"?(l.request=this.map._requestManager.transformRequest(o.exported.resolveURL(t),o.ResourceType.Source),l.request.collectResourceTiming=this._collectResourceTiming):l.data=JSON.stringify(t),this._pendingLoad=this.actor.send(`${this.type}.loadData`,l,(s,p)=>{if(this._loaded=!0,this._pendingLoad=null,s)this.fire(new o.ErrorEvent(s));else{let f={dataType:"source",sourceDataType:this._metadataFired?"content":"metadata"};this._collectResourceTiming&&p&&p.resourceTiming&&p.resourceTiming[this.id]&&(f.resourceTiming=p.resourceTiming[this.id]),this.fire(new o.Event("data",f)),this._metadataFired=!0}this._coalesce&&(this._updateWorkerData(),this._coalesce=!1)})}loaded(){return this._loaded}loadTile(l,t){let s=l.actor?"reloadTile":"loadTile";l.actor=this.actor,l.request=this.actor.send(s,{type:this.type,uid:l.uid,tileID:l.tileID,tileZoom:l.tileZoom,zoom:l.tileID.overscaledZ,maxZoom:this.maxzoom,tileSize:this.tileSize,source:this.id,pixelRatio:o.exported.devicePixelRatio,showCollisionBoxes:this.map.showCollisionBoxes,promoteId:this.promoteId},(p,f)=>(delete l.request,l.unloadVectorData(),l.aborted?t(null):p?t(p):(l.loadVectorData(f,this.map.painter,s==="reloadTile"),t(null))),void 0,s==="loadTile")}abortTile(l){l.request&&(l.request.cancel(),delete l.request),l.aborted=!0}unloadTile(l){l.unloadVectorData(),this.actor.send("removeTile",{uid:l.uid,type:this.type,source:this.id})}onRemove(){this._pendingLoad&&this._pendingLoad.cancel()}serialize(){return o.extend({},this._options,{type:this.type,data:this._data})}hasTransition(){return!1}},video:class extends pe{constructor(l,t,s,p){super(l,t,s,p),this.roundZoom=!0,this.type="video",this.options=t}load(){this._loaded=!1;let l=this.options;this.urls=[];for(let t of l.urls)this.urls.push(this.map._requestManager.transformRequest(t,o.ResourceType.Source).url);o.getVideo(this.urls,(t,s)=>{this._loaded=!0,t?this.fire(new o.ErrorEvent(t)):s&&(this.video=s,this.video.loop=!0,this.video.setAttribute("playsinline",""),this.video.addEventListener("playing",()=>{this.map.triggerRepaint()}),this.map&&this.video.play(),this._finishLoading())})}pause(){this.video&&this.video.pause()}play(){this.video&&this.video.play()}seek(l){if(this.video){let t=this.video.seekable;l<t.start(0)||l>t.end(0)?this.fire(new o.ErrorEvent(new o.ValidationError(`sources.${this.id}`,null,`Playback for this video can be set only between the ${t.start(0)} and ${t.end(0)}-second mark.`))):this.video.currentTime=l}}getVideo(){return this.video}onAdd(l){this.map||(this.map=l,this.load(),this.video&&(this.video.play(),this.setCoordinates(this.coordinates)))}prepare(){if(Object.keys(this.tiles).length===0||this.video.readyState<2)return;let l=this.map.painter.context,t=l.gl;this.texture?this.video.paused||(this.texture.bind(t.LINEAR,t.CLAMP_TO_EDGE),t.texSubImage2D(t.TEXTURE_2D,0,0,0,t.RGBA,t.UNSIGNED_BYTE,this.video)):(this.texture=new o.Texture(l,this.video,t.RGBA),this.texture.bind(t.LINEAR,t.CLAMP_TO_EDGE),this.width=this.video.videoWidth,this.height=this.video.videoHeight),this._prepareData(l)}serialize(){return{type:"video",urls:this.urls,coordinates:this.coordinates}}hasTransition(){return this.video&&!this.video.paused}},image:pe,canvas:class extends pe{constructor(l,t,s,p){super(l,t,s,p),t.coordinates?Array.isArray(t.coordinates)&&t.coordinates.length===4&&!t.coordinates.some(f=>!Array.isArray(f)||f.length!==2||f.some(_=>typeof _!="number"))||this.fire(new o.ErrorEvent(new o.ValidationError(`sources.${l}`,null,'"coordinates" property must be an array of 4 longitude/latitude array pairs'))):this.fire(new o.ErrorEvent(new o.ValidationError(`sources.${l}`,null,'missing required property "coordinates"'))),t.animate&&typeof t.animate!="boolean"&&this.fire(new o.ErrorEvent(new o.ValidationError(`sources.${l}`,null,'optional "animate" property must be a boolean value'))),t.canvas?typeof t.canvas=="string"||t.canvas instanceof o.window.HTMLCanvasElement||this.fire(new o.ErrorEvent(new o.ValidationError(`sources.${l}`,null,'"canvas" must be either a string representing the ID of the canvas element from which to read, or an HTMLCanvasElement instance'))):this.fire(new o.ErrorEvent(new o.ValidationError(`sources.${l}`,null,'missing required property "canvas"'))),this.options=t,this.animate=t.animate===void 0||t.animate}load(){this._loaded=!0,this.canvas||(this.canvas=this.options.canvas instanceof o.window.HTMLCanvasElement?this.options.canvas:o.window.document.getElementById(this.options.canvas)),this.width=this.canvas.width,this.height=this.canvas.height,this._hasInvalidDimensions()?this.fire(new o.ErrorEvent(new Error("Canvas dimensions cannot be less than or equal to zero."))):(this.play=function(){this._playing=!0,this.map.triggerRepaint()},this.pause=function(){this._playing&&(this.prepare(),this._playing=!1)},this._finishLoading())}getCanvas(){return this.canvas}onAdd(l){this.map=l,this.load(),this.canvas&&this.animate&&this.play()}onRemove(){this.pause()}prepare(){let l=!1;if(this.canvas.width!==this.width&&(this.width=this.canvas.width,l=!0),this.canvas.height!==this.height&&(this.height=this.canvas.height,l=!0),this._hasInvalidDimensions()||Object.keys(this.tiles).length===0)return;let t=this.map.painter.context;this.texture?(l||this._playing)&&this.texture.update(this.canvas,{premultiply:!0}):this.texture=new o.Texture(t,this.canvas,t.gl.RGBA,{premultiply:!0}),this._prepareData(t)}serialize(){return{type:"canvas",coordinates:this.coordinates}}hasTransition(){return this._playing}_hasInvalidDimensions(){for(let l of[this.canvas.width,this.canvas.height])if(isNaN(l)||l<=0)return!0;return!1}},custom:class extends o.Evented{constructor(l,t,s,p){super(),this.id=l,this.type="custom",this._dataType="raster",this._dispatcher=s,this._implementation=t,this.setEventedParent(p),this.scheme="xyz",this.minzoom=0,this.maxzoom=22,this.tileSize=512,this._loaded=!1,this.roundZoom=!0,this._implementation||this.fire(new o.ErrorEvent(new Error(`Missing implementation for ${this.id} custom source`))),this._implementation.loadTile||this.fire(new o.ErrorEvent(new Error(`Missing loadTile implementation for ${this.id} custom source`))),this._implementation.bounds&&(this.tileBounds=new Kr(this._implementation.bounds,this.minzoom,this.maxzoom)),t.update=this._update.bind(this),t.coveringTiles=this._coveringTiles.bind(this),o.extend(this,o.pick(t,["dataType","scheme","minzoom","maxzoom","tileSize","attribution","minTileCacheSize","maxTileCacheSize"]))}serialize(){return o.pick(this,["type","scheme","minzoom","maxzoom","tileSize","attribution"])}load(){this._loaded=!0,this.fire(new o.Event("data",{dataType:"source",sourceDataType:"metadata"})),this.fire(new o.Event("data",{dataType:"source",sourceDataType:"content"}))}loaded(){return this._loaded}onAdd(l){this._map=l,this._loaded=!1,this.fire(new o.Event("dataloading",{dataType:"source"})),this._implementation.onAdd&&this._implementation.onAdd(l),this.load()}onRemove(l){this._implementation.onRemove&&this._implementation.onRemove(l)}hasTile(l){if(this._implementation.hasTile){let{x:t,y:s,z:p}=l.canonical;return this._implementation.hasTile({x:t,y:s,z:p})}return!this.tileBounds||this.tileBounds.contains(l.canonical)}loadTile(l,t){let{x:s,y:p,z:f}=l.tileID.canonical,_=new o.window.AbortController,b=this._implementation.loadTile({x:s,y:p,z:f},{signal:_.signal});if(!b)return this.loadTileData(l,{width:this.tileSize,height:this.tileSize,data:null}),l.state="loaded",t(null);b.cancel=()=>_.abort(),l.request=b.then(function(w){return delete l.request,l.aborted?(l.state="unloaded",t(null)):w?function(T){return T instanceof o.window.ImageData||T instanceof o.window.ImageBitmap||T instanceof o.window.HTMLCanvasElement}(w)?(this.loadTileData(l,w),l.state="loaded",void t(null)):(l.state="errored",t(new Error(`Can't infer data type for ${this.id}, only raster data supported at the moment`))):(this.loadTileData(l,{width:this.tileSize,height:this.tileSize,data:null}),l.state="loaded",t(null))}.bind(this)).catch(w=>{w.code!==20&&(l.state="errored",t(w))})}loadTileData(l,t){ee.loadTileData(l,t,this._map.painter)}unloadTileData(l){ee.unloadTileData(l,this._map.painter)}prepareTile(l){if(!this._implementation.prepareTile)return null;let{x:t,y:s,z:p}=l.tileID.canonical,f=this._implementation.prepareTile({x:t,y:s,z:p});return f?(this.loadTileData(l,f),l.state="loaded",f):null}unloadTile(l,t){if(this.unloadTileData(l),this._implementation.unloadTile){let{x:s,y:p,z:f}=l.tileID.canonical;this._implementation.unloadTile({x:s,y:p,z:f})}t()}abortTile(l,t){l.request&&l.request.cancel&&(l.request.cancel(),delete l.request),t()}hasTransition(){return!1}_coveringTiles(){return this._map.transform.coveringTiles({tileSize:this.tileSize,minzoom:this.minzoom,maxzoom:this.maxzoom,roundZoom:this.roundZoom}).map(l=>({x:l.canonical.x,y:l.canonical.y,z:l.canonical.z}))}_update(){this.fire(new o.Event("data",{dataType:"source",sourceDataType:"content"}))}}},me=function(l,t,s,p){let f=new he[t.type](l,t,s,p);if(f.id!==l)throw new Error(`Expected Source id to be ${l} instead of ${f.id}`);return o.bindAll(["load","abort","unload","serialize","prepare"],f),f};function ze(l,t){let s=o.identity([]);return o.scale(s,s,[.5*l.width,.5*-l.height,1]),o.translate(s,s,[1,-1,0]),o.multiply(s,s,l.calculateProjMatrix(t.toUnwrapped())),Float32Array.from(s)}function Ze(l,t,s,p,f,_,b,w=!1){let T=l.tilesIn(p,b,w);T.sort(nt);let A=[];for(let L of T)A.push({wrappedTileID:L.tile.tileID.wrapped().key,queryResults:L.tile.queryRenderedFeatures(t,s,l._state,L,f,_,ze(l.transform,L.tile.tileID),w)});let I=function(L){let O={},V={};for(let N of L){let j=N.queryResults,J=N.wrappedTileID,U=V[J]=V[J]||{};for(let $ in j){let q=j[$],ie=U[$]=U[$]||{},K=O[$]=O[$]||[];for(let Q of q)ie[Q.featureIndex]||(ie[Q.featureIndex]=!0,K.push(Q))}}return O}(A);for(let L in I)I[L].forEach(O=>{let V=O.feature,N=V.layer;N&&N.type!=="background"&&N.type!=="sky"&&(V.source=N.source,N["source-layer"]&&(V.sourceLayer=N["source-layer"]),V.state=V.id!==void 0?l.getFeatureState(N["source-layer"],V.id):{})});return I}function De(l,t){let s=l.getRenderableIds().map(_=>l.getTileByID(_)),p=[],f={};for(let _=0;_<s.length;_++){let b=s[_],w=b.tileID.canonical.key;f[w]||(f[w]=!0,b.querySourceFeatures(p,t))}return p}function nt(l,t){let s=l.tileID,p=t.tileID;return s.overscaledZ-p.overscaledZ||s.canonical.y-p.canonical.y||s.wrap-p.wrap||s.canonical.x-p.canonical.x}function at(){return Ua.workerClass!=null?new Ua.workerClass:new o.window.Worker(Ua.workerUrl)}let ot="mapboxgl_preloaded_worker_pool";class ct{constructor(){this.active={}}acquire(t){if(!this.workers)for(this.workers=[];this.workers.length<ct.workerCount;)this.workers.push(new at);return this.active[t]=!0,this.workers.slice()}release(t){delete this.active[t],this.numActive()===0&&(this.workers.forEach(s=>{s.terminate()}),this.workers=null)}isPreloaded(){return!!this.active[ot]}numActive(){return Object.keys(this.active).length}}let _t;function Rt(){return _t||(_t=new ct),_t}function Yt(l,t){let s={};for(let p in l)p!=="ref"&&(s[p]=l[p]);return o.refProperties.forEach(p=>{p in t&&(s[p]=t[p])}),s}function Vt(l){l=l.slice();let t=Object.create(null);for(let s=0;s<l.length;s++)t[l[s].id]=l[s];for(let s=0;s<l.length;s++)"ref"in l[s]&&(l[s]=Yt(l[s],t[l[s].ref]));return l}ct.workerCount=2;let de={setStyle:"setStyle",addLayer:"addLayer",removeLayer:"removeLayer",setPaintProperty:"setPaintProperty",setLayoutProperty:"setLayoutProperty",setFilter:"setFilter",addSource:"addSource",removeSource:"removeSource",setGeoJSONSourceData:"setGeoJSONSourceData",setLayerZoomRange:"setLayerZoomRange",setLayerProperty:"setLayerProperty",setCenter:"setCenter",setZoom:"setZoom",setBearing:"setBearing",setPitch:"setPitch",setSprite:"setSprite",setGlyphs:"setGlyphs",setTransition:"setTransition",setLight:"setLight",setTerrain:"setTerrain",setFog:"setFog",setProjection:"setProjection"};function ir(l,t,s){s.push({command:de.addSource,args:[l,t[l]]})}function ii(l,t,s){t.push({command:de.removeSource,args:[l]}),s[l]=!0}function pr(l,t,s,p){ii(l,s,p),ir(l,t,s)}function ip(l,t,s){let p;for(p in l[s])if(l[s].hasOwnProperty(p)&&p!=="data"&&!z(l[s][p],t[s][p]))return!1;for(p in t[s])if(t[s].hasOwnProperty(p)&&p!=="data"&&!z(l[s][p],t[s][p]))return!1;return!0}function rr(l,t,s,p,f,_){let b;for(b in t=t||{},l=l||{})l.hasOwnProperty(b)&&(z(l[b],t[b])||s.push({command:_,args:[p,b,t[b],f]}));for(b in t)t.hasOwnProperty(b)&&!l.hasOwnProperty(b)&&(z(l[b],t[b])||s.push({command:_,args:[p,b,t[b],f]}))}function ea(l){return l.id}function Gc(l,t){return l[t.id]=t,l}class Jo{constructor(t,s){this.reset(t,s)}reset(t,s){this.points=t||[],this._distances=[0];for(let p=1;p<this.points.length;p++)this._distances[p]=this._distances[p-1]+this.points[p].dist(this.points[p-1]);this.length=this._distances[this._distances.length-1],this.padding=Math.min(s||0,.5*this.length),this.paddedLength=this.length-2*this.padding}lerp(t){if(this.points.length===1)return this.points[0];t=o.clamp(t,0,1);let s=1,p=this._distances[s],f=t*this.paddedLength+this.padding;for(;p<f&&s<this._distances.length;)p=this._distances[++s];let _=s-1,b=this._distances[_],w=p-b,T=w>0?(f-b)/w:0;return this.points[_].mult(1-T).add(this.points[s].mult(T))}}class $e{constructor(t,s,p){let f=this.boxCells=[],_=this.circleCells=[];this.xCellCount=Math.ceil(t/p),this.yCellCount=Math.ceil(s/p);for(let b=0;b<this.xCellCount*this.yCellCount;b++)f.push([]),_.push([]);this.circleKeys=[],this.boxKeys=[],this.bboxes=[],this.circles=[],this.width=t,this.height=s,this.xScale=this.xCellCount/t,this.yScale=this.yCellCount/s,this.boxUid=0,this.circleUid=0}keysLength(){return this.boxKeys.length+this.circleKeys.length}insert(t,s,p,f,_){this._forEachCell(s,p,f,_,this._insertBoxCell,this.boxUid++),this.boxKeys.push(t),this.bboxes.push(s),this.bboxes.push(p),this.bboxes.push(f),this.bboxes.push(_)}insertCircle(t,s,p,f){this._forEachCell(s-f,p-f,s+f,p+f,this._insertCircleCell,this.circleUid++),this.circleKeys.push(t),this.circles.push(s),this.circles.push(p),this.circles.push(f)}_insertBoxCell(t,s,p,f,_,b){this.boxCells[_].push(b)}_insertCircleCell(t,s,p,f,_,b){this.circleCells[_].push(b)}_query(t,s,p,f,_,b){if(p<0||t>this.width||f<0||s>this.height)return!_&&[];let w=[];if(t<=0&&s<=0&&this.width<=p&&this.height<=f){if(_)return!0;for(let T=0;T<this.boxKeys.length;T++)w.push({key:this.boxKeys[T],x1:this.bboxes[4*T],y1:this.bboxes[4*T+1],x2:this.bboxes[4*T+2],y2:this.bboxes[4*T+3]});for(let T=0;T<this.circleKeys.length;T++){let A=this.circles[3*T],I=this.circles[3*T+1],L=this.circles[3*T+2];w.push({key:this.circleKeys[T],x1:A-L,y1:I-L,x2:A+L,y2:I+L})}return b?w.filter(b):w}return this._forEachCell(t,s,p,f,this._queryCell,w,{hitTest:_,seenUids:{box:{},circle:{}}},b),_?w.length>0:w}_queryCircle(t,s,p,f,_){let b=t-p,w=t+p,T=s-p,A=s+p;if(w<0||b>this.width||A<0||T>this.height)return!f&&[];let I=[];return this._forEachCell(b,T,w,A,this._queryCellCircle,I,{hitTest:f,circle:{x:t,y:s,radius:p},seenUids:{box:{},circle:{}}},_),f?I.length>0:I}query(t,s,p,f,_){return this._query(t,s,p,f,!1,_)}hitTest(t,s,p,f,_){return this._query(t,s,p,f,!0,_)}hitTestCircle(t,s,p,f){return this._queryCircle(t,s,p,!0,f)}_queryCell(t,s,p,f,_,b,w,T){let A=w.seenUids,I=this.boxCells[_];if(I!==null){let O=this.bboxes;for(let V of I)if(!A.box[V]){A.box[V]=!0;let N=4*V;if(t<=O[N+2]&&s<=O[N+3]&&p>=O[N+0]&&f>=O[N+1]&&(!T||T(this.boxKeys[V]))){if(w.hitTest)return b.push(!0),!0;b.push({key:this.boxKeys[V],x1:O[N],y1:O[N+1],x2:O[N+2],y2:O[N+3]})}}}let L=this.circleCells[_];if(L!==null){let O=this.circles;for(let V of L)if(!A.circle[V]){A.circle[V]=!0;let N=3*V;if(this._circleAndRectCollide(O[N],O[N+1],O[N+2],t,s,p,f)&&(!T||T(this.circleKeys[V]))){if(w.hitTest)return b.push(!0),!0;{let j=O[N],J=O[N+1],U=O[N+2];b.push({key:this.circleKeys[V],x1:j-U,y1:J-U,x2:j+U,y2:J+U})}}}}}_queryCellCircle(t,s,p,f,_,b,w,T){let A=w.circle,I=w.seenUids,L=this.boxCells[_];if(L!==null){let V=this.bboxes;for(let N of L)if(!I.box[N]){I.box[N]=!0;let j=4*N;if(this._circleAndRectCollide(A.x,A.y,A.radius,V[j+0],V[j+1],V[j+2],V[j+3])&&(!T||T(this.boxKeys[N])))return b.push(!0),!0}}let O=this.circleCells[_];if(O!==null){let V=this.circles;for(let N of O)if(!I.circle[N]){I.circle[N]=!0;let j=3*N;if(this._circlesCollide(V[j],V[j+1],V[j+2],A.x,A.y,A.radius)&&(!T||T(this.circleKeys[N])))return b.push(!0),!0}}}_forEachCell(t,s,p,f,_,b,w,T){let A=this._convertToXCellCoord(t),I=this._convertToYCellCoord(s),L=this._convertToXCellCoord(p),O=this._convertToYCellCoord(f);for(let V=A;V<=L;V++)for(let N=I;N<=O;N++)if(_.call(this,t,s,p,f,this.xCellCount*N+V,b,w,T))return}_convertToXCellCoord(t){return Math.max(0,Math.min(this.xCellCount-1,Math.floor(t*this.xScale)))}_convertToYCellCoord(t){return Math.max(0,Math.min(this.yCellCount-1,Math.floor(t*this.yScale)))}_circlesCollide(t,s,p,f,_,b){let w=f-t,T=_-s,A=p+b;return A*A>w*w+T*T}_circleAndRectCollide(t,s,p,f,_,b,w){let T=(b-f)/2,A=Math.abs(t-(f+T));if(A>T+p)return!1;let I=(w-_)/2,L=Math.abs(s-(_+I));if(L>I+p)return!1;if(A<=T||L<=I)return!0;let O=A-T,V=L-I;return O*O+V*V<=p*p}}let Tt=Math.tan(85*Math.PI/180);function yt(l,t,s,p,f,_,b){let w=o.create();if(s)if(_.name==="globe"){let T=o.calculateGlobeLabelMatrix(f,t);o.multiply(w,w,T)}else{let T=li([],b);w[0]=T[0],w[1]=T[1],w[4]=T[2],w[5]=T[3],p||o.rotateZ(w,w,f.angle)}else o.multiply(w,f.labelPlaneMatrix,l);return w}function kr(l,t,s,p,f,_,b){let w=yt(l,t,s,p,f,_,b);return _.name==="globe"&&s||(w[2]=w[6]=w[10]=w[14]=0),w}function Dn(l,t,s,p,f,_,b){if(s){if(_.name==="globe"){let w=yt(l,t,s,p,f,_,b);return o.invert(w,w),o.multiply(w,l,w),w}{let w=o.clone(l),T=o.identity([]);return T[0]=b[0],T[1]=b[1],T[4]=b[2],T[5]=b[3],o.multiply(w,w,T),p||o.rotateZ(w,w,-f.angle),w}}return f.glCoordMatrix}function ft(l,t,s=0){let p=[l.x,l.y,s,1];s?o.transformMat4$1(p,p,t):hi(p,p,t);let f=p[3];return{point:[p[0]/f,p[1]/f,p[2]/f],signedDistanceFromCamera:f}}function rn(l,t){let s=[l[0],l[1],l[2],1];o.transformMat4$1(s,s,t);let p=s[3];return{point:[s[0]/p,s[1]/p,s[2]/p],signedDistanceFromCamera:p}}function so(l,t){return Math.min(.5+l/t*.5,1.5)}function Qo(l,t){let s=l[0]/l[3],p=l[1]/l[3];return s>=-t[0]&&s<=t[0]&&p>=-t[1]&&p<=t[1]}function dr(l,t,s,p,f,_,b,w,T,A){let I=s.transform,L=p?l.textSizeData:l.iconSizeData,O=o.evaluateSizeForZoom(L,s.transform.zoom),V=I.projection.name==="globe",N=[256/s.width*2+1,256/s.height*2+1],j=p?l.text.dynamicLayoutVertexArray:l.icon.dynamicLayoutVertexArray;j.clear();let J=null;V&&(J=p?l.text.globeExtVertexArray:l.icon.globeExtVertexArray);let U=l.lineVertexArray,$=p?l.text.placedSymbolArray:l.icon.placedSymbolArray,q=s.transform.width/s.transform.height,ie=!1;for(let K=0;K<$.length;K++){let Q=$.get(K);if(Q.writingMode!==o.WritingMode.vertical||ie||K!==0&&$.get(K-1).writingMode===o.WritingMode.horizontal||(ie=!0),(Q.hidden||Q.writingMode===o.WritingMode.vertical)&&!ie){bi(Q.numGlyphs,j);continue}ie=!1;let ae=new o.pointGeometry(Q.tileAnchorX,Q.tileAnchorY),ye=T?T(ae):[0,0,0],be=I.projection.projectTilePoint(ae.x,ae.y,A.canonical),xe=[be.x+ye[0],be.y+ye[1],be.z+ye[2]],_e=[...xe,1];if(o.transformMat4$1(_e,_e,t),!Qo(_e,N)){bi(Q.numGlyphs,j);continue}let te=so(s.transform.cameraToCenterDistance,_e[3]),Ie=o.evaluateSizeForFeature(L,O,Q),Me=b?Ie/te:Ie*te,Ve=ft(new o.pointGeometry(xe[0],xe[1]),f,xe[2]);if(Ve.signedDistanceFromCamera<=0){bi(Q.numGlyphs,j);continue}let Te={},tt=b?null:T,Ue=ao(Q,Me,!1,w,t,f,_,l.glyphOffsetArray,U,j,J,Ve.point,ae,Te,q,tt,I.projection,A,b);ie=Ue.useVertical,tt&&Ue.needsFlipping&&(Te={}),(Ue.notEnoughRoom||ie||Ue.needsFlipping&&ao(Q,Me,!0,w,t,f,_,l.glyphOffsetArray,U,j,J,Ve.point,ae,Te,q,tt,I.projection,A,b).notEnoughRoom)&&bi(Q.numGlyphs,j)}p?(l.text.dynamicLayoutVertexBuffer.updateData(j),J&&l.text.globeExtVertexBuffer.updateData(J)):(l.icon.dynamicLayoutVertexBuffer.updateData(j),J&&l.icon.globeExtVertexBuffer.updateData(J))}function ri(l,t,s,p,f,_,b,w,T,A,I,L,O,V,N,j){let J=w.glyphStartIndex+w.numGlyphs,U=w.lineStartIndex,$=w.lineStartIndex+w.lineLength,q=t.getoffsetX(w.glyphStartIndex),ie=t.getoffsetX(J-1),K=co(l*q,s,p,f,_,b,w.segment,U,$,T,A,I,L,O,!0,V,N,j);if(!K)return null;let Q=co(l*ie,s,p,f,_,b,w.segment,U,$,T,A,I,L,O,!0,V,N,j);return Q?{first:K,last:Q}:null}function $c(l,t,s,p){return l.writingMode===o.WritingMode.horizontal&&Math.abs(s.y-t.y)>Math.abs(s.x-t.x)*p?{useVertical:!0}:l.writingMode===o.WritingMode.vertical?t.y<s.y?{needsFlipping:!0}:null:l.flipState!==0&&function(f,_,b){let w=(_.x-f.x)*b;return w===0||Math.abs((_.y-f.y)/w)>Tt}(t,s,p)?l.flipState===1?{needsFlipping:!0}:null:t.x>s.x?{needsFlipping:!0}:null}function ao(l,t,s,p,f,_,b,w,T,A,I,L,O,V,N,j,J,U,$){let q=t/24,ie=l.lineOffsetX*q,K=l.lineOffsetY*q,Q;if(l.numGlyphs>1){let ae=l.glyphStartIndex+l.numGlyphs,ye=l.lineStartIndex,be=l.lineStartIndex+l.lineLength,xe=ri(q,w,ie,K,s,L,O,l,T,_,V,j,!1,J,U,$);if(!xe)return{notEnoughRoom:!0};let _e=rn(xe.first.point,b).point,te=rn(xe.last.point,b).point,Ie=new o.pointGeometry(_e[0],_e[1]),Me=new o.pointGeometry(te[0],te[1]);if(p&&!s){let Ve=$c(l,Ie,Me,N);if(l.flipState=Ve&&Ve.needsFlipping?1:2,Ve)return Ve}Q=[xe.first];for(let Ve=l.glyphStartIndex+1;Ve<ae-1;Ve++)Q.push(co(q*w.getoffsetX(Ve),ie,K,s,L,O,l.segment,ye,be,T,_,V,j,!1,!1,J,U,$));Q.push(xe.last)}else{if(p&&!s){let ye=ft(O,f).point,be=l.lineStartIndex+l.segment+1,xe=new o.pointGeometry(T.getx(be),T.gety(be)),_e=ft(xe,f),te=_e.signedDistanceFromCamera>0?_e.point:lo(O,xe,ye,1,f,void 0,J,U.canonical),Ie=$c(l,new o.pointGeometry(ye[0],ye[1]),new o.pointGeometry(te[0],te[1]),N);if(l.flipState=Ie&&Ie.needsFlipping?1:2,Ie)return Ie}let ae=co(q*w.getoffsetX(l.glyphStartIndex),ie,K,s,L,O,l.segment,l.lineStartIndex,l.lineStartIndex+l.lineLength,T,_,V,j,!1,!1,J,U,$);if(!ae)return{notEnoughRoom:!0};Q=[ae]}if(I)for(let ae of Q)o.updateGlobeVertexNormal(I,A.length+0,ae.up[0],ae.up[1],ae.up[2]),o.updateGlobeVertexNormal(I,A.length+1,ae.up[0],ae.up[1],ae.up[2]),o.updateGlobeVertexNormal(I,A.length+2,ae.up[0],ae.up[1],ae.up[2]),o.updateGlobeVertexNormal(I,A.length+3,ae.up[0],ae.up[1],ae.up[2]),o.addDynamicAttributes(A,ae.point[0],ae.point[1],ae.point[2],ae.angle);else for(let ae of Q)o.addDynamicAttributes(A,ae.point[0],ae.point[1],ae.point[2],ae.angle);return{}}function ta(l,t,s,p,f){let _=p.projectTilePoint(l.x,l.y,t);if(!f)return ft(_,s,_.z);let b=f(l);return ft(new o.pointGeometry(_.x+b[0],_.y+b[1]),s,_.z+b[2])}function lo(l,t,s,p,f,_,b,w){let T=ta(l.add(l.sub(t)._unit()),w,f,b,_).point,A=o.sub([],s,T);return o.scaleAndAdd([],s,A,p/o.length(A))}function co(l,t,s,p,f,_,b,w,T,A,I,L,O,V,N,j,J,U){let $=p?l-t:l+t,q=$>0?1:-1,ie=0;p&&(q*=-1,ie=Math.PI),q<0&&(ie+=Math.PI);let K=q>0?w+b:w+b+1,Q=f,ae=f,ye=0,be=0,xe=Math.abs($),_e=[],te=[],Ie=_,Me=()=>{let et=K-q;return ye===0?_:new o.pointGeometry(A.getx(et),A.gety(et))},Ve=()=>lo(Me(),Ie,ae,xe-ye+1,I,O,j,J.canonical);for(;ye+be<=xe;){if(K+=q,K<w||K>=T)return null;if(ae=Q,_e.push(Q),V&&te.push(Ie||Me()),Q=L[K],Q===void 0){Ie=new o.pointGeometry(A.getx(K),A.gety(K));let et=ta(Ie,J.canonical,I,j,O);Q=et.signedDistanceFromCamera>0?L[K]=et.point:Ve()}else Ie=null;ye+=be,be=o.distance(ae,Q)}Ie=Ie||new o.pointGeometry(A.getx(K),A.gety(K));let Te=Me();N&&O&&(L[K]=Q=L[K]===void 0?Q:Ve(),be=o.distance(ae,Q));let tt=(xe-ye)/be,Ue=Ie.sub(Te).mult(tt)._add(Te),je=o.sub([],Q,ae),Fe=o.scaleAndAdd([],ae,je,tt),Oe=[0,0,1],ht=je[0],rt=je[1];if(U&&(Oe=j.upVector(J.canonical,Ue.x,Ue.y),Oe[0]!==0||Oe[1]!==0||Oe[2]!==1)){let et=[1,0,0],pt=[0,1,0];et[0]=Oe[2],et[1]=0,et[2]=-Oe[0],o.cross(pt,Oe,et),o.normalize(et,et),o.normalize(pt,pt),ht=o.dot(je,et),rt=o.dot(je,pt)}if(s){let et=o.cross([],Oe,je);o.normalize(et,et),o.scaleAndAdd(Fe,Fe,et,s*q)}let mt=ie+Math.atan2(rt,ht);return _e.push(Fe),V&&te.push(Ue),{point:Fe,angle:mt,path:_e,tilePath:te,up:Oe}}let qc=new Float32Array([-1/0,-1/0,0,-1/0,-1/0,0,-1/0,-1/0,0,-1/0,-1/0,0,-1/0,-1/0,0]);function bi(l,t){for(let s=0;s<l;s++){let p=t.length;t.resize(p+4),t.float32.set(qc,4*p)}}function hi(l,t,s){let p=t[0],f=t[1];return l[0]=s[0]*p+s[4]*f+s[12],l[1]=s[1]*p+s[5]*f+s[13],l[3]=s[3]*p+s[7]*f+s[15],l}let fr=100;class cl{constructor(t,s,p=new $e(t.width+200,t.height+200,25),f=new $e(t.width+200,t.height+200,25)){this.transform=t,this.grid=p,this.ignoredGrid=f,this.pitchfactor=Math.cos(t._pitch)*t.cameraToCenterDistance,this.screenRightBoundary=t.width+fr,this.screenBottomBoundary=t.height+fr,this.gridRightBoundary=t.width+200,this.gridBottomBoundary=t.height+200,this.fogState=s}placeCollisionBox(t,s,p,f,_,b,w,T){let A=p.projectedAnchorX,I=p.projectedAnchorY,L=p.projectedAnchorZ,O=p.elevation,V=p.tileID;if(O&&V){let K=t.getProjection().upVector(V.canonical,p.tileAnchorX,p.tileAnchorY),Q=t.getProjection().upVectorScale(V.canonical,this.transform.center.lat,this.transform.worldSize).metersToTile;A+=K[0]*O*Q,I+=K[1]*O*Q,L+=K[2]*O*Q}let N=this.projectAndGetPerspectiveRatio(w,[A,I,L],p.tileID,t.projection.name==="globe"||!!O||this.transform.pitch>0,t.getProjection()),j=b*N.perspectiveRatio,J=(p.x1*s+f.x-p.padding)*j+N.point.x,U=(p.y1*s+f.y-p.padding)*j+N.point.y,$=(p.x2*s+f.x+p.padding)*j+N.point.x,q=(p.y2*s+f.y+p.padding)*j+N.point.y,ie=N.perspectiveRatio<=.55||N.occluded;return!this.isInsideGrid(J,U,$,q)||!_&&this.grid.hitTest(J,U,$,q,T)||ie?{box:[],offscreen:!1,occluded:N.occluded}:{box:[J,U,$,q],offscreen:this.isOffscreen(J,U,$,q),occluded:!1}}placeCollisionCircles(t,s,p,f,_,b,w,T,A,I,L,O,V,N,j){let J=[],U=this.transform.elevation,$=U?U.getAtTileOffsetFunc(j,this.transform.center.lat,this.transform.worldSize,t.getProjection()):Te=>[0,0,0],q=new o.pointGeometry(p.tileAnchorX,p.tileAnchorY),ie=t.getProjection().projectTilePoint(p.tileAnchorX,p.tileAnchorY,j.canonical),K=$(q),Q=[ie.x+K[0],ie.y+K[1],ie.z+K[2]],ae=t.projection.name==="globe",ye=this.projectAndGetPerspectiveRatio(w,[Q[0],Q[1],Q[2]],j,ae||!!U||this.transform.pitch>0,t.getProjection()),{perspectiveRatio:be}=ye,xe=(L?b/be:b*be)/o.ONE_EM,_e=ft(new o.pointGeometry(Q[0],Q[1]),T,Q[2]).point,te=ye.signedDistanceFromCamera>0?ri(xe,_,p.lineOffsetX*xe,p.lineOffsetY*xe,!1,_e,q,p,f,T,{},U&&!L?$:null,L&&!!U,t.getProjection(),j,L):null,Ie=!1,Me=!1,Ve=!0;if(te&&!ye.occluded){let Te=.5*V*be+N,tt=new o.pointGeometry(-100,-100),Ue=new o.pointGeometry(this.screenRightBoundary,this.screenBottomBoundary),je=new Jo,Fe=te.first,Oe=te.last,ht=[];for(let et=Fe.path.length-1;et>=1;et--)ht.push(Fe.path[et]);for(let et=1;et<Oe.path.length;et++)ht.push(Oe.path[et]);let rt=2.5*Te;if(A){let et=ht.map(U&&!ae?(pt,Ot)=>{let Gt=$(Ot<Fe.path.length-1?Fe.tilePath[Fe.path.length-1-Ot]:Oe.tilePath[Ot-Fe.path.length+2]);return pt[2]=Gt[2],rn(pt,A)}:pt=>rn(pt,A));ht=et.some(pt=>pt.signedDistanceFromCamera<=0)?[]:et.map(pt=>pt.point)}let mt=[];if(ht.length>0){let et=ht.map(Zt=>new o.pointGeometry(Zt[0],Zt[1])),pt=1/0,Ot=-1/0,Gt=1/0,di=-1/0;for(let Zt=0;Zt<et.length;Zt++)pt=Math.min(pt,et[Zt].x),Gt=Math.min(Gt,et[Zt].y),Ot=Math.max(Ot,et[Zt].x),di=Math.max(di,et[Zt].y);mt=pt>=tt.x&&Ot<=Ue.x&&Gt>=tt.y&&di<=Ue.y?[et]:Ot<tt.x||pt>Ue.x||di<tt.y||Gt>Ue.y?[]:o.clipLine([et],tt.x,tt.y,Ue.x,Ue.y)}for(let et of mt){je.reset(et,.25*Te);let pt=0;pt=je.length<=.5*Te?1:Math.ceil(je.paddedLength/rt)+1;for(let Ot=0;Ot<pt;Ot++){let Gt=Ot/Math.max(pt-1,1),di=je.lerp(Gt),Zt=di.x+fr,nr=di.y+fr;J.push(Zt,nr,Te,0);let jr=Zt-Te,an=nr-Te,Jt=Zt+Te,ei=nr+Te;if(Ve=Ve&&this.isOffscreen(jr,an,Jt,ei),Me=Me||this.isInsideGrid(jr,an,Jt,ei),!s&&this.grid.hitTestCircle(Zt,nr,Te,O)&&(Ie=!0,!I))return{circles:[],offscreen:!1,collisionDetected:Ie,occluded:!1}}}}return{circles:!I&&Ie||!Me?[]:J,offscreen:Ve,collisionDetected:Ie,occluded:ye.occluded}}queryRenderedSymbols(t){if(t.length===0||this.grid.keysLength()===0&&this.ignoredGrid.keysLength()===0)return{};let s=[],p=1/0,f=1/0,_=-1/0,b=-1/0;for(let I of t){let L=new o.pointGeometry(I.x+fr,I.y+fr);p=Math.min(p,L.x),f=Math.min(f,L.y),_=Math.max(_,L.x),b=Math.max(b,L.y),s.push(L)}let w=this.grid.query(p,f,_,b).concat(this.ignoredGrid.query(p,f,_,b)),T={},A={};for(let I of w){let L=I.key;if(T[L.bucketInstanceId]===void 0&&(T[L.bucketInstanceId]={}),T[L.bucketInstanceId][L.featureIndex])continue;let O=[new o.pointGeometry(I.x1,I.y1),new o.pointGeometry(I.x2,I.y1),new o.pointGeometry(I.x2,I.y2),new o.pointGeometry(I.x1,I.y2)];o.polygonIntersectsPolygon(s,O)&&(T[L.bucketInstanceId][L.featureIndex]=!0,A[L.bucketInstanceId]===void 0&&(A[L.bucketInstanceId]=[]),A[L.bucketInstanceId].push(L.featureIndex))}return A}insertCollisionBox(t,s,p,f,_){(s?this.ignoredGrid:this.grid).insert({bucketInstanceId:p,featureIndex:f,collisionGroupID:_},t[0],t[1],t[2],t[3])}insertCollisionCircles(t,s,p,f,_){let b=s?this.ignoredGrid:this.grid,w={bucketInstanceId:p,featureIndex:f,collisionGroupID:_};for(let T=0;T<t.length;T+=4)b.insertCircle(w,t[T],t[T+1],t[T+2])}projectAndGetPerspectiveRatio(t,s,p,f,_){let b=[s[0],s[1],s[2],1],w=!1;if(s[2]||this.transform.pitch>0){o.transformMat4$1(b,b,t);let T=_.name==="globe";this.fogState&&p&&!T&&(w=function(A,I,L,O,V,N){let j=N.calculateFogTileMatrix(V),J=[I,L,O];return o.transformMat4(J,J,j),Ri(A,J,N.pitch,N._fov)}(this.fogState,s[0],s[1],s[2],p.toUnwrapped(),this.transform)>.9)}else hi(b,b,t);return{point:new o.pointGeometry((b[0]/b[3]+1)/2*this.transform.width+fr,(-b[1]/b[3]+1)/2*this.transform.height+fr),perspectiveRatio:Math.min(.5+this.transform.getCameraToCenterDistance(_)/b[3]*.5,1.5),signedDistanceFromCamera:b[3],occluded:f&&b[2]>b[3]||w}}isOffscreen(t,s,p,f){return p<fr||t>=this.screenRightBoundary||f<fr||s>this.screenBottomBoundary}isInsideGrid(t,s,p,f){return p>=0&&t<this.gridRightBoundary&&f>=0&&s<this.gridBottomBoundary}getViewportMatrix(){let t=o.identity([]);return o.translate(t,t,[-100,-100,0]),t}}function Oi(l,t,s){let p=t.createTileMatrix(l,l.worldSize,s.toUnwrapped());return o.multiply(new Float32Array(16),l.projMatrix,p)}function mr(l,t,s){if(t.projection.name===s.projection.name)return l.projMatrix;let p=s.clone();return p.setProjection(t.projection),Oi(p,t.getProjection(),l)}function ia(l,t,s){return t.name===s.projection.name?l.projMatrix:Oi(s,t,l)}class es{constructor(t,s,p,f){this.opacity=t?Math.max(0,Math.min(1,t.opacity+(t.placed?s:-s))):f&&p?1:0,this.placed=p}isHidden(){return this.opacity===0&&!this.placed}}class si{constructor(t,s,p,f,_,b=!1){this.text=new es(t?t.text:null,s,p,_),this.icon=new es(t?t.icon:null,s,f,_),this.clipped=b}isHidden(){return this.text.isHidden()&&this.icon.isHidden()}}class Ln{constructor(t,s,p,f=!1){this.text=t,this.icon=s,this.skipFade=p,this.clipped=f}}class hl{constructor(){this.invProjMatrix=o.create(),this.viewportMatrix=o.create(),this.circles=[]}}class ts{constructor(t,s,p,f,_){this.bucketInstanceId=t,this.featureIndex=s,this.sourceLayerIndex=p,this.bucketIndex=f,this.tileID=_}}class zi{constructor(t){this.crossSourceCollisions=t,this.maxGroupID=0,this.collisionGroups={}}get(t){if(this.crossSourceCollisions)return{ID:0,predicate:null};if(!this.collisionGroups[t]){let s=++this.maxGroupID;this.collisionGroups[t]={ID:s,predicate:p=>p.collisionGroupID===s}}return this.collisionGroups[t]}}function ra(l,t,s,p,f){let{horizontalAlign:_,verticalAlign:b}=o.getAnchorAlignment(l),w=-(_-.5)*t,T=-(b-.5)*s,A=o.evaluateVariableOffset(l,p);return new o.pointGeometry(w+A[0]*f,T+A[1]*f)}function is(l,t,s,p,f){let _=new o.pointGeometry(l,t);return s&&_._rotate(p?f:-f),_}class nn{constructor(t,s,p,f,_){this.transform=t.clone(),this.projection=t.projection.name,this.collisionIndex=new cl(this.transform,_),this.placements={},this.opacities={},this.variableOffsets={},this.stale=!1,this.commitTime=0,this.fadeDuration=s,this.retainedQueryData={},this.collisionGroups=new zi(p),this.collisionCircleArrays={},this.prevPlacement=f,f&&(f.prevPlacement=void 0),this.placedOrientations={}}getBucketParts(t,s,p,f){let _=p.getBucket(s),b=p.latestFeatureIndex;if(!_||!b||s.id!==_.layerIds[0])return;let w=_.layers[0].layout,T=p.collisionBoxArray,A=Math.pow(2,this.transform.zoom-p.tileID.overscaledZ),I=p.tileSize/o.EXTENT,L=p.tileID.toUnwrapped();this.transform.setProjection(_.projection);let O=(V=p.tileID,N=_.getProjection(),j=this.transform,N.name===this.projection?j.calculateProjMatrix(V.toUnwrapped()):Oi(j,N,V));var V,N,j;let J=w.get("text-pitch-alignment")==="map",U=w.get("text-rotation-alignment")==="map";s.compileFilter();let $=s.dynamicFilter(),q=s.dynamicFilterNeedsFeature(),ie=this.transform.calculatePixelsToTileUnitsMatrix(p),K=kr(O,p.tileID.canonical,J,U,this.transform,_.getProjection(),ie),Q=null;if(J){let be=Dn(O,p.tileID.canonical,J,U,this.transform,_.getProjection(),ie);Q=o.multiply([],this.transform.labelPlaneMatrix,be)}let ae=null;$&&p.latestFeatureIndex&&(ae={unwrappedTileID:L,dynamicFilter:$,dynamicFilterNeedsFeature:q,featureIndex:p.latestFeatureIndex}),this.retainedQueryData[_.bucketInstanceId]=new ts(_.bucketInstanceId,b,_.sourceLayerIndex,_.index,p.tileID);let ye={bucket:_,layout:w,posMatrix:O,textLabelPlaneMatrix:K,labelToScreenMatrix:Q,clippingData:ae,scale:A,textPixelRatio:I,holdingForFade:p.holdingForFade(),collisionBoxArray:T,partiallyEvaluatedTextSize:o.evaluateSizeForZoom(_.textSizeData,this.transform.zoom),partiallyEvaluatedIconSize:o.evaluateSizeForZoom(_.iconSizeData,this.transform.zoom),collisionGroup:this.collisionGroups.get(_.sourceID)};if(f)for(let be of _.sortKeyRanges){let{sortKey:xe,symbolInstanceStart:_e,symbolInstanceEnd:te}=be;t.push({sortKey:xe,symbolInstanceStart:_e,symbolInstanceEnd:te,parameters:ye})}else t.push({symbolInstanceStart:0,symbolInstanceEnd:_.symbolInstances.length,parameters:ye})}attemptAnchorPlacement(t,s,p,f,_,b,w,T,A,I,L,O,V,N,j,J,U,$){let q=[O.textOffset0,O.textOffset1],ie=ra(t,p,f,q,_),K=this.collisionIndex.placeCollisionBox(N,_,s,is(ie.x,ie.y,b,w,this.transform.angle),L,T,A,I.predicate);if((!J||this.collisionIndex.placeCollisionBox(N,N.getSymbolInstanceIconSize($,this.transform.zoom,V),J,is(ie.x,ie.y,b,w,this.transform.angle),L,T,A,I.predicate).box.length!==0)&&K.box.length>0){let Q;return this.prevPlacement&&this.prevPlacement.variableOffsets[O.crossTileID]&&this.prevPlacement.placements[O.crossTileID]&&this.prevPlacement.placements[O.crossTileID].text&&(Q=this.prevPlacement.variableOffsets[O.crossTileID].anchor),this.variableOffsets[O.crossTileID]={textOffset:q,width:p,height:f,anchor:t,textScale:_,prevAnchor:Q},this.markUsedJustification(N,t,O,j),N.allowVerticalPlacement&&(this.markUsedOrientation(N,j,O),this.placedOrientations[O.crossTileID]=j),{shift:ie,placedGlyphBoxes:K}}}placeLayerBucketPart(t,s,p,f){let{bucket:_,layout:b,posMatrix:w,textLabelPlaneMatrix:T,labelToScreenMatrix:A,clippingData:I,textPixelRatio:L,holdingForFade:O,collisionBoxArray:V,partiallyEvaluatedTextSize:N,partiallyEvaluatedIconSize:j,collisionGroup:J}=t.parameters,U=b.get("text-optional"),$=b.get("icon-optional"),q=b.get("text-allow-overlap"),ie=b.get("icon-allow-overlap"),K=b.get("text-rotation-alignment")==="map",Q=b.get("text-pitch-alignment")==="map",ae=b.get("icon-text-fit")!=="none",ye=b.get("symbol-z-order")==="viewport-y";this.transform.setProjection(_.projection);let be=q&&(ie||!_.hasIconData()||$),xe=ie&&(q||!_.hasTextData()||U);!_.collisionArrays&&V&&_.deserializeCollisionBoxes(V),p&&f&&_.updateCollisionDebugBuffers(this.transform.zoom,V);let _e=(te,Ie,Me)=>{if(I){let Jt={zoom:this.transform.zoom,pitch:this.transform.pitch},ei=null;if(I.dynamicFilterNeedsFeature){let jt=this.retainedQueryData[_.bucketInstanceId];ei=I.featureIndex.loadFeature({featureIndex:te.featureIndex,bucketIndex:jt.bucketIndex,sourceLayerIndex:jt.sourceLayerIndex,layoutVertexArrayOffset:0})}if(!(0,I.dynamicFilter)(Jt,ei,this.retainedQueryData[_.bucketInstanceId].tileID.canonical,new o.pointGeometry(te.tileAnchorX,te.tileAnchorY),this.transform.calculateDistanceTileData(I.unwrappedTileID)))return this.placements[te.crossTileID]=new Ln(!1,!1,!1,!0),void(s[te.crossTileID]=!0)}if(s[te.crossTileID])return;if(O)return void(this.placements[te.crossTileID]=new Ln(!1,!1,!1));let Ve=!1,Te=!1,tt=!0,Ue=!1,je=!1,Fe=null,Oe={box:null,offscreen:null,occluded:null},ht={box:null,offscreen:null,occluded:null},rt=null,mt=null,et=null,pt=0,Ot=0,Gt=0;Me.textFeatureIndex?pt=Me.textFeatureIndex:te.useRuntimeCollisionCircles&&(pt=te.featureIndex),Me.verticalTextFeatureIndex&&(Ot=Me.verticalTextFeatureIndex);let di=Jt=>{Jt.tileID=this.retainedQueryData[_.bucketInstanceId].tileID,(this.transform.elevation||Jt.elevation)&&(Jt.elevation=this.transform.elevation?this.transform.elevation.getAtTileOffset(this.retainedQueryData[_.bucketInstanceId].tileID,Jt.tileAnchorX,Jt.tileAnchorY):0)},Zt=Me.textBox;if(Zt){di(Zt);let Jt=jt=>{let _i=o.WritingMode.horizontal;if(_.allowVerticalPlacement&&!jt&&this.prevPlacement){let Pi=this.prevPlacement.placedOrientations[te.crossTileID];Pi&&(this.placedOrientations[te.crossTileID]=Pi,_i=Pi,this.markUsedOrientation(_,_i,te))}return _i},ei=(jt,_i)=>{if(_.allowVerticalPlacement&&te.numVerticalGlyphVertices>0&&Me.verticalTextBox){for(let Pi of _.writingModes)if(Pi===o.WritingMode.vertical?(Oe=_i(),ht=Oe):Oe=jt(),Oe&&Oe.box&&Oe.box.length)break}else Oe=jt()};if(b.get("text-variable-anchor")){let jt=b.get("text-variable-anchor");if(this.prevPlacement&&this.prevPlacement.variableOffsets[te.crossTileID]){let Mt=this.prevPlacement.variableOffsets[te.crossTileID];jt.indexOf(Mt.anchor)>0&&(jt=jt.filter(qi=>qi!==Mt.anchor),jt.unshift(Mt.anchor))}let _i=(Mt,qi,Gn)=>{let Mr=_.getSymbolInstanceTextSize(N,te,this.transform.zoom,Ie),To=(Mt.x2-Mt.x1)*Mr+2*Mt.padding,Co=(Mt.y2-Mt.y1)*Mr+2*Mt.padding,_n=ae&&!ie?qi:null;_n&&di(_n);let yi={box:[],offscreen:!1,occluded:!1},Ur=q?2*jt.length:jt.length;for(let ln=0;ln<Ur;++ln){let ws=this.attemptAnchorPlacement(jt[ln%jt.length],Mt,To,Co,Mr,K,Q,L,w,J,ln>=jt.length,te,Ie,_,Gn,_n,N,j);if(ws&&(yi=ws.placedGlyphBoxes,yi&&yi.box&&yi.box.length)){Ve=!0,Fe=ws.shift;break}}return yi};ei(()=>_i(Zt,Me.iconBox,o.WritingMode.horizontal),()=>{let Mt=Me.verticalTextBox;return Mt&&di(Mt),_.allowVerticalPlacement&&!(Oe&&Oe.box&&Oe.box.length)&&te.numVerticalGlyphVertices>0&&Mt?_i(Mt,Me.verticalIconBox,o.WritingMode.vertical):{box:null,offscreen:null,occluded:null}}),Oe&&(Ve=Oe.box,tt=Oe.offscreen,Ue=Oe.occluded);let Pi=Jt(Oe&&Oe.box);if(!Ve&&this.prevPlacement){let Mt=this.prevPlacement.variableOffsets[te.crossTileID];Mt&&(this.variableOffsets[te.crossTileID]=Mt,this.markUsedJustification(_,Mt.anchor,te,Pi))}}else{let jt=(_i,Pi)=>{let Mt=_.getSymbolInstanceTextSize(N,te,this.transform.zoom,Ie),qi=this.collisionIndex.placeCollisionBox(_,Mt,_i,new o.pointGeometry(0,0),q,L,w,J.predicate);return qi&&qi.box&&qi.box.length&&(this.markUsedOrientation(_,Pi,te),this.placedOrientations[te.crossTileID]=Pi),qi};ei(()=>jt(Zt,o.WritingMode.horizontal),()=>{let _i=Me.verticalTextBox;return _.allowVerticalPlacement&&te.numVerticalGlyphVertices>0&&_i?(di(_i),jt(_i,o.WritingMode.vertical)):{box:null,offscreen:null,occluded:null}}),Jt(Oe&&Oe.box&&Oe.box.length)}}if(rt=Oe,Ve=rt&&rt.box&&rt.box.length>0,tt=rt&&rt.offscreen,Ue=rt&&rt.occluded,te.useRuntimeCollisionCircles){let Jt=_.text.placedSymbolArray.get(te.centerJustifiedTextSymbolIndex>=0?te.centerJustifiedTextSymbolIndex:te.verticalPlacedTextSymbolIndex),ei=o.evaluateSizeForFeature(_.textSizeData,N,Jt),jt=b.get("text-padding");mt=this.collisionIndex.placeCollisionCircles(_,q,Jt,_.lineVertexArray,_.glyphOffsetArray,ei,w,T,A,p,Q,J.predicate,te.collisionCircleDiameter*ei/o.ONE_EM,jt,this.retainedQueryData[_.bucketInstanceId].tileID),Ve=q||mt.circles.length>0&&!mt.collisionDetected,tt=tt&&mt.offscreen,Ue=mt.occluded}if(Me.iconFeatureIndex&&(Gt=Me.iconFeatureIndex),Me.iconBox){let Jt=ei=>{di(ei);let jt=ae&&Fe?is(Fe.x,Fe.y,K,Q,this.transform.angle):new o.pointGeometry(0,0),_i=_.getSymbolInstanceIconSize(j,this.transform.zoom,Ie);return this.collisionIndex.placeCollisionBox(_,_i,ei,jt,ie,L,w,J.predicate)};ht&&ht.box&&ht.box.length&&Me.verticalIconBox?(et=Jt(Me.verticalIconBox),Te=et.box.length>0):(et=Jt(Me.iconBox),Te=et.box.length>0),tt=tt&&et.offscreen,je=et.occluded}let nr=U||te.numHorizontalGlyphVertices===0&&te.numVerticalGlyphVertices===0,jr=$||te.numIconVertices===0;if(nr||jr?jr?nr||(Te=Te&&Ve):Ve=Te&&Ve:Te=Ve=Te&&Ve,Ve&&rt&&rt.box&&this.collisionIndex.insertCollisionBox(rt.box,b.get("text-ignore-placement"),_.bucketInstanceId,ht&&ht.box&&Ot?Ot:pt,J.ID),Te&&et&&this.collisionIndex.insertCollisionBox(et.box,b.get("icon-ignore-placement"),_.bucketInstanceId,Gt,J.ID),mt&&(Ve&&this.collisionIndex.insertCollisionCircles(mt.circles,b.get("text-ignore-placement"),_.bucketInstanceId,pt,J.ID),p)){let Jt=_.bucketInstanceId,ei=this.collisionCircleArrays[Jt];ei===void 0&&(ei=this.collisionCircleArrays[Jt]=new hl);for(let jt=0;jt<mt.circles.length;jt+=4)ei.circles.push(mt.circles[jt+0]),ei.circles.push(mt.circles[jt+1]),ei.circles.push(mt.circles[jt+2]),ei.circles.push(mt.collisionDetected?1:0)}let an=_.projection.name!=="globe";be=be&&(an||!Ue),xe=xe&&(an||!je),this.placements[te.crossTileID]=new Ln(Ve||be,Te||xe,tt||_.justReloaded),s[te.crossTileID]=!0};if(ye){let te=_.getSortedSymbolIndexes(this.transform.angle);for(let Ie=te.length-1;Ie>=0;--Ie){let Me=te[Ie];_e(_.symbolInstances.get(Me),Me,_.collisionArrays[Me])}}else for(let te=t.symbolInstanceStart;te<t.symbolInstanceEnd;te++)_e(_.symbolInstances.get(te),te,_.collisionArrays[te]);if(p&&_.bucketInstanceId in this.collisionCircleArrays){let te=this.collisionCircleArrays[_.bucketInstanceId];o.invert(te.invProjMatrix,w),te.viewportMatrix=this.collisionIndex.getViewportMatrix()}_.justReloaded=!1}markUsedJustification(t,s,p,f){let _;_=f===o.WritingMode.vertical?p.verticalPlacedTextSymbolIndex:{left:p.leftJustifiedTextSymbolIndex,center:p.centerJustifiedTextSymbolIndex,right:p.rightJustifiedTextSymbolIndex}[o.getAnchorJustification(s)];let b=[p.leftJustifiedTextSymbolIndex,p.centerJustifiedTextSymbolIndex,p.rightJustifiedTextSymbolIndex,p.verticalPlacedTextSymbolIndex];for(let w of b)w>=0&&(t.text.placedSymbolArray.get(w).crossTileID=_>=0&&w!==_?0:p.crossTileID)}markUsedOrientation(t,s,p){let f=s===o.WritingMode.horizontal||s===o.WritingMode.horizontalOnly?s:0,_=s===o.WritingMode.vertical?s:0,b=[p.leftJustifiedTextSymbolIndex,p.centerJustifiedTextSymbolIndex,p.rightJustifiedTextSymbolIndex];for(let w of b)t.text.placedSymbolArray.get(w).placedOrientation=f;p.verticalPlacedTextSymbolIndex&&(t.text.placedSymbolArray.get(p.verticalPlacedTextSymbolIndex).placedOrientation=_)}commit(t){this.commitTime=t,this.zoomAtLastRecencyCheck=this.transform.zoom;let s=this.prevPlacement,p=!1;this.prevZoomAdjustment=s?s.zoomAdjustment(this.transform.zoom):0;let f=s?s.symbolFadeChange(t):1,_=s?s.opacities:{},b=s?s.variableOffsets:{},w=s?s.placedOrientations:{};for(let T in this.placements){let A=this.placements[T],I=_[T];I?(this.opacities[T]=new si(I,f,A.text,A.icon,null,A.clipped),p=p||A.text!==I.text.placed||A.icon!==I.icon.placed):(this.opacities[T]=new si(null,f,A.text,A.icon,A.skipFade,A.clipped),p=p||A.text||A.icon)}for(let T in _){let A=_[T];if(!this.opacities[T]){let I=new si(A,f,!1,!1);I.isHidden()||(this.opacities[T]=I,p=p||A.text.placed||A.icon.placed)}}for(let T in b)this.variableOffsets[T]||!this.opacities[T]||this.opacities[T].isHidden()||(this.variableOffsets[T]=b[T]);for(let T in w)this.placedOrientations[T]||!this.opacities[T]||this.opacities[T].isHidden()||(this.placedOrientations[T]=w[T]);p?this.lastPlacementChangeTime=t:typeof this.lastPlacementChangeTime!="number"&&(this.lastPlacementChangeTime=s?s.lastPlacementChangeTime:t)}updateLayerOpacities(t,s){let p={};for(let f of s){let _=f.getBucket(t);_&&f.latestFeatureIndex&&t.id===_.layerIds[0]&&this.updateBucketOpacities(_,p,f.collisionBoxArray)}}updateBucketOpacities(t,s,p){t.hasTextData()&&t.text.opacityVertexArray.clear(),t.hasIconData()&&t.icon.opacityVertexArray.clear(),t.hasIconCollisionBoxData()&&t.iconCollisionBox.collisionVertexArray.clear(),t.hasTextCollisionBoxData()&&t.textCollisionBox.collisionVertexArray.clear();let f=t.layers[0].layout,_=!!t.layers[0].dynamicFilter(),b=new si(null,0,!1,!1,!0),w=f.get("text-allow-overlap"),T=f.get("icon-allow-overlap"),A=f.get("text-variable-anchor"),I=f.get("text-rotation-alignment")==="map",L=f.get("text-pitch-alignment")==="map",O=f.get("icon-text-fit")!=="none",V=new si(null,0,w&&(T||!t.hasIconData()||f.get("icon-optional")),T&&(w||!t.hasTextData()||f.get("text-optional")),!0);!t.collisionArrays&&p&&(t.hasIconCollisionBoxData()||t.hasTextCollisionBoxData())&&t.deserializeCollisionBoxes(p);let N=(J,U,$)=>{for(let q=0;q<U/4;q++)J.opacityVertexArray.emplaceBack($)},j=0;for(let J=0;J<t.symbolInstances.length;J++){let U=t.symbolInstances.get(J),{numHorizontalGlyphVertices:$,numVerticalGlyphVertices:q,crossTileID:ie}=U,K=this.opacities[ie];s[ie]?K=b:K||(K=V,this.opacities[ie]=K),s[ie]=!0;let Q=$>0||q>0,ae=U.numIconVertices>0,ye=this.placedOrientations[U.crossTileID],be=ye===o.WritingMode.vertical,xe=ye===o.WritingMode.horizontal||ye===o.WritingMode.horizontalOnly;if(!Q&&!ae||K.isHidden()||j++,Q){let _e=on(K.text);N(t.text,$,be?Bn:_e),N(t.text,q,xe?Bn:_e);let te=K.text.isHidden();[U.rightJustifiedTextSymbolIndex,U.centerJustifiedTextSymbolIndex,U.leftJustifiedTextSymbolIndex].forEach(Ve=>{Ve>=0&&(t.text.placedSymbolArray.get(Ve).hidden=te||be?1:0)}),U.verticalPlacedTextSymbolIndex>=0&&(t.text.placedSymbolArray.get(U.verticalPlacedTextSymbolIndex).hidden=te||xe?1:0);let Ie=this.variableOffsets[U.crossTileID];Ie&&this.markUsedJustification(t,Ie.anchor,U,ye);let Me=this.placedOrientations[U.crossTileID];Me&&(this.markUsedJustification(t,"left",U,Me),this.markUsedOrientation(t,Me,U))}if(ae){let _e=on(K.icon);U.placedIconSymbolIndex>=0&&(N(t.icon,U.numIconVertices,be?Bn:_e),t.icon.placedSymbolArray.get(U.placedIconSymbolIndex).hidden=K.icon.isHidden()),U.verticalPlacedIconSymbolIndex>=0&&(N(t.icon,U.numVerticalIconVertices,xe?Bn:_e),t.icon.placedSymbolArray.get(U.verticalPlacedIconSymbolIndex).hidden=K.icon.isHidden())}if(t.hasIconCollisionBoxData()||t.hasTextCollisionBoxData()){let _e=t.collisionArrays[J];if(_e){let te=new o.pointGeometry(0,0),Ie=!0;if(_e.textBox||_e.verticalTextBox){if(A){let Ve=this.variableOffsets[ie];Ve?(te=ra(Ve.anchor,Ve.width,Ve.height,Ve.textOffset,Ve.textScale),I&&te._rotate(L?this.transform.angle:-this.transform.angle)):Ie=!1}_&&(Ie=!K.clipped),_e.textBox&&mn(t.textCollisionBox.collisionVertexArray,K.text.placed,!Ie||be,te.x,te.y),_e.verticalTextBox&&mn(t.textCollisionBox.collisionVertexArray,K.text.placed,!Ie||xe,te.x,te.y)}let Me=Ie&&Boolean(!xe&&_e.verticalIconBox);_e.iconBox&&mn(t.iconCollisionBox.collisionVertexArray,K.icon.placed,Me,O?te.x:0,O?te.y:0),_e.verticalIconBox&&mn(t.iconCollisionBox.collisionVertexArray,K.icon.placed,!Me,O?te.x:0,O?te.y:0)}}}if(t.fullyClipped=j===0,t.sortFeatures(this.transform.angle),this.retainedQueryData[t.bucketInstanceId]&&(this.retainedQueryData[t.bucketInstanceId].featureSortOrder=t.featureSortOrder),t.hasTextData()&&t.text.opacityVertexBuffer&&t.text.opacityVertexBuffer.updateData(t.text.opacityVertexArray),t.hasIconData()&&t.icon.opacityVertexBuffer&&t.icon.opacityVertexBuffer.updateData(t.icon.opacityVertexArray),t.hasIconCollisionBoxData()&&t.iconCollisionBox.collisionVertexBuffer&&t.iconCollisionBox.collisionVertexBuffer.updateData(t.iconCollisionBox.collisionVertexArray),t.hasTextCollisionBoxData()&&t.textCollisionBox.collisionVertexBuffer&&t.textCollisionBox.collisionVertexBuffer.updateData(t.textCollisionBox.collisionVertexArray),t.bucketInstanceId in this.collisionCircleArrays){let J=this.collisionCircleArrays[t.bucketInstanceId];t.placementInvProjMatrix=J.invProjMatrix,t.placementViewportMatrix=J.viewportMatrix,t.collisionCircleArray=J.circles,delete this.collisionCircleArrays[t.bucketInstanceId]}}symbolFadeChange(t){return this.fadeDuration===0?1:(t-this.commitTime)/this.fadeDuration+this.prevZoomAdjustment}zoomAdjustment(t){return Math.max(0,(this.transform.zoom-t)/1.5)}hasTransitions(t){return this.stale||t-this.lastPlacementChangeTime<this.fadeDuration}stillRecent(t,s){let p=this.zoomAtLastRecencyCheck===s?1-this.zoomAdjustment(s):1;return this.zoomAtLastRecencyCheck=s,this.commitTime+this.fadeDuration*p>t}setStale(){this.stale=!0}}function mn(l,t,s,p,f){l.emplaceBack(t?1:0,s?1:0,p||0,f||0),l.emplaceBack(t?1:0,s?1:0,p||0,f||0),l.emplaceBack(t?1:0,s?1:0,p||0,f||0),l.emplaceBack(t?1:0,s?1:0,p||0,f||0)}let na=Math.pow(2,25),rp=Math.pow(2,24),ul=Math.pow(2,17),ho=Math.pow(2,16),np=Math.pow(2,9),Zc=Math.pow(2,8),uo=Math.pow(2,1);function on(l){if(l.opacity===0&&!l.placed)return 0;if(l.opacity===1&&l.placed)return 4294967295;let t=l.placed?1:0,s=Math.floor(127*l.opacity);return s*na+t*rp+s*ul+t*ho+s*np+t*Zc+s*uo+t}let Bn=0;class gn{constructor(t){this._sortAcrossTiles=t.layout.get("symbol-z-order")!=="viewport-y"&&t.layout.get("symbol-sort-key").constantOr(1)!==void 0,this._currentTileIndex=0,this._currentPartIndex=0,this._seenCrossTileIDs={},this._bucketParts=[]}continuePlacement(t,s,p,f,_){let b=this._bucketParts;for(;this._currentTileIndex<t.length;)if(s.getBucketParts(b,f,t[this._currentTileIndex],this._sortAcrossTiles),this._currentTileIndex++,_())return!0;for(this._sortAcrossTiles&&(this._sortAcrossTiles=!1,b.sort((w,T)=>w.sortKey-T.sortKey));this._currentPartIndex<b.length;){let w=b[this._currentPartIndex];if(s.placeLayerBucketPart(w,this._seenCrossTileIDs,p,w.symbolInstanceStart===0),this._currentPartIndex++,_())return!0}return!1}}class pl{constructor(t,s,p,f,_,b,w,T){this.placement=new nn(t,_,b,w,T),this._currentPlacementIndex=s.length-1,this._forceFullPlacement=p,this._showCollisionBoxes=f,this._done=!1}isDone(){return this._done}continuePlacement(t,s,p){let f=o.exported.now(),_=()=>{let b=o.exported.now()-f;return!this._forceFullPlacement&&b>2};for(;this._currentPlacementIndex>=0;){let b=s[t[this._currentPlacementIndex]],w=this.placement.collisionIndex.transform.zoom;if(b.type==="symbol"&&(!b.minzoom||b.minzoom<=w)&&(!b.maxzoom||b.maxzoom>w)){if(this._inProgressLayer||(this._inProgressLayer=new gn(b)),this._inProgressLayer.continuePlacement(p[b.source],this.placement,this._showCollisionBoxes,b,_))return;delete this._inProgressLayer}this._currentPlacementIndex--}this._done=!0}commit(t){return this.placement.commit(t),this.placement}}let oa=512/o.EXTENT/2;class op{constructor(t,s,p){this.tileID=t,this.indexedSymbolInstances={},this.bucketInstanceId=p;for(let f=0;f<s.length;f++){let _=s.get(f),b=_.key;this.indexedSymbolInstances[b]||(this.indexedSymbolInstances[b]=[]),this.indexedSymbolInstances[b].push({crossTileID:_.crossTileID,coord:this.getScaledCoordinates(_,t)})}}getScaledCoordinates(t,s){let p=oa/Math.pow(2,s.canonical.z-this.tileID.canonical.z);return{x:Math.floor((s.canonical.x*o.EXTENT+t.tileAnchorX)*p),y:Math.floor((s.canonical.y*o.EXTENT+t.tileAnchorY)*p)}}findMatches(t,s,p){let f=this.tileID.canonical.z<s.canonical.z?1:Math.pow(2,this.tileID.canonical.z-s.canonical.z);for(let _=0;_<t.length;_++){let b=t.get(_);if(b.crossTileID)continue;let w=this.indexedSymbolInstances[b.key];if(!w)continue;let T=this.getScaledCoordinates(b,s);for(let A of w)if(Math.abs(A.coord.x-T.x)<=f&&Math.abs(A.coord.y-T.y)<=f&&!p[A.crossTileID]){p[A.crossTileID]=!0,b.crossTileID=A.crossTileID;break}}}}class sp{constructor(){this.maxCrossTileID=0}generate(){return++this.maxCrossTileID}}class dl{constructor(){this.indexes={},this.usedCrossTileIDs={},this.lng=0}handleWrapJump(t){let s=Math.round((t-this.lng)/360);if(s!==0)for(let p in this.indexes){let f=this.indexes[p],_={};for(let b in f){let w=f[b];w.tileID=w.tileID.unwrapTo(w.tileID.wrap+s),_[w.tileID.key]=w}this.indexes[p]=_}this.lng=t}addBucket(t,s,p){if(this.indexes[t.overscaledZ]&&this.indexes[t.overscaledZ][t.key]){if(this.indexes[t.overscaledZ][t.key].bucketInstanceId===s.bucketInstanceId)return!1;this.removeBucketCrossTileIDs(t.overscaledZ,this.indexes[t.overscaledZ][t.key])}for(let _=0;_<s.symbolInstances.length;_++)s.symbolInstances.get(_).crossTileID=0;this.usedCrossTileIDs[t.overscaledZ]||(this.usedCrossTileIDs[t.overscaledZ]={});let f=this.usedCrossTileIDs[t.overscaledZ];for(let _ in this.indexes){let b=this.indexes[_];if(Number(_)>t.overscaledZ)for(let w in b){let T=b[w];T.tileID.isChildOf(t)&&T.findMatches(s.symbolInstances,t,f)}else{let w=b[t.scaledTo(Number(_)).key];w&&w.findMatches(s.symbolInstances,t,f)}}for(let _=0;_<s.symbolInstances.length;_++){let b=s.symbolInstances.get(_);b.crossTileID||(b.crossTileID=p.generate(),f[b.crossTileID]=!0)}return this.indexes[t.overscaledZ]===void 0&&(this.indexes[t.overscaledZ]={}),this.indexes[t.overscaledZ][t.key]=new op(t,s.symbolInstances,s.bucketInstanceId),!0}removeBucketCrossTileIDs(t,s){for(let p in s.indexedSymbolInstances)for(let f of s.indexedSymbolInstances[p])delete this.usedCrossTileIDs[t][f.crossTileID]}removeStaleBuckets(t){let s=!1;for(let p in this.indexes){let f=this.indexes[p];for(let _ in f)t[f[_].bucketInstanceId]||(this.removeBucketCrossTileIDs(p,f[_]),delete f[_],s=!0)}return s}}class Wc{constructor(){this.layerIndexes={},this.crossTileIDs=new sp,this.maxBucketInstanceId=0,this.bucketsInCurrentPlacement={}}addLayer(t,s,p,f){let _=this.layerIndexes[t.id];_===void 0&&(_=this.layerIndexes[t.id]=new dl);let b=!1,w={};f.name!=="globe"&&_.handleWrapJump(p);for(let T of s){let A=T.getBucket(t);A&&t.id===A.layerIds[0]&&(A.bucketInstanceId||(A.bucketInstanceId=++this.maxBucketInstanceId),_.addBucket(T.tileID,A,this.crossTileIDs)&&(b=!0),w[A.bucketInstanceId]=!0)}return _.removeStaleBuckets(w)&&(b=!0),b}pruneUnusedLayers(t){let s={};t.forEach(p=>{s[p]=!0});for(let p in this.layerIndexes)s[p]||delete this.layerIndexes[p]}}let rs=(l,t)=>o.emitValidationErrors(l,t&&t.filter(s=>s.identifier!=="source.canvas")),ap=o.pick(de,["addLayer","removeLayer","setPaintProperty","setLayoutProperty","setFilter","addSource","removeSource","setLayerZoomRange","setLight","setTransition","setGeoJSONSourceData","setTerrain","setFog","setProjection"]),Hc=o.pick(de,["setCenter","setZoom","setBearing","setPitch"]),lp={version:8,layers:[],sources:{}},fl={fill:!0,line:!0,background:!0,hillshade:!0,raster:!0};class Sr extends o.Evented{constructor(t,s={}){super(),this.map=t,this.dispatcher=new Fi(Rt(),this),this.imageManager=new Ci,this.imageManager.setEventedParent(this),this.glyphManager=new o.GlyphManager(t._requestManager,s.localFontFamily?o.LocalGlyphMode.all:s.localIdeographFontFamily?o.LocalGlyphMode.ideographs:o.LocalGlyphMode.none,s.localFontFamily||s.localIdeographFontFamily),this.lineAtlas=new o.LineAtlas(256,512),this.crossTileSymbolIndex=new Wc,this._layers={},this._num3DLayers=0,this._numSymbolLayers=0,this._numCircleLayers=0,this._serializedLayers={},this._sourceCaches={},this._otherSourceCaches={},this._symbolSourceCaches={},this.zoomHistory=new o.ZoomHistory,this._loaded=!1,this._availableImages=[],this._order=[],this._drapedFirstOrder=[],this._markersNeedUpdate=!1,this._resetUpdates(),this.dispatcher.broadcast("setReferrer",o.getReferrer());let p=this;this._rtlTextPluginCallback=Sr.registerForPluginStateChange(f=>{p.dispatcher.broadcast("syncRTLPluginState",{pluginStatus:f.pluginStatus,pluginURL:f.pluginURL},(_,b)=>{if(o.triggerPluginCompletionEvent(_),b&&b.every(w=>w))for(let w in p._sourceCaches){let T=p._sourceCaches[w],A=T.getSource().type;A!=="vector"&&A!=="geojson"||T.reload()}})}),this.on("data",f=>{if(f.dataType!=="source"||f.sourceDataType!=="metadata")return;let _=this.getSource(f.sourceId);if(_&&_.vectorLayerIds)for(let b in this._layers){let w=this._layers[b];w.source===_.id&&this._validateLayer(w)}})}loadURL(t,s={}){this.fire(new o.Event("dataloading",{dataType:"style"}));let p=typeof s.validate=="boolean"?s.validate:!o.isMapboxURL(t);t=this.map._requestManager.normalizeStyleURL(t,s.accessToken);let f=this.map._requestManager.transformRequest(t,o.ResourceType.Style);this._request=o.getJSON(f,(_,b)=>{this._request=null,_?this.fire(new o.ErrorEvent(_)):b&&this._load(b,p)})}loadJSON(t,s={}){this.fire(new o.Event("dataloading",{dataType:"style"})),this._request=o.exported.frame(()=>{this._request=null,this._load(t,s.validate!==!1)})}loadEmpty(){this.fire(new o.Event("dataloading",{dataType:"style"})),this._load(lp,!1)}_updateLayerCount(t,s){let p=s?1:-1;t.is3D()&&(this._num3DLayers+=p),t.type==="circle"&&(this._numCircleLayers+=p),t.type==="symbol"&&(this._numSymbolLayers+=p)}_load(t,s){if(s&&rs(this,o.validateStyle(t)))return;this._loaded=!0,this.stylesheet=o.clone$1(t),this._updateMapProjection();for(let f in t.sources)this.addSource(f,t.sources[f],{validate:!1});this._changed=!1,t.sprite?this._loadSprite(t.sprite):(this.imageManager.setLoaded(!0),this.dispatcher.broadcast("spriteLoaded",!0)),this.glyphManager.setURL(t.glyphs);let p=Vt(this.stylesheet.layers);this._order=p.map(f=>f.id),this._layers={},this._serializedLayers={};for(let f of p)f=o.createStyleLayer(f),f.setEventedParent(this,{layer:{id:f.id}}),this._layers[f.id]=f,this._serializedLayers[f.id]=f.serialize(),this._updateLayerCount(f,!0);this.dispatcher.broadcast("setLayers",this._serializeLayers(this._order)),this.light=new lr(this.stylesheet.light),this.stylesheet.terrain&&!this.terrainSetForDrapingOnly()&&this._createTerrain(this.stylesheet.terrain,1),this.stylesheet.fog&&this._createFog(this.stylesheet.fog),this._updateDrapeFirstLayers(),this.fire(new o.Event("data",{dataType:"style"})),this.fire(new o.Event("style.load"))}terrainSetForDrapingOnly(){return!!this.terrain&&this.terrain.drapeRenderMode===0}setProjection(t){t?this.stylesheet.projection=t:delete this.stylesheet.projection,this.map._explicitProjection||this.map._updateProjection()}_updateMapProjection(){this.map._explicitProjection?this.applyProjectionUpdate():this.map._updateProjection()}applyProjectionUpdate(){this._loaded&&(this.dispatcher.broadcast("setProjection",this.map.transform.projectionOptions),this.map.transform.projection.requiresDraping?this.getTerrain()||this.stylesheet.terrain||this.setTerrainForDraping():this.terrainSetForDrapingOnly()&&this.setTerrain(null))}_loadSprite(t){this._spriteRequest=function(s,p,f){let _,b,w,T=o.exported.devicePixelRatio>1?"@2x":"",A=o.getJSON(p.transformRequest(p.normalizeSpriteURL(s,T,".json"),o.ResourceType.SpriteJSON),(O,V)=>{A=null,w||(w=O,_=V,L())}),I=o.getImage(p.transformRequest(p.normalizeSpriteURL(s,T,".png"),o.ResourceType.SpriteImage),(O,V)=>{I=null,w||(w=O,b=V,L())});function L(){if(w)f(w);else if(_&&b){let O=o.exported.getImageData(b),V={};for(let N in _){let{width:j,height:J,x:U,y:$,sdf:q,pixelRatio:ie,stretchX:K,stretchY:Q,content:ae}=_[N],ye=new o.RGBAImage({width:j,height:J});o.RGBAImage.copy(O,ye,{x:U,y:$},{x:0,y:0},{width:j,height:J}),V[N]={data:ye,pixelRatio:ie,sdf:q,stretchX:K,stretchY:Q,content:ae}}f(null,V)}}return{cancel(){A&&(A.cancel(),A=null),I&&(I.cancel(),I=null)}}}(t,this.map._requestManager,(s,p)=>{if(this._spriteRequest=null,s)this.fire(new o.ErrorEvent(s));else if(p)for(let f in p)this.imageManager.addImage(f,p[f]);this.imageManager.setLoaded(!0),this._availableImages=this.imageManager.listImages(),this.dispatcher.broadcast("setImages",this._availableImages),this.dispatcher.broadcast("spriteLoaded",!0),this.fire(new o.Event("data",{dataType:"style"}))})}_validateLayer(t){let s=this.getSource(t.source);if(!s)return;let p=t.sourceLayer;p&&(s.type==="geojson"||s.vectorLayerIds&&s.vectorLayerIds.indexOf(p)===-1)&&this.fire(new o.ErrorEvent(new Error(`Source layer "${p}" does not exist on source "${s.id}" as specified by style layer "${t.id}"`)))}loaded(){if(!this._loaded||Object.keys(this._updatedSources).length)return!1;for(let t in this._sourceCaches)if(!this._sourceCaches[t].loaded())return!1;return!!this.imageManager.isLoaded()}_serializeLayers(t){let s=[];for(let p of t){let f=this._layers[p];f.type!=="custom"&&s.push(f.serialize())}return s}hasTransitions(){if(this.light&&this.light.hasTransition()||this.fog&&this.fog.hasTransition())return!0;for(let t in this._sourceCaches)if(this._sourceCaches[t].hasTransition())return!0;for(let t in this._layers)if(this._layers[t].hasTransition())return!0;return!1}get order(){return this.map._optimizeForTerrain&&this.terrain?this._drapedFirstOrder:this._order}isLayerDraped(t){return!!this.terrain&&fl[t.type]}_checkLoaded(){if(!this._loaded)throw new Error("Style is not done loading")}update(t){if(!this._loaded)return;let s=this._changed;if(this._changed){let f=Object.keys(this._updatedLayers),_=Object.keys(this._removedLayers);(f.length||_.length)&&this._updateWorkerLayers(f,_);for(let b in this._updatedSources){let w=this._updatedSources[b];w==="reload"?this._reloadSource(b):w==="clear"&&this._clearSource(b)}this._updateTilesForChangedImages();for(let b in this._updatedPaintProps)this._layers[b].updateTransitions(t);this.light.updateTransitions(t),this.fog&&this.fog.updateTransitions(t),this._resetUpdates()}let p={};for(let f in this._sourceCaches){let _=this._sourceCaches[f];p[f]=_.used,_.used=!1}for(let f of this._order){let _=this._layers[f];if(_.recalculate(t,this._availableImages),!_.isHidden(t.zoom)){let w=this._getLayerSourceCache(_);w&&(w.used=!0)}let b=this.map.painter;if(b){let w=_.getProgramIds();if(!w)continue;let T=_.getProgramConfiguration(t.zoom);for(let A of w)b.useProgram(A,T)}}for(let f in p){let _=this._sourceCaches[f];p[f]!==_.used&&_.getSource().fire(new o.Event("data",{sourceDataType:"visibility",dataType:"source",sourceId:_.getSource().id}))}this.light.recalculate(t),this.terrain&&this.terrain.recalculate(t),this.fog&&this.fog.recalculate(t),this.z=t.zoom,this._markersNeedUpdate&&(this._updateMarkersOpacity(),this._markersNeedUpdate=!1),s&&this.fire(new o.Event("data",{dataType:"style"}))}_updateTilesForChangedImages(){let t=Object.keys(this._changedImages);if(t.length){for(let s in this._sourceCaches)this._sourceCaches[s].reloadTilesForDependencies(["icons","patterns"],t);this._changedImages={}}}_updateWorkerLayers(t,s){this.dispatcher.broadcast("updateLayers",{layers:this._serializeLayers(t),removedIds:s})}_resetUpdates(){this._changed=!1,this._updatedLayers={},this._removedLayers={},this._updatedSources={},this._updatedPaintProps={},this._changedImages={}}setState(t){if(this._checkLoaded(),rs(this,o.validateStyle(t)))return!1;(t=o.clone$1(t)).layers=Vt(t.layers);let s=function(f,_){if(!f)return[{command:de.setStyle,args:[_]}];let b=[];try{if(!z(f.version,_.version))return[{command:de.setStyle,args:[_]}];z(f.center,_.center)||b.push({command:de.setCenter,args:[_.center]}),z(f.zoom,_.zoom)||b.push({command:de.setZoom,args:[_.zoom]}),z(f.bearing,_.bearing)||b.push({command:de.setBearing,args:[_.bearing]}),z(f.pitch,_.pitch)||b.push({command:de.setPitch,args:[_.pitch]}),z(f.sprite,_.sprite)||b.push({command:de.setSprite,args:[_.sprite]}),z(f.glyphs,_.glyphs)||b.push({command:de.setGlyphs,args:[_.glyphs]}),z(f.transition,_.transition)||b.push({command:de.setTransition,args:[_.transition]}),z(f.light,_.light)||b.push({command:de.setLight,args:[_.light]}),z(f.fog,_.fog)||b.push({command:de.setFog,args:[_.fog]}),z(f.projection,_.projection)||b.push({command:de.setProjection,args:[_.projection]});let w={},T=[];(function(L,O,V,N){let j;for(j in O=O||{},L=L||{})L.hasOwnProperty(j)&&(O.hasOwnProperty(j)||ii(j,V,N));for(j in O)O.hasOwnProperty(j)&&(L.hasOwnProperty(j)?z(L[j],O[j])||(L[j].type==="geojson"&&O[j].type==="geojson"&&ip(L,O,j)?V.push({command:de.setGeoJSONSourceData,args:[j,O[j].data]}):pr(j,O,V,N)):ir(j,O,V))})(f.sources,_.sources,T,w);let A=[];f.layers&&f.layers.forEach(L=>{L.source&&w[L.source]?b.push({command:de.removeLayer,args:[L.id]}):A.push(L)});let I=f.terrain;I&&w[I.source]&&(b.push({command:de.setTerrain,args:[void 0]}),I=void 0),b=b.concat(T),z(I,_.terrain)||b.push({command:de.setTerrain,args:[_.terrain]}),function(L,O,V){O=O||[];let N=(L=L||[]).map(ea),j=O.map(ea),J=L.reduce(Gc,{}),U=O.reduce(Gc,{}),$=N.slice(),q=Object.create(null),ie,K,Q,ae,ye,be,xe;for(ie=0,K=0;ie<N.length;ie++)Q=N[ie],U.hasOwnProperty(Q)?K++:(V.push({command:de.removeLayer,args:[Q]}),$.splice($.indexOf(Q,K),1));for(ie=0,K=0;ie<j.length;ie++)Q=j[j.length-1-ie],$[$.length-1-ie]!==Q&&(J.hasOwnProperty(Q)?(V.push({command:de.removeLayer,args:[Q]}),$.splice($.lastIndexOf(Q,$.length-K),1)):K++,be=$[$.length-ie],V.push({command:de.addLayer,args:[U[Q],be]}),$.splice($.length-ie,0,Q),q[Q]=!0);for(ie=0;ie<j.length;ie++)if(Q=j[ie],ae=J[Q],ye=U[Q],!q[Q]&&!z(ae,ye))if(z(ae.source,ye.source)&&z(ae["source-layer"],ye["source-layer"])&&z(ae.type,ye.type)){for(xe in rr(ae.layout,ye.layout,V,Q,null,de.setLayoutProperty),rr(ae.paint,ye.paint,V,Q,null,de.setPaintProperty),z(ae.filter,ye.filter)||V.push({command:de.setFilter,args:[Q,ye.filter]}),z(ae.minzoom,ye.minzoom)&&z(ae.maxzoom,ye.maxzoom)||V.push({command:de.setLayerZoomRange,args:[Q,ye.minzoom,ye.maxzoom]}),ae)ae.hasOwnProperty(xe)&&xe!=="layout"&&xe!=="paint"&&xe!=="filter"&&xe!=="metadata"&&xe!=="minzoom"&&xe!=="maxzoom"&&(xe.indexOf("paint.")===0?rr(ae[xe],ye[xe],V,Q,xe.slice(6),de.setPaintProperty):z(ae[xe],ye[xe])||V.push({command:de.setLayerProperty,args:[Q,xe,ye[xe]]}));for(xe in ye)ye.hasOwnProperty(xe)&&!ae.hasOwnProperty(xe)&&xe!=="layout"&&xe!=="paint"&&xe!=="filter"&&xe!=="metadata"&&xe!=="minzoom"&&xe!=="maxzoom"&&(xe.indexOf("paint.")===0?rr(ae[xe],ye[xe],V,Q,xe.slice(6),de.setPaintProperty):z(ae[xe],ye[xe])||V.push({command:de.setLayerProperty,args:[Q,xe,ye[xe]]}))}else V.push({command:de.removeLayer,args:[Q]}),be=$[$.lastIndexOf(Q)+1],V.push({command:de.addLayer,args:[ye,be]})}(A,_.layers,b)}catch(w){console.warn("Unable to compute style diff:",w),b=[{command:de.setStyle,args:[_]}]}return b}(this.serialize(),t).filter(f=>!(f.command in Hc));if(s.length===0)return!1;let p=s.filter(f=>!(f.command in ap));if(p.length>0)throw new Error(`Unimplemented: ${p.map(f=>f.command).join(", ")}.`);return s.forEach(f=>{f.command!=="setTransition"&&this[f.command].apply(this,f.args)}),this.stylesheet=t,this._updateMapProjection(),!0}addImage(t,s){return this.getImage(t)?this.fire(new o.ErrorEvent(new Error("An image with this name already exists."))):(this.imageManager.addImage(t,s),this._afterImageUpdated(t),this)}updateImage(t,s){this.imageManager.updateImage(t,s)}getImage(t){return this.imageManager.getImage(t)}removeImage(t){return this.getImage(t)?(this.imageManager.removeImage(t),this._afterImageUpdated(t),this):this.fire(new o.ErrorEvent(new Error("No image with this name exists.")))}_afterImageUpdated(t){this._availableImages=this.imageManager.listImages(),this._changedImages[t]=!0,this._changed=!0,this.dispatcher.broadcast("setImages",this._availableImages),this.fire(new o.Event("data",{dataType:"style"}))}listImages(){return this._checkLoaded(),this._availableImages.slice()}addSource(t,s,p={}){if(this._checkLoaded(),this.getSource(t)!==void 0)throw new Error("There is already a source with this ID");if(!s.type)throw new Error(`The type property must be defined, but only the following properties were given: ${Object.keys(s).join(", ")}.`);if(["vector","raster","geojson","video","image"].indexOf(s.type)>=0&&this._validate(o.validateSource,`sources.${t}`,s,null,p))return;this.map&&this.map._collectResourceTiming&&(s.collectResourceTiming=!0);let f=me(t,s,this.dispatcher,this);f.setEventedParent(this,()=>({isSourceLoaded:this._isSourceCacheLoaded(t),source:f.serialize(),sourceId:t}));let _=b=>{let w=(b?"symbol:":"other:")+t,T=this._sourceCaches[w]=new o.SourceCache(w,f,b);(b?this._symbolSourceCaches:this._otherSourceCaches)[t]=T,T.style=this,T.onAdd(this.map)};_(!1),s.type!=="vector"&&s.type!=="geojson"||_(!0),f.onAdd&&f.onAdd(this.map),this._changed=!0}removeSource(t){this._checkLoaded();let s=this.getSource(t);if(!s)throw new Error("There is no source with this ID");for(let f in this._layers)if(this._layers[f].source===t)return this.fire(new o.ErrorEvent(new Error(`Source "${t}" cannot be removed while layer "${f}" is using it.`)));if(this.terrain&&this.terrain.get().source===t)return this.fire(new o.ErrorEvent(new Error(`Source "${t}" cannot be removed while terrain is using it.`)));let p=this._getSourceCaches(t);for(let f of p)delete this._sourceCaches[f.id],delete this._updatedSources[f.id],f.fire(new o.Event("data",{sourceDataType:"metadata",dataType:"source",sourceId:f.getSource().id})),f.setEventedParent(null),f.clearTiles();return delete this._otherSourceCaches[t],delete this._symbolSourceCaches[t],s.setEventedParent(null),s.onRemove&&s.onRemove(this.map),this._changed=!0,this}setGeoJSONSourceData(t,s){this._checkLoaded(),this.getSource(t).setData(s),this._changed=!0}getSource(t){let s=this._getSourceCache(t);return s&&s.getSource()}addLayer(t,s,p={}){this._checkLoaded();let f=t.id;if(this.getLayer(f))return void this.fire(new o.ErrorEvent(new Error(`Layer with id "${f}" already exists on this map`)));let _;if(t.type==="custom"){if(rs(this,o.validateCustomStyleLayer(t)))return;_=o.createStyleLayer(t)}else{if(typeof t.source=="object"&&(this.addSource(f,t.source),t=o.clone$1(t),t=o.extend(t,{source:f})),this._validate(o.validateLayer,`layers.${f}`,t,{arrayIndex:-1},p))return;_=o.createStyleLayer(t),this._validateLayer(_),_.setEventedParent(this,{layer:{id:f}}),this._serializedLayers[_.id]=_.serialize(),this._updateLayerCount(_,!0)}let b=s?this._order.indexOf(s):this._order.length;if(s&&b===-1)return void this.fire(new o.ErrorEvent(new Error(`Layer with id "${s}" does not exist on this map.`)));this._order.splice(b,0,f),this._layerOrderChanged=!0,this._layers[f]=_;let w=this._getLayerSourceCache(_);if(this._removedLayers[f]&&_.source&&w&&_.type!=="custom"){let T=this._removedLayers[f];delete this._removedLayers[f],T.type!==_.type?this._updatedSources[_.source]="clear":(this._updatedSources[_.source]="reload",w.pause())}this._updateLayer(_),_.onAdd&&_.onAdd(this.map),this._updateDrapeFirstLayers()}moveLayer(t,s){if(this._checkLoaded(),this._changed=!0,!this._layers[t])return void this.fire(new o.ErrorEvent(new Error(`The layer '${t}' does not exist in the map's style and cannot be moved.`)));if(t===s)return;let p=this._order.indexOf(t);this._order.splice(p,1);let f=s?this._order.indexOf(s):this._order.length;s&&f===-1?this.fire(new o.ErrorEvent(new Error(`Layer with id "${s}" does not exist on this map.`))):(this._order.splice(f,0,t),this._layerOrderChanged=!0,this._updateDrapeFirstLayers())}removeLayer(t){this._checkLoaded();let s=this._layers[t];if(!s)return void this.fire(new o.ErrorEvent(new Error(`The layer '${t}' does not exist in the map's style and cannot be removed.`)));s.setEventedParent(null),this._updateLayerCount(s,!1);let p=this._order.indexOf(t);this._order.splice(p,1),this._layerOrderChanged=!0,this._changed=!0,this._removedLayers[t]=s,delete this._layers[t],delete this._serializedLayers[t],delete this._updatedLayers[t],delete this._updatedPaintProps[t],s.onRemove&&s.onRemove(this.map),this._updateDrapeFirstLayers()}getLayer(t){return this._layers[t]}hasLayer(t){return t in this._layers}hasLayerType(t){for(let s in this._layers)if(this._layers[s].type===t)return!0;return!1}setLayerZoomRange(t,s,p){this._checkLoaded();let f=this.getLayer(t);f?f.minzoom===s&&f.maxzoom===p||(s!=null&&(f.minzoom=s),p!=null&&(f.maxzoom=p),this._updateLayer(f)):this.fire(new o.ErrorEvent(new Error(`The layer '${t}' does not exist in the map's style and cannot have zoom extent.`)))}setFilter(t,s,p={}){this._checkLoaded();let f=this.getLayer(t);if(f){if(!z(f.filter,s))return s==null?(f.filter=void 0,void this._updateLayer(f)):void(this._validate(o.validateFilter,`layers.${f.id}.filter`,s,{layerType:f.type},p)||(f.filter=o.clone$1(s),this._updateLayer(f)))}else this.fire(new o.ErrorEvent(new Error(`The layer '${t}' does not exist in the map's style and cannot be filtered.`)))}getFilter(t){let s=this.getLayer(t);return s&&o.clone$1(s.filter)}setLayoutProperty(t,s,p,f={}){this._checkLoaded();let _=this.getLayer(t);_?z(_.getLayoutProperty(s),p)||(_.setLayoutProperty(s,p,f),this._updateLayer(_)):this.fire(new o.ErrorEvent(new Error(`The layer '${t}' does not exist in the map's style and cannot be styled.`)))}getLayoutProperty(t,s){let p=this.getLayer(t);if(p)return p.getLayoutProperty(s);this.fire(new o.ErrorEvent(new Error(`The layer '${t}' does not exist in the map's style.`)))}setPaintProperty(t,s,p,f={}){this._checkLoaded();let _=this.getLayer(t);_?z(_.getPaintProperty(s),p)||(_.setPaintProperty(s,p,f)&&this._updateLayer(_),this._changed=!0,this._updatedPaintProps[t]=!0):this.fire(new o.ErrorEvent(new Error(`The layer '${t}' does not exist in the map's style and cannot be styled.`)))}getPaintProperty(t,s){let p=this.getLayer(t);return p&&p.getPaintProperty(s)}setFeatureState(t,s){this._checkLoaded();let p=t.source,f=t.sourceLayer,_=this.getSource(p);if(!_)return void this.fire(new o.ErrorEvent(new Error(`The source '${p}' does not exist in the map's style.`)));let b=_.type;if(b==="geojson"&&f)return void this.fire(new o.ErrorEvent(new Error("GeoJSON sources cannot have a sourceLayer parameter.")));if(b==="vector"&&!f)return void this.fire(new o.ErrorEvent(new Error("The sourceLayer parameter must be provided for vector source types.")));t.id===void 0&&this.fire(new o.ErrorEvent(new Error("The feature id parameter must be provided.")));let w=this._getSourceCaches(p);for(let T of w)T.setFeatureState(f,t.id,s)}removeFeatureState(t,s){this._checkLoaded();let p=t.source,f=this.getSource(p);if(!f)return void this.fire(new o.ErrorEvent(new Error(`The source '${p}' does not exist in the map's style.`)));let _=f.type,b=_==="vector"?t.sourceLayer:void 0;if(_==="vector"&&!b)return void this.fire(new o.ErrorEvent(new Error("The sourceLayer parameter must be provided for vector source types.")));if(s&&typeof t.id!="string"&&typeof t.id!="number")return void this.fire(new o.ErrorEvent(new Error("A feature id is required to remove its specific state property.")));let w=this._getSourceCaches(p);for(let T of w)T.removeFeatureState(b,t.id,s)}getFeatureState(t){this._checkLoaded();let s=t.source,p=t.sourceLayer,f=this.getSource(s);if(f){if(f.type!=="vector"||p)return t.id===void 0&&this.fire(new o.ErrorEvent(new Error("The feature id parameter must be provided."))),this._getSourceCaches(s)[0].getFeatureState(p,t.id);this.fire(new o.ErrorEvent(new Error("The sourceLayer parameter must be provided for vector source types.")))}else this.fire(new o.ErrorEvent(new Error(`The source '${s}' does not exist in the map's style.`)))}getTransition(){return o.extend({duration:300,delay:0},this.stylesheet&&this.stylesheet.transition)}serialize(){let t={};for(let s in this._sourceCaches){let p=this._sourceCaches[s].getSource();t[p.id]||(t[p.id]=p.serialize())}return o.filterObject({version:this.stylesheet.version,name:this.stylesheet.name,metadata:this.stylesheet.metadata,light:this.stylesheet.light,terrain:this.stylesheet.terrain,fog:this.stylesheet.fog,center:this.stylesheet.center,zoom:this.stylesheet.zoom,bearing:this.stylesheet.bearing,pitch:this.stylesheet.pitch,sprite:this.stylesheet.sprite,glyphs:this.stylesheet.glyphs,transition:this.stylesheet.transition,projection:this.stylesheet.projection,sources:t,layers:this._serializeLayers(this._order)},s=>s!==void 0)}_updateLayer(t){this._updatedLayers[t.id]=!0;let s=this._getLayerSourceCache(t);t.source&&!this._updatedSources[t.source]&&s&&s.getSource().type!=="raster"&&(this._updatedSources[t.source]="reload",s.pause()),this._changed=!0,t.invalidateCompiledFilter()}_flattenAndSortRenderedFeatures(t){let s=b=>this._layers[b].type==="fill-extrusion",p={},f=[];for(let b=this._order.length-1;b>=0;b--){let w=this._order[b];if(s(w)){p[w]=b;for(let T of t){let A=T[w];if(A)for(let I of A)f.push(I)}}}f.sort((b,w)=>w.intersectionZ-b.intersectionZ);let _=[];for(let b=this._order.length-1;b>=0;b--){let w=this._order[b];if(s(w))for(let T=f.length-1;T>=0;T--){let A=f[T].feature;if(p[A.layer.id]<b)break;_.push(A),f.pop()}else for(let T of t){let A=T[w];if(A)for(let I of A)_.push(I.feature)}}return _}queryRenderedFeatures(t,s,p){s&&s.filter&&this._validate(o.validateFilter,"queryRenderedFeatures.filter",s.filter,null,s);let f={};if(s&&s.layers){if(!Array.isArray(s.layers))return this.fire(new o.ErrorEvent(new Error("parameters.layers must be an Array."))),[];for(let T of s.layers){let A=this._layers[T];if(!A)return this.fire(new o.ErrorEvent(new Error(`The layer '${T}' does not exist in the map's style and cannot be queried for features.`))),[];f[A.source]=!0}}let _=[];s.availableImages=this._availableImages;let b=s&&s.layers?s.layers.some(T=>{let A=this.getLayer(T);return A&&A.is3D()}):this.has3DLayers(),w=Qi.createFromScreenPoints(t,p);for(let T in this._sourceCaches){let A=this._sourceCaches[T].getSource().id;s.layers&&!f[A]||_.push(Ze(this._sourceCaches[T],this._layers,this._serializedLayers,w,s,p,b,!!this.map._showQueryGeometry))}return this.placement&&_.push(function(T,A,I,L,O,V,N){let j={},J=V.queryRenderedSymbols(L),U=[];for(let $ of Object.keys(J).map(Number))U.push(N[$]);U.sort(nt);for(let $ of U){let q=$.featureIndex.lookupSymbolFeatures(J[$.bucketInstanceId],A,$.bucketIndex,$.sourceLayerIndex,O.filter,O.layers,O.availableImages,T);for(let ie in q){let K=j[ie]=j[ie]||[],Q=q[ie];Q.sort((ae,ye)=>{let be=$.featureSortOrder;if(be){let xe=be.indexOf(ae.featureIndex);return be.indexOf(ye.featureIndex)-xe}return ye.featureIndex-ae.featureIndex});for(let ae of Q)K.push(ae)}}for(let $ in j)j[$].forEach(q=>{let ie=q.feature,K=I(T[$]).getFeatureState(ie.layer["source-layer"],ie.id);ie.source=ie.layer.source,ie.layer["source-layer"]&&(ie.sourceLayer=ie.layer["source-layer"]),ie.state=K});return j}(this._layers,this._serializedLayers,this._getLayerSourceCache.bind(this),w.screenGeometry,s,this.placement.collisionIndex,this.placement.retainedQueryData)),this._flattenAndSortRenderedFeatures(_)}querySourceFeatures(t,s){s&&s.filter&&this._validate(o.validateFilter,"querySourceFeatures.filter",s.filter,null,s);let p=this._getSourceCaches(t),f=[];for(let _ of p)f=f.concat(De(_,s));return f}addSourceType(t,s,p){return Sr.getSourceType(t)?p(new Error(`A source type called "${t}" already exists.`)):(Sr.setSourceType(t,s),s.workerSourceURL?void this.dispatcher.broadcast("loadWorkerSource",{name:t,url:s.workerSourceURL},p):p(null,null))}getLight(){return this.light.getLight()}setLight(t,s={}){this._checkLoaded();let p=this.light.getLight(),f=!1;for(let b in t)if(!z(t[b],p[b])){f=!0;break}if(!f)return;let _=this._setTransitionParameters({duration:300,delay:0});this.light.setLight(t,s),this.light.updateTransitions(_)}getTerrain(){return this.terrain&&this.terrain.drapeRenderMode===1?this.terrain.get():null}setTerrainForDraping(){this.setTerrain({source:"",exaggeration:0},0)}setTerrain(t,s=1){if(this._checkLoaded(),!t)return delete this.terrain,delete this.stylesheet.terrain,this.dispatcher.broadcast("enableTerrain",!1),this._force3DLayerUpdate(),void(this._markersNeedUpdate=!0);if(s===1){if(typeof t.source=="object"){let p="terrain-dem-src";this.addSource(p,t.source),t=o.clone$1(t),t=o.extend(t,{source:p})}if(this._validate(o.validateTerrain,"terrain",t))return}if(!this.terrain||this.terrain&&s!==this.terrain.drapeRenderMode)this._createTerrain(t,s);else{let p=this.terrain,f=p.get();for(let _ of Object.keys(o.spec.terrain))!t.hasOwnProperty(_)&&o.spec.terrain[_].default&&(t[_]=o.spec.terrain[_].default);for(let _ in t)if(!z(t[_],f[_])){p.set(t),this.stylesheet.terrain=t;let b=this._setTransitionParameters({duration:0});p.updateTransitions(b);break}}this._updateDrapeFirstLayers(),this._markersNeedUpdate=!0}_createFog(t){let s=this.fog=new ci(t,this.map.transform);this.stylesheet.fog=t;let p=this._setTransitionParameters({duration:0});s.updateTransitions(p)}_updateMarkersOpacity(){this.map._markers.length!==0&&this.map._requestDomTask(()=>{for(let t of this.map._markers)t._evaluateOpacity()})}getFog(){return this.fog?this.fog.get():null}setFog(t){if(this._checkLoaded(),!t)return delete this.fog,delete this.stylesheet.fog,void(this._markersNeedUpdate=!0);if(this.fog){let s=this.fog,p=s.get();Object.keys(t).length===0&&s.set(t);for(let f in t)if(!z(t[f],p[f])){s.set(t),this.stylesheet.fog=t;let _=this._setTransitionParameters({duration:0});s.updateTransitions(_);break}}else this._createFog(t);this._markersNeedUpdate=!0}_setTransitionParameters(t){return{now:o.exported.now(),transition:o.extend(t,this.stylesheet.transition)}}_updateDrapeFirstLayers(){if(!this.map._optimizeForTerrain||!this.terrain)return;let t=this._order.filter(p=>this.isLayerDraped(this._layers[p])),s=this._order.filter(p=>!this.isLayerDraped(this._layers[p]));this._drapedFirstOrder=[],this._drapedFirstOrder.push(...t),this._drapedFirstOrder.push(...s)}_createTerrain(t,s){let p=this.terrain=new cr(t,s);this.stylesheet.terrain=t,this.dispatcher.broadcast("enableTerrain",!this.terrainSetForDrapingOnly()),this._force3DLayerUpdate();let f=this._setTransitionParameters({duration:0});p.updateTransitions(f)}_force3DLayerUpdate(){for(let t in this._layers){let s=this._layers[t];s.type==="fill-extrusion"&&this._updateLayer(s)}}_forceSymbolLayerUpdate(){for(let t in this._layers){let s=this._layers[t];s.type==="symbol"&&this._updateLayer(s)}}_validate(t,s,p,f,_={}){return(!_||_.validate!==!1)&&rs(this,t.call(o.validateStyle,o.extend({key:s,style:this.serialize(),value:p,styleSpec:o.spec},f)))}_remove(){this._request&&(this._request.cancel(),this._request=null),this._spriteRequest&&(this._spriteRequest.cancel(),this._spriteRequest=null),o.evented.off("pluginStateChange",this._rtlTextPluginCallback);for(let t in this._layers)this._layers[t].setEventedParent(null);for(let t in this._sourceCaches)this._sourceCaches[t].clearTiles(),this._sourceCaches[t].setEventedParent(null);this.imageManager.setEventedParent(null),this.setEventedParent(null),this.dispatcher.remove()}_clearSource(t){let s=this._getSourceCaches(t);for(let p of s)p.clearTiles()}_reloadSource(t){let s=this._getSourceCaches(t);for(let p of s)p.resume(),p.reload()}_updateSources(t){for(let s in this._sourceCaches)this._sourceCaches[s].update(t)}_generateCollisionBoxes(){for(let t in this._sourceCaches){let s=this._sourceCaches[t];s.resume(),s.reload()}}_updatePlacement(t,s,p,f,_=!1){let b=!1,w=!1,T={};for(let A of this._order){let I=this._layers[A];if(I.type!=="symbol")continue;if(!T[I.source]){let O=this._getLayerSourceCache(I);if(!O)continue;T[I.source]=O.getRenderableIds(!0).map(V=>O.getTileByID(V)).sort((V,N)=>N.tileID.overscaledZ-V.tileID.overscaledZ||(V.tileID.isLessThan(N.tileID)?-1:1))}let L=this.crossTileSymbolIndex.addLayer(I,T[I.source],t.center.lng,t.projection);b=b||L}if(this.crossTileSymbolIndex.pruneUnusedLayers(this._order),_=_||this._layerOrderChanged||p===0,this._layerOrderChanged&&this.fire(new o.Event("neworder")),(_||!this.pauseablePlacement||this.pauseablePlacement.isDone()&&!this.placement.stillRecent(o.exported.now(),t.zoom))&&(this.pauseablePlacement=new pl(t,this._order,_,s,p,f,this.placement,this.fog&&t.projection.supportsFog?this.fog.state:null),this._layerOrderChanged=!1),this.pauseablePlacement.isDone()?this.placement.setStale():(this.pauseablePlacement.continuePlacement(this._order,this._layers,T),this.pauseablePlacement.isDone()&&(this.placement=this.pauseablePlacement.commit(o.exported.now()),w=!0),b&&this.pauseablePlacement.placement.setStale()),w||b)for(let A of this._order){let I=this._layers[A];I.type==="symbol"&&this.placement.updateLayerOpacities(I,T[I.source])}return!this.pauseablePlacement.isDone()||this.placement.hasTransitions(o.exported.now())}_releaseSymbolFadeTiles(){for(let t in this._sourceCaches)this._sourceCaches[t].releaseSymbolFadeTiles()}getImages(t,s,p){this.imageManager.getImages(s.icons,p),this._updateTilesForChangedImages();let f=_=>{_&&_.setDependencies(s.tileID.key,s.type,s.icons)};f(this._otherSourceCaches[s.source]),f(this._symbolSourceCaches[s.source])}getGlyphs(t,s,p){this.glyphManager.getGlyphs(s.stacks,p)}getResource(t,s,p){return o.makeRequest(s,p)}_getSourceCache(t){return this._otherSourceCaches[t]}_getLayerSourceCache(t){return t.type==="symbol"?this._symbolSourceCaches[t.source]:this._otherSourceCaches[t.source]}_getSourceCaches(t){let s=[];return this._otherSourceCaches[t]&&s.push(this._otherSourceCaches[t]),this._symbolSourceCaches[t]&&s.push(this._symbolSourceCaches[t]),s}_isSourceCacheLoaded(t){let s=this._getSourceCaches(t);return s.length===0?(this.fire(new o.ErrorEvent(new Error(`There is no source with ID '${t}'`))),!1):s.every(p=>p.loaded())}has3DLayers(){return this._num3DLayers>0}hasSymbolLayers(){return this._numSymbolLayers>0}hasCircleLayers(){return this._numCircleLayers>0}_clearWorkerCaches(){this.dispatcher.broadcast("clearCaches")}destroy(){this._clearWorkerCaches(),this.terrainSetForDrapingOnly()&&(delete this.terrain,delete this.stylesheet.terrain)}}Sr.getSourceType=function(l){return he[l]},Sr.setSourceType=function(l,t){he[l]=t},Sr.registerForPluginStateChange=o.registerForPluginStateChange;var ml=`
#define EPSILON 0.0000001
#define PI 3.141592653589793
#define EXTENT 8192.0
#define HALF_PI PI/2.0
#define QUARTER_PI PI/4.0
#define RAD_TO_DEG 180.0/PI
#define DEG_TO_RAD PI/180.0
#define GLOBE_RADIUS EXTENT/PI/2.0`,gl="attribute highp vec3 a_pos_3f;uniform lowp mat4 u_matrix;varying highp vec3 v_uv;void main() {const mat3 half_neg_pi_around_x=mat3(1.0,0.0, 0.0,0.0,0.0,-1.0,0.0,1.0, 0.0);v_uv=half_neg_pi_around_x*a_pos_3f;vec4 pos=u_matrix*vec4(a_pos_3f,1.0);gl_Position=pos.xyww;}";let ns={},sn={};ns=Ft("",`
#define ELEVATION_SCALE 7.0
#define ELEVATION_OFFSET 450.0
#ifdef PROJECTION_GLOBE_VIEW
uniform vec3 u_tile_tl_up;uniform vec3 u_tile_tr_up;uniform vec3 u_tile_br_up;uniform vec3 u_tile_bl_up;uniform float u_tile_up_scale;vec3 elevationVector(vec2 pos) {vec2 uv=pos/EXTENT;vec3 up=normalize(mix(
mix(u_tile_tl_up,u_tile_tr_up,uv.xxx),mix(u_tile_bl_up,u_tile_br_up,uv.xxx),uv.yyy));return up*u_tile_up_scale;}
#else
vec3 elevationVector(vec2 pos) { return vec3(0,0,1); }
#endif
#ifdef TERRAIN
#ifdef TERRAIN_DEM_FLOAT_FORMAT
uniform highp sampler2D u_dem;uniform highp sampler2D u_dem_prev;
#else
uniform sampler2D u_dem;uniform sampler2D u_dem_prev;
#endif
uniform vec4 u_dem_unpack;uniform vec2 u_dem_tl;uniform vec2 u_dem_tl_prev;uniform float u_dem_scale;uniform float u_dem_scale_prev;uniform float u_dem_size;uniform float u_dem_lerp;uniform float u_exaggeration;uniform float u_meter_to_dem;uniform mat4 u_label_plane_matrix_inv;uniform sampler2D u_depth;uniform vec2 u_depth_size_inv;vec4 tileUvToDemSample(vec2 uv,float dem_size,float dem_scale,vec2 dem_tl) {vec2 pos=dem_size*(uv*dem_scale+dem_tl)+1.0;vec2 f=fract(pos);return vec4((pos-f+0.5)/(dem_size+2.0),f);}float decodeElevation(vec4 v) {return dot(vec4(v.xyz*255.0,-1.0),u_dem_unpack);}float currentElevation(vec2 apos) {
#ifdef TERRAIN_DEM_FLOAT_FORMAT
vec2 pos=(u_dem_size*(apos/8192.0*u_dem_scale+u_dem_tl)+1.5)/(u_dem_size+2.0);return u_exaggeration*texture2D(u_dem,pos).a;
#else
float dd=1.0/(u_dem_size+2.0);vec4 r=tileUvToDemSample(apos/8192.0,u_dem_size,u_dem_scale,u_dem_tl);vec2 pos=r.xy;vec2 f=r.zw;float tl=decodeElevation(texture2D(u_dem,pos));
#ifdef TERRAIN_DEM_NEAREST_FILTER
return u_exaggeration*tl;
#endif
float tr=decodeElevation(texture2D(u_dem,pos+vec2(dd,0.0)));float bl=decodeElevation(texture2D(u_dem,pos+vec2(0.0,dd)));float br=decodeElevation(texture2D(u_dem,pos+vec2(dd,dd)));return u_exaggeration*mix(mix(tl,tr,f.x),mix(bl,br,f.x),f.y);
#endif
}float prevElevation(vec2 apos) {
#ifdef TERRAIN_DEM_FLOAT_FORMAT
vec2 pos=(u_dem_size*(apos/8192.0*u_dem_scale_prev+u_dem_tl_prev)+1.5)/(u_dem_size+2.0);return u_exaggeration*texture2D(u_dem_prev,pos).a;
#else
float dd=1.0/(u_dem_size+2.0);vec4 r=tileUvToDemSample(apos/8192.0,u_dem_size,u_dem_scale_prev,u_dem_tl_prev);vec2 pos=r.xy;vec2 f=r.zw;float tl=decodeElevation(texture2D(u_dem_prev,pos));float tr=decodeElevation(texture2D(u_dem_prev,pos+vec2(dd,0.0)));float bl=decodeElevation(texture2D(u_dem_prev,pos+vec2(0.0,dd)));float br=decodeElevation(texture2D(u_dem_prev,pos+vec2(dd,dd)));return u_exaggeration*mix(mix(tl,tr,f.x),mix(bl,br,f.x),f.y);
#endif
}
#ifdef TERRAIN_VERTEX_MORPHING
float elevation(vec2 apos) {float nextElevation=currentElevation(apos);float prevElevation=prevElevation(apos);return mix(prevElevation,nextElevation,u_dem_lerp);}
#else
float elevation(vec2 apos) {return currentElevation(apos);}
#endif
float unpack_depth(vec4 rgba_depth)
{const vec4 bit_shift=vec4(1.0/(256.0*256.0*256.0),1.0/(256.0*256.0),1.0/256.0,1.0);return dot(rgba_depth,bit_shift)*2.0-1.0;}bool isOccluded(vec4 frag) {vec3 coord=frag.xyz/frag.w;float depth=unpack_depth(texture2D(u_depth,(coord.xy+1.0)*0.5));return coord.z > depth+0.0005;}float occlusionFade(vec4 frag) {vec3 coord=frag.xyz/frag.w;vec3 df=vec3(5.0*u_depth_size_inv,0.0);vec2 uv=0.5*coord.xy+0.5;vec4 depth=vec4(
unpack_depth(texture2D(u_depth,uv-df.xz)),unpack_depth(texture2D(u_depth,uv+df.xz)),unpack_depth(texture2D(u_depth,uv-df.zy)),unpack_depth(texture2D(u_depth,uv+df.zy))
);return dot(vec4(0.25),vec4(1.0)-clamp(300.0*(vec4(coord.z-0.001)-depth),0.0,1.0));}vec4 fourSample(vec2 pos,vec2 off) {
#ifdef TERRAIN_DEM_FLOAT_FORMAT
float tl=texture2D(u_dem,pos).a;float tr=texture2D(u_dem,pos+vec2(off.x,0.0)).a;float bl=texture2D(u_dem,pos+vec2(0.0,off.y)).a;float br=texture2D(u_dem,pos+off).a;
#else
vec4 demtl=vec4(texture2D(u_dem,pos).xyz*255.0,-1.0);float tl=dot(demtl,u_dem_unpack);vec4 demtr=vec4(texture2D(u_dem,pos+vec2(off.x,0.0)).xyz*255.0,-1.0);float tr=dot(demtr,u_dem_unpack);vec4 dembl=vec4(texture2D(u_dem,pos+vec2(0.0,off.y)).xyz*255.0,-1.0);float bl=dot(dembl,u_dem_unpack);vec4 dembr=vec4(texture2D(u_dem,pos+off).xyz*255.0,-1.0);float br=dot(dembr,u_dem_unpack);
#endif
return vec4(tl,tr,bl,br);}float flatElevation(vec2 pack) {vec2 apos=floor(pack/8.0);vec2 span=10.0*(pack-apos*8.0);vec2 uvTex=(apos-vec2(1.0,1.0))/8190.0;float size=u_dem_size+2.0;float dd=1.0/size;vec2 pos=u_dem_size*(uvTex*u_dem_scale+u_dem_tl)+1.0;vec2 f=fract(pos);pos=(pos-f+0.5)*dd;vec4 h=fourSample(pos,vec2(dd));float z=mix(mix(h.x,h.y,f.x),mix(h.z,h.w,f.x),f.y);vec2 w=floor(0.5*(span*u_meter_to_dem-1.0));vec2 d=dd*w;vec4 bounds=vec4(d,vec2(1.0)-d);h=fourSample(pos-d,2.0*d+vec2(dd));vec4 diff=abs(h.xzxy-h.ywzw);vec2 slope=min(vec2(0.25),u_meter_to_dem*0.5*(diff.xz+diff.yw)/(2.0*w+vec2(1.0)));vec2 fix=slope*span;float base=z+max(fix.x,fix.y);return u_exaggeration*base;}float elevationFromUint16(float word) {return u_exaggeration*(word/ELEVATION_SCALE-ELEVATION_OFFSET);}
#else
float elevation(vec2 pos) { return 0.0; }bool isOccluded(vec4 frag) { return false; }float occlusionFade(vec4 frag) { return 1.0; }
#endif`,!0),sn=Ft(`#ifdef FOG
uniform mediump vec4 u_fog_color;uniform mediump vec2 u_fog_range;uniform mediump float u_fog_horizon_blend;uniform mediump float u_fog_temporal_offset;varying vec3 v_fog_pos;uniform highp vec3 u_frustum_tl;uniform highp vec3 u_frustum_tr;uniform highp vec3 u_frustum_br;uniform highp vec3 u_frustum_bl;uniform highp vec3 u_globe_pos;uniform highp float u_globe_radius;uniform highp vec2 u_viewport;uniform float u_globe_transition;uniform int u_is_globe;float fog_range(float depth) {return (depth-u_fog_range[0])/(u_fog_range[1]-u_fog_range[0]);}float fog_horizon_blending(vec3 camera_dir) {float t=max(0.0,camera_dir.z/u_fog_horizon_blend);return u_fog_color.a*exp(-3.0*t*t);}float fog_opacity(float t) {const float decay=6.0;float falloff=1.0-min(1.0,exp(-decay*t));falloff*=falloff*falloff;return u_fog_color.a*min(1.0,1.00747*falloff);}float globe_glow_progress() {highp vec2 uv=gl_FragCoord.xy/u_viewport;highp vec3 ray_dir=mix(
mix(u_frustum_tl,u_frustum_tr,uv.x),mix(u_frustum_bl,u_frustum_br,uv.x),1.0-uv.y);highp vec3 dir=normalize(ray_dir);highp vec3 closest_point=dot(u_globe_pos,dir)*dir;highp float sdf=length(closest_point-u_globe_pos)/u_globe_radius;return sdf+PI*0.5;}float fog_opacity(vec3 pos) {float depth=length(pos);return fog_opacity(fog_range(depth));}vec3 fog_apply(vec3 color,vec3 pos) {float depth=length(pos);float opacity;if (u_is_globe==1) {float glow_progress=globe_glow_progress();float t=mix(glow_progress,depth,u_globe_transition);opacity=fog_opacity(fog_range(t));} else {opacity=fog_opacity(fog_range(depth));opacity*=fog_horizon_blending(pos/depth);}return mix(color,u_fog_color.rgb,opacity);}vec4 fog_apply_from_vert(vec4 color,float fog_opac) {float alpha=EPSILON+color.a;color.rgb=mix(color.rgb/alpha,u_fog_color.rgb,fog_opac)*alpha;return color;}vec3 fog_apply_sky_gradient(vec3 camera_ray,vec3 sky_color) {float horizon_blend=fog_horizon_blending(normalize(camera_ray));return mix(sky_color,u_fog_color.rgb,horizon_blend);}vec4 fog_apply_premultiplied(vec4 color,vec3 pos) {float alpha=EPSILON+color.a;color.rgb=fog_apply(color.rgb/alpha,pos)*alpha;return color;}vec3 fog_dither(vec3 color) {vec2 dither_seed=gl_FragCoord.xy+u_fog_temporal_offset;return dither(color,dither_seed);}vec4 fog_dither(vec4 color) {return vec4(fog_dither(color.rgb),color.a);}
#endif`,`#ifdef FOG
uniform mediump vec4 u_fog_color;uniform mediump vec2 u_fog_range;uniform mediump float u_fog_horizon_blend;uniform mediump mat4 u_fog_matrix;varying vec3 v_fog_pos;float fog_range(float depth) {return (depth-u_fog_range[0])/(u_fog_range[1]-u_fog_range[0]);}float fog_horizon_blending(vec3 camera_dir) {float t=max(0.0,camera_dir.z/u_fog_horizon_blend);return u_fog_color.a*exp(-3.0*t*t);}float fog_opacity(float t) {const float decay=6.0;float falloff=1.0-min(1.0,exp(-decay*t));falloff*=falloff*falloff;return u_fog_color.a*min(1.0,1.00747*falloff);}vec3 fog_position(vec3 pos) {return (u_fog_matrix*vec4(pos,1.0)).xyz;}vec3 fog_position(vec2 pos) {return fog_position(vec3(pos,0.0));}float fog(vec3 pos) {float depth=length(pos);float opacity=fog_opacity(fog_range(depth));return opacity*fog_horizon_blending(pos/depth);}
#endif`,!0);let sa=Ft(`
highp vec3 hash(highp vec2 p) {highp vec3 p3=fract(p.xyx*vec3(443.8975,397.2973,491.1871));p3+=dot(p3,p3.yxz+19.19);return fract((p3.xxy+p3.yzz)*p3.zyx);}vec3 dither(vec3 color,highp vec2 seed) {vec3 rnd=hash(seed)+hash(seed+0.59374)-0.5;return color+rnd/255.0;}
#ifdef TERRAIN
highp vec4 pack_depth(highp float ndc_z) {highp float depth=ndc_z*0.5+0.5;const highp vec4 bit_shift=vec4(256.0*256.0*256.0,256.0*256.0,256.0,1.0);const highp vec4 bit_mask =vec4(0.0,1.0/256.0,1.0/256.0,1.0/256.0);highp vec4 res=fract(depth*bit_shift);res-=res.xxyz*bit_mask;return res;}
#endif`,`
float wrap(float n,float min,float max) {float d=max-min;float w=mod(mod(n-min,d)+d,d)+min;return (w==min) ? max : w;}
#ifdef PROJECTION_GLOBE_VIEW
vec3 mercator_tile_position(mat4 matrix,vec2 tile_anchor,vec3 tile_id,vec2 mercator_center) {
#ifndef PROJECTED_POS_ON_VIEWPORT
float tiles=tile_id.z;vec2 mercator=(tile_anchor/EXTENT+tile_id.xy)/tiles;mercator-=mercator_center;mercator.x=wrap(mercator.x,-0.5,0.5);vec4 mercator_tile=vec4(mercator.xy*EXTENT,EXTENT/(2.0*PI),1.0);mercator_tile=matrix*mercator_tile;return mercator_tile.xyz;
#else
return vec3(0.0);
#endif
}vec3 mix_globe_mercator(vec3 globe,vec3 mercator,float t) {return mix(globe,mercator,t);}mat3 globe_mercator_surface_vectors(vec3 pos_normal,vec3 up_dir,float zoom_transition) {vec3 normal=zoom_transition==0.0 ? pos_normal : normalize(mix(pos_normal,up_dir,zoom_transition));vec3 xAxis=normalize(vec3(normal.z,0.0,-normal.x));vec3 yAxis=normalize(cross(normal,xAxis));return mat3(xAxis,yAxis,normal);}
#endif
vec2 unpack_float(const float packedValue) {int packedIntValue=int(packedValue);int v0=packedIntValue/256;return vec2(v0,packedIntValue-v0*256);}vec2 unpack_opacity(const float packedOpacity) {int intOpacity=int(packedOpacity)/2;return vec2(float(intOpacity)/127.0,mod(packedOpacity,2.0));}vec4 decode_color(const vec2 encodedColor) {return vec4(
unpack_float(encodedColor[0])/255.0,unpack_float(encodedColor[1])/255.0
);}float unpack_mix_vec2(const vec2 packedValue,const float t) {return mix(packedValue[0],packedValue[1],t);}vec4 unpack_mix_color(const vec4 packedColors,const float t) {vec4 minColor=decode_color(vec2(packedColors[0],packedColors[1]));vec4 maxColor=decode_color(vec2(packedColors[2],packedColors[3]));return mix(minColor,maxColor,t);}vec2 get_pattern_pos(const vec2 pixel_coord_upper,const vec2 pixel_coord_lower,const vec2 pattern_size,const float tile_units_to_pixels,const vec2 pos) {vec2 offset=mod(mod(mod(pixel_coord_upper,pattern_size)*256.0,pattern_size)*256.0+pixel_coord_lower,pattern_size);return (tile_units_to_pixels*pos+offset)/pattern_size;}const vec4 AWAY=vec4(-1000.0,-1000.0,-1000.0,1);//Normalized device coordinate that is not rendered.`),po=ml,fo=`
#ifdef GL_ES
precision mediump float;
#else

#if !defined(lowp)
#define lowp
#endif

#if !defined(mediump)
#define mediump
#endif

#if !defined(highp)
#define highp
#endif

#endif`;var aa={background:Ft(`uniform vec4 u_color;uniform float u_opacity;void main() {vec4 out_color=u_color;
#ifdef FOG
out_color=fog_dither(fog_apply_premultiplied(out_color,v_fog_pos));
#endif
gl_FragColor=out_color*u_opacity;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`attribute vec2 a_pos;uniform mat4 u_matrix;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);
#ifdef FOG
v_fog_pos=fog_position(a_pos);
#endif
}`),backgroundPattern:Ft(`uniform vec2 u_pattern_tl_a;uniform vec2 u_pattern_br_a;uniform vec2 u_pattern_tl_b;uniform vec2 u_pattern_br_b;uniform vec2 u_texsize;uniform float u_mix;uniform float u_opacity;uniform sampler2D u_image;varying vec2 v_pos_a;varying vec2 v_pos_b;void main() {vec2 imagecoord=mod(v_pos_a,1.0);vec2 pos=mix(u_pattern_tl_a/u_texsize,u_pattern_br_a/u_texsize,imagecoord);vec4 color1=texture2D(u_image,pos);vec2 imagecoord_b=mod(v_pos_b,1.0);vec2 pos2=mix(u_pattern_tl_b/u_texsize,u_pattern_br_b/u_texsize,imagecoord_b);vec4 color2=texture2D(u_image,pos2);vec4 out_color=mix(color1,color2,u_mix);
#ifdef FOG
out_color=fog_dither(fog_apply_premultiplied(out_color,v_fog_pos));
#endif
gl_FragColor=out_color*u_opacity;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`uniform mat4 u_matrix;uniform vec2 u_pattern_size_a;uniform vec2 u_pattern_size_b;uniform vec2 u_pixel_coord_upper;uniform vec2 u_pixel_coord_lower;uniform float u_scale_a;uniform float u_scale_b;uniform float u_tile_units_to_pixels;attribute vec2 a_pos;varying vec2 v_pos_a;varying vec2 v_pos_b;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);v_pos_a=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,u_scale_a*u_pattern_size_a,u_tile_units_to_pixels,a_pos);v_pos_b=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,u_scale_b*u_pattern_size_b,u_tile_units_to_pixels,a_pos);
#ifdef FOG
v_fog_pos=fog_position(a_pos);
#endif
}`),circle:Ft(`varying vec3 v_data;varying float v_visibility;
#pragma mapbox: define highp vec4 color
#pragma mapbox: define mediump float radius
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define highp vec4 stroke_color
#pragma mapbox: define mediump float stroke_width
#pragma mapbox: define lowp float stroke_opacity
void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize mediump float radius
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize highp vec4 stroke_color
#pragma mapbox: initialize mediump float stroke_width
#pragma mapbox: initialize lowp float stroke_opacity
vec2 extrude=v_data.xy;float extrude_length=length(extrude);lowp float antialiasblur=v_data.z;float antialiased_blur=-max(blur,antialiasblur);float opacity_t=smoothstep(0.0,antialiased_blur,extrude_length-1.0);float color_t=stroke_width < 0.01 ? 0.0 : smoothstep(
antialiased_blur,0.0,extrude_length-radius/(radius+stroke_width)
);vec4 out_color=mix(color*opacity,stroke_color*stroke_opacity,color_t);
#ifdef FOG
out_color=fog_apply_premultiplied(out_color,v_fog_pos);
#endif
gl_FragColor=out_color*(v_visibility*opacity_t);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`#define NUM_VISIBILITY_RINGS 2
#define INV_SQRT2 0.70710678
#define ELEVATION_BIAS 0.0001
#define NUM_SAMPLES_PER_RING 16
uniform mat4 u_matrix;uniform mat2 u_extrude_scale;uniform lowp float u_device_pixel_ratio;uniform highp float u_camera_to_center_distance;attribute vec2 a_pos;
#ifdef PROJECTION_GLOBE_VIEW
attribute vec3 a_pos_3;attribute vec3 a_pos_normal_3;attribute float a_scale;uniform mat4 u_inv_rot_matrix;uniform vec2 u_merc_center;uniform vec3 u_tile_id;uniform float u_zoom_transition;uniform vec3 u_up_dir;
#endif
varying vec3 v_data;varying float v_visibility;
#pragma mapbox: define highp vec4 color
#pragma mapbox: define mediump float radius
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define highp vec4 stroke_color
#pragma mapbox: define mediump float stroke_width
#pragma mapbox: define lowp float stroke_opacity
vec2 calc_offset(vec2 extrusion,float radius,float stroke_width, float view_scale) {return extrusion*(radius+stroke_width)*u_extrude_scale*view_scale;}float cantilevered_elevation(vec2 pos,float radius,float stroke_width,float view_scale) {vec2 c1=pos+calc_offset(vec2(-1,-1),radius,stroke_width,view_scale);vec2 c2=pos+calc_offset(vec2(1,-1),radius,stroke_width,view_scale);vec2 c3=pos+calc_offset(vec2(1,1),radius,stroke_width,view_scale);vec2 c4=pos+calc_offset(vec2(-1,1),radius,stroke_width,view_scale);float h1=elevation(c1)+ELEVATION_BIAS;float h2=elevation(c2)+ELEVATION_BIAS;float h3=elevation(c3)+ELEVATION_BIAS;float h4=elevation(c4)+ELEVATION_BIAS;return max(h4,max(h3,max(h1,h2)));}float circle_elevation(vec2 pos) {
#if defined(TERRAIN)
return elevation(pos)+ELEVATION_BIAS;
#else
return 0.0;
#endif
}vec4 project_vertex(vec2 extrusion,vec4 world_center,vec4 projected_center,float radius,float stroke_width, float view_scale,mat3 surface_vectors) {vec2 sample_offset=calc_offset(extrusion,radius,stroke_width,view_scale);
#ifdef PITCH_WITH_MAP
#ifdef PROJECTION_GLOBE_VIEW
return u_matrix*( world_center+vec4(sample_offset.x*surface_vectors[0]+sample_offset.y*surface_vectors[1],0) );
#else
return u_matrix*( world_center+vec4(sample_offset,0,0) );
#endif
#else
return projected_center+vec4(sample_offset,0,0);
#endif
}float get_sample_step() {
#ifdef PITCH_WITH_MAP
return 2.0*PI/float(NUM_SAMPLES_PER_RING);
#else
return PI/float(NUM_SAMPLES_PER_RING);
#endif
}void main(void) {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize mediump float radius
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize highp vec4 stroke_color
#pragma mapbox: initialize mediump float stroke_width
#pragma mapbox: initialize lowp float stroke_opacity
vec2 extrude=vec2(mod(a_pos,2.0)*2.0-1.0);vec2 circle_center=floor(a_pos*0.5);
#ifdef PROJECTION_GLOBE_VIEW
vec3 pos_normal_3=a_pos_normal_3/16384.0;mat3 surface_vectors=globe_mercator_surface_vectors(pos_normal_3,u_up_dir,u_zoom_transition);vec3 surface_extrusion=extrude.x*surface_vectors[0]+extrude.y*surface_vectors[1];vec3 globe_elevation=elevationVector(circle_center)*circle_elevation(circle_center);vec3 globe_pos=a_pos_3+surface_extrusion+globe_elevation;vec3 mercator_elevation=u_up_dir*u_tile_up_scale*circle_elevation(circle_center);vec3 merc_pos=mercator_tile_position(u_inv_rot_matrix,circle_center,u_tile_id,u_merc_center)+surface_extrusion+mercator_elevation;vec3 pos=mix_globe_mercator(globe_pos,merc_pos,u_zoom_transition);vec4 world_center=vec4(pos,1);
#else 
mat3 surface_vectors=mat3(1.0);float height=circle_elevation(circle_center);vec4 world_center=vec4(circle_center,height,1);
#endif
vec4 projected_center=u_matrix*world_center;float view_scale=0.0;
#ifdef PITCH_WITH_MAP
#ifdef SCALE_WITH_MAP
view_scale=1.0;
#else
view_scale=projected_center.w/u_camera_to_center_distance;
#endif
#else
#ifdef SCALE_WITH_MAP
view_scale=u_camera_to_center_distance;
#else
view_scale=projected_center.w;
#endif
#endif
gl_Position=project_vertex(extrude,world_center,projected_center,radius,stroke_width,view_scale,surface_vectors);float visibility=0.0;
#ifdef TERRAIN
float step=get_sample_step();
#ifdef PITCH_WITH_MAP
float cantilevered_height=cantilevered_elevation(circle_center,radius,stroke_width,view_scale);vec4 occlusion_world_center=vec4(circle_center,cantilevered_height,1);vec4 occlusion_projected_center=u_matrix*occlusion_world_center;
#else
vec4 occlusion_world_center=world_center;vec4 occlusion_projected_center=projected_center;
#endif
for(int ring=0; ring < NUM_VISIBILITY_RINGS; ring++) {float scale=(float(ring)+1.0)/float(NUM_VISIBILITY_RINGS);for(int i=0; i < NUM_SAMPLES_PER_RING; i++) {vec2 extrusion=vec2(cos(step*float(i)),-sin(step*float(i)))*scale;vec4 frag_pos=project_vertex(extrusion,occlusion_world_center,occlusion_projected_center,radius,stroke_width,view_scale,surface_vectors);visibility+=float(!isOccluded(frag_pos));}}visibility/=float(NUM_VISIBILITY_RINGS)*float(NUM_SAMPLES_PER_RING);
#else
visibility=1.0;
#endif
#ifdef PROJECTION_GLOBE_VIEW
visibility=1.0;
#endif
v_visibility=visibility;lowp float antialiasblur=1.0/u_device_pixel_ratio/(radius+stroke_width);v_data=vec3(extrude.x,extrude.y,antialiasblur);
#ifdef FOG
v_fog_pos=fog_position(world_center.xyz);
#endif
}`),clippingMask:Ft("void main() {gl_FragColor=vec4(1.0);}","attribute vec2 a_pos;uniform mat4 u_matrix;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);}"),heatmap:Ft(`uniform highp float u_intensity;varying vec2 v_extrude;
#pragma mapbox: define highp float weight
#define GAUSS_COEF 0.3989422804014327
void main() {
#pragma mapbox: initialize highp float weight
float d=-0.5*3.0*3.0*dot(v_extrude,v_extrude);float val=weight*u_intensity*GAUSS_COEF*exp(d);gl_FragColor=vec4(val,1.0,1.0,1.0);
#ifdef FOG
if (u_is_globe==0) {gl_FragColor.r*=pow(1.0-fog_opacity(v_fog_pos),2.0);}
#endif
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`uniform mat4 u_matrix;uniform float u_extrude_scale;uniform float u_opacity;uniform float u_intensity;attribute vec2 a_pos;
#ifdef PROJECTION_GLOBE_VIEW
attribute vec3 a_pos_3;attribute vec3 a_pos_normal_3;uniform mat4 u_inv_rot_matrix;uniform vec2 u_merc_center;uniform vec3 u_tile_id;uniform float u_zoom_transition;uniform vec3 u_up_dir;
#endif
varying vec2 v_extrude;
#pragma mapbox: define highp float weight
#pragma mapbox: define mediump float radius
const highp float ZERO=1.0/255.0/16.0;
#define GAUSS_COEF 0.3989422804014327
void main(void) {
#pragma mapbox: initialize highp float weight
#pragma mapbox: initialize mediump float radius
vec2 unscaled_extrude=vec2(mod(a_pos,2.0)*2.0-1.0);float S=sqrt(-2.0*log(ZERO/weight/u_intensity/GAUSS_COEF))/3.0;v_extrude=S*unscaled_extrude;vec2 extrude=v_extrude*radius*u_extrude_scale;vec2 tilePos=floor(a_pos*0.5);
#ifdef PROJECTION_GLOBE_VIEW
vec3 pos_normal_3=a_pos_normal_3/16384.0;mat3 surface_vectors=globe_mercator_surface_vectors(pos_normal_3,u_up_dir,u_zoom_transition);vec3 surface_extrusion=extrude.x*surface_vectors[0]+extrude.y*surface_vectors[1];vec3 globe_elevation=elevationVector(tilePos)*elevation(tilePos);vec3 globe_pos=a_pos_3+surface_extrusion+globe_elevation;vec3 mercator_elevation=u_up_dir*u_tile_up_scale*elevation(tilePos);vec3 merc_pos=mercator_tile_position(u_inv_rot_matrix,tilePos,u_tile_id,u_merc_center)+surface_extrusion+mercator_elevation;vec3 pos=mix_globe_mercator(globe_pos,merc_pos,u_zoom_transition);
#else
vec3 pos=vec3(tilePos+extrude,elevation(tilePos));
#endif
gl_Position=u_matrix*vec4(pos,1);
#ifdef FOG
v_fog_pos=fog_position(pos);
#endif
}`),heatmapTexture:Ft(`uniform sampler2D u_image;uniform sampler2D u_color_ramp;uniform float u_opacity;varying vec2 v_pos;void main() {float t=texture2D(u_image,v_pos).r;vec4 color=texture2D(u_color_ramp,vec2(t,0.5));gl_FragColor=color*u_opacity;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(0.0);
#endif
}`,"attribute vec2 a_pos;varying vec2 v_pos;void main() {gl_Position=vec4(a_pos,0,1);v_pos=a_pos*0.5+0.5;}"),collisionBox:Ft("varying float v_placed;varying float v_notUsed;void main() {vec4 red =vec4(1.0,0.0,0.0,1.0);vec4 blue=vec4(0.0,0.0,1.0,0.5);gl_FragColor =mix(red,blue,step(0.5,v_placed))*0.5;gl_FragColor*=mix(1.0,0.1,step(0.5,v_notUsed));}",`attribute vec3 a_pos;attribute vec2 a_anchor_pos;attribute vec2 a_extrude;attribute vec2 a_placed;attribute vec2 a_shift;attribute float a_size_scale;attribute vec2 a_padding;uniform mat4 u_matrix;uniform vec2 u_extrude_scale;uniform float u_camera_to_center_distance;varying float v_placed;varying float v_notUsed;void main() {vec4 projectedPoint=u_matrix*vec4(a_pos+elevationVector(a_anchor_pos)*elevation(a_anchor_pos),1);highp float camera_to_anchor_distance=projectedPoint.w;highp float collision_perspective_ratio=clamp(
0.5+0.5*(u_camera_to_center_distance/camera_to_anchor_distance),0.0,1.5);gl_Position=projectedPoint;gl_Position.xy+=(a_extrude*a_size_scale+a_shift+a_padding)*u_extrude_scale*gl_Position.w*collision_perspective_ratio;v_placed=a_placed.x;v_notUsed=a_placed.y;}`),collisionCircle:Ft("varying float v_radius;varying vec2 v_extrude;varying float v_perspective_ratio;varying float v_collision;void main() {float alpha=0.5*min(v_perspective_ratio,1.0);float stroke_radius=0.9*max(v_perspective_ratio,1.0);float distance_to_center=length(v_extrude);float distance_to_edge=abs(distance_to_center-v_radius);float opacity_t=smoothstep(-stroke_radius,0.0,-distance_to_edge);vec4 color=mix(vec4(0.0,0.0,1.0,0.5),vec4(1.0,0.0,0.0,1.0),v_collision);gl_FragColor=color*alpha*opacity_t;}",`attribute vec2 a_pos_2f;attribute float a_radius;attribute vec2 a_flags;uniform mat4 u_matrix;uniform mat4 u_inv_matrix;uniform vec2 u_viewport_size;uniform float u_camera_to_center_distance;varying float v_radius;varying vec2 v_extrude;varying float v_perspective_ratio;varying float v_collision;vec3 toTilePosition(vec2 screenPos) {vec4 rayStart=u_inv_matrix*vec4(screenPos,-1.0,1.0);vec4 rayEnd  =u_inv_matrix*vec4(screenPos, 1.0,1.0);rayStart.xyz/=rayStart.w;rayEnd.xyz  /=rayEnd.w;highp float t=(0.0-rayStart.z)/(rayEnd.z-rayStart.z);return mix(rayStart.xyz,rayEnd.xyz,t);}void main() {vec2 quadCenterPos=a_pos_2f;float radius=a_radius;float collision=a_flags.x;float vertexIdx=a_flags.y;vec2 quadVertexOffset=vec2(
mix(-1.0,1.0,float(vertexIdx >=2.0)),mix(-1.0,1.0,float(vertexIdx >=1.0 && vertexIdx <=2.0)));vec2 quadVertexExtent=quadVertexOffset*radius;vec3 tilePos=toTilePosition(quadCenterPos);vec4 clipPos=u_matrix*vec4(tilePos,1.0);highp float camera_to_anchor_distance=clipPos.w;highp float collision_perspective_ratio=clamp(
0.5+0.5*(u_camera_to_center_distance/camera_to_anchor_distance),0.0,4.0);float padding_factor=1.2;v_radius=radius;v_extrude=quadVertexExtent*padding_factor;v_perspective_ratio=collision_perspective_ratio;v_collision=collision;gl_Position=vec4(clipPos.xyz/clipPos.w,1.0)+vec4(quadVertexExtent*padding_factor/u_viewport_size*2.0,0.0,0.0);}`),debug:Ft("uniform highp vec4 u_color;uniform sampler2D u_overlay;varying vec2 v_uv;void main() {vec4 overlay_color=texture2D(u_overlay,v_uv);gl_FragColor=mix(u_color,overlay_color,overlay_color.a);}",`attribute vec2 a_pos;
#ifdef PROJECTION_GLOBE_VIEW
attribute vec3 a_pos_3;
#endif
varying vec2 v_uv;uniform mat4 u_matrix;uniform float u_overlay_scale;void main() {float h=elevation(a_pos);v_uv=a_pos/8192.0;
#ifdef PROJECTION_GLOBE_VIEW
gl_Position=u_matrix*vec4(a_pos_3+elevationVector(a_pos)*h,1);
#else
gl_Position=u_matrix*vec4(a_pos*u_overlay_scale,h,1);
#endif
}`),fill:Ft(`#pragma mapbox: define highp vec4 color
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize lowp float opacity
vec4 out_color=color;
#ifdef FOG
out_color=fog_dither(fog_apply_premultiplied(out_color,v_fog_pos));
#endif
gl_FragColor=out_color*opacity;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`attribute vec2 a_pos;uniform mat4 u_matrix;
#pragma mapbox: define highp vec4 color
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize lowp float opacity
gl_Position=u_matrix*vec4(a_pos,0,1);
#ifdef FOG
v_fog_pos=fog_position(a_pos);
#endif
}`),fillOutline:Ft(`varying vec2 v_pos;
#pragma mapbox: define highp vec4 outline_color
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize highp vec4 outline_color
#pragma mapbox: initialize lowp float opacity
float dist=length(v_pos-gl_FragCoord.xy);float alpha=1.0-smoothstep(0.0,1.0,dist);vec4 out_color=outline_color;
#ifdef FOG
out_color=fog_dither(fog_apply_premultiplied(out_color,v_fog_pos));
#endif
gl_FragColor=out_color*(alpha*opacity);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`attribute vec2 a_pos;uniform mat4 u_matrix;uniform vec2 u_world;varying vec2 v_pos;
#pragma mapbox: define highp vec4 outline_color
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize highp vec4 outline_color
#pragma mapbox: initialize lowp float opacity
gl_Position=u_matrix*vec4(a_pos,0,1);v_pos=(gl_Position.xy/gl_Position.w+1.0)/2.0*u_world;
#ifdef FOG
v_fog_pos=fog_position(a_pos);
#endif
}`),fillOutlinePattern:Ft(`uniform vec2 u_texsize;uniform sampler2D u_image;uniform float u_fade;varying vec2 v_pos_a;varying vec2 v_pos_b;varying vec2 v_pos;
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp vec4 pattern_from
#pragma mapbox: define lowp vec4 pattern_to
void main() {
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump vec4 pattern_from
#pragma mapbox: initialize mediump vec4 pattern_to
vec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;vec2 imagecoord=mod(v_pos_a,1.0);vec2 pos=mix(pattern_tl_a/u_texsize,pattern_br_a/u_texsize,imagecoord);vec4 color1=texture2D(u_image,pos);vec2 imagecoord_b=mod(v_pos_b,1.0);vec2 pos2=mix(pattern_tl_b/u_texsize,pattern_br_b/u_texsize,imagecoord_b);vec4 color2=texture2D(u_image,pos2);float dist=length(v_pos-gl_FragCoord.xy);float alpha=1.0-smoothstep(0.0,1.0,dist);vec4 out_color=mix(color1,color2,u_fade);
#ifdef FOG
out_color=fog_dither(fog_apply_premultiplied(out_color,v_fog_pos));
#endif
gl_FragColor=out_color*(alpha*opacity);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`uniform mat4 u_matrix;uniform vec2 u_world;uniform vec2 u_pixel_coord_upper;uniform vec2 u_pixel_coord_lower;uniform vec3 u_scale;attribute vec2 a_pos;varying vec2 v_pos_a;varying vec2 v_pos_b;varying vec2 v_pos;
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp vec4 pattern_from
#pragma mapbox: define lowp vec4 pattern_to
#pragma mapbox: define lowp float pixel_ratio_from
#pragma mapbox: define lowp float pixel_ratio_to
void main() {
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump vec4 pattern_from
#pragma mapbox: initialize mediump vec4 pattern_to
#pragma mapbox: initialize lowp float pixel_ratio_from
#pragma mapbox: initialize lowp float pixel_ratio_to
vec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;float tileRatio=u_scale.x;float fromScale=u_scale.y;float toScale=u_scale.z;gl_Position=u_matrix*vec4(a_pos,0,1);vec2 display_size_a=(pattern_br_a-pattern_tl_a)/pixel_ratio_from;vec2 display_size_b=(pattern_br_b-pattern_tl_b)/pixel_ratio_to;v_pos_a=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,fromScale*display_size_a,tileRatio,a_pos);v_pos_b=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,toScale*display_size_b,tileRatio,a_pos);v_pos=(gl_Position.xy/gl_Position.w+1.0)/2.0*u_world;
#ifdef FOG
v_fog_pos=fog_position(a_pos);
#endif
}`),fillPattern:Ft(`uniform vec2 u_texsize;uniform float u_fade;uniform sampler2D u_image;varying vec2 v_pos_a;varying vec2 v_pos_b;
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp vec4 pattern_from
#pragma mapbox: define lowp vec4 pattern_to
void main() {
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump vec4 pattern_from
#pragma mapbox: initialize mediump vec4 pattern_to
vec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;vec2 imagecoord=mod(v_pos_a,1.0);vec2 pos=mix(pattern_tl_a/u_texsize,pattern_br_a/u_texsize,imagecoord);vec4 color1=texture2D(u_image,pos);vec2 imagecoord_b=mod(v_pos_b,1.0);vec2 pos2=mix(pattern_tl_b/u_texsize,pattern_br_b/u_texsize,imagecoord_b);vec4 color2=texture2D(u_image,pos2);vec4 out_color=mix(color1,color2,u_fade);
#ifdef FOG
out_color=fog_dither(fog_apply_premultiplied(out_color,v_fog_pos));
#endif
gl_FragColor=out_color*opacity;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`uniform mat4 u_matrix;uniform vec2 u_pixel_coord_upper;uniform vec2 u_pixel_coord_lower;uniform vec3 u_scale;attribute vec2 a_pos;varying vec2 v_pos_a;varying vec2 v_pos_b;
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp vec4 pattern_from
#pragma mapbox: define lowp vec4 pattern_to
#pragma mapbox: define lowp float pixel_ratio_from
#pragma mapbox: define lowp float pixel_ratio_to
void main() {
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump vec4 pattern_from
#pragma mapbox: initialize mediump vec4 pattern_to
#pragma mapbox: initialize lowp float pixel_ratio_from
#pragma mapbox: initialize lowp float pixel_ratio_to
vec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;float tileZoomRatio=u_scale.x;float fromScale=u_scale.y;float toScale=u_scale.z;vec2 display_size_a=(pattern_br_a-pattern_tl_a)/pixel_ratio_from;vec2 display_size_b=(pattern_br_b-pattern_tl_b)/pixel_ratio_to;gl_Position=u_matrix*vec4(a_pos,0,1);v_pos_a=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,fromScale*display_size_a,tileZoomRatio,a_pos);v_pos_b=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,toScale*display_size_b,tileZoomRatio,a_pos);
#ifdef FOG
v_fog_pos=fog_position(a_pos);
#endif
}`),fillExtrusion:Ft(`varying vec4 v_color;void main() {vec4 color=v_color;
#ifdef FOG
color=fog_dither(fog_apply_premultiplied(color,v_fog_pos));
#endif
gl_FragColor=color;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`uniform mat4 u_matrix;uniform vec3 u_lightcolor;uniform lowp vec3 u_lightpos;uniform lowp float u_lightintensity;uniform float u_vertical_gradient;uniform lowp float u_opacity;attribute vec4 a_pos_normal_ed;attribute vec2 a_centroid_pos;
#ifdef PROJECTION_GLOBE_VIEW
attribute vec3 a_pos_3;attribute vec3 a_pos_normal_3;uniform mat4 u_inv_rot_matrix;uniform vec2 u_merc_center;uniform vec3 u_tile_id;uniform float u_zoom_transition;uniform vec3 u_up_dir;uniform float u_height_lift;
#endif
varying vec4 v_color;
#pragma mapbox: define highp float base
#pragma mapbox: define highp float height
#pragma mapbox: define highp vec4 color
void main() {
#pragma mapbox: initialize highp float base
#pragma mapbox: initialize highp float height
#pragma mapbox: initialize highp vec4 color
vec3 pos_nx=floor(a_pos_normal_ed.xyz*0.5);mediump vec3 top_up_ny=a_pos_normal_ed.xyz-2.0*pos_nx;float x_normal=pos_nx.z/8192.0;vec3 normal=top_up_ny.y==1.0 ? vec3(0.0,0.0,1.0) : normalize(vec3(x_normal,(2.0*top_up_ny.z-1.0)*(1.0-abs(x_normal)),0.0));base=max(0.0,base);height=max(0.0,height);float t=top_up_ny.x;vec2 centroid_pos=vec2(0.0);
#if defined(HAS_CENTROID) || defined(TERRAIN)
centroid_pos=a_centroid_pos;
#endif
#ifdef TERRAIN
bool flat_roof=centroid_pos.x !=0.0 && t > 0.0;float ele=elevation(pos_nx.xy);float c_ele=flat_roof ? centroid_pos.y==0.0 ? elevationFromUint16(centroid_pos.x) : flatElevation(centroid_pos) : ele;float h=flat_roof ? max(c_ele+height,ele+base+2.0) : ele+(t > 0.0 ? height : base==0.0 ?-5.0 : base);vec3 pos=vec3(pos_nx.xy,h);
#else
vec3 pos=vec3(pos_nx.xy,t > 0.0 ? height : base);
#endif
#ifdef PROJECTION_GLOBE_VIEW
float lift=float((t+base) > 0.0)*u_height_lift;vec3 globe_normal=normalize(mix(a_pos_normal_3/16384.0,u_up_dir,u_zoom_transition));vec3 globe_pos=a_pos_3+globe_normal*(u_tile_up_scale*(pos.z+lift));vec3 merc_pos=mercator_tile_position(u_inv_rot_matrix,pos.xy,u_tile_id,u_merc_center)+u_up_dir*u_tile_up_scale*pos.z;pos=mix_globe_mercator(globe_pos,merc_pos,u_zoom_transition);
#endif
float hidden=float(centroid_pos.x==0.0 && centroid_pos.y==1.0);gl_Position=mix(u_matrix*vec4(pos,1),AWAY,hidden);float colorvalue=color.r*0.2126+color.g*0.7152+color.b*0.0722;v_color=vec4(0.0,0.0,0.0,1.0);vec4 ambientlight=vec4(0.03,0.03,0.03,1.0);color+=ambientlight;float directional=clamp(dot(normal,u_lightpos),0.0,1.0);directional=mix((1.0-u_lightintensity),max((1.0-colorvalue+u_lightintensity),1.0),directional);if (normal.y !=0.0) {directional*=(
(1.0-u_vertical_gradient)+(u_vertical_gradient*clamp((t+base)*pow(height/150.0,0.5),mix(0.7,0.98,1.0-u_lightintensity),1.0)));}v_color.rgb+=clamp(color.rgb*directional*u_lightcolor,mix(vec3(0.0),vec3(0.3),1.0-u_lightcolor),vec3(1.0));v_color*=u_opacity;
#ifdef FOG
v_fog_pos=fog_position(pos);
#endif
}`),fillExtrusionPattern:Ft(`uniform vec2 u_texsize;uniform float u_fade;uniform sampler2D u_image;varying vec2 v_pos_a;varying vec2 v_pos_b;varying vec4 v_lighting;
#pragma mapbox: define lowp float base
#pragma mapbox: define lowp float height
#pragma mapbox: define lowp vec4 pattern_from
#pragma mapbox: define lowp vec4 pattern_to
#pragma mapbox: define lowp float pixel_ratio_from
#pragma mapbox: define lowp float pixel_ratio_to
void main() {
#pragma mapbox: initialize lowp float base
#pragma mapbox: initialize lowp float height
#pragma mapbox: initialize mediump vec4 pattern_from
#pragma mapbox: initialize mediump vec4 pattern_to
#pragma mapbox: initialize lowp float pixel_ratio_from
#pragma mapbox: initialize lowp float pixel_ratio_to
vec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;vec2 imagecoord=mod(v_pos_a,1.0);vec2 pos=mix(pattern_tl_a/u_texsize,pattern_br_a/u_texsize,imagecoord);vec4 color1=texture2D(u_image,pos);vec2 imagecoord_b=mod(v_pos_b,1.0);vec2 pos2=mix(pattern_tl_b/u_texsize,pattern_br_b/u_texsize,imagecoord_b);vec4 color2=texture2D(u_image,pos2);vec4 out_color=mix(color1,color2,u_fade);out_color=out_color*v_lighting;
#ifdef FOG
out_color=fog_dither(fog_apply_premultiplied(out_color,v_fog_pos));
#endif
gl_FragColor=out_color;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`uniform mat4 u_matrix;uniform vec2 u_pixel_coord_upper;uniform vec2 u_pixel_coord_lower;uniform float u_height_factor;uniform vec3 u_scale;uniform float u_vertical_gradient;uniform lowp float u_opacity;uniform vec3 u_lightcolor;uniform lowp vec3 u_lightpos;uniform lowp float u_lightintensity;attribute vec4 a_pos_normal_ed;attribute vec2 a_centroid_pos;
#ifdef PROJECTION_GLOBE_VIEW
attribute vec3 a_pos_3;attribute vec3 a_pos_normal_3;uniform mat4 u_inv_rot_matrix;uniform vec2 u_merc_center;uniform vec3 u_tile_id;uniform float u_zoom_transition;uniform vec3 u_up_dir;uniform float u_height_lift;
#endif
varying vec2 v_pos_a;varying vec2 v_pos_b;varying vec4 v_lighting;
#pragma mapbox: define lowp float base
#pragma mapbox: define lowp float height
#pragma mapbox: define lowp vec4 pattern_from
#pragma mapbox: define lowp vec4 pattern_to
#pragma mapbox: define lowp float pixel_ratio_from
#pragma mapbox: define lowp float pixel_ratio_to
void main() {
#pragma mapbox: initialize lowp float base
#pragma mapbox: initialize lowp float height
#pragma mapbox: initialize mediump vec4 pattern_from
#pragma mapbox: initialize mediump vec4 pattern_to
#pragma mapbox: initialize lowp float pixel_ratio_from
#pragma mapbox: initialize lowp float pixel_ratio_to
vec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;float tileRatio=u_scale.x;float fromScale=u_scale.y;float toScale=u_scale.z;vec3 pos_nx=floor(a_pos_normal_ed.xyz*0.5);mediump vec3 top_up_ny=a_pos_normal_ed.xyz-2.0*pos_nx;float x_normal=pos_nx.z/8192.0;vec3 normal=top_up_ny.y==1.0 ? vec3(0.0,0.0,1.0) : normalize(vec3(x_normal,(2.0*top_up_ny.z-1.0)*(1.0-abs(x_normal)),0.0));float edgedistance=a_pos_normal_ed.w;vec2 display_size_a=(pattern_br_a-pattern_tl_a)/pixel_ratio_from;vec2 display_size_b=(pattern_br_b-pattern_tl_b)/pixel_ratio_to;base=max(0.0,base);height=max(0.0,height);float t=top_up_ny.x;float z=t > 0.0 ? height : base;vec2 centroid_pos=vec2(0.0);
#if defined(HAS_CENTROID) || defined(TERRAIN)
centroid_pos=a_centroid_pos;
#endif
#ifdef TERRAIN
bool flat_roof=centroid_pos.x !=0.0 && t > 0.0;float ele=elevation(pos_nx.xy);float c_ele=flat_roof ? centroid_pos.y==0.0 ? elevationFromUint16(centroid_pos.x) : flatElevation(centroid_pos) : ele;float h=flat_roof ? max(c_ele+height,ele+base+2.0) : ele+(t > 0.0 ? height : base==0.0 ?-5.0 : base);vec3 p=vec3(pos_nx.xy,h);
#else
vec3 p=vec3(pos_nx.xy,z);
#endif
#ifdef PROJECTION_GLOBE_VIEW
float lift=float((t+base) > 0.0)*u_height_lift;vec3 globe_normal=normalize(mix(a_pos_normal_3/16384.0,u_up_dir,u_zoom_transition));vec3 globe_pos=a_pos_3+globe_normal*(u_tile_up_scale*(p.z+lift));vec3 merc_pos=mercator_tile_position(u_inv_rot_matrix,p.xy,u_tile_id,u_merc_center)+u_up_dir*u_tile_up_scale*p.z;p=mix_globe_mercator(globe_pos,merc_pos,u_zoom_transition);
#endif
float hidden=float(centroid_pos.x==0.0 && centroid_pos.y==1.0);gl_Position=mix(u_matrix*vec4(p,1),AWAY,hidden);vec2 pos=normal.z==1.0
? pos_nx.xy
: vec2(edgedistance,z*u_height_factor);v_pos_a=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,fromScale*display_size_a,tileRatio,pos);v_pos_b=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,toScale*display_size_b,tileRatio,pos);v_lighting=vec4(0.0,0.0,0.0,1.0);float directional=clamp(dot(normal,u_lightpos),0.0,1.0);directional=mix((1.0-u_lightintensity),max((0.5+u_lightintensity),1.0),directional);if (normal.y !=0.0) {directional*=(
(1.0-u_vertical_gradient)+(u_vertical_gradient*clamp((t+base)*pow(height/150.0,0.5),mix(0.7,0.98,1.0-u_lightintensity),1.0)));}v_lighting.rgb+=clamp(directional*u_lightcolor,mix(vec3(0.0),vec3(0.3),1.0-u_lightcolor),vec3(1.0));v_lighting*=u_opacity;
#ifdef FOG
v_fog_pos=fog_position(p);
#endif
}`),hillshadePrepare:Ft(`#ifdef GL_ES
precision highp float;
#endif
uniform sampler2D u_image;varying vec2 v_pos;uniform vec2 u_dimension;uniform float u_zoom;uniform vec4 u_unpack;float getElevation(vec2 coord) {
#ifdef TERRAIN_DEM_FLOAT_FORMAT
return texture2D(u_image,coord).a/4.0;
#else
vec4 data=texture2D(u_image,coord)*255.0;data.a=-1.0;return dot(data,u_unpack)/4.0;
#endif
}void main() {vec2 epsilon=1.0/u_dimension;float a=getElevation(v_pos+vec2(-epsilon.x,-epsilon.y));float b=getElevation(v_pos+vec2(0,-epsilon.y));float c=getElevation(v_pos+vec2(epsilon.x,-epsilon.y));float d=getElevation(v_pos+vec2(-epsilon.x,0));float e=getElevation(v_pos);float f=getElevation(v_pos+vec2(epsilon.x,0));float g=getElevation(v_pos+vec2(-epsilon.x,epsilon.y));float h=getElevation(v_pos+vec2(0,epsilon.y));float i=getElevation(v_pos+vec2(epsilon.x,epsilon.y));float exaggerationFactor=u_zoom < 2.0 ? 0.4 : u_zoom < 4.5 ? 0.35 : 0.3;float exaggeration=u_zoom < 15.0 ? (u_zoom-15.0)*exaggerationFactor : 0.0;vec2 deriv=vec2(
(c+f+f+i)-(a+d+d+g),(g+h+h+i)-(a+b+b+c)
)/pow(2.0,exaggeration+(19.2562-u_zoom));gl_FragColor=clamp(vec4(
deriv.x/2.0+0.5,deriv.y/2.0+0.5,1.0,1.0),0.0,1.0);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,"uniform mat4 u_matrix;uniform vec2 u_dimension;attribute vec2 a_pos;attribute vec2 a_texture_pos;varying vec2 v_pos;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);highp vec2 epsilon=1.0/u_dimension;float scale=(u_dimension.x-2.0)/u_dimension.x;v_pos=(a_texture_pos/8192.0)*scale+epsilon;}"),hillshade:Ft(`uniform sampler2D u_image;varying vec2 v_pos;uniform vec2 u_latrange;uniform vec2 u_light;uniform vec4 u_shadow;uniform vec4 u_highlight;uniform vec4 u_accent;void main() {vec4 pixel=texture2D(u_image,v_pos);vec2 deriv=((pixel.rg*2.0)-1.0);float scaleFactor=cos(radians((u_latrange[0]-u_latrange[1])*(1.0-v_pos.y)+u_latrange[1]));float slope=atan(1.25*length(deriv)/scaleFactor);float aspect=deriv.x !=0.0 ? atan(deriv.y,-deriv.x) : PI/2.0*(deriv.y > 0.0 ? 1.0 :-1.0);float intensity=u_light.x;float azimuth=u_light.y+PI;float base=1.875-intensity*1.75;float maxValue=0.5*PI;float scaledSlope=intensity !=0.5 ? ((pow(base,slope)-1.0)/(pow(base,maxValue)-1.0))*maxValue : slope;float accent=cos(scaledSlope);vec4 accent_color=(1.0-accent)*u_accent*clamp(intensity*2.0,0.0,1.0);float shade=abs(mod((aspect+azimuth)/PI+0.5,2.0)-1.0);vec4 shade_color=mix(u_shadow,u_highlight,shade)*sin(scaledSlope)*clamp(intensity*2.0,0.0,1.0);gl_FragColor=accent_color*(1.0-shade_color.a)+shade_color;
#ifdef FOG
gl_FragColor=fog_dither(fog_apply_premultiplied(gl_FragColor,v_fog_pos));
#endif
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`uniform mat4 u_matrix;attribute vec2 a_pos;attribute vec2 a_texture_pos;varying vec2 v_pos;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);v_pos=a_texture_pos/8192.0;
#ifdef FOG
v_fog_pos=fog_position(a_pos);
#endif
}`),line:Ft(`uniform lowp float u_device_pixel_ratio;uniform float u_alpha_discard_threshold;uniform highp vec2 u_trim_offset;varying vec2 v_width2;varying vec2 v_normal;varying float v_gamma_scale;varying highp vec4 v_uv;
#ifdef RENDER_LINE_DASH
uniform sampler2D u_dash_image;uniform float u_mix;uniform vec3 u_scale;varying vec2 v_tex_a;varying vec2 v_tex_b;
#endif
#ifdef RENDER_LINE_GRADIENT
uniform sampler2D u_gradient_image;
#endif
#pragma mapbox: define highp vec4 color
#pragma mapbox: define lowp float floorwidth
#pragma mapbox: define lowp vec4 dash_from
#pragma mapbox: define lowp vec4 dash_to
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize lowp float floorwidth
#pragma mapbox: initialize lowp vec4 dash_from
#pragma mapbox: initialize lowp vec4 dash_to
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
float dist=length(v_normal)*v_width2.s;float blur2=(blur+1.0/u_device_pixel_ratio)*v_gamma_scale;float alpha=clamp(min(dist-(v_width2.t-blur2),v_width2.s-dist)/blur2,0.0,1.0);
#ifdef RENDER_LINE_DASH
float sdfdist_a=texture2D(u_dash_image,v_tex_a).a;float sdfdist_b=texture2D(u_dash_image,v_tex_b).a;float sdfdist=mix(sdfdist_a,sdfdist_b,u_mix);float sdfwidth=min(dash_from.z*u_scale.y,dash_to.z*u_scale.z);float sdfgamma=1.0/(2.0*u_device_pixel_ratio)/sdfwidth;alpha*=smoothstep(0.5-sdfgamma/floorwidth,0.5+sdfgamma/floorwidth,sdfdist);
#endif
#ifdef RENDER_LINE_GRADIENT
highp vec4 out_color=texture2D(u_gradient_image,v_uv.xy);
#else
vec4 out_color=color;
#endif
#ifdef RENDER_LINE_TRIM_OFFSET
highp float start=v_uv[2];highp float end=v_uv[3];highp float trim_start=u_trim_offset[0];highp float trim_end=u_trim_offset[1];highp float line_progress=(start+(v_uv.x)*(end-start));if (trim_end > trim_start) {if (line_progress <=trim_end && line_progress >=trim_start) {out_color=vec4(0,0,0,0);}}
#endif
#ifdef FOG
out_color=fog_dither(fog_apply_premultiplied(out_color,v_fog_pos));
#endif
#ifdef RENDER_LINE_ALPHA_DISCARD
if (alpha < u_alpha_discard_threshold) {discard;}
#endif
gl_FragColor=out_color*(alpha*opacity);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`
#define EXTRUDE_SCALE 0.015873016
attribute vec2 a_pos_normal;attribute vec4 a_data;
#if defined(RENDER_LINE_GRADIENT) || defined(RENDER_LINE_TRIM_OFFSET)
attribute highp vec4 a_packed;
#endif
#ifdef RENDER_LINE_DASH
attribute float a_linesofar;
#endif
uniform mat4 u_matrix;uniform mat2 u_pixels_to_tile_units;uniform vec2 u_units_to_pixels;uniform lowp float u_device_pixel_ratio;varying vec2 v_normal;varying vec2 v_width2;varying float v_gamma_scale;varying highp vec4 v_uv;
#ifdef RENDER_LINE_DASH
uniform vec2 u_texsize;uniform mediump vec3 u_scale;varying vec2 v_tex_a;varying vec2 v_tex_b;
#endif
#ifdef RENDER_LINE_GRADIENT
uniform float u_image_height;
#endif
#pragma mapbox: define highp vec4 color
#pragma mapbox: define lowp float floorwidth
#pragma mapbox: define lowp vec4 dash_from
#pragma mapbox: define lowp vec4 dash_to
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define mediump float gapwidth
#pragma mapbox: define lowp float offset
#pragma mapbox: define mediump float width
void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize lowp float floorwidth
#pragma mapbox: initialize lowp vec4 dash_from
#pragma mapbox: initialize lowp vec4 dash_to
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump float gapwidth
#pragma mapbox: initialize lowp float offset
#pragma mapbox: initialize mediump float width
float ANTIALIASING=1.0/u_device_pixel_ratio/2.0;vec2 a_extrude=a_data.xy-128.0;float a_direction=mod(a_data.z,4.0)-1.0;vec2 pos=floor(a_pos_normal*0.5);mediump vec2 normal=a_pos_normal-2.0*pos;normal.y=normal.y*2.0-1.0;v_normal=normal;gapwidth=gapwidth/2.0;float halfwidth=width/2.0;offset=-1.0*offset;float inset=gapwidth+(gapwidth > 0.0 ? ANTIALIASING : 0.0);float outset=gapwidth+halfwidth*(gapwidth > 0.0 ? 2.0 : 1.0)+(halfwidth==0.0 ? 0.0 : ANTIALIASING);mediump vec2 dist=outset*a_extrude*EXTRUDE_SCALE;mediump float u=0.5*a_direction;mediump float t=1.0-abs(u);mediump vec2 offset2=offset*a_extrude*EXTRUDE_SCALE*normal.y*mat2(t,-u,u,t);vec4 projected_extrude=u_matrix*vec4(dist*u_pixels_to_tile_units,0.0,0.0);gl_Position=u_matrix*vec4(pos+offset2*u_pixels_to_tile_units,0.0,1.0)+projected_extrude;
#ifndef RENDER_TO_TEXTURE
float extrude_length_without_perspective=length(dist);float extrude_length_with_perspective=length(projected_extrude.xy/gl_Position.w*u_units_to_pixels);v_gamma_scale=extrude_length_without_perspective/extrude_length_with_perspective;
#else
v_gamma_scale=1.0;
#endif
#if defined(RENDER_LINE_GRADIENT) || defined(RENDER_LINE_TRIM_OFFSET)
float a_uv_x=a_packed[0];float a_split_index=a_packed[1];highp float a_clip_start=a_packed[2];highp float a_clip_end=a_packed[3];
#ifdef RENDER_LINE_GRADIENT
highp float texel_height=1.0/u_image_height;highp float half_texel_height=0.5*texel_height;v_uv=vec4(a_uv_x,a_split_index*texel_height-half_texel_height,a_clip_start,a_clip_end);
#else
v_uv=vec4(a_uv_x,0.0,a_clip_start,a_clip_end);
#endif
#endif
#ifdef RENDER_LINE_DASH
float tileZoomRatio=u_scale.x;float fromScale=u_scale.y;float toScale=u_scale.z;float scaleA=dash_from.z==0.0 ? 0.0 : tileZoomRatio/(dash_from.z*fromScale);float scaleB=dash_to.z==0.0 ? 0.0 : tileZoomRatio/(dash_to.z*toScale);float heightA=dash_from.y;float heightB=dash_to.y;v_tex_a=vec2(a_linesofar*scaleA/floorwidth,(-normal.y*heightA+dash_from.x+0.5)/u_texsize.y);v_tex_b=vec2(a_linesofar*scaleB/floorwidth,(-normal.y*heightB+dash_to.x+0.5)/u_texsize.y);
#endif
v_width2=vec2(outset,inset);
#ifdef FOG
v_fog_pos=fog_position(pos);
#endif
}`),linePattern:Ft(`uniform lowp float u_device_pixel_ratio;uniform vec2 u_texsize;uniform float u_fade;uniform mediump vec3 u_scale;uniform sampler2D u_image;varying vec2 v_normal;varying vec2 v_width2;varying float v_linesofar;varying float v_gamma_scale;varying float v_width;
#pragma mapbox: define lowp vec4 pattern_from
#pragma mapbox: define lowp vec4 pattern_to
#pragma mapbox: define lowp float pixel_ratio_from
#pragma mapbox: define lowp float pixel_ratio_to
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize mediump vec4 pattern_from
#pragma mapbox: initialize mediump vec4 pattern_to
#pragma mapbox: initialize lowp float pixel_ratio_from
#pragma mapbox: initialize lowp float pixel_ratio_to
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
vec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;float tileZoomRatio=u_scale.x;float fromScale=u_scale.y;float toScale=u_scale.z;vec2 display_size_a=(pattern_br_a-pattern_tl_a)/pixel_ratio_from;vec2 display_size_b=(pattern_br_b-pattern_tl_b)/pixel_ratio_to;vec2 pattern_size_a=vec2(display_size_a.x*fromScale/tileZoomRatio,display_size_a.y);vec2 pattern_size_b=vec2(display_size_b.x*toScale/tileZoomRatio,display_size_b.y);float aspect_a=display_size_a.y/v_width;float aspect_b=display_size_b.y/v_width;float dist=length(v_normal)*v_width2.s;float blur2=(blur+1.0/u_device_pixel_ratio)*v_gamma_scale;float alpha=clamp(min(dist-(v_width2.t-blur2),v_width2.s-dist)/blur2,0.0,1.0);float x_a=mod(v_linesofar/pattern_size_a.x*aspect_a,1.0);float x_b=mod(v_linesofar/pattern_size_b.x*aspect_b,1.0);float y=0.5*v_normal.y+0.5;vec2 texel_size=1.0/u_texsize;vec2 pos_a=mix(pattern_tl_a*texel_size-texel_size,pattern_br_a*texel_size+texel_size,vec2(x_a,y));vec2 pos_b=mix(pattern_tl_b*texel_size-texel_size,pattern_br_b*texel_size+texel_size,vec2(x_b,y));vec4 color=mix(texture2D(u_image,pos_a),texture2D(u_image,pos_b),u_fade);
#ifdef FOG
color=fog_dither(fog_apply_premultiplied(color,v_fog_pos));
#endif
gl_FragColor=color*(alpha*opacity);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`
#define scale 0.015873016
attribute vec2 a_pos_normal;attribute vec4 a_data;attribute float a_linesofar;uniform mat4 u_matrix;uniform vec2 u_units_to_pixels;uniform mat2 u_pixels_to_tile_units;uniform lowp float u_device_pixel_ratio;varying vec2 v_normal;varying vec2 v_width2;varying float v_linesofar;varying float v_gamma_scale;varying float v_width;
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp float offset
#pragma mapbox: define mediump float gapwidth
#pragma mapbox: define mediump float width
#pragma mapbox: define lowp float floorwidth
#pragma mapbox: define lowp vec4 pattern_from
#pragma mapbox: define lowp vec4 pattern_to
#pragma mapbox: define lowp float pixel_ratio_from
#pragma mapbox: define lowp float pixel_ratio_to
void main() {
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize lowp float offset
#pragma mapbox: initialize mediump float gapwidth
#pragma mapbox: initialize mediump float width
#pragma mapbox: initialize lowp float floorwidth
#pragma mapbox: initialize mediump vec4 pattern_from
#pragma mapbox: initialize mediump vec4 pattern_to
#pragma mapbox: initialize lowp float pixel_ratio_from
#pragma mapbox: initialize lowp float pixel_ratio_to
float ANTIALIASING=1.0/u_device_pixel_ratio/2.0;vec2 a_extrude=a_data.xy-128.0;float a_direction=mod(a_data.z,4.0)-1.0;vec2 pos=floor(a_pos_normal*0.5);mediump vec2 normal=a_pos_normal-2.0*pos;normal.y=normal.y*2.0-1.0;v_normal=normal;gapwidth=gapwidth/2.0;float halfwidth=width/2.0;offset=-1.0*offset;float inset=gapwidth+(gapwidth > 0.0 ? ANTIALIASING : 0.0);float outset=gapwidth+halfwidth*(gapwidth > 0.0 ? 2.0 : 1.0)+(halfwidth==0.0 ? 0.0 : ANTIALIASING);mediump vec2 dist=outset*a_extrude*scale;mediump float u=0.5*a_direction;mediump float t=1.0-abs(u);mediump vec2 offset2=offset*a_extrude*scale*normal.y*mat2(t,-u,u,t);vec4 projected_extrude=u_matrix*vec4(dist*u_pixels_to_tile_units,0.0,0.0);gl_Position=u_matrix*vec4(pos+offset2*u_pixels_to_tile_units,0.0,1.0)+projected_extrude;
#ifndef RENDER_TO_TEXTURE
float extrude_length_without_perspective=length(dist);float extrude_length_with_perspective=length(projected_extrude.xy/gl_Position.w*u_units_to_pixels);v_gamma_scale=extrude_length_without_perspective/extrude_length_with_perspective;
#else
v_gamma_scale=1.0;
#endif
v_linesofar=a_linesofar;v_width2=vec2(outset,inset);v_width=floorwidth;
#ifdef FOG
v_fog_pos=fog_position(pos);
#endif
}`),raster:Ft(`uniform float u_fade_t;uniform float u_opacity;uniform sampler2D u_image0;uniform sampler2D u_image1;varying vec2 v_pos0;varying vec2 v_pos1;uniform float u_brightness_low;uniform float u_brightness_high;uniform float u_saturation_factor;uniform float u_contrast_factor;uniform vec3 u_spin_weights;void main() {vec4 color0=texture2D(u_image0,v_pos0);vec4 color1=texture2D(u_image1,v_pos1);if (color0.a > 0.0) {color0.rgb=color0.rgb/color0.a;}if (color1.a > 0.0) {color1.rgb=color1.rgb/color1.a;}vec4 color=mix(color0,color1,u_fade_t);color.a*=u_opacity;vec3 rgb=color.rgb;rgb=vec3(
dot(rgb,u_spin_weights.xyz),dot(rgb,u_spin_weights.zxy),dot(rgb,u_spin_weights.yzx));float average=(color.r+color.g+color.b)/3.0;rgb+=(average-rgb)*u_saturation_factor;rgb=(rgb-0.5)*u_contrast_factor+0.5;vec3 u_high_vec=vec3(u_brightness_low,u_brightness_low,u_brightness_low);vec3 u_low_vec=vec3(u_brightness_high,u_brightness_high,u_brightness_high);vec3 out_color=mix(u_high_vec,u_low_vec,rgb);
#ifdef FOG
out_color=fog_dither(fog_apply(out_color,v_fog_pos));
#endif
gl_FragColor=vec4(out_color*color.a,color.a);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`uniform mat4 u_matrix;uniform vec2 u_tl_parent;uniform float u_scale_parent;uniform vec2 u_perspective_transform;attribute vec2 a_pos;attribute vec2 a_texture_pos;varying vec2 v_pos0;varying vec2 v_pos1;void main() {float w=1.0+dot(a_texture_pos,u_perspective_transform);gl_Position=u_matrix*vec4(a_pos*w,0,w);v_pos0=a_texture_pos/8192.0;v_pos1=(v_pos0*u_scale_parent)+u_tl_parent;
#ifdef FOG
v_fog_pos=fog_position(a_pos);
#endif
}`),symbolIcon:Ft(`uniform sampler2D u_texture;varying vec2 v_tex;varying float v_fade_opacity;
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize lowp float opacity
lowp float alpha=opacity*v_fade_opacity;gl_FragColor=texture2D(u_texture,v_tex)*alpha;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`attribute vec4 a_pos_offset;attribute vec4 a_tex_size;attribute vec4 a_pixeloffset;attribute vec4 a_projected_pos;attribute float a_fade_opacity;
#ifdef PROJECTION_GLOBE_VIEW
attribute vec3 a_globe_anchor;attribute vec3 a_globe_normal;
#endif
uniform bool u_is_size_zoom_constant;uniform bool u_is_size_feature_constant;uniform highp float u_size_t;uniform highp float u_size;uniform highp float u_camera_to_center_distance;uniform bool u_rotate_symbol;uniform highp float u_aspect_ratio;uniform float u_fade_change;uniform mat4 u_matrix;uniform mat4 u_label_plane_matrix;uniform mat4 u_coord_matrix;uniform bool u_is_text;uniform bool u_pitch_with_map;uniform vec2 u_texsize;uniform vec3 u_up_vector;
#ifdef PROJECTION_GLOBE_VIEW
uniform vec3 u_tile_id;uniform mat4 u_inv_rot_matrix;uniform vec2 u_merc_center;uniform vec3 u_camera_forward;uniform float u_zoom_transition;uniform vec3 u_ecef_origin;uniform mat4 u_tile_matrix;
#endif
varying vec2 v_tex;varying float v_fade_opacity;
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize lowp float opacity
vec2 a_pos=a_pos_offset.xy;vec2 a_offset=a_pos_offset.zw;vec2 a_tex=a_tex_size.xy;vec2 a_size=a_tex_size.zw;float a_size_min=floor(a_size[0]*0.5);vec2 a_pxoffset=a_pixeloffset.xy;vec2 a_min_font_scale=a_pixeloffset.zw/256.0;highp float segment_angle=-a_projected_pos[3];float size;if (!u_is_size_zoom_constant && !u_is_size_feature_constant) {size=mix(a_size_min,a_size[1],u_size_t)/128.0;} else if (u_is_size_zoom_constant && !u_is_size_feature_constant) {size=a_size_min/128.0;} else {size=u_size;}vec2 tile_anchor=a_pos;vec3 h=elevationVector(tile_anchor)*elevation(tile_anchor);
#ifdef PROJECTION_GLOBE_VIEW
vec3 mercator_pos=mercator_tile_position(u_inv_rot_matrix,tile_anchor,u_tile_id,u_merc_center);vec3 world_pos=mix_globe_mercator(a_globe_anchor+h,mercator_pos,u_zoom_transition);vec4 ecef_point=u_tile_matrix*vec4(world_pos,1.0);vec3 origin_to_point=ecef_point.xyz-u_ecef_origin;float globe_occlusion_fade=dot(origin_to_point,u_camera_forward) >=0.0 ? 0.0 : 1.0;
#else
vec3 world_pos=vec3(tile_anchor,0)+h;float globe_occlusion_fade=1.0;
#endif
vec4 projected_point=u_matrix*vec4(world_pos,1);highp float camera_to_anchor_distance=projected_point.w;highp float distance_ratio=u_pitch_with_map ?
camera_to_anchor_distance/u_camera_to_center_distance :
u_camera_to_center_distance/camera_to_anchor_distance;highp float perspective_ratio=clamp(
0.5+0.5*distance_ratio,0.0,1.5);size*=perspective_ratio;float font_scale=u_is_text ? size/24.0 : size;highp float symbol_rotation=0.0;if (u_rotate_symbol) {
#ifdef PROJECTION_GLOBE_VIEW
vec3 displacement=vec3(a_globe_normal.z,0,-a_globe_normal.x);vec4 offsetProjected_point=u_matrix*vec4(a_globe_anchor+displacement,1);
#else
vec4 offsetProjected_point=u_matrix*vec4(tile_anchor+vec2(1,0),0,1);
#endif
vec2 a=projected_point.xy/projected_point.w;vec2 b=offsetProjected_point.xy/offsetProjected_point.w;symbol_rotation=atan((b.y-a.y)/u_aspect_ratio,b.x-a.x);}
#ifdef PROJECTION_GLOBE_VIEW
vec3 proj_pos=mix_globe_mercator(a_projected_pos.xyz+h,mercator_pos,u_zoom_transition);vec4 projected_pos=u_label_plane_matrix*vec4(proj_pos,1.0);
#else
vec4 projected_pos=u_label_plane_matrix*vec4(a_projected_pos.xy,h.z,1.0);
#endif
highp float angle_sin=sin(segment_angle+symbol_rotation);highp float angle_cos=cos(segment_angle+symbol_rotation);mat2 rotation_matrix=mat2(angle_cos,-1.0*angle_sin,angle_sin,angle_cos);float z=0.0;vec2 offset=rotation_matrix*(a_offset/32.0*max(a_min_font_scale,font_scale)+a_pxoffset/16.0);
#ifdef PITCH_WITH_MAP_TERRAIN
vec4 tile_pos=u_label_plane_matrix_inv*vec4(a_projected_pos.xy+offset,0.0,1.0);z=elevation(tile_pos.xy);
#endif
float occlusion_fade=occlusionFade(projected_point)*globe_occlusion_fade;
#ifdef PROJECTION_GLOBE_VIEW
vec3 xAxis=u_pitch_with_map ? normalize(cross(a_globe_normal,u_up_vector)) : vec3(1,0,0);vec3 yAxis=u_pitch_with_map ? normalize(cross(a_globe_normal,xAxis)) : vec3(0,1,0);gl_Position=mix(u_coord_matrix*vec4(projected_pos.xyz/projected_pos.w+xAxis*offset.x+yAxis*offset.y,1.0),AWAY,float(projected_point.w <=0.0 || occlusion_fade==0.0));
#else
gl_Position=mix(u_coord_matrix*vec4(projected_pos.xy/projected_pos.w+offset,z,1.0),AWAY,float(projected_point.w <=0.0 || occlusion_fade==0.0));
#endif
float projection_transition_fade=1.0;
#if defined(PROJECTED_POS_ON_VIEWPORT) && defined(PROJECTION_GLOBE_VIEW)
projection_transition_fade=1.0-step(EPSILON,u_zoom_transition);
#endif
v_tex=a_tex/u_texsize;vec2 fade_opacity=unpack_opacity(a_fade_opacity);float fade_change=fade_opacity[1] > 0.5 ? u_fade_change :-u_fade_change;v_fade_opacity=max(0.0,min(occlusion_fade,fade_opacity[0]+fade_change))*projection_transition_fade;}`),symbolSDF:Ft(`#define SDF_PX 8.0
uniform bool u_is_halo;uniform sampler2D u_texture;uniform highp float u_gamma_scale;uniform lowp float u_device_pixel_ratio;uniform bool u_is_text;varying vec2 v_data0;varying vec3 v_data1;
#pragma mapbox: define highp vec4 fill_color
#pragma mapbox: define highp vec4 halo_color
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp float halo_width
#pragma mapbox: define lowp float halo_blur
void main() {
#pragma mapbox: initialize highp vec4 fill_color
#pragma mapbox: initialize highp vec4 halo_color
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize lowp float halo_width
#pragma mapbox: initialize lowp float halo_blur
float EDGE_GAMMA=0.105/u_device_pixel_ratio;vec2 tex=v_data0.xy;float gamma_scale=v_data1.x;float size=v_data1.y;float fade_opacity=v_data1[2];float fontScale=u_is_text ? size/24.0 : size;lowp vec4 color=fill_color;highp float gamma=EDGE_GAMMA/(fontScale*u_gamma_scale);lowp float buff=(256.0-64.0)/256.0;if (u_is_halo) {color=halo_color;gamma=(halo_blur*1.19/SDF_PX+EDGE_GAMMA)/(fontScale*u_gamma_scale);buff=(6.0-halo_width/fontScale)/SDF_PX;}lowp float dist=texture2D(u_texture,tex).a;highp float gamma_scaled=gamma*gamma_scale;highp float alpha=smoothstep(buff-gamma_scaled,buff+gamma_scaled,dist);gl_FragColor=color*(alpha*opacity*fade_opacity);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`attribute vec4 a_pos_offset;attribute vec4 a_tex_size;attribute vec4 a_pixeloffset;attribute vec4 a_projected_pos;attribute float a_fade_opacity;
#ifdef PROJECTION_GLOBE_VIEW
attribute vec3 a_globe_anchor;attribute vec3 a_globe_normal;
#endif
uniform bool u_is_size_zoom_constant;uniform bool u_is_size_feature_constant;uniform highp float u_size_t;uniform highp float u_size;uniform mat4 u_matrix;uniform mat4 u_label_plane_matrix;uniform mat4 u_coord_matrix;uniform bool u_is_text;uniform bool u_pitch_with_map;uniform bool u_rotate_symbol;uniform highp float u_aspect_ratio;uniform highp float u_camera_to_center_distance;uniform float u_fade_change;uniform vec2 u_texsize;uniform vec3 u_up_vector;
#ifdef PROJECTION_GLOBE_VIEW
uniform vec3 u_tile_id;uniform mat4 u_inv_rot_matrix;uniform vec2 u_merc_center;uniform vec3 u_camera_forward;uniform float u_zoom_transition;uniform vec3 u_ecef_origin;uniform mat4 u_tile_matrix;
#endif
varying vec2 v_data0;varying vec3 v_data1;
#pragma mapbox: define highp vec4 fill_color
#pragma mapbox: define highp vec4 halo_color
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp float halo_width
#pragma mapbox: define lowp float halo_blur
void main() {
#pragma mapbox: initialize highp vec4 fill_color
#pragma mapbox: initialize highp vec4 halo_color
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize lowp float halo_width
#pragma mapbox: initialize lowp float halo_blur
vec2 a_pos=a_pos_offset.xy;vec2 a_offset=a_pos_offset.zw;vec2 a_tex=a_tex_size.xy;vec2 a_size=a_tex_size.zw;float a_size_min=floor(a_size[0]*0.5);vec2 a_pxoffset=a_pixeloffset.xy;highp float segment_angle=-a_projected_pos[3];float size;if (!u_is_size_zoom_constant && !u_is_size_feature_constant) {size=mix(a_size_min,a_size[1],u_size_t)/128.0;} else if (u_is_size_zoom_constant && !u_is_size_feature_constant) {size=a_size_min/128.0;} else {size=u_size;}vec2 tile_anchor=a_pos;vec3 h=elevationVector(tile_anchor)*elevation(tile_anchor);
#ifdef PROJECTION_GLOBE_VIEW
vec3 mercator_pos=mercator_tile_position(u_inv_rot_matrix,tile_anchor,u_tile_id,u_merc_center);vec3 world_pos=mix_globe_mercator(a_globe_anchor+h,mercator_pos,u_zoom_transition);vec4 ecef_point=u_tile_matrix*vec4(world_pos,1.0);vec3 origin_to_point=ecef_point.xyz-u_ecef_origin;float globe_occlusion_fade=dot(origin_to_point,u_camera_forward) >=0.0 ? 0.0 : 1.0;
#else
vec3 world_pos=vec3(tile_anchor,0)+h;float globe_occlusion_fade=1.0;
#endif
vec4 projected_point=u_matrix*vec4(world_pos,1);highp float camera_to_anchor_distance=projected_point.w;highp float distance_ratio=u_pitch_with_map ?
camera_to_anchor_distance/u_camera_to_center_distance :
u_camera_to_center_distance/camera_to_anchor_distance;highp float perspective_ratio=clamp(
0.5+0.5*distance_ratio,0.0,1.5);size*=perspective_ratio;float fontScale=u_is_text ? size/24.0 : size;highp float symbol_rotation=0.0;if (u_rotate_symbol) {
#ifdef PROJECTION_GLOBE_VIEW
vec3 displacement=vec3(a_globe_normal.z,0,-a_globe_normal.x);vec4 offsetprojected_point=u_matrix*vec4(a_globe_anchor+displacement,1);
#else
vec4 offsetprojected_point=u_matrix*vec4(tile_anchor+vec2(1,0),0,1);
#endif
vec2 a=projected_point.xy/projected_point.w;vec2 b=offsetprojected_point.xy/offsetprojected_point.w;symbol_rotation=atan((b.y-a.y)/u_aspect_ratio,b.x-a.x);}
#ifdef PROJECTION_GLOBE_VIEW
vec3 proj_pos=mix_globe_mercator(a_projected_pos.xyz+h,mercator_pos,u_zoom_transition);vec4 projected_pos=u_label_plane_matrix*vec4(proj_pos,1.0);
#else
vec4 projected_pos=u_label_plane_matrix*vec4(a_projected_pos.xy,h.z,1.0);
#endif
highp float angle_sin=sin(segment_angle+symbol_rotation);highp float angle_cos=cos(segment_angle+symbol_rotation);mat2 rotation_matrix=mat2(angle_cos,-1.0*angle_sin,angle_sin,angle_cos);float z=0.0;vec2 offset=rotation_matrix*(a_offset/32.0*fontScale+a_pxoffset);
#ifdef PITCH_WITH_MAP_TERRAIN
vec4 tile_pos=u_label_plane_matrix_inv*vec4(a_projected_pos.xy+offset,0.0,1.0);z=elevation(tile_pos.xy);
#endif
float occlusion_fade=occlusionFade(projected_point)*globe_occlusion_fade;
#ifdef PROJECTION_GLOBE_VIEW
vec3 xAxis=u_pitch_with_map ? normalize(cross(a_globe_normal,u_up_vector)) : vec3(1,0,0);vec3 yAxis=u_pitch_with_map ? normalize(cross(a_globe_normal,xAxis)) : vec3(0,1,0);gl_Position=mix(u_coord_matrix*vec4(projected_pos.xyz/projected_pos.w+xAxis*offset.x+yAxis*offset.y,1.0),AWAY,float(projected_point.w <=0.0 || occlusion_fade==0.0));
#else
gl_Position=mix(u_coord_matrix*vec4(projected_pos.xy/projected_pos.w+offset,z,1.0),AWAY,float(projected_point.w <=0.0 || occlusion_fade==0.0));
#endif
float gamma_scale=gl_Position.w;float projection_transition_fade=1.0;
#if defined(PROJECTED_POS_ON_VIEWPORT) && defined(PROJECTION_GLOBE_VIEW)
projection_transition_fade=1.0-step(EPSILON,u_zoom_transition);
#endif
vec2 fade_opacity=unpack_opacity(a_fade_opacity);float fade_change=fade_opacity[1] > 0.5 ? u_fade_change :-u_fade_change;float interpolated_fade_opacity=max(0.0,min(occlusion_fade,fade_opacity[0]+fade_change));v_data0=a_tex/u_texsize;v_data1=vec3(gamma_scale,size,interpolated_fade_opacity*projection_transition_fade);}`),symbolTextAndIcon:Ft(`#define SDF_PX 8.0
#define SDF 1.0
#define ICON 0.0
uniform bool u_is_halo;uniform sampler2D u_texture;uniform sampler2D u_texture_icon;uniform highp float u_gamma_scale;uniform lowp float u_device_pixel_ratio;varying vec4 v_data0;varying vec4 v_data1;
#pragma mapbox: define highp vec4 fill_color
#pragma mapbox: define highp vec4 halo_color
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp float halo_width
#pragma mapbox: define lowp float halo_blur
void main() {
#pragma mapbox: initialize highp vec4 fill_color
#pragma mapbox: initialize highp vec4 halo_color
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize lowp float halo_width
#pragma mapbox: initialize lowp float halo_blur
float fade_opacity=v_data1[2];if (v_data1.w==ICON) {vec2 tex_icon=v_data0.zw;lowp float alpha=opacity*fade_opacity;gl_FragColor=texture2D(u_texture_icon,tex_icon)*alpha;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
return;}vec2 tex=v_data0.xy;float EDGE_GAMMA=0.105/u_device_pixel_ratio;float gamma_scale=v_data1.x;float size=v_data1.y;float fontScale=size/24.0;lowp vec4 color=fill_color;highp float gamma=EDGE_GAMMA/(fontScale*u_gamma_scale);lowp float buff=(256.0-64.0)/256.0;if (u_is_halo) {color=halo_color;gamma=(halo_blur*1.19/SDF_PX+EDGE_GAMMA)/(fontScale*u_gamma_scale);buff=(6.0-halo_width/fontScale)/SDF_PX;}lowp float dist=texture2D(u_texture,tex).a;highp float gamma_scaled=gamma*gamma_scale;highp float alpha=smoothstep(buff-gamma_scaled,buff+gamma_scaled,dist);gl_FragColor=color*(alpha*opacity*fade_opacity);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`attribute vec4 a_pos_offset;attribute vec4 a_tex_size;attribute vec4 a_projected_pos;attribute float a_fade_opacity;
#ifdef PROJECTION_GLOBE_VIEW
attribute vec3 a_globe_anchor;attribute vec3 a_globe_normal;
#endif
uniform bool u_is_size_zoom_constant;uniform bool u_is_size_feature_constant;uniform highp float u_size_t;uniform highp float u_size;uniform mat4 u_matrix;uniform mat4 u_label_plane_matrix;uniform mat4 u_coord_matrix;uniform bool u_is_text;uniform bool u_pitch_with_map;uniform bool u_rotate_symbol;uniform highp float u_aspect_ratio;uniform highp float u_camera_to_center_distance;uniform float u_fade_change;uniform vec2 u_texsize;uniform vec3 u_up_vector;uniform vec2 u_texsize_icon;
#ifdef PROJECTION_GLOBE_VIEW
uniform vec3 u_tile_id;uniform mat4 u_inv_rot_matrix;uniform vec2 u_merc_center;uniform vec3 u_camera_forward;uniform float u_zoom_transition;uniform vec3 u_ecef_origin;uniform mat4 u_tile_matrix;
#endif
varying vec4 v_data0;varying vec4 v_data1;
#pragma mapbox: define highp vec4 fill_color
#pragma mapbox: define highp vec4 halo_color
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp float halo_width
#pragma mapbox: define lowp float halo_blur
void main() {
#pragma mapbox: initialize highp vec4 fill_color
#pragma mapbox: initialize highp vec4 halo_color
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize lowp float halo_width
#pragma mapbox: initialize lowp float halo_blur
vec2 a_pos=a_pos_offset.xy;vec2 a_offset=a_pos_offset.zw;vec2 a_tex=a_tex_size.xy;vec2 a_size=a_tex_size.zw;float a_size_min=floor(a_size[0]*0.5);float is_sdf=a_size[0]-2.0*a_size_min;highp float segment_angle=-a_projected_pos[3];float size;if (!u_is_size_zoom_constant && !u_is_size_feature_constant) {size=mix(a_size_min,a_size[1],u_size_t)/128.0;} else if (u_is_size_zoom_constant && !u_is_size_feature_constant) {size=a_size_min/128.0;} else {size=u_size;}vec2 tile_anchor=a_pos;vec3 h=elevationVector(tile_anchor)*elevation(tile_anchor);
#ifdef PROJECTION_GLOBE_VIEW
vec3 mercator_pos=mercator_tile_position(u_inv_rot_matrix,tile_anchor,u_tile_id,u_merc_center);vec3 world_pos=mix_globe_mercator(a_globe_anchor+h,mercator_pos,u_zoom_transition);vec4 ecef_point=u_tile_matrix*vec4(world_pos,1.0);vec3 origin_to_point=ecef_point.xyz-u_ecef_origin;float globe_occlusion_fade=dot(origin_to_point,u_camera_forward) >=0.0 ? 0.0 : 1.0;
#else
vec3 world_pos=vec3(tile_anchor,0)+h;float globe_occlusion_fade=1.0;
#endif
vec4 projected_point=u_matrix*vec4(world_pos,1);highp float camera_to_anchor_distance=projected_point.w;highp float distance_ratio=u_pitch_with_map ?
camera_to_anchor_distance/u_camera_to_center_distance :
u_camera_to_center_distance/camera_to_anchor_distance;highp float perspective_ratio=clamp(
0.5+0.5*distance_ratio,0.0,1.5);size*=perspective_ratio;float font_scale=size/24.0;highp float symbol_rotation=0.0;if (u_rotate_symbol) {vec4 offset_projected_point=u_matrix*vec4(a_pos+vec2(1,0),0,1);vec2 a=projected_point.xy/projected_point.w;vec2 b=offset_projected_point.xy/offset_projected_point.w;symbol_rotation=atan((b.y-a.y)/u_aspect_ratio,b.x-a.x);}
#ifdef PROJECTION_GLOBE_VIEW
vec3 proj_pos=mix_globe_mercator(a_projected_pos.xyz+h,mercator_pos,u_zoom_transition);vec4 projected_pos=u_label_plane_matrix*vec4(proj_pos,1.0);
#else
vec4 projected_pos=u_label_plane_matrix*vec4(a_projected_pos.xy,h.z,1.0);
#endif
highp float angle_sin=sin(segment_angle+symbol_rotation);highp float angle_cos=cos(segment_angle+symbol_rotation);mat2 rotation_matrix=mat2(angle_cos,-1.0*angle_sin,angle_sin,angle_cos);float z=0.0;vec2 offset=rotation_matrix*(a_offset/32.0*font_scale);
#ifdef PITCH_WITH_MAP_TERRAIN
vec4 tile_pos=u_label_plane_matrix_inv*vec4(a_projected_pos.xy+offset,0.0,1.0);z=elevation(tile_pos.xy);
#endif
float occlusion_fade=occlusionFade(projected_point)*globe_occlusion_fade;
#ifdef PROJECTION_GLOBE_VIEW
vec3 xAxis=u_pitch_with_map ? normalize(cross(a_globe_normal,u_up_vector)) : vec3(1,0,0);vec3 yAxis=u_pitch_with_map ? normalize(cross(a_globe_normal,xAxis)) : vec3(0,1,0);gl_Position=mix(u_coord_matrix*vec4(projected_pos.xyz/projected_pos.w+xAxis*offset.x+yAxis*offset.y,1.0),AWAY,float(projected_point.w <=0.0 || occlusion_fade==0.0));
#else
gl_Position=mix(u_coord_matrix*vec4(projected_pos.xy/projected_pos.w+offset,z,1.0),AWAY,float(projected_point.w <=0.0 || occlusion_fade==0.0));
#endif
float gamma_scale=gl_Position.w;vec2 fade_opacity=unpack_opacity(a_fade_opacity);float fade_change=fade_opacity[1] > 0.5 ? u_fade_change :-u_fade_change;float interpolated_fade_opacity=max(0.0,min(occlusion_fade,fade_opacity[0]+fade_change));float projection_transition_fade=1.0;
#if defined(PROJECTED_POS_ON_VIEWPORT) && defined(PROJECTION_GLOBE_VIEW)
projection_transition_fade=1.0-step(EPSILON,u_zoom_transition);
#endif
v_data0.xy=a_tex/u_texsize;v_data0.zw=a_tex/u_texsize_icon;v_data1=vec4(gamma_scale,size,interpolated_fade_opacity*projection_transition_fade,is_sdf);}`),terrainRaster:Ft(`uniform sampler2D u_image0;varying vec2 v_pos0;
#ifdef FOG
varying float v_fog_opacity;
#endif
void main() {vec4 color=texture2D(u_image0,v_pos0);
#ifdef FOG
color=fog_dither(fog_apply_from_vert(color,v_fog_opacity));
#endif
gl_FragColor=color;
#ifdef TERRAIN_WIREFRAME
gl_FragColor=vec4(1.0,0.0,0.0,0.8);
#endif
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`uniform mat4 u_matrix;uniform float u_skirt_height;attribute vec2 a_pos;attribute vec2 a_texture_pos;varying vec2 v_pos0;
#ifdef FOG
varying float v_fog_opacity;
#endif
const float skirtOffset=24575.0;const float wireframeOffset=0.00015;void main() {v_pos0=a_texture_pos/8192.0;float skirt=float(a_pos.x >=skirtOffset);float elevation=elevation(a_texture_pos)-skirt*u_skirt_height;
#ifdef TERRAIN_WIREFRAME
elevation+=u_skirt_height*u_skirt_height*wireframeOffset;
#endif
vec2 decodedPos=a_pos-vec2(skirt*skirtOffset,0.0);gl_Position=u_matrix*vec4(decodedPos,elevation,1.0);
#ifdef FOG
v_fog_opacity=fog(fog_position(vec3(decodedPos,elevation)));
#endif
}`),terrainDepth:Ft(`#ifdef GL_ES
precision highp float;
#endif
varying float v_depth;void main() {gl_FragColor=pack_depth(v_depth);}`,"uniform mat4 u_matrix;attribute vec2 a_pos;attribute vec2 a_texture_pos;varying float v_depth;void main() {float elevation=elevation(a_texture_pos);gl_Position=u_matrix*vec4(a_pos,elevation,1.0);v_depth=gl_Position.z/gl_Position.w;}"),skybox:Ft(`
varying lowp vec3 v_uv;uniform lowp samplerCube u_cubemap;uniform lowp float u_opacity;uniform highp float u_temporal_offset;uniform highp vec3 u_sun_direction;float sun_disk(highp vec3 ray_direction,highp vec3 sun_direction) {highp float cos_angle=dot(normalize(ray_direction),sun_direction);const highp float cos_sun_angular_diameter=0.99996192306;const highp float smoothstep_delta=1e-5;return smoothstep(
cos_sun_angular_diameter-smoothstep_delta,cos_sun_angular_diameter+smoothstep_delta,cos_angle);}float map(float value,float start,float end,float new_start,float new_end) {return ((value-start)*(new_end-new_start))/(end-start)+new_start;}void main() {vec3 uv=v_uv;const float y_bias=0.015;uv.y+=y_bias;uv.y=pow(abs(uv.y),1.0/5.0);uv.y=map(uv.y,0.0,1.0,-1.0,1.0);vec3 sky_color=textureCube(u_cubemap,uv).rgb;
#ifdef FOG
sky_color=fog_apply_sky_gradient(v_uv.xzy,sky_color);
#endif
sky_color.rgb=dither(sky_color.rgb,gl_FragCoord.xy+u_temporal_offset);sky_color+=0.1*sun_disk(v_uv,u_sun_direction);gl_FragColor=vec4(sky_color*u_opacity,u_opacity);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,gl),skyboxGradient:Ft(`varying highp vec3 v_uv;uniform lowp sampler2D u_color_ramp;uniform highp vec3 u_center_direction;uniform lowp float u_radius;uniform lowp float u_opacity;uniform highp float u_temporal_offset;void main() {float progress=acos(dot(normalize(v_uv),u_center_direction))/u_radius;vec4 color=texture2D(u_color_ramp,vec2(progress,0.5));
#ifdef FOG
color.rgb=fog_apply_sky_gradient(v_uv.xzy,color.rgb/color.a)*color.a;
#endif
color*=u_opacity;color.rgb=dither(color.rgb,gl_FragCoord.xy+u_temporal_offset);gl_FragColor=color;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,gl),skyboxCapture:Ft(`
varying highp vec3 v_position;uniform highp float u_sun_intensity;uniform highp float u_luminance;uniform lowp vec3 u_sun_direction;uniform highp vec4 u_color_tint_r;uniform highp vec4 u_color_tint_m;
#ifdef GL_ES
precision highp float;
#endif
#define BETA_R                  vec3(5.5e-6,13.0e-6,22.4e-6)
#define BETA_M                  vec3(21e-6,21e-6,21e-6)
#define MIE_G                   0.76
#define DENSITY_HEIGHT_SCALE_R  8000.0
#define DENSITY_HEIGHT_SCALE_M  1200.0
#define PLANET_RADIUS           6360e3
#define ATMOSPHERE_RADIUS       6420e3
#define SAMPLE_STEPS            10
#define DENSITY_STEPS           4
float ray_sphere_exit(vec3 orig,vec3 dir,float radius) {float a=dot(dir,dir);float b=2.0*dot(dir,orig);float c=dot(orig,orig)-radius*radius;float d=sqrt(b*b-4.0*a*c);return (-b+d)/(2.0*a);}vec3 extinction(vec2 density) {return exp(-vec3(BETA_R*u_color_tint_r.a*density.x+BETA_M*u_color_tint_m.a*density.y));}vec2 local_density(vec3 point) {float height=max(length(point)-PLANET_RADIUS,0.0);float exp_r=exp(-height/DENSITY_HEIGHT_SCALE_R);float exp_m=exp(-height/DENSITY_HEIGHT_SCALE_M);return vec2(exp_r,exp_m);}float phase_ray(float cos_angle) {return (3.0/(16.0*PI))*(1.0+cos_angle*cos_angle);}float phase_mie(float cos_angle) {return (3.0/(8.0*PI))*((1.0-MIE_G*MIE_G)*(1.0+cos_angle*cos_angle))/((2.0+MIE_G*MIE_G)*pow(1.0+MIE_G*MIE_G-2.0*MIE_G*cos_angle,1.5));}vec2 density_to_atmosphere(vec3 point,vec3 light_dir) {float ray_len=ray_sphere_exit(point,light_dir,ATMOSPHERE_RADIUS);float step_len=ray_len/float(DENSITY_STEPS);vec2 density_point_to_atmosphere=vec2(0.0);for (int i=0; i < DENSITY_STEPS;++i) {vec3 point_on_ray=point+light_dir*((float(i)+0.5)*step_len);density_point_to_atmosphere+=local_density(point_on_ray)*step_len;;}return density_point_to_atmosphere;}vec3 atmosphere(vec3 ray_dir,vec3 sun_direction,float sun_intensity) {vec2 density_orig_to_point=vec2(0.0);vec3 scatter_r=vec3(0.0);vec3 scatter_m=vec3(0.0);vec3 origin=vec3(0.0,PLANET_RADIUS,0.0);float ray_len=ray_sphere_exit(origin,ray_dir,ATMOSPHERE_RADIUS);float step_len=ray_len/float(SAMPLE_STEPS);for (int i=0; i < SAMPLE_STEPS;++i) {vec3 point_on_ray=origin+ray_dir*((float(i)+0.5)*step_len);vec2 density=local_density(point_on_ray)*step_len;density_orig_to_point+=density;vec2 density_point_to_atmosphere=density_to_atmosphere(point_on_ray,sun_direction);vec2 density_orig_to_atmosphere=density_orig_to_point+density_point_to_atmosphere;vec3 extinction=extinction(density_orig_to_atmosphere);scatter_r+=density.x*extinction;scatter_m+=density.y*extinction;}float cos_angle=dot(ray_dir,sun_direction);float phase_r=phase_ray(cos_angle);float phase_m=phase_mie(cos_angle);vec3 beta_r=BETA_R*u_color_tint_r.rgb*u_color_tint_r.a;vec3 beta_m=BETA_M*u_color_tint_m.rgb*u_color_tint_m.a;return (scatter_r*phase_r*beta_r+scatter_m*phase_m*beta_m)*sun_intensity;}const float A=0.15;const float B=0.50;const float C=0.10;const float D=0.20;const float E=0.02;const float F=0.30;vec3 uncharted2_tonemap(vec3 x) {return ((x*(A*x+C*B)+D*E)/(x*(A*x+B)+D*F))-E/F;}void main() {vec3 ray_direction=v_position;ray_direction.y=pow(ray_direction.y,5.0);const float y_bias=0.015;ray_direction.y+=y_bias;vec3 color=atmosphere(normalize(ray_direction),u_sun_direction,u_sun_intensity);float white_scale=1.0748724675633854;color=uncharted2_tonemap((log2(2.0/pow(u_luminance,4.0)))*color)*white_scale;gl_FragColor=vec4(color,1.0);}`,"attribute highp vec3 a_pos_3f;uniform mat3 u_matrix_3f;varying highp vec3 v_position;float map(float value,float start,float end,float new_start,float new_end) {return ((value-start)*(new_end-new_start))/(end-start)+new_start;}void main() {vec4 pos=vec4(u_matrix_3f*a_pos_3f,1.0);v_position=pos.xyz;v_position.y*=-1.0;v_position.y=map(v_position.y,-1.0,1.0,0.0,1.0);gl_Position=vec4(a_pos_3f.xy,0.0,1.0);}"),globeRaster:Ft(`uniform sampler2D u_image0;varying vec2 v_pos0;
#ifndef FOG
uniform highp vec3 u_frustum_tl;uniform highp vec3 u_frustum_tr;uniform highp vec3 u_frustum_br;uniform highp vec3 u_frustum_bl;uniform highp vec3 u_globe_pos;uniform highp float u_globe_radius;uniform vec2 u_viewport;
#endif
void main() {
#ifdef CUSTOM_ANTIALIASING
vec2 uv=gl_FragCoord.xy/u_viewport;highp vec3 ray_dir=mix(
mix(u_frustum_tl,u_frustum_tr,uv.x),mix(u_frustum_bl,u_frustum_br,uv.x),1.0-uv.y);vec3 dir=normalize(ray_dir);vec3 closest_point=dot(u_globe_pos,dir)*dir;float norm_dist_from_center=1.0-length(closest_point-u_globe_pos)/u_globe_radius;const float antialias_pixel=2.0;float antialias_factor=antialias_pixel*fwidth(norm_dist_from_center);float antialias=smoothstep(0.0,antialias_factor,norm_dist_from_center);vec4 raster=texture2D(u_image0,v_pos0);vec4 color=vec4(raster.rgb*antialias,raster.a*antialias);
#else
vec4 color=texture2D(u_image0,v_pos0);
#endif
#ifdef FOG
color=fog_dither(fog_apply_premultiplied(color,v_fog_pos));
#endif
gl_FragColor=color;
#ifdef TERRAIN_WIREFRAME
gl_FragColor=vec4(1.0,0.0,0.0,0.8);
#endif
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`uniform mat4 u_proj_matrix;uniform mat4 u_normalize_matrix;uniform mat4 u_globe_matrix;uniform mat4 u_merc_matrix;uniform float u_zoom_transition;uniform vec2 u_merc_center;uniform mat3 u_grid_matrix;
#ifdef GLOBE_POLES
attribute vec3 a_globe_pos;attribute vec2 a_merc_pos;attribute vec2 a_uv;
#else
attribute vec2 a_pos;
#endif
varying vec2 v_pos0;const float wireframeOffset=1e3;float mercatorXfromLng(float lng) {return (180.0+lng)/360.0;}float mercatorYfromLat(float lat) {return (180.0-(RAD_TO_DEG*log(tan(QUARTER_PI+lat/2.0*DEG_TO_RAD))))/360.0;}vec3 latLngToECEF(vec2 latLng) {latLng=DEG_TO_RAD*latLng;float cosLat=cos(latLng[0]);float sinLat=sin(latLng[0]);float cosLng=cos(latLng[1]);float sinLng=sin(latLng[1]);float sx=cosLat*sinLng*GLOBE_RADIUS;float sy=-sinLat*GLOBE_RADIUS;float sz=cosLat*cosLng*GLOBE_RADIUS;return vec3(sx,sy,sz);}void main() {
#ifdef GLOBE_POLES
vec3 globe_pos=a_globe_pos;vec2 merc_pos=a_merc_pos;vec2 uv=a_uv;
#else
float tiles=u_grid_matrix[0][2];float idy=u_grid_matrix[1][2];float S=u_grid_matrix[2][2];vec3 latLng=u_grid_matrix*vec3(a_pos,1.0);float mercatorY=mercatorYfromLat(latLng[0]);float uvY=mercatorY*tiles-idy;float mercatorX=mercatorXfromLng(latLng[1]);float uvX=a_pos[0]*S;vec3 globe_pos=latLngToECEF(latLng.xy);vec2 merc_pos=vec2(mercatorX,mercatorY);vec2 uv=vec2(uvX,uvY);
#endif
v_pos0=uv;uv=uv*EXTENT;vec4 up_vector=vec4(elevationVector(uv),1.0);float height=elevation(uv);
#ifdef TERRAIN_WIREFRAME
height+=wireframeOffset;
#endif
globe_pos+=up_vector.xyz*height;vec4 globe=u_globe_matrix*vec4(globe_pos,1.0);vec4 mercator=vec4(0.0);if (u_zoom_transition > 0.0) {mercator=vec4(merc_pos,height,1.0);mercator.xy-=u_merc_center;mercator.x=wrap(mercator.x,-0.5,0.5);mercator=u_merc_matrix*mercator;}vec3 position=mix(globe.xyz,mercator.xyz,u_zoom_transition);gl_Position=u_proj_matrix*vec4(position,1.0);
#ifdef FOG
v_fog_pos=fog_position((u_normalize_matrix*vec4(globe_pos,1.0)).xyz);
#endif
}`),globeAtmosphere:Ft(`uniform float u_transition;uniform highp float u_fadeout_range;uniform highp float u_temporal_offset;uniform vec3 u_start_color;uniform vec4 u_color;uniform vec4 u_space_color;uniform vec4 u_high_color;uniform float u_star_intensity;uniform float u_star_size;uniform float u_star_density;uniform float u_horizon_angle;uniform mat4 u_rotation_matrix;varying highp vec3 v_ray_dir;varying highp vec3 v_horizon_dir;highp float random(highp vec3 p) {p=fract(p*vec3(23.2342,97.1231,91.2342));p+=dot(p.zxy,p.yxz+123.1234);return fract(p.x*p.y);}float stars(vec3 p,float scale,vec2 offset) {vec2 uv_scale=(u_viewport/u_star_size)*scale;vec3 position=vec3(p.xy*uv_scale+offset*u_viewport,p.z);vec3 q=fract(position)-0.5;vec3 id=floor(position);float random_visibility=step(random(id),u_star_density);float circle=smoothstep(0.5+u_star_intensity,0.5,length(q));return circle*random_visibility;}void main() {highp vec3 dir=normalize(v_ray_dir);
#ifdef PROJECTION_GLOBE_VIEW
float globe_pos_dot_dir=dot(u_globe_pos,dir);highp vec3 closest_point_forward=abs(globe_pos_dot_dir)*dir;float norm_dist_from_center=length(closest_point_forward-u_globe_pos)/u_globe_radius;if (norm_dist_from_center < 0.98) {discard;return;}
#endif
highp vec3 horizon_dir=normalize(v_horizon_dir);float horizon_angle_mercator=dir.y < horizon_dir.y ?
0.0 : max(acos(dot(dir,horizon_dir)),0.0);
#ifdef PROJECTION_GLOBE_VIEW
highp vec3 closest_point=globe_pos_dot_dir*dir;float closest_point_to_center=length(closest_point-u_globe_pos);float theta=asin(clamp(closest_point_to_center/length(u_globe_pos),-1.0,1.0));float horizon_angle=globe_pos_dot_dir < 0.0 ?
PI-theta-u_horizon_angle : theta-u_horizon_angle;float angle_t=pow(u_transition,10.0);horizon_angle=mix(horizon_angle,horizon_angle_mercator,angle_t);
#else
float horizon_angle=horizon_angle_mercator;
#endif
horizon_angle/=PI;float t=exp(-horizon_angle/u_fadeout_range);float alpha_0=u_color.a;float alpha_1=u_high_color.a;float alpha_2=u_space_color.a;vec3 color_stop_0=u_color.rgb;vec3 color_stop_1=u_high_color.rgb;vec3 color_stop_2=u_space_color.rgb;vec3 c0=mix(color_stop_2,color_stop_1,alpha_1);vec3 c1=mix(c0,color_stop_0,alpha_0);vec3 c2=mix(c0,c1,t);vec3 c =mix(color_stop_2,c2,t);float a0=mix(alpha_2,1.0,alpha_1);float a1=mix(a0,1.0,alpha_0);float a2=mix(a0,a1,t);float a =mix(alpha_2,a2,t);vec2 uv=gl_FragCoord.xy/u_viewport-0.5;float aspect_ratio=u_viewport.x/u_viewport.y;vec4 uv_dir=vec4(normalize(vec3(uv.x*aspect_ratio,uv.y,1.0)),1.0);uv_dir=u_rotation_matrix*uv_dir;vec3 n=abs(uv_dir.xyz);vec2 uv_remap=(n.x > n.y && n.x > n.z) ? uv_dir.yz/uv_dir.x:
(n.y > n.x && n.y > n.z) ? uv_dir.zx/uv_dir.y:
uv_dir.xy/uv_dir.z;uv_remap.x/=aspect_ratio;vec3 D=vec3(uv_remap,1.0);highp float star_field=0.0;if (u_star_intensity > 0.0) {star_field+=stars(D,1.2,vec2(0.0,0.0));star_field+=stars(D,1.0,vec2(1.0,0.0));star_field+=stars(D,0.8,vec2(0.0,1.0));star_field+=stars(D,0.6,vec2(1.0,1.0));star_field*=(1.0-pow(t,0.25+(1.0-u_high_color.a)*0.75));c+=star_field*alpha_2;}c=dither(c,gl_FragCoord.xy+u_temporal_offset);gl_FragColor=vec4(c,a);}`,`attribute vec3 a_pos;attribute vec2 a_uv;uniform vec3 u_frustum_tl;uniform vec3 u_frustum_tr;uniform vec3 u_frustum_br;uniform vec3 u_frustum_bl;uniform float u_horizon;varying highp vec3 v_ray_dir;varying highp vec3 v_horizon_dir;void main() {v_ray_dir=mix(
mix(u_frustum_tl,u_frustum_tr,a_uv.x),mix(u_frustum_bl,u_frustum_br,a_uv.x),a_uv.y);v_horizon_dir=mix(
mix(u_frustum_tl,u_frustum_bl,u_horizon),mix(u_frustum_tr,u_frustum_br,u_horizon),a_uv.x);gl_Position=vec4(a_pos,1.0);}`)};function Ft(l,t,s){let p=/#pragma mapbox: ([\w]+) ([\w]+) ([\w]+) ([\w]+)/g,f=/uniform (highp |mediump |lowp )?([\w]+) ([\w]+)([\s]*)([\w]*)/g,_=t.match(/attribute (highp |mediump |lowp )?([\w]+) ([\w]+)/g),b=l.match(f),w=t.match(f),T=ml.match(f),A=w?w.concat(b):b;s||(ns.staticUniforms&&(A=ns.staticUniforms.concat(A)),sn.staticUniforms&&(A=sn.staticUniforms.concat(A))),A&&(A=A.concat(T));let I={};return{fragmentSource:l=l.replace(p,(L,O,V,N,j)=>(I[j]=!0,O==="define"?`
#ifndef HAS_UNIFORM_u_${j}
varying ${V} ${N} ${j};
#else
uniform ${V} ${N} u_${j};
#endif
`:`
#ifdef HAS_UNIFORM_u_${j}
    ${V} ${N} ${j} = u_${j};
#endif
`)),vertexSource:t=t.replace(p,(L,O,V,N,j)=>{let J=N==="float"?"vec2":"vec4",U=j.match(/color/)?"color":J;return I[j]?O==="define"?`
#ifndef HAS_UNIFORM_u_${j}
uniform lowp float u_${j}_t;
attribute ${V} ${J} a_${j};
varying ${V} ${N} ${j};
#else
uniform ${V} ${N} u_${j};
#endif
`:U==="vec4"?`
#ifndef HAS_UNIFORM_u_${j}
    ${j} = a_${j};
#else
    ${V} ${N} ${j} = u_${j};
#endif
`:`
#ifndef HAS_UNIFORM_u_${j}
    ${j} = unpack_mix_${U}(a_${j}, u_${j}_t);
#else
    ${V} ${N} ${j} = u_${j};
#endif
`:O==="define"?`
#ifndef HAS_UNIFORM_u_${j}
uniform lowp float u_${j}_t;
attribute ${V} ${J} a_${j};
#else
uniform ${V} ${N} u_${j};
#endif
`:U==="vec4"?`
#ifndef HAS_UNIFORM_u_${j}
    ${V} ${N} ${j} = a_${j};
#else
    ${V} ${N} ${j} = u_${j};
#endif
`:`
#ifndef HAS_UNIFORM_u_${j}
    ${V} ${N} ${j} = unpack_mix_${U}(a_${j}, u_${j}_t);
#else
    ${V} ${N} ${j} = u_${j};
#endif
`}),staticAttributes:_,staticUniforms:A}}class Xc{constructor(){this.boundProgram=null,this.boundLayoutVertexBuffer=null,this.boundPaintVertexBuffers=[],this.boundIndexBuffer=null,this.boundVertexOffset=null,this.boundDynamicVertexBuffer=null,this.vao=null}bind(t,s,p,f,_,b,w,T,A){this.context=t;let I=this.boundPaintVertexBuffers.length!==f.length;for(let L=0;!I&&L<f.length;L++)this.boundPaintVertexBuffers[L]!==f[L]&&(I=!0);t.extVertexArrayObject&&this.vao&&this.boundProgram===s&&this.boundLayoutVertexBuffer===p&&!I&&this.boundIndexBuffer===_&&this.boundVertexOffset===b&&this.boundDynamicVertexBuffer===w&&this.boundDynamicVertexBuffer2===T&&this.boundDynamicVertexBuffer3===A?(t.bindVertexArrayOES.set(this.vao),w&&w.bind(),_&&_.dynamicDraw&&_.bind(),T&&T.bind(),A&&A.bind()):this.freshBind(s,p,f,_,b,w,T,A)}freshBind(t,s,p,f,_,b,w,T){let A,I=t.numAttributes,L=this.context,O=L.gl;if(L.extVertexArrayObject)this.vao&&this.destroy(),this.vao=L.extVertexArrayObject.createVertexArrayOES(),L.bindVertexArrayOES.set(this.vao),A=0,this.boundProgram=t,this.boundLayoutVertexBuffer=s,this.boundPaintVertexBuffers=p,this.boundIndexBuffer=f,this.boundVertexOffset=_,this.boundDynamicVertexBuffer=b,this.boundDynamicVertexBuffer2=w,this.boundDynamicVertexBuffer3=T;else{A=L.currentNumAttributes||0;for(let V=I;V<A;V++)O.disableVertexAttribArray(V)}s.enableAttributes(O,t);for(let V of p)V.enableAttributes(O,t);b&&b.enableAttributes(O,t),w&&w.enableAttributes(O,t),T&&T.enableAttributes(O,t),s.bind(),s.setVertexAttribPointers(O,t,_);for(let V of p)V.bind(),V.setVertexAttribPointers(O,t,_);b&&(b.bind(),b.setVertexAttribPointers(O,t,_)),f&&f.bind(),w&&(w.bind(),w.setVertexAttribPointers(O,t,_)),T&&(T.bind(),T.setVertexAttribPointers(O,t,_)),L.currentNumAttributes=I}destroy(){this.vao&&(this.context.extVertexArrayObject.deleteVertexArrayOES(this.vao),this.vao=null)}}function _l(l,t){let s=Math.pow(2,t.canonical.z),p=t.canonical.y;return[new o.MercatorCoordinate(0,p/s).toLngLat().lat,new o.MercatorCoordinate(0,(p+1)/s).toLngLat().lat]}function Kc(l,t,s,p,f,_,b){let w=l.context,T=w.gl,A=s.fbo;if(!A)return;l.prepareDrawTile();let I=l.useProgram("hillshade");w.activeTexture.set(T.TEXTURE0),T.bindTexture(T.TEXTURE_2D,A.colorAttachment.get());let L=((j,J,U,$)=>{let q=U.paint.get("hillshade-shadow-color"),ie=U.paint.get("hillshade-highlight-color"),K=U.paint.get("hillshade-accent-color"),Q=U.paint.get("hillshade-illumination-direction")*(Math.PI/180);U.paint.get("hillshade-illumination-anchor")==="viewport"&&(Q-=j.transform.angle);let ae=!j.options.moving;return{u_matrix:$||j.transform.calculateProjMatrix(J.tileID.toUnwrapped(),ae),u_image:0,u_latrange:_l(0,J.tileID),u_light:[U.paint.get("hillshade-exaggeration"),Q],u_shadow:q,u_highlight:ie,u_accent:K}})(l,s,p,l.terrain?t.projMatrix:null);l.prepareDrawProgram(w,I,t.toUnwrapped());let{tileBoundsBuffer:O,tileBoundsIndexBuffer:V,tileBoundsSegments:N}=l.getTileBoundsBuffers(s);I.draw(w,T.TRIANGLES,f,_,b,o.CullFaceMode.disabled,L,p.id,O,V,N)}function la(l,t,s){if(!t.needsDEMTextureUpload)return;let p=l.context,f=p.gl;p.pixelStoreUnpackPremultiplyAlpha.set(!1),t.demTexture=t.demTexture||l.getTileTexture(s.stride);let _=s.getPixels();t.demTexture?t.demTexture.update(_,{premultiply:!1}):t.demTexture=new o.Texture(p,_,f.RGBA,{premultiply:!1}),t.needsDEMTextureUpload=!1}function ca(l,t,s,p,f,_){let b=l.context,w=b.gl;if(!t.dem)return;let T=t.dem;if(b.activeTexture.set(w.TEXTURE1),la(l,t,T),!t.demTexture)return;t.demTexture.bind(w.NEAREST,w.CLAMP_TO_EDGE);let A=T.dim;b.activeTexture.set(w.TEXTURE0);let I=t.fbo;if(!I){let N=new o.Texture(b,{width:A,height:A,data:null},w.RGBA);N.bind(w.LINEAR,w.CLAMP_TO_EDGE),I=t.fbo=b.createFramebuffer(A,A,!0),I.colorAttachment.set(N.texture)}b.bindFramebuffer.set(I.framebuffer),b.viewport.set([0,0,A,A]);let{tileBoundsBuffer:L,tileBoundsIndexBuffer:O,tileBoundsSegments:V}=l.getMercatorTileBoundsBuffers();l.useProgram("hillshadePrepare").draw(b,w.TRIANGLES,p,f,_,o.CullFaceMode.disabled,((N,j)=>{let J=j.stride,U=o.create();return o.ortho(U,0,o.EXTENT,-o.EXTENT,0,0,1),o.translate(U,U,[0,-o.EXTENT,0]),{u_matrix:U,u_image:1,u_dimension:[J,J],u_zoom:N.overscaledZ,u_unpack:j.unpackVector}})(t.tileID,T),s.id,L,O,V),t.needsHillshadePrepare=!1}let ha=(l,t)=>({u_matrix:new o.UniformMatrix4f(l,t.u_matrix),u_image0:new o.Uniform1i(l,t.u_image0),u_skirt_height:new o.Uniform1f(l,t.u_skirt_height)}),ua=(l,t)=>({u_matrix:l,u_image0:0,u_skirt_height:t}),Pt=(l,t,s,p,f,_,b,w,T,A,I,L,O,V)=>({u_proj_matrix:Float32Array.from(l),u_globe_matrix:t,u_normalize_matrix:Float32Array.from(p),u_merc_matrix:s,u_zoom_transition:f,u_merc_center:_,u_image0:0,u_frustum_tl:b,u_frustum_tr:w,u_frustum_br:T,u_frustum_bl:A,u_globe_pos:I,u_globe_radius:L,u_viewport:O,u_grid_matrix:V?Float32Array.from(V):new Float32Array(9)});function os(l,t){return l!=null&&t!=null&&!(!l.hasData()||!t.hasData())&&l.demTexture!=null&&t.demTexture!=null&&l.tileID.key!==t.tileID.key}let Rn=new class{constructor(){this.operations={}}newMorphing(l,t,s,p,f){if(l in this.operations){let _=this.operations[l];_.to.tileID.key!==s.tileID.key&&(_.queued=s)}else this.operations[l]={startTime:p,phase:0,duration:f,from:t,to:s,queued:null}}getMorphValuesForProxy(l){if(!(l in this.operations))return null;let t=this.operations[l];return{from:t.from,to:t.to,phase:t.phase}}update(l){for(let t in this.operations){let s=this.operations[t];for(s.phase=(l-s.startTime)/s.duration;s.phase>=1||!this._validOp(s);)if(!this._nextOp(s,l)){delete this.operations[t];break}}}_nextOp(l,t){return!!l.queued&&(l.from=l.to,l.to=l.queued,l.queued=null,l.phase=0,l.startTime=t,!0)}_validOp(l){return l.from.hasData()&&l.to.hasData()}},ss={0:null,1:"TERRAIN_VERTEX_MORPHING",2:"TERRAIN_WIREFRAME"};function Yc(l,t){let s=1<<l.z;return!t&&(l.x===0||l.x===s-1)||l.y===0||l.y===s-1}let as=l=>({u_matrix:l});function yl(l,t,s,p,f){if(f>0){let _=o.exported.now(),b=(_-l.timeAdded)/f,w=t?(_-t.timeAdded)/f:-1,T=s.getSource(),A=p.coveringZoomLevel({tileSize:T.tileSize,roundZoom:T.roundZoom}),I=!t||Math.abs(t.tileID.overscaledZ-A)>Math.abs(l.tileID.overscaledZ-A),L=I&&l.refreshedUponExpiration?1:o.clamp(I?b:1-w,0,1);return l.refreshedUponExpiration&&b>=1&&(l.refreshedUponExpiration=!1),t?{opacity:1,mix:1-L}:{opacity:L,mix:0}}return{opacity:1,mix:0}}class cp extends o.SourceCache{constructor(t){let s={type:"raster-dem",maxzoom:t.transform.maxZoom},p=new Fi(Rt(),null),f=me("mock-dem",s,p,t.style);super("mock-dem",f,!1),f.setEventedParent(this),this._sourceLoaded=!0}_loadTile(t,s){t.state="loaded",s(null)}}class hp extends o.SourceCache{constructor(t){let s=me("proxy",{type:"geojson",maxzoom:t.transform.maxZoom},new Fi(Rt(),null),t.style);super("proxy",s,!1),s.setEventedParent(this),this.map=this.getSource().map=t,this.used=this._sourceLoaded=!0,this.renderCache=[],this.renderCachePool=[],this.proxyCachedFBO={}}update(t,s,p){if(t.freezeTileCoverage)return;this.transform=t;let f=t.coveringTiles({tileSize:this._source.tileSize,minzoom:this._source.minzoom,maxzoom:this._source.maxzoom,roundZoom:this._source.roundZoom,reparseOverscaled:this._source.reparseOverscaled}).reduce((_,b)=>{if(_[b.key]="",!this._tiles[b.key]){let w=new o.Tile(b,this._source.tileSize*b.overscaleFactor(),t.tileZoom);w.state="loaded",this._tiles[b.key]=w}return _},{});for(let _ in this._tiles)_ in f||(this.freeFBO(_),this._tiles[_].unloadVectorData(),delete this._tiles[_])}freeFBO(t){let s=this.proxyCachedFBO[t];if(s!==void 0){let p=Object.values(s);this.renderCachePool.push(...p),delete this.proxyCachedFBO[t]}}deallocRenderCache(){this.renderCache.forEach(t=>t.fb.destroy()),this.renderCache=[],this.renderCachePool=[],this.proxyCachedFBO={}}}class pa extends o.OverscaledTileID{constructor(t,s,p){super(t.overscaledZ,t.wrap,t.canonical.z,t.canonical.x,t.canonical.y),this.proxyTileKey=s,this.projMatrix=p}}class xl extends o.Elevation{constructor(t,s){super(),this.painter=t,this.terrainTileForTile={},this.prevTerrainTileForTile={};let[p,f,_]=function(T){let A=new o.StructArrayLayout4i8,I=new o.StructArrayLayout3ui6,L=131;A.reserve(17161),I.reserve(33800);let O=o.EXTENT/128,V=o.EXTENT+O/2,N=V+O;for(let J=-O;J<N;J+=O)for(let U=-O;U<N;U+=O){let $=U<0||U>V||J<0||J>V?24575:0,q=o.clamp(Math.round(U),0,o.EXTENT),ie=o.clamp(Math.round(J),0,o.EXTENT);A.emplaceBack(q+$,ie,q,ie)}let j=(J,U)=>{let $=U*L+J;I.emplaceBack($+1,$,$+L),I.emplaceBack($+L,$+L+1,$+1)};for(let J=1;J<129;J++)for(let U=1;U<129;U++)j(U,J);return[0,129].forEach(J=>{for(let U=0;U<130;U++)j(U,J),j(J,U)}),[A,I,32768]}(),b=t.context;this.gridBuffer=b.createVertexBuffer(p,o.boundsAttributes.members),this.gridIndexBuffer=b.createIndexBuffer(f),this.gridSegments=o.SegmentVector.simpleSegment(0,0,p.length,f.length),this.gridNoSkirtSegments=o.SegmentVector.simpleSegment(0,0,p.length,_),this.proxyCoords=[],this.proxiedCoords={},this._visibleDemTiles=[],this._drapedRenderBatches=[],this._sourceTilesOverlap={},this.proxySourceCache=new hp(s.map),this.orthoMatrix=o.create(),o.ortho(this.orthoMatrix,0,o.EXTENT,0,o.EXTENT,0,1);let w=b.gl;this._overlapStencilMode=new o.StencilMode({func:w.GEQUAL,mask:255},0,255,w.KEEP,w.KEEP,w.REPLACE),this._previousZoom=t.transform.zoom,this.pool=[],this._findCoveringTileCache={},this._tilesDirty={},this.style=s,this._useVertexMorphing=!0,this._exaggeration=1,this._mockSourceCache=new cp(s.map)}set style(t){t.on("data",this._onStyleDataEvent.bind(this)),t.on("neworder",this._checkRenderCacheEfficiency.bind(this)),this._style=t,this._checkRenderCacheEfficiency()}update(t,s,p){if(t&&t.terrain){this._style!==t&&(this.style=t),this.enabled=!0;let f=t.terrain.properties;this.sourceCache=t.terrain.drapeRenderMode===0?this._mockSourceCache:t._getSourceCache(f.get("source")),this._exaggeration=f.get("exaggeration");let _=()=>{this.sourceCache.used&&o.warnOnce(`Raster DEM source '${this.sourceCache.id}' is used both for terrain and as layer source.
This leads to lower resolution of hillshade. For full hillshade resolution but higher memory consumption, define another raster DEM source.`);let b=this.getScaledDemTileSize();this.sourceCache.update(s,b,!0),this.resetTileLookupCache(this.sourceCache.id)};this.sourceCache.usedForTerrain||(this.resetTileLookupCache(this.sourceCache.id),this.sourceCache.usedForTerrain=!0,_(),this._initializing=!0),_(),s.updateElevation(!p),this.resetTileLookupCache(this.proxySourceCache.id),this.proxySourceCache.update(s),this._emptyDEMTextureDirty=!0}else this._disable()}resetTileLookupCache(t){this._findCoveringTileCache[t]={}}getScaledDemTileSize(){return this.sourceCache.getSource().tileSize/128*this.proxySourceCache.getSource().tileSize}_checkRenderCacheEfficiency(){let t=this.renderCacheEfficiency(this._style);this._style.map._optimizeForTerrain||t.efficiency!==100&&o.warnOnce(`Terrain render cache efficiency is not optimal (${t.efficiency}%) and performance
                may be affected negatively, consider placing all background, fill and line layers before layer
                with id '${t.firstUndrapedLayer}' or create a map using optimizeForTerrain: true option.`)}_onStyleDataEvent(t){t.coord&&t.dataType==="source"?this._clearRenderCacheForTile(t.sourceCacheId,t.coord):t.dataType==="style"&&(this._invalidateRenderCache=!0)}_disable(){if(this.enabled&&(this.enabled=!1,this._sharedDepthStencil=void 0,this.proxySourceCache.deallocRenderCache(),this._style))for(let t in this._style._sourceCaches)this._style._sourceCaches[t].usedForTerrain=!1}destroy(){this._disable(),this._emptyDEMTexture&&this._emptyDEMTexture.destroy(),this._emptyDepthBufferTexture&&this._emptyDepthBufferTexture.destroy(),this.pool.forEach(t=>t.fb.destroy()),this.pool=[],this._depthFBO&&(this._depthFBO.destroy(),this._depthFBO=void 0,this._depthTexture=void 0)}_source(){return this.enabled?this.sourceCache:null}exaggeration(){return this._exaggeration}get visibleDemTiles(){return this._visibleDemTiles}get drapeBufferSize(){let t=2*this.proxySourceCache.getSource().tileSize;return[t,t]}set useVertexMorphing(t){this._useVertexMorphing=t}updateTileBinding(t){if(!this.enabled)return;this.prevTerrainTileForTile=this.terrainTileForTile;let s=this.proxySourceCache,p=this.painter.transform;this._initializing&&(this._initializing=p._centerAltitude===0&&this.getAtPointOrZero(o.MercatorCoordinate.fromLngLat(p.center),-1)===-1,this._emptyDEMTextureDirty=!this._initializing);let f=this.proxyCoords=s.getIds().map(T=>{let A=s.getTileByID(T).tileID;return A.projMatrix=p.calculateProjMatrix(A.toUnwrapped()),A});(function(T,A){let I=A.transform.pointCoordinate(A.transform.getCameraPoint()),L=new o.pointGeometry(I.x,I.y);T.sort((O,V)=>{if(V.overscaledZ-O.overscaledZ)return V.overscaledZ-O.overscaledZ;let N=new o.pointGeometry(O.canonical.x+(1<<O.canonical.z)*O.wrap,O.canonical.y),j=new o.pointGeometry(V.canonical.x+(1<<V.canonical.z)*V.wrap,V.canonical.y),J=L.mult(1<<O.canonical.z);return J.x-=.5,J.y-=.5,J.distSqr(N)-J.distSqr(j)})})(f,this.painter),this._previousZoom=p.zoom;let _=this.proxyToSource||{};this.proxyToSource={},f.forEach(T=>{this.proxyToSource[T.key]={}}),this.terrainTileForTile={};let b=this._style._sourceCaches;for(let T in b){let A=b[T];if(!A.used||(A!==this.sourceCache&&this.resetTileLookupCache(A.id),this._setupProxiedCoordsForOrtho(A,t[T],_),A.usedForTerrain))continue;let I=t[T];A.getSource().reparseOverscaled&&this._assignTerrainTiles(I)}this.proxiedCoords[s.id]=f.map(T=>new pa(T,T.key,this.orthoMatrix)),this._assignTerrainTiles(f),this._prepareDEMTextures(),this._setupDrapedRenderBatches(),this._initFBOPool(),this._setupRenderCache(_),this.renderingToTexture=!1,this._updateTimestamp=o.exported.now();let w={};this._visibleDemTiles=[];for(let T of this.proxyCoords){let A=this.terrainTileForTile[T.key];if(!A)continue;let I=A.tileID.key;I in w||(this._visibleDemTiles.push(A),w[I]=I)}}_assignTerrainTiles(t){this._initializing||t.forEach(s=>{if(this.terrainTileForTile[s.key])return;let p=this._findTileCoveringTileID(s,this.sourceCache);p&&(this.terrainTileForTile[s.key]=p)})}_prepareDEMTextures(){let t=this.painter.context,s=t.gl;for(let p in this.terrainTileForTile){let f=this.terrainTileForTile[p],_=f.dem;!_||f.demTexture&&!f.needsDEMTextureUpload||(t.activeTexture.set(s.TEXTURE1),la(this.painter,f,_))}}_prepareDemTileUniforms(t,s,p,f){if(!s||s.demTexture==null)return!1;let _=t.tileID.canonical,b=Math.pow(2,s.tileID.canonical.z-_.z),w=f||"";return p[`u_dem_tl${w}`]=[_.x*b%1,_.y*b%1],p[`u_dem_scale${w}`]=b,!0}get emptyDEMTexture(){return!this._emptyDEMTextureDirty&&this._emptyDEMTexture?this._emptyDEMTexture:this._updateEmptyDEMTexture()}get emptyDepthBufferTexture(){let t=this.painter.context,s=t.gl;if(!this._emptyDepthBufferTexture){let p=new o.RGBAImage({width:1,height:1},Uint8Array.of(255,255,255,255));this._emptyDepthBufferTexture=new o.Texture(t,p,s.RGBA,{premultiply:!1})}return this._emptyDepthBufferTexture}_getLoadedAreaMinimum(){let t=0,s=this._visibleDemTiles.reduce((p,f)=>{if(!f.dem)return p;let _=f.dem.tree.minimums[0];return _>0&&t++,p+_},0);return t?s/t:0}_updateEmptyDEMTexture(){let t=this.painter.context,s=t.gl;t.activeTexture.set(s.TEXTURE2);let p=this._getLoadedAreaMinimum(),f=new o.RGBAImage({width:1,height:1},new Uint8Array(o.DEMData.pack(p,this.sourceCache.getSource().encoding)));this._emptyDEMTextureDirty=!1;let _=this._emptyDEMTexture;return _?_.update(f,{premultiply:!1}):_=this._emptyDEMTexture=new o.Texture(t,f,s.RGBA,{premultiply:!1}),_}setupElevationDraw(t,s,p){let f=this.painter.context,_=f.gl,b=(w=this.sourceCache.getSource().encoding,{u_dem:2,u_dem_prev:4,u_dem_unpack:o.DEMData.getUnpackVector(w),u_dem_tl:[0,0],u_dem_tl_prev:[0,0],u_dem_scale:0,u_dem_scale_prev:0,u_dem_size:0,u_dem_lerp:1,u_depth:3,u_depth_size_inv:[0,0],u_exaggeration:0,u_tile_tl_up:[0,0,1],u_tile_tr_up:[0,0,1],u_tile_br_up:[0,0,1],u_tile_bl_up:[0,0,1],u_tile_up_scale:1});var w;b.u_dem_size=this.sourceCache.getSource().tileSize,b.u_exaggeration=this.exaggeration();let T=this.painter.transform,A=T.projection,I=t.tileID.canonical;b.u_tile_tl_up=A.upVector(I,0,0),b.u_tile_tr_up=A.upVector(I,o.EXTENT,0),b.u_tile_br_up=A.upVector(I,o.EXTENT,o.EXTENT),b.u_tile_bl_up=A.upVector(I,0,o.EXTENT),b.u_tile_up_scale=p&&p.useDenormalizedUpVectorScale?o.GLOBE_METERS_TO_ECEF:A.upVectorScale(I,T.center.lat,T.worldSize).metersToTile;let L=null,O=null,V=1;if(p&&p.morphing&&this._useVertexMorphing){let N=p.morphing.srcDemTile,j=p.morphing.dstDemTile;V=p.morphing.phase,N&&j&&(this._prepareDemTileUniforms(t,N,b,"_prev")&&(O=N),this._prepareDemTileUniforms(t,j,b)&&(L=j))}if(O&&L?(f.activeTexture.set(_.TEXTURE2),L.demTexture.bind(_.NEAREST,_.CLAMP_TO_EDGE,_.NEAREST),f.activeTexture.set(_.TEXTURE4),O.demTexture.bind(_.NEAREST,_.CLAMP_TO_EDGE,_.NEAREST),b.u_dem_lerp=V):(L=this.terrainTileForTile[t.tileID.key],f.activeTexture.set(_.TEXTURE2),(this._prepareDemTileUniforms(t,L,b)?L.demTexture:this.emptyDEMTexture).bind(_.NEAREST,_.CLAMP_TO_EDGE)),f.activeTexture.set(_.TEXTURE3),p&&p.useDepthForOcclusion?(this._depthTexture&&this._depthTexture.bind(_.NEAREST,_.CLAMP_TO_EDGE),this._depthFBO&&(b.u_depth_size_inv=[1/this._depthFBO.width,1/this._depthFBO.height])):(this.emptyDepthBufferTexture.bind(_.NEAREST,_.CLAMP_TO_EDGE),b.u_depth_size_inv=[1,1]),p&&p.useMeterToDem&&L){let N=(1<<L.tileID.canonical.z)*o.mercatorZfromAltitude(1,this.painter.transform.center.lat)*this.sourceCache.getSource().tileSize;b.u_meter_to_dem=N}p&&p.labelPlaneMatrixInv&&(b.u_label_plane_matrix_inv=p.labelPlaneMatrixInv),s.setTerrainUniformValues(f,b)}renderToBackBuffer(t){let s=this.painter,p=this.painter.context;t.length!==0&&(p.bindFramebuffer.set(null),p.viewport.set([0,0,s.width,s.height]),s.gpuTimingDeferredRenderStart(),this.renderingToTexture=!1,function(f,_,b,w,T){if(f.transform.projection.name==="globe")(function(A,I,L,O,V){let N=A.context,j=N.gl,J,U,$=A.options.showTerrainWireframe?2:0,q=A.transform,ie=o.globeUseCustomAntiAliasing(A,N,q),K=(te,Ie)=>{if(U===te)return;let Me=[ss[te],"PROJECTION_GLOBE_VIEW"];ie&&Me.push("CUSTOM_ANTIALIASING"),Ie&&Me.push(ss[$]),J=A.useProgram("globeRaster",null,Me),U=te},Q=A.colorModeForRenderPass(),ae=new o.DepthMode(j.LEQUAL,o.DepthMode.ReadWrite,A.depthRangeFor3D);Rn.update(V);let ye=o.calculateGlobeMercatorMatrix(q),be=[o.mercatorXfromLng(q.center.lng),o.mercatorYfromLat(q.center.lat)],xe=A.globeSharedBuffers,_e=[q.width*o.exported.devicePixelRatio,q.height*o.exported.devicePixelRatio];if(($?[!1,!0]:[!1]).forEach(te=>{U=-1;let Ie=te?j.LINES:j.TRIANGLES;for(let Me of O){let Ve=L.getTile(Me),Te=o.StencilMode.disabled,tt=I.prevTerrainTileForTile[Me.key],Ue=I.terrainTileForTile[Me.key];os(tt,Ue)&&Rn.newMorphing(Me.key,tt,Ue,V,250),N.activeTexture.set(j.TEXTURE0),Ve.texture.bind(j.LINEAR,j.CLAMP_TO_EDGE);let je=Rn.getMorphValuesForProxy(Me.key),Fe=je?1:0,Oe={useDenormalizedUpVectorScale:!0};je&&o.extend$1(Oe,{morphing:{srcDemTile:je.from,dstDemTile:je.to,phase:o.easeCubicInOut(je.phase)}});let ht=Float32Array.from(q.globeMatrix),rt=o.globeTileLatLngCorners(Me.canonical),mt=o.getLatitudinalLod((rt[0][0]+rt[1][0])/2),et=o.getGridMatrix(Me.canonical,rt,mt),pt=o.globeNormalizeECEF(o.globeTileBounds(Me.canonical)),Ot=Pt(q.projMatrix,ht,ye,pt,o.globeToMercatorTransition(q.zoom),be,q.frustumCorners.TL,q.frustumCorners.TR,q.frustumCorners.BR,q.frustumCorners.BL,q.globeCenterInViewSpace,q.globeRadius,_e,et);if(K(Fe,te),I.setupElevationDraw(Ve,J,Oe),A.prepareDrawProgram(N,J,Me.toUnwrapped()),xe){let[Gt,di,Zt]=te?xe.getWirefameBuffers(A.context,mt):xe.getGridBuffers(mt);J.draw(N,Ie,ae,Te,Q,o.CullFaceMode.backCCW,Ot,"globe_raster",Gt,di,Zt)}}}),xe){let te=["GLOBE_POLES","PROJECTION_GLOBE_VIEW"];ie&&te.push("CUSTOM_ANTIALIASING"),J=A.useProgram("globeRaster",null,te);for(let Ie of O){let{x:Me,y:Ve,z:Te}=Ie.canonical,tt=Ve===0,Ue=Ve===(1<<Te)-1,[je,Fe,Oe,ht]=xe.getPoleBuffers(Te);if(ht&&(tt||Ue)){let rt=L.getTile(Ie);N.activeTexture.set(j.TEXTURE0),rt.texture.bind(j.LINEAR,j.CLAMP_TO_EDGE);let mt=o.globePoleMatrixForTile(Te,Me,q),et=o.globeNormalizeECEF(o.globeTileBounds(Ie.canonical)),pt=(Ot,Gt)=>Ot.draw(N,j.TRIANGLES,ae,o.StencilMode.disabled,Q,o.CullFaceMode.disabled,Pt(q.projMatrix,mt,mt,et,0,be,q.frustumCorners.TL,q.frustumCorners.TR,q.frustumCorners.BR,q.frustumCorners.BL,q.globeCenterInViewSpace,q.globeRadius,_e),"globe_pole_raster",Gt,Oe,ht);I.setupElevationDraw(rt,J,{}),A.prepareDrawProgram(N,J,Ie.toUnwrapped()),tt&&pt(J,je),Ue&&(mt=o.scale(o.create(),mt,[1,-1,1]),pt(J,Fe))}}}})(f,_,b,w,T);else{let A=f.context,I=A.gl,L,O,V=f.options.showTerrainWireframe?2:0,N=(q,ie)=>{if(O===q)return;let K=[ss[q]];ie&&K.push(ss[V]),L=f.useProgram("terrainRaster",null,K),O=q},j=f.colorModeForRenderPass(),J=new o.DepthMode(I.LEQUAL,o.DepthMode.ReadWrite,f.depthRangeFor3D);Rn.update(T);let U=f.transform,$=6*Math.pow(1.5,22-U.zoom)*_.exaggeration();(V?[!1,!0]:[!1]).forEach(q=>{O=-1;let ie=q?I.LINES:I.TRIANGLES,[K,Q]=q?_.getWirefameBuffer():[_.gridIndexBuffer,_.gridSegments];for(let ae of w){let ye=b.getTile(ae),be=o.StencilMode.disabled,xe=_.prevTerrainTileForTile[ae.key],_e=_.terrainTileForTile[ae.key];os(xe,_e)&&Rn.newMorphing(ae.key,xe,_e,T,250),A.activeTexture.set(I.TEXTURE0),ye.texture.bind(I.LINEAR,I.CLAMP_TO_EDGE,I.LINEAR_MIPMAP_NEAREST);let te=Rn.getMorphValuesForProxy(ae.key),Ie=te?1:0,Me;te&&(Me={morphing:{srcDemTile:te.from,dstDemTile:te.to,phase:o.easeCubicInOut(te.phase)}});let Ve=ua(ae.projMatrix,Yc(ae.canonical,U.renderWorldCopies)?$/10:$);N(Ie,q),_.setupElevationDraw(ye,L,Me),f.prepareDrawProgram(A,L,ae.toUnwrapped()),L.draw(A,ie,J,be,j,o.CullFaceMode.backCCW,Ve,"terrain_raster",_.gridBuffer,K,Q)}})}}(s,this,this.proxySourceCache,t,this._updateTimestamp),this.renderingToTexture=!0,s.gpuTimingDeferredRenderEnd(),t.splice(0,t.length))}renderBatch(t){if(this._drapedRenderBatches.length===0)return t+1;this.renderingToTexture=!0;let s=this.painter,p=this.painter.context,f=this.proxySourceCache,_=this.proxiedCoords[f.id],b=this._drapedRenderBatches.shift(),w=[],T=s.style.order,A=0;for(let I of _){let L=f.getTileByID(I.proxyTileKey),O=f.proxyCachedFBO[I.key]?f.proxyCachedFBO[I.key][t]:void 0,V=O!==void 0?f.renderCache[O]:this.pool[A++],N=O!==void 0;if(L.texture=V.tex,N&&!V.dirty){w.push(L.tileID);continue}let j;p.bindFramebuffer.set(V.fb.framebuffer),this.renderedToTile=!1,V.dirty&&(p.clear({color:o.Color.transparent,stencil:0}),V.dirty=!1);for(let J=b.start;J<=b.end;++J){let U=s.style._layers[T[J]];if(U.isHidden(s.transform.zoom))continue;let $=s.style._getLayerSourceCache(U),q=$?this.proxyToSource[I.key][$.id]:[I];if(!q)continue;let ie=q;p.viewport.set([0,0,V.fb.width,V.fb.height]),j!==($?$.id:null)&&(this._setupStencil(V,q,U,$),j=$?$.id:null),s.renderLayer(s,$,U,ie)}this.renderedToTile?(V.dirty=!0,w.push(L.tileID)):N||--A,A===5&&(A=0,this.renderToBackBuffer(w))}return this.renderToBackBuffer(w),this.renderingToTexture=!1,p.bindFramebuffer.set(null),p.viewport.set([0,0,s.width,s.height]),b.end+1}postRender(){}renderCacheEfficiency(t){let s=t.order.length;if(s===0)return{efficiency:100};let p,f=0,_=0,b=!1;for(let w=0;w<s;++w){let T=t._layers[t.order[w]];this._style.isLayerDraped(T)?(b&&++f,++_):b||(b=!0,p=T.id)}return _===0?{efficiency:100}:{efficiency:100*(1-f/_),firstUndrapedLayer:p}}getMinElevationBelowMSL(){let t=0;return this._visibleDemTiles.filter(s=>s.dem).forEach(s=>{t=Math.min(t,s.dem.tree.minimums[0])}),t===0?t:(t-30)*this._exaggeration}raycast(t,s,p){if(!this._visibleDemTiles)return null;let f=this._visibleDemTiles.filter(_=>_.dem).map(_=>{let b=_.tileID,w=Math.pow(2,b.overscaledZ),{x:T,y:A}=b.canonical,I=T/w,L=(T+1)/w,O=A/w,V=(A+1)/w;return{minx:I,miny:O,maxx:L,maxy:V,t:_.dem.tree.raycastRoot(I,O,L,V,t,s,p),tile:_}});f.sort((_,b)=>(_.t!==null?_.t:Number.MAX_VALUE)-(b.t!==null?b.t:Number.MAX_VALUE));for(let _ of f){if(_.t==null)return null;let b=_.tile.dem.tree.raycast(_.minx,_.miny,_.maxx,_.maxy,t,s,p);if(b!=null)return b}return null}_createFBO(){let t=this.painter.context,s=t.gl,p=this.drapeBufferSize;t.activeTexture.set(s.TEXTURE0);let f=new o.Texture(t,{width:p[0],height:p[1],data:null},s.RGBA);f.bind(s.LINEAR,s.CLAMP_TO_EDGE);let _=t.createFramebuffer(p[0],p[1],!1);return _.colorAttachment.set(f.texture),_.depthAttachment=new D(t,_.framebuffer),this._sharedDepthStencil===void 0?(this._sharedDepthStencil=t.createRenderbuffer(t.gl.DEPTH_STENCIL,p[0],p[1]),this._stencilRef=0,_.depthAttachment.set(this._sharedDepthStencil),t.clear({stencil:0})):_.depthAttachment.set(this._sharedDepthStencil),t.extTextureFilterAnisotropic&&!t.extTextureFilterAnisotropicForceOff&&s.texParameterf(s.TEXTURE_2D,t.extTextureFilterAnisotropic.TEXTURE_MAX_ANISOTROPY_EXT,t.extTextureFilterAnisotropicMax),{fb:_,tex:f,dirty:!1}}_initFBOPool(){for(;this.pool.length<Math.min(5,this.proxyCoords.length);)this.pool.push(this._createFBO())}_shouldDisableRenderCache(){if(this._style.light&&this._style.light.hasTransition())return!0;for(let t in this._style._sourceCaches)if(this._style._sourceCaches[t].hasTransition())return!0;return this._style.order.some(t=>{let s=this._style._layers[t],p=s.isHidden(this.painter.transform.zoom),f=s.getCrossfadeParameters(),_=!!f&&f.t!==1,b=s.hasTransition();return s.type!=="custom"&&!p&&(_||b)})}_clearRasterFadeFromRenderCache(){let t=!1;for(let s in this._style._sourceCaches)if(this._style._sourceCaches[s]._source instanceof ee){t=!0;break}if(t)for(let s=0;s<this._style.order.length;++s){let p=this._style._layers[this._style.order[s]],f=p.isHidden(this.painter.transform.zoom),_=this._style._getLayerSourceCache(p);if(p.type!=="raster"||f||!_)continue;let b=p.paint.get("raster-fade-duration");for(let w of this.proxyCoords){let T=this.proxyToSource[w.key][_.id];if(T)for(let A of T){let I=yl(_.getTile(A),_.findLoadedParent(A,0),_,this.painter.transform,b);(I.opacity!==1||I.mix!==0)&&this._clearRenderCacheForTile(_.id,A)}}}}_setupDrapedRenderBatches(){let t=this._style.order,s=t.length;if(s===0)return;let p=[],f,_=0,b=this._style._layers[t[_]];for(;!this._style.isLayerDraped(b)&&b.isHidden(this.painter.transform.zoom)&&++_<s;)b=this._style._layers[t[_]];for(;_<s;++_){let w=this._style._layers[t[_]];w.isHidden(this.painter.transform.zoom)||(this._style.isLayerDraped(w)?f===void 0&&(f=_):f!==void 0&&(p.push({start:f,end:_-1}),f=void 0))}f!==void 0&&p.push({start:f,end:_-1}),this._drapedRenderBatches=p}_setupRenderCache(t){let s=this.proxySourceCache;if(this._shouldDisableRenderCache()||this._invalidateRenderCache){if(this._invalidateRenderCache=!1,s.renderCache.length>s.renderCachePool.length){let b=Object.values(s.proxyCachedFBO);s.proxyCachedFBO={};for(let w=0;w<b.length;++w){let T=Object.values(b[w]);s.renderCachePool.push(...T)}}return}this._clearRasterFadeFromRenderCache();let p=this.proxyCoords,f=this._tilesDirty;for(let b=p.length-1;b>=0;b--){let w=p[b];if(s.getTileByID(w.key),s.proxyCachedFBO[w.key]!==void 0){let T=t[w.key],A=this.proxyToSource[w.key],I=0;for(let L in A){let O=A[L],V=T[L];if(!V||V.length!==O.length||O.some((N,j)=>N!==V[j]||f[L]&&f[L].hasOwnProperty(N.key))){I=-1;break}++I}for(let L in s.proxyCachedFBO[w.key])s.renderCache[s.proxyCachedFBO[w.key][L]].dirty=I<0||I!==Object.values(T).length}}let _=[...this._drapedRenderBatches];_.sort((b,w)=>w.end-w.start-(b.end-b.start));for(let b of _)for(let w of p){if(s.proxyCachedFBO[w.key])continue;let T=s.renderCachePool.pop();T===void 0&&s.renderCache.length<50&&(T=s.renderCache.length,s.renderCache.push(this._createFBO())),T!==void 0&&(s.proxyCachedFBO[w.key]={},s.proxyCachedFBO[w.key][b.start]=T,s.renderCache[T].dirty=!0)}this._tilesDirty={}}_setupStencil(t,s,p,f){if(!f||!this._sourceTilesOverlap[f.id])return void(this._overlapStencilType&&(this._overlapStencilType=!1));let _=this.painter.context,b=_.gl;if(s.length<=1)return void(this._overlapStencilType=!1);let w;if(p.isTileClipped())w=s.length,this._overlapStencilMode.test={func:b.EQUAL,mask:255},this._overlapStencilType="Clip";else{if(!(s[0].overscaledZ>s[s.length-1].overscaledZ))return void(this._overlapStencilType=!1);w=1,this._overlapStencilMode.test={func:b.GREATER,mask:255},this._overlapStencilType="Mask"}this._stencilRef+w>255&&(_.clear({stencil:0}),this._stencilRef=0),this._stencilRef+=w,this._overlapStencilMode.ref=this._stencilRef,p.isTileClipped()&&this._renderTileClippingMasks(s,this._overlapStencilMode.ref)}clipOrMaskOverlapStencilType(){return this._overlapStencilType==="Clip"||this._overlapStencilType==="Mask"}stencilModeForRTTOverlap(t){return this.renderingToTexture&&this._overlapStencilType?(this._overlapStencilType==="Clip"&&(this._overlapStencilMode.ref=this.painter._tileClippingMaskIDs[t.key]),this._overlapStencilMode):o.StencilMode.disabled}_renderTileClippingMasks(t,s){let p=this.painter,f=this.painter.context,_=f.gl;p._tileClippingMaskIDs={},f.setColorMode(o.ColorMode.disabled),f.setDepthMode(o.DepthMode.disabled);let b=p.useProgram("clippingMask");for(let w of t){let T=p._tileClippingMaskIDs[w.key]=--s;b.draw(f,_.TRIANGLES,o.DepthMode.disabled,new o.StencilMode({func:_.ALWAYS,mask:0},T,255,_.KEEP,_.KEEP,_.REPLACE),o.ColorMode.disabled,o.CullFaceMode.disabled,as(w.projMatrix),"$clipping",p.tileExtentBuffer,p.quadTriangleIndexBuffer,p.tileExtentSegments)}}pointCoordinate(t){let s=this.painter.transform;if(t.x<0||t.x>s.width||t.y<0||t.y>s.height)return null;let p=[t.x,t.y,1,1];o.transformMat4$1(p,p,s.pixelMatrixInverse),o.scale$1(p,p,1/p[3]),p[0]/=s.worldSize,p[1]/=s.worldSize;let f=s._camera.position,_=o.mercatorZfromAltitude(1,s.center.lat),b=[f[0],f[1],f[2]/_,0],w=o.subtract([],p.slice(0,3),b);o.normalize(w,w);let T=this.raycast(b,w,this._exaggeration);return T!==null&&T?(o.scaleAndAdd(b,b,w,T),b[3]=b[2],b[2]*=_,b):null}drawDepth(){let t=this.painter,s=t.context,p=this.proxySourceCache,f=Math.ceil(t.width),_=Math.ceil(t.height);if(!this._depthFBO||this._depthFBO.width===f&&this._depthFBO.height===_||(this._depthFBO.destroy(),this._depthFBO=void 0,this._depthTexture=void 0),!this._depthFBO){let b=s.gl,w=s.createFramebuffer(f,_,!0);s.activeTexture.set(b.TEXTURE0);let T=new o.Texture(s,{width:f,height:_,data:null},b.RGBA);T.bind(b.NEAREST,b.CLAMP_TO_EDGE),w.colorAttachment.set(T.texture);let A=s.createRenderbuffer(s.gl.DEPTH_COMPONENT16,f,_);w.depthAttachment.set(A),this._depthFBO=w,this._depthTexture=T}s.bindFramebuffer.set(this._depthFBO.framebuffer),s.viewport.set([0,0,f,_]),function(b,w,T,A){if(b.transform.projection.name==="globe")return;let I=b.context,L=I.gl;I.clear({depth:1});let O=b.useProgram("terrainDepth"),V=new o.DepthMode(L.LESS,o.DepthMode.ReadWrite,b.depthRangeFor3D);for(let N of A){let j=T.getTile(N),J=ua(N.projMatrix,0);w.setupElevationDraw(j,O),O.draw(I,L.TRIANGLES,V,o.StencilMode.disabled,o.ColorMode.unblended,o.CullFaceMode.backCCW,J,"terrain_depth",w.gridBuffer,w.gridIndexBuffer,w.gridNoSkirtSegments)}}(t,this,p,this.proxyCoords)}_setupProxiedCoordsForOrtho(t,s,p){if(t.getSource()instanceof pe)return this._setupProxiedCoordsForImageSource(t,s,p);this._findCoveringTileCache[t.id]=this._findCoveringTileCache[t.id]||{};let f=this.proxiedCoords[t.id]=[],_=this.proxyCoords;for(let w=0;w<_.length;w++){let T=_[w],A=this._findTileCoveringTileID(T,t);if(A){let I=this._createProxiedId(T,A,p[T.key]&&p[T.key][t.id]);f.push(I),this.proxyToSource[T.key][t.id]=[I]}}let b=!1;for(let w=0;w<s.length;w++){let T=t.getTile(s[w]);if(!T||!T.hasData())continue;let A=this._findTileCoveringTileID(T.tileID,this.proxySourceCache);if(A&&A.tileID.canonical.z!==T.tileID.canonical.z){let I=this.proxyToSource[A.tileID.key][t.id],L=this._createProxiedId(A.tileID,T,p[A.tileID.key]&&p[A.tileID.key][t.id]);I?I.splice(I.length-1,0,L):this.proxyToSource[A.tileID.key][t.id]=[L],f.push(L),b=!0}}this._sourceTilesOverlap[t.id]=b}_setupProxiedCoordsForImageSource(t,s,p){if(!t.getSource().loaded())return;let f=this.proxiedCoords[t.id]=[],_=this.proxyCoords,b=t.getSource(),w=new o.pointGeometry(b.tileID.x,b.tileID.y)._div(1<<b.tileID.z),T=b.coordinates.map(o.MercatorCoordinate.fromLngLat).reduce((I,L)=>(I.min.x=Math.min(I.min.x,L.x-w.x),I.min.y=Math.min(I.min.y,L.y-w.y),I.max.x=Math.max(I.max.x,L.x-w.x),I.max.y=Math.max(I.max.y,L.y-w.y),I),{min:new o.pointGeometry(Number.MAX_VALUE,Number.MAX_VALUE),max:new o.pointGeometry(-Number.MAX_VALUE,-Number.MAX_VALUE)}),A=(I,L)=>{let O=I.wrap+I.canonical.x/(1<<I.canonical.z),V=I.canonical.y/(1<<I.canonical.z),N=o.EXTENT/(1<<I.canonical.z),j=L.wrap+L.canonical.x/(1<<L.canonical.z),J=L.canonical.y/(1<<L.canonical.z);return O+N<j+T.min.x||O>j+T.max.x||V+N<J+T.min.y||V>J+T.max.y};for(let I=0;I<_.length;I++){let L=_[I];for(let O=0;O<s.length;O++){let V=t.getTile(s[O]);if(!V||!V.hasData()||A(L,V.tileID))continue;let N=this._createProxiedId(L,V,p[L.key]&&p[L.key][t.id]),j=this.proxyToSource[L.key][t.id];j?j.push(N):this.proxyToSource[L.key][t.id]=[N],f.push(N)}}}_createProxiedId(t,s,p){let f=this.orthoMatrix;if(p){let _=p.find(b=>b.key===s.tileID.key);if(_)return _}if(s.tileID.key!==t.key){let _=t.canonical.z-s.tileID.canonical.z,b,w,T;f=o.create();let A=s.tileID.wrap-t.wrap<<t.overscaledZ;_>0?(b=o.EXTENT>>_,w=b*((s.tileID.canonical.x<<_)-t.canonical.x+A),T=b*((s.tileID.canonical.y<<_)-t.canonical.y)):(b=o.EXTENT<<-_,w=o.EXTENT*(s.tileID.canonical.x-(t.canonical.x+A<<-_)),T=o.EXTENT*(s.tileID.canonical.y-(t.canonical.y<<-_))),o.ortho(f,0,b,0,b,0,1),o.translate(f,f,[w,T,0])}return new pa(s.tileID,t.key,f)}_findTileCoveringTileID(t,s){let p=s.getTile(t);if(p&&p.hasData())return p;let f=this._findCoveringTileCache[s.id],_=f[t.key];if(p=_?s.getTileByID(_):null,p&&p.hasData()||_===null)return p;let b=p?p.tileID:t,w=b.overscaledZ,T=s.getSource().minzoom,A=[];if(!_){let L=s.getSource().maxzoom;if(t.canonical.z>=L){let O=t.canonical.z-L;s.getSource().reparseOverscaled?(w=Math.max(t.canonical.z+2,s.transform.tileZoom),b=new o.OverscaledTileID(w,t.wrap,L,t.canonical.x>>O,t.canonical.y>>O)):O!==0&&(w=L,b=new o.OverscaledTileID(w,t.wrap,L,t.canonical.x>>O,t.canonical.y>>O))}b.key!==t.key&&(A.push(b.key),p=s.getTile(b))}let I=L=>{A.forEach(O=>{f[O]=L}),A.length=0};for(w-=1;w>=T&&(!p||!p.hasData());w--){p&&I(p.tileID.key);let L=b.calculateScaledKey(w);if(p=s.getTileByID(L),p&&p.hasData())break;let O=f[L];if(O===null)break;O===void 0?A.push(L):p=s.getTileByID(O)}return I(p?p.tileID.key:null),p&&p.hasData()?p:null}findDEMTileFor(t){return this.enabled?this._findTileCoveringTileID(t,this.sourceCache):null}prepareDrawTile(){this.renderedToTile=!0}_clearRenderCacheForTile(t,s){let p=this._tilesDirty[t];p||(p=this._tilesDirty[t]={}),p[s.key]=!0}getWirefameBuffer(){if(!this.wireframeSegments){let t=function(s){let p=0,f=new o.StructArrayLayout2ui4,_=131;for(let b=1;b<129;b++){for(let w=1;w<129;w++)p=b*_+w,f.emplaceBack(p,p+1),f.emplaceBack(p,p+_),f.emplaceBack(p+1,p+_),b===128&&f.emplaceBack(p+_,p+_+1);f.emplaceBack(p+1,p+1+_)}return f}();this.wireframeIndexBuffer=this.painter.context.createIndexBuffer(t),this.wireframeSegments=o.SegmentVector.simpleSegment(0,0,this.gridBuffer.length,t.length)}return[this.wireframeIndexBuffer,this.wireframeSegments]}}function da(l){let t=[];for(let s=0;s<l.length;s++){if(l[s]===null)continue;let p=l[s].split(" ");t.push(p.pop())}return t}class fa{static cacheKey(t,s,p){let f=`${t}${p?p.cacheKey:""}`;for(let _ of s)f+=`/${_}`;return f}constructor(t,s,p,f,_,b){let w=t.gl;this.program=w.createProgram();let T=da(p.staticAttributes),A=f?f.getBinderAttributes():[],I=T.concat(A),L=p.staticUniforms?da(p.staticUniforms):[],O=f?f.getBinderUniforms():[],V=L.concat(O),N=[];for(let K of V)N.indexOf(K)<0&&N.push(K);let j=f?f.defines():[];j=j.concat(b.map(K=>`#define ${K}`));let J=j.concat(t.extStandardDerivatives?`#extension GL_OES_standard_derivatives : enable
`.concat(fo):fo,fo,po,sa.fragmentSource,sn.fragmentSource,p.fragmentSource).join(`
`),U=j.concat(`
#ifdef GL_ES
precision highp float;
#else

#if !defined(lowp)
#define lowp
#endif

#if !defined(mediump)
#define mediump
#endif

#if !defined(highp)
#define highp
#endif

#endif`,po,sa.vertexSource,sn.vertexSource,ns.vertexSource,p.vertexSource).join(`
`),$=w.createShader(w.FRAGMENT_SHADER);if(w.isContextLost())return void(this.failedToCreate=!0);w.shaderSource($,J),w.compileShader($),w.attachShader(this.program,$);let q=w.createShader(w.VERTEX_SHADER);if(w.isContextLost())return void(this.failedToCreate=!0);w.shaderSource(q,U),w.compileShader(q),w.attachShader(this.program,q),this.attributes={};let ie={};this.numAttributes=I.length;for(let K=0;K<this.numAttributes;K++)I[K]&&(w.bindAttribLocation(this.program,K,I[K]),this.attributes[I[K]]=K);w.linkProgram(this.program),w.deleteShader(q),w.deleteShader($);for(let K=0;K<N.length;K++){let Q=N[K];if(Q&&!ie[Q]){let ae=w.getUniformLocation(this.program,Q);ae&&(ie[Q]=ae)}}this.fixedUniforms=_(t,ie),this.binderUniforms=f?f.getUniforms(t,ie):[],b.indexOf("TERRAIN")!==-1&&(this.terrainUniforms=((K,Q)=>({u_dem:new o.Uniform1i(K,Q.u_dem),u_dem_prev:new o.Uniform1i(K,Q.u_dem_prev),u_dem_unpack:new o.Uniform4f(K,Q.u_dem_unpack),u_dem_tl:new o.Uniform2f(K,Q.u_dem_tl),u_dem_scale:new o.Uniform1f(K,Q.u_dem_scale),u_dem_tl_prev:new o.Uniform2f(K,Q.u_dem_tl_prev),u_dem_scale_prev:new o.Uniform1f(K,Q.u_dem_scale_prev),u_dem_size:new o.Uniform1f(K,Q.u_dem_size),u_dem_lerp:new o.Uniform1f(K,Q.u_dem_lerp),u_exaggeration:new o.Uniform1f(K,Q.u_exaggeration),u_depth:new o.Uniform1i(K,Q.u_depth),u_depth_size_inv:new o.Uniform2f(K,Q.u_depth_size_inv),u_meter_to_dem:new o.Uniform1f(K,Q.u_meter_to_dem),u_label_plane_matrix_inv:new o.UniformMatrix4f(K,Q.u_label_plane_matrix_inv),u_tile_tl_up:new o.Uniform3f(K,Q.u_tile_tl_up),u_tile_tr_up:new o.Uniform3f(K,Q.u_tile_tr_up),u_tile_br_up:new o.Uniform3f(K,Q.u_tile_br_up),u_tile_bl_up:new o.Uniform3f(K,Q.u_tile_bl_up),u_tile_up_scale:new o.Uniform1f(K,Q.u_tile_up_scale)}))(t,ie)),b.indexOf("FOG")!==-1&&(this.fogUniforms=((K,Q)=>({u_fog_matrix:new o.UniformMatrix4f(K,Q.u_fog_matrix),u_fog_range:new o.Uniform2f(K,Q.u_fog_range),u_fog_color:new o.Uniform4f(K,Q.u_fog_color),u_fog_horizon_blend:new o.Uniform1f(K,Q.u_fog_horizon_blend),u_fog_temporal_offset:new o.Uniform1f(K,Q.u_fog_temporal_offset),u_frustum_tl:new o.Uniform3f(K,Q.u_frustum_tl),u_frustum_tr:new o.Uniform3f(K,Q.u_frustum_tr),u_frustum_br:new o.Uniform3f(K,Q.u_frustum_br),u_frustum_bl:new o.Uniform3f(K,Q.u_frustum_bl),u_globe_pos:new o.Uniform3f(K,Q.u_globe_pos),u_globe_radius:new o.Uniform1f(K,Q.u_globe_radius),u_globe_transition:new o.Uniform1f(K,Q.u_globe_transition),u_is_globe:new o.Uniform1i(K,Q.u_is_globe),u_viewport:new o.Uniform2f(K,Q.u_viewport)}))(t,ie))}setTerrainUniformValues(t,s){if(!this.terrainUniforms)return;let p=this.terrainUniforms;if(!this.failedToCreate){t.program.set(this.program);for(let f in s)p[f].set(s[f])}}setFogUniformValues(t,s){if(!this.fogUniforms)return;let p=this.fogUniforms;if(!this.failedToCreate){t.program.set(this.program);for(let f in s)p[f].location&&p[f].set(s[f])}}draw(t,s,p,f,_,b,w,T,A,I,L,O,V,N,j,J,U){let $=t.gl;if(this.failedToCreate)return;t.program.set(this.program),t.setDepthMode(p),t.setStencilMode(f),t.setColorMode(_),t.setCullFace(b);for(let ie of Object.keys(this.fixedUniforms))this.fixedUniforms[ie].set(w[ie]);N&&N.setUniforms(t,this.binderUniforms,O,{zoom:V});let q={[$.LINES]:2,[$.TRIANGLES]:3,[$.LINE_STRIP]:1}[s];for(let ie of L.get()){let K=ie.vaos||(ie.vaos={});(K[T]||(K[T]=new Xc)).bind(t,this,A,N?N.getPaintVertexBuffers():[],I,ie.vertexOffset,j,J,U),$.drawElements(s,ie.primitiveLength*q,$.UNSIGNED_SHORT,ie.primitiveOffset*q*2)}}}function vl(l,t,s){let p=1/Wr(s,1,t.transform.tileZoom),f=Math.pow(2,s.tileID.overscaledZ),_=s.tileSize*Math.pow(2,t.transform.tileZoom)/f,b=_*(s.tileID.canonical.x+s.tileID.wrap*f),w=_*s.tileID.canonical.y;return{u_image:0,u_texsize:s.imageAtlasTexture.size,u_scale:[p,l.fromScale,l.toScale],u_fade:l.t,u_pixel_coord_upper:[b>>16,w>>16],u_pixel_coord_lower:[65535&b,65535&w]}}let Jc=o.create(),Qc=(l,t,s,p,f,_,b,w,T)=>{let A=t.style.light,I=A.properties.get("position"),L=[I.x,I.y,I.z],O=o.create$1();A.properties.get("anchor")==="viewport"&&(o.fromRotation(O,-t.transform.angle),o.transformMat3(L,L,O));let V=A.properties.get("color"),N=t.transform,j={u_matrix:l,u_lightpos:L,u_lightintensity:A.properties.get("intensity"),u_lightcolor:[V.r,V.g,V.b],u_vertical_gradient:+s,u_opacity:p,u_tile_id:[0,0,0],u_zoom_transition:0,u_inv_rot_matrix:Jc,u_merc_center:[0,0],u_up_dir:[0,0,0],u_height_lift:0};return N.projection.name==="globe"&&(j.u_tile_id=[f.canonical.x,f.canonical.y,1<<f.canonical.z],j.u_zoom_transition=b,j.u_inv_rot_matrix=T,j.u_merc_center=w,j.u_up_dir=N.projection.upVector(new o.CanonicalTileID(0,0,0),w[0]*o.EXTENT,w[1]*o.EXTENT),j.u_height_lift=_),j},ls=(l,t,s,p,f,_,b,w,T,A,I)=>{let L=Qc(l,t,s,p,f,w,T,A,I),O={u_height_factor:-Math.pow(2,f.overscaledZ)/b.tileSize/8};return o.extend(L,vl(_,t,b),O)},mo=l=>({u_matrix:l}),bl=(l,t,s,p)=>o.extend(mo(l),vl(s,t,p)),ma=(l,t)=>({u_matrix:l,u_world:t}),wl=(l,t,s,p,f)=>o.extend(bl(l,t,s,p),{u_world:f}),Fr=o.create(),El=(l,t,s,p,f,_)=>{let b=l.transform,w=b.projection.name==="globe",T;if(_.paint.get("circle-pitch-alignment")==="map")if(w){let I=o.globePixelsToTileUnits(b.zoom,t.canonical)*b._projectionScaler;T=Float32Array.from([I,0,0,I])}else T=b.calculatePixelsToTileUnitsMatrix(s);else T=new Float32Array([b.pixelsToGLUnits[0],0,0,b.pixelsToGLUnits[1]]);let A={u_camera_to_center_distance:b.cameraToCenterDistance,u_matrix:l.translatePosMatrix(t.projMatrix,s,_.paint.get("circle-translate"),_.paint.get("circle-translate-anchor")),u_device_pixel_ratio:o.exported.devicePixelRatio,u_extrude_scale:T,u_inv_rot_matrix:Fr,u_merc_center:[0,0],u_tile_id:[0,0,0],u_zoom_transition:0,u_up_dir:[0,0,0]};if(w){A.u_inv_rot_matrix=p,A.u_merc_center=f,A.u_tile_id=[t.canonical.x,t.canonical.y,1<<t.canonical.z],A.u_zoom_transition=o.globeToMercatorTransition(b.zoom);let I=f[0]*o.EXTENT,L=f[1]*o.EXTENT;A.u_up_dir=b.projection.upVector(new o.CanonicalTileID(0,0,0),I,L)}return A},eh=l=>{let t=[];return l.paint.get("circle-pitch-alignment")==="map"&&t.push("PITCH_WITH_MAP"),l.paint.get("circle-pitch-scale")==="map"&&t.push("SCALE_WITH_MAP"),t},Tl=(l,t,s,p)=>{let f=o.EXTENT/s.tileSize;return{u_matrix:l,u_camera_to_center_distance:t.getCameraToCenterDistance(p),u_extrude_scale:[t.pixelsToGLUnits[0]/f,t.pixelsToGLUnits[1]/f]}},Cl=(l,t,s=1)=>({u_matrix:l,u_color:t,u_overlay:0,u_overlay_scale:s}),kl=o.create(),up=(l,t,s,p,f,_,b)=>{let w=l.transform,T=w.projection.name==="globe",A=T?o.globePixelsToTileUnits(w.zoom,t.canonical)*w._projectionScaler:Wr(s,1,_),I={u_matrix:t.projMatrix,u_extrude_scale:A,u_intensity:b,u_inv_rot_matrix:kl,u_merc_center:[0,0],u_tile_id:[0,0,0],u_zoom_transition:0,u_up_dir:[0,0,0]};if(T){I.u_inv_rot_matrix=p,I.u_merc_center=f,I.u_tile_id=[t.canonical.x,t.canonical.y,1<<t.canonical.z],I.u_zoom_transition=o.globeToMercatorTransition(w.zoom);let L=f[0]*o.EXTENT,O=f[1]*o.EXTENT;I.u_up_dir=w.projection.upVector(new o.CanonicalTileID(0,0,0),L,O)}return I},Sl=(l,t,s,p,f,_,b,w)=>{let T=l.transform,A=T.calculatePixelsToTileUnitsMatrix(t),I={u_matrix:th(l,t,s,f),u_pixels_to_tile_units:A,u_device_pixel_ratio:b,u_units_to_pixels:[1/T.pixelsToGLUnits[0],1/T.pixelsToGLUnits[1]],u_dash_image:0,u_gradient_image:1,u_image_height:_,u_texsize:[0,0],u_scale:[0,0,0],u_mix:0,u_alpha_discard_threshold:0,u_trim_offset:w};if(ga(s)){let L=cs(t,l.transform);I.u_texsize=t.lineAtlasTexture.size,I.u_scale=[L,p.fromScale,p.toScale],I.u_mix=p.t}return I},pp=(l,t,s,p,f,_)=>{let b=l.transform,w=cs(t,b);return{u_matrix:th(l,t,s,f),u_texsize:t.imageAtlasTexture.size,u_pixels_to_tile_units:b.calculatePixelsToTileUnitsMatrix(t),u_device_pixel_ratio:_,u_image:0,u_scale:[w,p.fromScale,p.toScale],u_fade:p.t,u_units_to_pixels:[1/b.pixelsToGLUnits[0],1/b.pixelsToGLUnits[1]],u_alpha_discard_threshold:0}};function cs(l,t){return 1/Wr(l,1,t.tileZoom)}function th(l,t,s,p){return l.translatePosMatrix(p||t.tileID.projMatrix,t,s.paint.get("line-translate"),s.paint.get("line-translate-anchor"))}function ga(l){let t=l.paint.get("line-dasharray").value;return t.value||t.kind!=="constant"}let dp=(l,t,s,p,f,_)=>{return{u_matrix:l,u_tl_parent:t,u_scale_parent:s,u_fade_t:p.mix,u_opacity:p.opacity*f.paint.get("raster-opacity"),u_image0:0,u_image1:1,u_brightness_low:f.paint.get("raster-brightness-min"),u_brightness_high:f.paint.get("raster-brightness-max"),u_saturation_factor:(w=f.paint.get("raster-saturation"),w>0?1-1/(1.001-w):-w),u_contrast_factor:(b=f.paint.get("raster-contrast"),b>0?1/(1-b):1+b),u_spin_weights:Al(f.paint.get("raster-hue-rotate")),u_perspective_transform:_};var b,w};function Al(l){l*=Math.PI/180;let t=Math.sin(l),s=Math.cos(l);return[(2*s+1)/3,(-Math.sqrt(3)*t-s+1)/3,(Math.sqrt(3)*t-s+1)/3]}let ih=o.create(),hs=(l,t,s,p,f,_,b,w,T,A,I,L,O,V,N,j)=>{let J=f.transform,U={u_is_size_zoom_constant:+(l==="constant"||l==="source"),u_is_size_feature_constant:+(l==="constant"||l==="camera"),u_size_t:t?t.uSizeT:0,u_size:t?t.uSize:0,u_camera_to_center_distance:J.cameraToCenterDistance,u_rotate_symbol:+s,u_aspect_ratio:J.width/J.height,u_fade_change:f.options.fadeDuration?f.symbolFadeChange:1,u_matrix:_,u_label_plane_matrix:b,u_coord_matrix:w,u_is_text:+T,u_pitch_with_map:+p,u_texsize:A,u_texture:0,u_tile_id:[0,0,0],u_zoom_transition:0,u_inv_rot_matrix:ih,u_merc_center:[0,0],u_camera_forward:[0,0,0],u_ecef_origin:[0,0,0],u_tile_matrix:ih,u_up_vector:[0,-1,0]};return j.name==="globe"&&(U.u_tile_id=[I.canonical.x,I.canonical.y,1<<I.canonical.z],U.u_zoom_transition=L,U.u_inv_rot_matrix=V,U.u_merc_center=O,U.u_camera_forward=J._camera.forward(),U.u_ecef_origin=o.globeECEFOrigin(J.globeMatrix,I.toUnwrapped()),U.u_tile_matrix=Float32Array.from(J.globeMatrix),U.u_up_vector=N),U},rh=(l,t,s,p,f,_,b,w,T,A,I,L,O,V,N,j,J)=>o.extend(hs(l,t,s,p,f,_,b,w,T,A,L,O,V,N,j,J),{u_gamma_scale:p?f.transform.cameraToCenterDistance*Math.cos(f.terrain?0:f.transform._pitch):1,u_device_pixel_ratio:o.exported.devicePixelRatio,u_is_halo:+I}),nh=(l,t,s,p,f,_,b,w,T,A,I,L,O,V,N,j)=>o.extend(rh(l,t,s,p,f,_,b,w,!0,T,!0,I,L,O,V,N,j),{u_texsize_icon:A,u_texture_icon:1}),oh=(l,t,s)=>({u_matrix:l,u_opacity:t,u_color:s}),go=(l,t,s,p,f,_)=>o.extend(function(b,w,T,A){let I=T.imageManager.getPattern(b.from.toString()),L=T.imageManager.getPattern(b.to.toString()),{width:O,height:V}=T.imageManager.getPixelSize(),N=Math.pow(2,A.tileID.overscaledZ),j=A.tileSize*Math.pow(2,T.transform.tileZoom)/N,J=j*(A.tileID.canonical.x+A.tileID.wrap*N),U=j*A.tileID.canonical.y;return{u_image:0,u_pattern_tl_a:I.tl,u_pattern_br_a:I.br,u_pattern_tl_b:L.tl,u_pattern_br_b:L.br,u_texsize:[O,V],u_mix:w.t,u_pattern_size_a:I.displaySize,u_pattern_size_b:L.displaySize,u_scale_a:w.fromScale,u_scale_b:w.toScale,u_tile_units_to_pixels:1/Wr(A,1,T.transform.tileZoom),u_pixel_coord_upper:[J>>16,U>>16],u_pixel_coord_lower:[65535&J,65535&U]}}(p,_,s,f),{u_matrix:l,u_opacity:t}),fp={fillExtrusion:(l,t)=>({u_matrix:new o.UniformMatrix4f(l,t.u_matrix),u_lightpos:new o.Uniform3f(l,t.u_lightpos),u_lightintensity:new o.Uniform1f(l,t.u_lightintensity),u_lightcolor:new o.Uniform3f(l,t.u_lightcolor),u_vertical_gradient:new o.Uniform1f(l,t.u_vertical_gradient),u_opacity:new o.Uniform1f(l,t.u_opacity),u_tile_id:new o.Uniform3f(l,t.u_tile_id),u_zoom_transition:new o.Uniform1f(l,t.u_zoom_transition),u_inv_rot_matrix:new o.UniformMatrix4f(l,t.u_inv_rot_matrix),u_merc_center:new o.Uniform2f(l,t.u_merc_center),u_up_dir:new o.Uniform3f(l,t.u_up_dir),u_height_lift:new o.Uniform1f(l,t.u_height_lift)}),fillExtrusionPattern:(l,t)=>({u_matrix:new o.UniformMatrix4f(l,t.u_matrix),u_lightpos:new o.Uniform3f(l,t.u_lightpos),u_lightintensity:new o.Uniform1f(l,t.u_lightintensity),u_lightcolor:new o.Uniform3f(l,t.u_lightcolor),u_vertical_gradient:new o.Uniform1f(l,t.u_vertical_gradient),u_height_factor:new o.Uniform1f(l,t.u_height_factor),u_tile_id:new o.Uniform3f(l,t.u_tile_id),u_zoom_transition:new o.Uniform1f(l,t.u_zoom_transition),u_inv_rot_matrix:new o.UniformMatrix4f(l,t.u_inv_rot_matrix),u_merc_center:new o.Uniform2f(l,t.u_merc_center),u_up_dir:new o.Uniform3f(l,t.u_up_dir),u_height_lift:new o.Uniform1f(l,t.u_height_lift),u_image:new o.Uniform1i(l,t.u_image),u_texsize:new o.Uniform2f(l,t.u_texsize),u_pixel_coord_upper:new o.Uniform2f(l,t.u_pixel_coord_upper),u_pixel_coord_lower:new o.Uniform2f(l,t.u_pixel_coord_lower),u_scale:new o.Uniform3f(l,t.u_scale),u_fade:new o.Uniform1f(l,t.u_fade),u_opacity:new o.Uniform1f(l,t.u_opacity)}),fill:(l,t)=>({u_matrix:new o.UniformMatrix4f(l,t.u_matrix)}),fillPattern:(l,t)=>({u_matrix:new o.UniformMatrix4f(l,t.u_matrix),u_image:new o.Uniform1i(l,t.u_image),u_texsize:new o.Uniform2f(l,t.u_texsize),u_pixel_coord_upper:new o.Uniform2f(l,t.u_pixel_coord_upper),u_pixel_coord_lower:new o.Uniform2f(l,t.u_pixel_coord_lower),u_scale:new o.Uniform3f(l,t.u_scale),u_fade:new o.Uniform1f(l,t.u_fade)}),fillOutline:(l,t)=>({u_matrix:new o.UniformMatrix4f(l,t.u_matrix),u_world:new o.Uniform2f(l,t.u_world)}),fillOutlinePattern:(l,t)=>({u_matrix:new o.UniformMatrix4f(l,t.u_matrix),u_world:new o.Uniform2f(l,t.u_world),u_image:new o.Uniform1i(l,t.u_image),u_texsize:new o.Uniform2f(l,t.u_texsize),u_pixel_coord_upper:new o.Uniform2f(l,t.u_pixel_coord_upper),u_pixel_coord_lower:new o.Uniform2f(l,t.u_pixel_coord_lower),u_scale:new o.Uniform3f(l,t.u_scale),u_fade:new o.Uniform1f(l,t.u_fade)}),circle:(l,t)=>({u_camera_to_center_distance:new o.Uniform1f(l,t.u_camera_to_center_distance),u_extrude_scale:new o.UniformMatrix2f(l,t.u_extrude_scale),u_device_pixel_ratio:new o.Uniform1f(l,t.u_device_pixel_ratio),u_matrix:new o.UniformMatrix4f(l,t.u_matrix),u_inv_rot_matrix:new o.UniformMatrix4f(l,t.u_inv_rot_matrix),u_merc_center:new o.Uniform2f(l,t.u_merc_center),u_tile_id:new o.Uniform3f(l,t.u_tile_id),u_zoom_transition:new o.Uniform1f(l,t.u_zoom_transition),u_up_dir:new o.Uniform3f(l,t.u_up_dir)}),collisionBox:(l,t)=>({u_matrix:new o.UniformMatrix4f(l,t.u_matrix),u_camera_to_center_distance:new o.Uniform1f(l,t.u_camera_to_center_distance),u_extrude_scale:new o.Uniform2f(l,t.u_extrude_scale)}),collisionCircle:(l,t)=>({u_matrix:new o.UniformMatrix4f(l,t.u_matrix),u_inv_matrix:new o.UniformMatrix4f(l,t.u_inv_matrix),u_camera_to_center_distance:new o.Uniform1f(l,t.u_camera_to_center_distance),u_viewport_size:new o.Uniform2f(l,t.u_viewport_size)}),debug:(l,t)=>({u_color:new o.UniformColor(l,t.u_color),u_matrix:new o.UniformMatrix4f(l,t.u_matrix),u_overlay:new o.Uniform1i(l,t.u_overlay),u_overlay_scale:new o.Uniform1f(l,t.u_overlay_scale)}),clippingMask:(l,t)=>({u_matrix:new o.UniformMatrix4f(l,t.u_matrix)}),heatmap:(l,t)=>({u_extrude_scale:new o.Uniform1f(l,t.u_extrude_scale),u_intensity:new o.Uniform1f(l,t.u_intensity),u_matrix:new o.UniformMatrix4f(l,t.u_matrix),u_inv_rot_matrix:new o.UniformMatrix4f(l,t.u_inv_rot_matrix),u_merc_center:new o.Uniform2f(l,t.u_merc_center),u_tile_id:new o.Uniform3f(l,t.u_tile_id),u_zoom_transition:new o.Uniform1f(l,t.u_zoom_transition),u_up_dir:new o.Uniform3f(l,t.u_up_dir)}),heatmapTexture:(l,t)=>({u_image:new o.Uniform1i(l,t.u_image),u_color_ramp:new o.Uniform1i(l,t.u_color_ramp),u_opacity:new o.Uniform1f(l,t.u_opacity)}),hillshade:(l,t)=>({u_matrix:new o.UniformMatrix4f(l,t.u_matrix),u_image:new o.Uniform1i(l,t.u_image),u_latrange:new o.Uniform2f(l,t.u_latrange),u_light:new o.Uniform2f(l,t.u_light),u_shadow:new o.UniformColor(l,t.u_shadow),u_highlight:new o.UniformColor(l,t.u_highlight),u_accent:new o.UniformColor(l,t.u_accent)}),hillshadePrepare:(l,t)=>({u_matrix:new o.UniformMatrix4f(l,t.u_matrix),u_image:new o.Uniform1i(l,t.u_image),u_dimension:new o.Uniform2f(l,t.u_dimension),u_zoom:new o.Uniform1f(l,t.u_zoom),u_unpack:new o.Uniform4f(l,t.u_unpack)}),line:(l,t)=>({u_matrix:new o.UniformMatrix4f(l,t.u_matrix),u_pixels_to_tile_units:new o.UniformMatrix2f(l,t.u_pixels_to_tile_units),u_device_pixel_ratio:new o.Uniform1f(l,t.u_device_pixel_ratio),u_units_to_pixels:new o.Uniform2f(l,t.u_units_to_pixels),u_dash_image:new o.Uniform1i(l,t.u_dash_image),u_gradient_image:new o.Uniform1i(l,t.u_gradient_image),u_image_height:new o.Uniform1f(l,t.u_image_height),u_texsize:new o.Uniform2f(l,t.u_texsize),u_scale:new o.Uniform3f(l,t.u_scale),u_mix:new o.Uniform1f(l,t.u_mix),u_alpha_discard_threshold:new o.Uniform1f(l,t.u_alpha_discard_threshold),u_trim_offset:new o.Uniform2f(l,t.u_trim_offset)}),linePattern:(l,t)=>({u_matrix:new o.UniformMatrix4f(l,t.u_matrix),u_texsize:new o.Uniform2f(l,t.u_texsize),u_pixels_to_tile_units:new o.UniformMatrix2f(l,t.u_pixels_to_tile_units),u_device_pixel_ratio:new o.Uniform1f(l,t.u_device_pixel_ratio),u_image:new o.Uniform1i(l,t.u_image),u_units_to_pixels:new o.Uniform2f(l,t.u_units_to_pixels),u_scale:new o.Uniform3f(l,t.u_scale),u_fade:new o.Uniform1f(l,t.u_fade),u_alpha_discard_threshold:new o.Uniform1f(l,t.u_alpha_discard_threshold)}),raster:(l,t)=>({u_matrix:new o.UniformMatrix4f(l,t.u_matrix),u_tl_parent:new o.Uniform2f(l,t.u_tl_parent),u_scale_parent:new o.Uniform1f(l,t.u_scale_parent),u_fade_t:new o.Uniform1f(l,t.u_fade_t),u_opacity:new o.Uniform1f(l,t.u_opacity),u_image0:new o.Uniform1i(l,t.u_image0),u_image1:new o.Uniform1i(l,t.u_image1),u_brightness_low:new o.Uniform1f(l,t.u_brightness_low),u_brightness_high:new o.Uniform1f(l,t.u_brightness_high),u_saturation_factor:new o.Uniform1f(l,t.u_saturation_factor),u_contrast_factor:new o.Uniform1f(l,t.u_contrast_factor),u_spin_weights:new o.Uniform3f(l,t.u_spin_weights),u_perspective_transform:new o.Uniform2f(l,t.u_perspective_transform)}),symbolIcon:(l,t)=>({u_is_size_zoom_constant:new o.Uniform1i(l,t.u_is_size_zoom_constant),u_is_size_feature_constant:new o.Uniform1i(l,t.u_is_size_feature_constant),u_size_t:new o.Uniform1f(l,t.u_size_t),u_size:new o.Uniform1f(l,t.u_size),u_camera_to_center_distance:new o.Uniform1f(l,t.u_camera_to_center_distance),u_rotate_symbol:new o.Uniform1i(l,t.u_rotate_symbol),u_aspect_ratio:new o.Uniform1f(l,t.u_aspect_ratio),u_fade_change:new o.Uniform1f(l,t.u_fade_change),u_matrix:new o.UniformMatrix4f(l,t.u_matrix),u_label_plane_matrix:new o.UniformMatrix4f(l,t.u_label_plane_matrix),u_coord_matrix:new o.UniformMatrix4f(l,t.u_coord_matrix),u_is_text:new o.Uniform1i(l,t.u_is_text),u_pitch_with_map:new o.Uniform1i(l,t.u_pitch_with_map),u_texsize:new o.Uniform2f(l,t.u_texsize),u_tile_id:new o.Uniform3f(l,t.u_tile_id),u_zoom_transition:new o.Uniform1f(l,t.u_zoom_transition),u_inv_rot_matrix:new o.UniformMatrix4f(l,t.u_inv_rot_matrix),u_merc_center:new o.Uniform2f(l,t.u_merc_center),u_camera_forward:new o.Uniform3f(l,t.u_camera_forward),u_tile_matrix:new o.UniformMatrix4f(l,t.u_tile_matrix),u_up_vector:new o.Uniform3f(l,t.u_up_vector),u_ecef_origin:new o.Uniform3f(l,t.u_ecef_origin),u_texture:new o.Uniform1i(l,t.u_texture)}),symbolSDF:(l,t)=>({u_is_size_zoom_constant:new o.Uniform1i(l,t.u_is_size_zoom_constant),u_is_size_feature_constant:new o.Uniform1i(l,t.u_is_size_feature_constant),u_size_t:new o.Uniform1f(l,t.u_size_t),u_size:new o.Uniform1f(l,t.u_size),u_camera_to_center_distance:new o.Uniform1f(l,t.u_camera_to_center_distance),u_rotate_symbol:new o.Uniform1i(l,t.u_rotate_symbol),u_aspect_ratio:new o.Uniform1f(l,t.u_aspect_ratio),u_fade_change:new o.Uniform1f(l,t.u_fade_change),u_matrix:new o.UniformMatrix4f(l,t.u_matrix),u_label_plane_matrix:new o.UniformMatrix4f(l,t.u_label_plane_matrix),u_coord_matrix:new o.UniformMatrix4f(l,t.u_coord_matrix),u_is_text:new o.Uniform1i(l,t.u_is_text),u_pitch_with_map:new o.Uniform1i(l,t.u_pitch_with_map),u_texsize:new o.Uniform2f(l,t.u_texsize),u_texture:new o.Uniform1i(l,t.u_texture),u_gamma_scale:new o.Uniform1f(l,t.u_gamma_scale),u_device_pixel_ratio:new o.Uniform1f(l,t.u_device_pixel_ratio),u_tile_id:new o.Uniform3f(l,t.u_tile_id),u_zoom_transition:new o.Uniform1f(l,t.u_zoom_transition),u_inv_rot_matrix:new o.UniformMatrix4f(l,t.u_inv_rot_matrix),u_merc_center:new o.Uniform2f(l,t.u_merc_center),u_camera_forward:new o.Uniform3f(l,t.u_camera_forward),u_tile_matrix:new o.UniformMatrix4f(l,t.u_tile_matrix),u_up_vector:new o.Uniform3f(l,t.u_up_vector),u_ecef_origin:new o.Uniform3f(l,t.u_ecef_origin),u_is_halo:new o.Uniform1i(l,t.u_is_halo)}),symbolTextAndIcon:(l,t)=>({u_is_size_zoom_constant:new o.Uniform1i(l,t.u_is_size_zoom_constant),u_is_size_feature_constant:new o.Uniform1i(l,t.u_is_size_feature_constant),u_size_t:new o.Uniform1f(l,t.u_size_t),u_size:new o.Uniform1f(l,t.u_size),u_camera_to_center_distance:new o.Uniform1f(l,t.u_camera_to_center_distance),u_rotate_symbol:new o.Uniform1i(l,t.u_rotate_symbol),u_aspect_ratio:new o.Uniform1f(l,t.u_aspect_ratio),u_fade_change:new o.Uniform1f(l,t.u_fade_change),u_matrix:new o.UniformMatrix4f(l,t.u_matrix),u_label_plane_matrix:new o.UniformMatrix4f(l,t.u_label_plane_matrix),u_coord_matrix:new o.UniformMatrix4f(l,t.u_coord_matrix),u_is_text:new o.Uniform1i(l,t.u_is_text),u_pitch_with_map:new o.Uniform1i(l,t.u_pitch_with_map),u_texsize:new o.Uniform2f(l,t.u_texsize),u_texsize_icon:new o.Uniform2f(l,t.u_texsize_icon),u_texture:new o.Uniform1i(l,t.u_texture),u_texture_icon:new o.Uniform1i(l,t.u_texture_icon),u_gamma_scale:new o.Uniform1f(l,t.u_gamma_scale),u_device_pixel_ratio:new o.Uniform1f(l,t.u_device_pixel_ratio),u_is_halo:new o.Uniform1i(l,t.u_is_halo)}),background:(l,t)=>({u_matrix:new o.UniformMatrix4f(l,t.u_matrix),u_opacity:new o.Uniform1f(l,t.u_opacity),u_color:new o.UniformColor(l,t.u_color)}),backgroundPattern:(l,t)=>({u_matrix:new o.UniformMatrix4f(l,t.u_matrix),u_opacity:new o.Uniform1f(l,t.u_opacity),u_image:new o.Uniform1i(l,t.u_image),u_pattern_tl_a:new o.Uniform2f(l,t.u_pattern_tl_a),u_pattern_br_a:new o.Uniform2f(l,t.u_pattern_br_a),u_pattern_tl_b:new o.Uniform2f(l,t.u_pattern_tl_b),u_pattern_br_b:new o.Uniform2f(l,t.u_pattern_br_b),u_texsize:new o.Uniform2f(l,t.u_texsize),u_mix:new o.Uniform1f(l,t.u_mix),u_pattern_size_a:new o.Uniform2f(l,t.u_pattern_size_a),u_pattern_size_b:new o.Uniform2f(l,t.u_pattern_size_b),u_scale_a:new o.Uniform1f(l,t.u_scale_a),u_scale_b:new o.Uniform1f(l,t.u_scale_b),u_pixel_coord_upper:new o.Uniform2f(l,t.u_pixel_coord_upper),u_pixel_coord_lower:new o.Uniform2f(l,t.u_pixel_coord_lower),u_tile_units_to_pixels:new o.Uniform1f(l,t.u_tile_units_to_pixels)}),terrainRaster:ha,terrainDepth:ha,skybox:(l,t)=>({u_matrix:new o.UniformMatrix4f(l,t.u_matrix),u_sun_direction:new o.Uniform3f(l,t.u_sun_direction),u_cubemap:new o.Uniform1i(l,t.u_cubemap),u_opacity:new o.Uniform1f(l,t.u_opacity),u_temporal_offset:new o.Uniform1f(l,t.u_temporal_offset)}),skyboxGradient:(l,t)=>({u_matrix:new o.UniformMatrix4f(l,t.u_matrix),u_color_ramp:new o.Uniform1i(l,t.u_color_ramp),u_center_direction:new o.Uniform3f(l,t.u_center_direction),u_radius:new o.Uniform1f(l,t.u_radius),u_opacity:new o.Uniform1f(l,t.u_opacity),u_temporal_offset:new o.Uniform1f(l,t.u_temporal_offset)}),skyboxCapture:(l,t)=>({u_matrix_3f:new o.UniformMatrix3f(l,t.u_matrix_3f),u_sun_direction:new o.Uniform3f(l,t.u_sun_direction),u_sun_intensity:new o.Uniform1f(l,t.u_sun_intensity),u_color_tint_r:new o.Uniform4f(l,t.u_color_tint_r),u_color_tint_m:new o.Uniform4f(l,t.u_color_tint_m),u_luminance:new o.Uniform1f(l,t.u_luminance)}),globeRaster:(l,t)=>({u_proj_matrix:new o.UniformMatrix4f(l,t.u_proj_matrix),u_globe_matrix:new o.UniformMatrix4f(l,t.u_globe_matrix),u_normalize_matrix:new o.UniformMatrix4f(l,t.u_normalize_matrix),u_merc_matrix:new o.UniformMatrix4f(l,t.u_merc_matrix),u_zoom_transition:new o.Uniform1f(l,t.u_zoom_transition),u_merc_center:new o.Uniform2f(l,t.u_merc_center),u_image0:new o.Uniform1i(l,t.u_image0),u_grid_matrix:new o.UniformMatrix3f(l,t.u_grid_matrix),u_frustum_tl:new o.Uniform3f(l,t.u_frustum_tl),u_frustum_tr:new o.Uniform3f(l,t.u_frustum_tr),u_frustum_br:new o.Uniform3f(l,t.u_frustum_br),u_frustum_bl:new o.Uniform3f(l,t.u_frustum_bl),u_globe_pos:new o.Uniform3f(l,t.u_globe_pos),u_globe_radius:new o.Uniform1f(l,t.u_globe_radius),u_viewport:new o.Uniform2f(l,t.u_viewport)}),globeAtmosphere:(l,t)=>({u_frustum_tl:new o.Uniform3f(l,t.u_frustum_tl),u_frustum_tr:new o.Uniform3f(l,t.u_frustum_tr),u_frustum_br:new o.Uniform3f(l,t.u_frustum_br),u_frustum_bl:new o.Uniform3f(l,t.u_frustum_bl),u_horizon:new o.Uniform1f(l,t.u_horizon),u_transition:new o.Uniform1f(l,t.u_transition),u_fadeout_range:new o.Uniform1f(l,t.u_fadeout_range),u_color:new o.Uniform4f(l,t.u_color),u_high_color:new o.Uniform4f(l,t.u_high_color),u_space_color:new o.Uniform4f(l,t.u_space_color),u_star_intensity:new o.Uniform1f(l,t.u_star_intensity),u_star_density:new o.Uniform1f(l,t.u_star_density),u_star_size:new o.Uniform1f(l,t.u_star_size),u_temporal_offset:new o.Uniform1f(l,t.u_temporal_offset),u_horizon_angle:new o.Uniform1f(l,t.u_horizon_angle),u_rotation_matrix:new o.UniformMatrix4f(l,t.u_rotation_matrix)})},_a;function sh(l,t,s,p,f,_,b){let w=l.context,T=w.gl,A=l.transform,I=l.useProgram("collisionBox"),L=[],O=0,V=0;for(let ie=0;ie<p.length;ie++){let K=p[ie],Q=t.getTile(K),ae=Q.getBucket(s);if(!ae)continue;let ye=mr(K,ae,A),be=ye;f[0]===0&&f[1]===0||(be=l.translatePosMatrix(ye,Q,f,_));let xe=b?ae.textCollisionBox:ae.iconCollisionBox,_e=ae.collisionCircleArray;if(_e.length>0){let te=o.create(),Ie=be;o.mul(te,ae.placementInvProjMatrix,A.glCoordMatrix),o.mul(te,te,ae.placementViewportMatrix),L.push({circleArray:_e,circleOffset:V,transform:Ie,invTransform:te,projection:ae.getProjection()}),O+=_e.length/4,V=O}xe&&(l.terrain&&l.terrain.setupElevationDraw(Q,I),I.draw(w,T.LINES,o.DepthMode.disabled,o.StencilMode.disabled,l.colorModeForRenderPass(),o.CullFaceMode.disabled,Tl(be,A,Q,ae.getProjection()),s.id,xe.layoutVertexBuffer,xe.indexBuffer,xe.segments,null,A.zoom,null,xe.collisionVertexBuffer,xe.collisionVertexBufferExt))}if(!b||!L.length)return;let N=l.useProgram("collisionCircle"),j=new o.StructArrayLayout2f1f2i16;j.resize(4*O),j._trim();let J=0;for(let ie of L)for(let K=0;K<ie.circleArray.length/4;K++){let Q=4*K,ae=ie.circleArray[Q+0],ye=ie.circleArray[Q+1],be=ie.circleArray[Q+2],xe=ie.circleArray[Q+3];j.emplace(J++,ae,ye,be,xe,0),j.emplace(J++,ae,ye,be,xe,1),j.emplace(J++,ae,ye,be,xe,2),j.emplace(J++,ae,ye,be,xe,3)}(!_a||_a.length<2*O)&&(_a=function(ie){let K=2*ie,Q=new o.StructArrayLayout3ui6;Q.resize(K),Q._trim();for(let ae=0;ae<K;ae++){let ye=6*ae;Q.uint16[ye+0]=4*ae+0,Q.uint16[ye+1]=4*ae+1,Q.uint16[ye+2]=4*ae+2,Q.uint16[ye+3]=4*ae+2,Q.uint16[ye+4]=4*ae+3,Q.uint16[ye+5]=4*ae+0}return Q}(O));let U=w.createIndexBuffer(_a,!0),$=w.createVertexBuffer(j,o.collisionCircleLayout.members,!0);for(let ie of L){let K={u_matrix:ie.transform,u_inv_matrix:ie.invTransform,u_camera_to_center_distance:(q=A).getCameraToCenterDistance(ie.projection),u_viewport_size:[q.width,q.height]};N.draw(w,T.TRIANGLES,o.DepthMode.disabled,o.StencilMode.disabled,l.colorModeForRenderPass(),o.CullFaceMode.disabled,K,s.id,$,U,o.SegmentVector.simpleSegment(0,2*ie.circleOffset,ie.circleArray.length,ie.circleArray.length/2),null,A.zoom)}var q;$.destroy(),U.destroy()}let ah=o.create();function mp(l,t,s,p,f,_){let{horizontalAlign:b,verticalAlign:w}=o.getAnchorAlignment(l),T=-(b-.5)*t,A=-(w-.5)*s,I=o.evaluateVariableOffset(l,p);return new o.pointGeometry((T/f+I[0])*_,(A/f+I[1])*_)}function gp(l,t,s,p,f,_,b,w,T,A,I){let L=l.text.placedSymbolArray,O=l.text.dynamicLayoutVertexArray,V=l.icon.dynamicLayoutVertexArray,N={},j=ia(w,l.getProjection(),_),J=_.elevation,U=l.getProjection().upVectorScale(w.canonical,_.center.lat,_.worldSize);O.clear();for(let $=0;$<L.length;$++){let q=L.get($),ie=l.allowVerticalPlacement&&!q.placedOrientation,K=q.hidden||!q.crossTileID||ie?null:p[q.crossTileID];if(K){let Q=new o.pointGeometry(q.tileAnchorX,q.tileAnchorY),ae=l.getProjection().upVector(w.canonical,Q.x,Q.y),ye=J?J.getAtTileOffset(w,Q.x,Q.y):0,be=rn([q.projectedAnchorX+ye*ae[0]*U.metersToTile,q.projectedAnchorY+ye*ae[1]*U.metersToTile,q.projectedAnchorZ+ye*ae[2]*U.metersToTile],s?j:b),xe=so(_.getCameraToCenterDistance(l.getProjection()),be.signedDistanceFromCamera),_e=f.evaluateSizeForFeature(l.textSizeData,A,q)*xe/o.ONE_EM;s&&(_e*=l.tilePixelRatio/T);let{width:te,height:Ie,anchor:Me,textOffset:Ve,textScale:Te}=K,tt=mp(Me,te,Ie,Ve,Te,_e),Ue;if(s){let Fe=Q.add(tt),{x:Oe,y:ht,z:rt}=l.getProjection().projectTilePoint(Fe.x,Fe.y,w.canonical);Ue=rn([Oe+ye*ae[0]*U.metersToTile,ht+ye*ae[1]*U.metersToTile,rt+ye*ae[2]*U.metersToTile],b).point}else{let Fe=t?tt.rotate(-_.angle):tt;Ue=[be.point[0]+Fe.x,be.point[1]+Fe.y,0]}let je=l.allowVerticalPlacement&&q.placedOrientation===o.WritingMode.vertical?Math.PI/2:0;for(let Fe=0;Fe<q.numGlyphs;Fe++)o.addDynamicAttributes(O,Ue[0],Ue[1],Ue[2],je);I&&q.associatedIconIndex>=0&&(N[q.associatedIconIndex]={shiftedAnchor:Ue,angle:je})}else bi(q.numGlyphs,O)}if(I){V.clear();let $=l.icon.placedSymbolArray;for(let q=0;q<$.length;q++){let ie=$.get(q);if(ie.hidden)bi(ie.numGlyphs,V);else{let K=N[q];if(K)for(let Q=0;Q<ie.numGlyphs;Q++)o.addDynamicAttributes(V,K.shiftedAnchor[0],K.shiftedAnchor[1],K.shiftedAnchor[2],K.angle);else bi(ie.numGlyphs,V)}}l.icon.dynamicLayoutVertexBuffer.updateData(V)}l.text.dynamicLayoutVertexBuffer.updateData(O)}function Ml(l,t,s){return s.iconsInText&&t?"symbolTextAndIcon":l?"symbolSDF":"symbolIcon"}function ya(l,t,s,p,f,_,b,w,T,A,I,L){let O=l.context,V=O.gl,N=l.transform,j=w==="map",J=T==="map",U=j&&s.layout.get("symbol-placement")!=="point",$=j&&!J&&!U,q=s.layout.get("symbol-sort-key").constantOr(1)!==void 0,ie=!1,K=l.depthModeForSublayer(0,o.DepthMode.ReadOnly),Q=[o.mercatorXfromLng(N.center.lng),o.mercatorYfromLat(N.center.lat)],ae=s.layout.get("text-variable-anchor"),ye=N.projection.name==="globe",be=[],xe=[0,-1,0],_e=xe;!ye&&!N.mercatorFromTransition||j||(_e=function(te){let Ie=te._camera.getWorldToCamera(te.worldSize,1),Me=o.multiply([],Ie,te.globeMatrix);o.invert(Me,Me);let Ve=[0,0,0],Te=[0,1,0,0];return o.transformMat4$1(Te,Te,Me),Ve[0]=Te[0],Ve[1]=Te[1],Ve[2]=Te[2],o.normalize(Ve,Ve),Ve}(N));for(let te of p){let Ie=t.getTile(te),Me=Ie.getBucket(s);if(!Me||Me.projection.name==="mercator"&&ye)continue;let Ve=f?Me.text:Me.icon;if(!Ve||Me.fullyClipped||!Ve.segments.get().length)continue;let Te=Ve.programConfigurations.get(s.id),tt=f||Me.sdfIcons,Ue=f?Me.textSizeData:Me.iconSizeData,je=J||N.pitch!==0,Fe=o.evaluateSizeForZoom(Ue,N.zoom),Oe,ht,rt,mt,et=[0,0],pt=null;if(f){if(ht=Ie.glyphAtlasTexture,rt=V.LINEAR,Oe=Ie.glyphAtlasTexture.size,Me.iconsInText){et=Ie.imageAtlasTexture.size,pt=Ie.imageAtlasTexture;let yi=Ue.kind==="composite"||Ue.kind==="camera";mt=je||l.options.rotating||l.options.zooming||yi?V.LINEAR:V.NEAREST}}else{let yi=s.layout.get("icon-size").constantOr(0)!==1||Me.iconsNeedLinear;ht=Ie.imageAtlasTexture,rt=tt||l.options.rotating||l.options.zooming||yi||je?V.LINEAR:V.NEAREST,Oe=Ie.imageAtlasTexture.size}let Ot=Me.projection.name==="globe",Gt=Ot?_e:xe,di=Ot?o.globeToMercatorTransition(N.zoom):0,Zt=ia(te,Me.getProjection(),N),nr=N.calculatePixelsToTileUnitsMatrix(Ie),jr=yt(Zt,Ie.tileID.canonical,J,j,N,Me.getProjection(),nr),an=l.terrain&&J&&U?o.invert(o.create(),jr):ah,Jt=Dn(Zt,Ie.tileID.canonical,J,j,N,Me.getProjection(),nr),ei=ae&&Me.hasTextData(),jt=s.layout.get("icon-text-fit")!=="none"&&ei&&Me.hasIconData();if(U){let yi=N.elevation,Ur=yi?yi.getAtTileOffsetFunc(te,N.center.lat,N.worldSize,Me.getProjection()):ws=>[0,0,0],ln=kr(Zt,Ie.tileID.canonical,J,j,N,Me.getProjection(),nr);dr(Me,Zt,l,f,ln,Jt,J,A,Ur,te)}let _i=U||f&&ae||jt,Pi=l.translatePosMatrix(Zt,Ie,_,b),Mt=_i?ah:jr,qi=l.translatePosMatrix(Jt,Ie,_,b,!0),Gn=Me.getProjection().createInversionMatrix(N,te.canonical),Mr=[];l.terrain&&J&&Mr.push("PITCH_WITH_MAP_TERRAIN"),Ot&&Mr.push("PROJECTION_GLOBE_VIEW"),_i&&Mr.push("PROJECTED_POS_ON_VIEWPORT");let To=tt&&s.paint.get(f?"text-halo-width":"icon-halo-width").constantOr(1)!==0,Co;Co=tt?Me.iconsInText?nh(Ue.kind,Fe,$,J,l,Pi,Mt,qi,Oe,et,te,di,Q,Gn,Gt,Me.getProjection()):rh(Ue.kind,Fe,$,J,l,Pi,Mt,qi,f,Oe,!0,te,di,Q,Gn,Gt,Me.getProjection()):hs(Ue.kind,Fe,$,J,l,Pi,Mt,qi,f,Oe,te,di,Q,Gn,Gt,Me.getProjection());let _n={program:l.useProgram(Ml(tt,f,Me),Te,Mr),buffers:Ve,uniformValues:Co,atlasTexture:ht,atlasTextureIcon:pt,atlasInterpolation:rt,atlasInterpolationIcon:mt,isSDF:tt,hasHalo:To,tile:Ie,labelPlaneMatrixInv:an};if(q&&Me.canOverlap){ie=!0;let yi=Ve.segments.get();for(let Ur of yi)be.push({segments:new o.SegmentVector([Ur]),sortKey:Ur.sortKey,state:_n})}else be.push({segments:Ve.segments,sortKey:0,state:_n})}ie&&be.sort((te,Ie)=>te.sortKey-Ie.sortKey);for(let te of be){let Ie=te.state;if(l.terrain&&l.terrain.setupElevationDraw(Ie.tile,Ie.program,{useDepthForOcclusion:!ye,labelPlaneMatrixInv:Ie.labelPlaneMatrixInv}),O.activeTexture.set(V.TEXTURE0),Ie.atlasTexture.bind(Ie.atlasInterpolation,V.CLAMP_TO_EDGE),Ie.atlasTextureIcon&&(O.activeTexture.set(V.TEXTURE1),Ie.atlasTextureIcon&&Ie.atlasTextureIcon.bind(Ie.atlasInterpolationIcon,V.CLAMP_TO_EDGE)),Ie.isSDF){let Me=Ie.uniformValues;Ie.hasHalo&&(Me.u_is_halo=1,Il(Ie.buffers,te.segments,s,l,Ie.program,K,I,L,Me)),Me.u_is_halo=0}Il(Ie.buffers,te.segments,s,l,Ie.program,K,I,L,Ie.uniformValues)}}function Il(l,t,s,p,f,_,b,w,T){let A=p.context;f.draw(A,A.gl.TRIANGLES,_,b,w,o.CullFaceMode.disabled,T,s.id,l.layoutVertexBuffer,l.indexBuffer,t,s.paint,p.transform.zoom,l.programConfigurations.get(s.id),l.dynamicLayoutVertexBuffer,l.opacityVertexBuffer,l.globeExtVertexBuffer)}function zl(l,t,s,p,f,_,b){let w=l.context.gl,T=s.paint.get("fill-pattern"),A=T&&T.constantOr(1),I=s.getCrossfadeParameters(),L,O,V,N,j;b?(O=A&&!s.getPaintProperty("fill-outline-color")?"fillOutlinePattern":"fillOutline",L=w.LINES):(O=A?"fillPattern":"fill",L=w.TRIANGLES);for(let J of p){let U=t.getTile(J);if(A&&!U.patternsLoaded())continue;let $=U.getBucket(s);if(!$)continue;l.prepareDrawTile();let q=$.programConfigurations.get(s.id),ie=l.useProgram(O,q);A&&(l.context.activeTexture.set(w.TEXTURE0),U.imageAtlasTexture.bind(w.LINEAR,w.CLAMP_TO_EDGE),q.updatePaintBuffers(I));let K=T.constantOr(null);if(K&&U.imageAtlas){let ae=U.imageAtlas,ye=ae.patternPositions[K.to.toString()],be=ae.patternPositions[K.from.toString()];ye&&be&&q.setConstantPatternPositions(ye,be)}let Q=l.translatePosMatrix(J.projMatrix,U,s.paint.get("fill-translate"),s.paint.get("fill-translate-anchor"));if(b){N=$.indexBuffer2,j=$.segments2;let ae=l.terrain&&l.terrain.renderingToTexture?l.terrain.drapeBufferSize:[w.drawingBufferWidth,w.drawingBufferHeight];V=O==="fillOutlinePattern"&&A?wl(Q,l,I,U,ae):ma(Q,ae)}else N=$.indexBuffer,j=$.segments,V=A?bl(Q,l,I,U):mo(Q);l.prepareDrawProgram(l.context,ie,J.toUnwrapped()),ie.draw(l.context,L,f,l.stencilModeForClipping(J),_,o.CullFaceMode.disabled,V,s.id,$.layoutVertexBuffer,N,j,s.paint,l.transform.zoom,q)}}function xa(l,t,s,p,f,_,b){let w=l.context,T=w.gl,A=l.transform,I=s.paint.get("fill-extrusion-pattern"),L=I.constantOr(1),O=s.getCrossfadeParameters(),V=s.paint.get("fill-extrusion-opacity"),N=A.projection.name==="globe"?o.fillExtrusionHeightLift():0,j=A.projection.name==="globe",J=j?o.globeToMercatorTransition(A.zoom):0,U=[o.mercatorXfromLng(A.center.lng),o.mercatorYfromLat(A.center.lat)],$=[];j&&$.push("PROJECTION_GLOBE_VIEW");for(let q of p){let ie=t.getTile(q),K=ie.getBucket(s);if(!K||K.projection.name!==A.projection.name)continue;let Q=K.programConfigurations.get(s.id),ae=l.useProgram(L?"fillExtrusionPattern":"fillExtrusion",Q,$);if(l.terrain){let Ie=l.terrain;if(l.style.terrainSetForDrapingOnly())Ie.setupElevationDraw(ie,ae,{useMeterToDem:!0});else{if(!K.enableTerrain)continue;if(Ie.setupElevationDraw(ie,ae,{useMeterToDem:!0}),Pl(w,t,q,K,s,Ie),!K.centroidVertexBuffer){let Me=ae.attributes.a_centroid_pos;Me!==void 0&&T.vertexAttrib2f(Me,0,0)}}}L&&(l.context.activeTexture.set(T.TEXTURE0),ie.imageAtlasTexture.bind(T.LINEAR,T.CLAMP_TO_EDGE),Q.updatePaintBuffers(O));let ye=I.constantOr(null);if(ye&&ie.imageAtlas){let Ie=ie.imageAtlas,Me=Ie.patternPositions[ye.to.toString()],Ve=Ie.patternPositions[ye.from.toString()];Me&&Ve&&Q.setConstantPatternPositions(Me,Ve)}let be=l.translatePosMatrix(q.projMatrix,ie,s.paint.get("fill-extrusion-translate"),s.paint.get("fill-extrusion-translate-anchor")),xe=A.projection.createInversionMatrix(A,q.canonical),_e=s.paint.get("fill-extrusion-vertical-gradient"),te=L?ls(be,l,_e,V,q,O,ie,N,J,U,xe):Qc(be,l,_e,V,q,N,J,U,xe);l.prepareDrawProgram(w,ae,q.toUnwrapped()),ae.draw(w,w.gl.TRIANGLES,f,_,b,o.CullFaceMode.backCCW,te,s.id,K.layoutVertexBuffer,K.indexBuffer,K.segments,s.paint,l.transform.zoom,Q,l.terrain?K.centroidVertexBuffer:null,j?K.layoutVertexExtBuffer:null)}}function Pl(l,t,s,p,f,_){let b=[U=>{let $=U.canonical.x-1,q=U.wrap;return $<0&&($=(1<<U.canonical.z)-1,q--),new o.OverscaledTileID(U.overscaledZ,q,U.canonical.z,$,U.canonical.y)},U=>{let $=U.canonical.x+1,q=U.wrap;return $===1<<U.canonical.z&&($=0,q++),new o.OverscaledTileID(U.overscaledZ,q,U.canonical.z,$,U.canonical.y)},U=>new o.OverscaledTileID(U.overscaledZ,U.wrap,U.canonical.z,U.canonical.x,(U.canonical.y===0?1<<U.canonical.z:U.canonical.y)-1),U=>new o.OverscaledTileID(U.overscaledZ,U.wrap,U.canonical.z,U.canonical.x,U.canonical.y===(1<<U.canonical.z)-1?0:U.canonical.y+1)],w=U=>{let $=t.getSource().minzoom,q=K=>{let Q=t.getTileByID(K);if(Q&&Q.hasData())return Q.getBucket(f)},ie=[0,-1,1];for(let K of ie){if(U.overscaledZ+K<$)continue;let Q=q(U.calculateScaledKey(U.overscaledZ+K));if(Q)return Q}},T=[0,0,0],A=(U,$)=>(T[0]=Math.min(U.min.y,$.min.y),T[1]=Math.max(U.max.y,$.max.y),T[2]=o.EXTENT-$.min.x>U.max.x?$.min.x-o.EXTENT:U.max.x,T),I=(U,$)=>(T[0]=Math.min(U.min.x,$.min.x),T[1]=Math.max(U.max.x,$.max.x),T[2]=o.EXTENT-$.min.y>U.max.y?$.min.y-o.EXTENT:U.max.y,T),L=[(U,$)=>A(U,$),(U,$)=>A($,U),(U,$)=>I(U,$),(U,$)=>I($,U)],O=new o.pointGeometry(0,0),V,N,j,J=(U,$,q,ie,K)=>{let Q=[[ie?q:U,ie?U:q,0],[ie?q:$,ie?$:q,0]],ae=K<0?o.EXTENT+K:K,ye=[ie?ae:(U+$)/2,ie?(U+$)/2:ae,0];return q===0&&K<0||q!==0&&K>0?_.getForTilePoints(j,[ye],!0,N):Q.push(ye),_.getForTilePoints(s,Q,!0,V),Math.max(Q[0][2],Q[1][2],ye[2])/_.exaggeration()};for(let U=0;U<4;U++){let $=(U<2?1:5)-U,q=p.borders[U];if(q.length===0)continue;let ie=j=b[U](s),K=w(ie);if(!(K&&K instanceof o.FillExtrusionBucket&&K.enableTerrain)||p.borderDoneWithNeighborZ[U]===K.canonical.z&&K.borderDoneWithNeighborZ[$]===p.canonical.z||(N=_.findDEMTileFor(ie),!N||!N.dem))continue;if(!V){let be=_.findDEMTileFor(s);if(!be||!be.dem)return;V=be}let Q=K.borders[$],ae=0,ye=K.borderDoneWithNeighborZ[$]!==p.canonical.z;if(p.canonical.z===K.canonical.z){for(let be=0;be<q.length;be++){let xe=p.featuresOnBorder[q[be]],_e=xe.borders[U],te;for(;ae<Q.length&&(te=K.featuresOnBorder[Q[ae]],!(te.borders[$][1]>_e[0]+3));)ye&&K.encodeCentroid(void 0,te,!1),ae++;if(te&&ae<Q.length){let Ie=ae,Me=0;for(;!(te.borders[$][0]>_e[1]-3)&&(Me++,++ae!==Q.length);)te=K.featuresOnBorder[Q[ae]];if(te=K.featuresOnBorder[Q[Ie]],xe.intersectsCount()>1||te.intersectsCount()>1||Me!==1){Me!==1&&(ae=Ie),p.encodeCentroid(void 0,xe,!1),ye&&K.encodeCentroid(void 0,te,!1);continue}let Ve=L[U](xe,te),Te=U%2?o.EXTENT-1:0;O.x=J(Ve[0],Math.min(o.EXTENT-1,Ve[1]),Te,U<2,Ve[2]),O.y=0,p.encodeCentroid(O,xe,!1),ye&&K.encodeCentroid(O,te,!1)}else p.encodeCentroid(void 0,xe,!1)}p.borderDoneWithNeighborZ[U]=K.canonical.z,p.needsCentroidUpdate=!0,ye&&(K.borderDoneWithNeighborZ[$]=p.canonical.z,K.needsCentroidUpdate=!0)}else{for(let be of q)p.encodeCentroid(void 0,p.featuresOnBorder[be],!1);if(ye){for(let be of Q)K.encodeCentroid(void 0,K.featuresOnBorder[be],!1);K.borderDoneWithNeighborZ[$]=p.canonical.z,K.needsCentroidUpdate=!0}p.borderDoneWithNeighborZ[U]=K.canonical.z,p.needsCentroidUpdate=!0}}(p.needsCentroidUpdate||!p.centroidVertexBuffer&&p.centroidVertexArray.length!==0)&&p.uploadCentroid(l)}let Fn=new o.Color(1,0,0,1),us=new o.Color(0,1,0,1),lh=new o.Color(0,0,1,1),_o=new o.Color(1,0,1,1),yo=new o.Color(0,1,1,1);function Dl(l,t,s,p){Dt(l,0,t+s/2,l.transform.width,s,p)}function va(l,t,s,p){Dt(l,t-s/2,0,s,l.transform.height,p)}function Dt(l,t,s,p,f,_){let b=l.context,w=b.gl;w.enable(w.SCISSOR_TEST),w.scissor(t*o.exported.devicePixelRatio,s*o.exported.devicePixelRatio,p*o.exported.devicePixelRatio,f*o.exported.devicePixelRatio),b.clear({color:_}),w.disable(w.SCISSOR_TEST)}function ba(l,t,s){let p=l.context,f=p.gl,_=l.transform.projection.name==="globe",b=s.projMatrix,w=l.useProgram("debug",null,_?["PROJECTION_GLOBE_VIEW"]:null),T=t.getTileByID(s.key);l.terrain&&l.terrain.setupElevationDraw(T,w);let A=o.DepthMode.disabled,I=o.StencilMode.disabled,L=l.colorModeForRenderPass(),O="$debug";p.activeTexture.set(f.TEXTURE0),l.emptyTexture.bind(f.LINEAR,f.CLAMP_TO_EDGE),_?T._makeGlobeTileDebugBuffers(l.context,l.transform.projection):T._makeDebugTileBoundsBuffers(l.context,l.transform.projection);let V=T._tileDebugBuffer||l.debugBuffer,N=T._tileDebugIndexBuffer||l.debugIndexBuffer,j=T._tileDebugSegments||l.debugSegments;w.draw(p,f.LINE_STRIP,A,I,L,o.CullFaceMode.disabled,Cl(b,o.Color.red),O,V,N,j,null,null,null,T._globeTileDebugBorderBuffer);let J=T.latestRawTileData,U=Math.floor((J&&J.byteLength||0)/1024),$=t.getTile(s).tileSize,q=512/Math.min($,512)*(s.overscaledZ/l.transform.zoom)*.5,ie=s.canonical.toString();s.overscaledZ!==s.canonical.z&&(ie+=` => ${s.overscaledZ}`),function(ye,be){ye.initDebugOverlayCanvas();let xe=ye.debugOverlayCanvas,_e=ye.context.gl,te=ye.debugOverlayCanvas.getContext("2d");te.clearRect(0,0,xe.width,xe.height),te.shadowColor="white",te.shadowBlur=2,te.lineWidth=1.5,te.strokeStyle="white",te.textBaseline="top",te.font="bold 36px Open Sans, sans-serif",te.fillText(be,5,5),te.strokeText(be,5,5),ye.debugOverlayTexture.update(xe),ye.debugOverlayTexture.bind(_e.LINEAR,_e.CLAMP_TO_EDGE)}(l,`${ie} ${U}kb`);let K=T._tileDebugTextBuffer||l.debugBuffer,Q=T._tileDebugTextIndexBuffer||l.quadTriangleIndexBuffer,ae=T._tileDebugTextSegments||l.debugSegments;w.draw(p,f.TRIANGLES,A,I,o.ColorMode.alphaBlended,o.CullFaceMode.disabled,Cl(b,o.Color.transparent,q),O,K,Q,ae,null,null,null,T._globeTileDebugTextBuffer)}let _p=o.createLayout([{name:"a_pos_3f",components:3,type:"Float32"}]),{members:ch}=_p;function gr(l,t,s,p){l.emplaceBack(t,s,p)}class hh{constructor(t){this.vertexArray=new o.StructArrayLayout3f12,this.indices=new o.StructArrayLayout3ui6,gr(this.vertexArray,-1,-1,1),gr(this.vertexArray,1,-1,1),gr(this.vertexArray,-1,1,1),gr(this.vertexArray,1,1,1),gr(this.vertexArray,-1,-1,-1),gr(this.vertexArray,1,-1,-1),gr(this.vertexArray,-1,1,-1),gr(this.vertexArray,1,1,-1),this.indices.emplaceBack(5,1,3),this.indices.emplaceBack(3,7,5),this.indices.emplaceBack(6,2,0),this.indices.emplaceBack(0,4,6),this.indices.emplaceBack(2,6,7),this.indices.emplaceBack(7,3,2),this.indices.emplaceBack(5,4,0),this.indices.emplaceBack(0,1,5),this.indices.emplaceBack(0,2,3),this.indices.emplaceBack(3,1,0),this.indices.emplaceBack(7,6,4),this.indices.emplaceBack(4,5,7),this.vertexBuffer=t.createVertexBuffer(this.vertexArray,ch),this.indexBuffer=t.createIndexBuffer(this.indices),this.segment=o.SegmentVector.simpleSegment(0,0,36,12)}}function xo(l,t,s,p,f,_){let b=l.gl,w=t.paint.get("sky-atmosphere-color"),T=t.paint.get("sky-atmosphere-halo-color"),A=t.paint.get("sky-atmosphere-sun-intensity"),I=((L,O,V,N,j)=>({u_matrix_3f:L,u_sun_direction:O,u_sun_intensity:V,u_color_tint_r:[N.r,N.g,N.b,N.a],u_color_tint_m:[j.r,j.g,j.b,j.a],u_luminance:5e-5}))(o.fromMat4(o.create$1(),p),f,A,w,T);b.framebufferTexture2D(b.FRAMEBUFFER,b.COLOR_ATTACHMENT0,b.TEXTURE_CUBE_MAP_POSITIVE_X+_,t.skyboxTexture,0),s.draw(l,b.TRIANGLES,o.DepthMode.disabled,o.StencilMode.disabled,o.ColorMode.unblended,o.CullFaceMode.frontCW,I,"skyboxCapture",t.skyboxGeometry.vertexBuffer,t.skyboxGeometry.indexBuffer,t.skyboxGeometry.segment)}let uh=o.createLayout([{type:"Float32",name:"a_pos",components:3},{type:"Float32",name:"a_uv",components:2}]);class yp{constructor(t){let s=new o.StructArrayLayout5f20;s.emplaceBack(-1,1,1,0,0),s.emplaceBack(1,1,1,1,0),s.emplaceBack(1,-1,1,1,1),s.emplaceBack(-1,-1,1,0,1);let p=new o.StructArrayLayout3ui6;p.emplaceBack(0,1,2),p.emplaceBack(2,3,0),this.vertexBuffer=t.createVertexBuffer(s,uh.members),this.indexBuffer=t.createIndexBuffer(p),this.segments=o.SegmentVector.simpleSegment(0,0,4,2)}destroy(){this.vertexBuffer.destroy(),this.indexBuffer.destroy(),this.segments.destroy()}}let wa={symbol:function(l,t,s,p,f){if(l.renderPass!=="translucent")return;let _=o.StencilMode.disabled,b=l.colorModeForRenderPass();s.layout.get("text-variable-anchor")&&function(w,T,A,I,L,O,V){let N=T.transform,j=L==="map",J=O==="map";for(let U of w){let $=I.getTile(U),q=$.getBucket(A);if(!q||!q.text||!q.text.segments.get().length)continue;let ie=o.evaluateSizeForZoom(q.textSizeData,N.zoom),K=ia(U,q.getProjection(),N),Q=N.calculatePixelsToTileUnitsMatrix($),ae=yt(K,$.tileID.canonical,J,j,N,q.getProjection(),Q),ye=A.layout.get("icon-text-fit")!=="none"&&q.hasIconData();if(ie){let be=Math.pow(2,N.zoom-$.tileID.overscaledZ);gp(q,j,J,V,o.symbolSize,N,ae,U,be,ie,ye)}}}(p,l,s,t,s.layout.get("text-rotation-alignment"),s.layout.get("text-pitch-alignment"),f),s.paint.get("icon-opacity").constantOr(1)!==0&&ya(l,t,s,p,!1,s.paint.get("icon-translate"),s.paint.get("icon-translate-anchor"),s.layout.get("icon-rotation-alignment"),s.layout.get("icon-pitch-alignment"),s.layout.get("icon-keep-upright"),_,b),s.paint.get("text-opacity").constantOr(1)!==0&&ya(l,t,s,p,!0,s.paint.get("text-translate"),s.paint.get("text-translate-anchor"),s.layout.get("text-rotation-alignment"),s.layout.get("text-pitch-alignment"),s.layout.get("text-keep-upright"),_,b),t.map.showCollisionBoxes&&(sh(l,t,s,p,s.paint.get("text-translate"),s.paint.get("text-translate-anchor"),!0),sh(l,t,s,p,s.paint.get("icon-translate"),s.paint.get("icon-translate-anchor"),!1))},circle:function(l,t,s,p){if(l.renderPass!=="translucent")return;let f=s.paint.get("circle-opacity"),_=s.paint.get("circle-stroke-width"),b=s.paint.get("circle-stroke-opacity"),w=s.layout.get("circle-sort-key").constantOr(1)!==void 0;if(f.constantOr(1)===0&&(_.constantOr(1)===0||b.constantOr(1)===0))return;let T=l.context,A=T.gl,I=l.transform,L=l.depthModeForSublayer(0,o.DepthMode.ReadOnly),O=o.StencilMode.disabled,V=l.colorModeForRenderPass(),N=I.projection.name==="globe",j=[o.mercatorXfromLng(I.center.lng),o.mercatorYfromLat(I.center.lat)],J=[];for(let $=0;$<p.length;$++){let q=p[$],ie=t.getTile(q),K=ie.getBucket(s);if(!K||K.projection.name!==I.projection.name)continue;let Q=K.programConfigurations.get(s.id),ae=eh(s);N&&ae.push("PROJECTION_GLOBE_VIEW");let ye=l.useProgram("circle",Q,ae),be=K.layoutVertexBuffer,xe=K.globeExtVertexBuffer,_e=K.indexBuffer,te=I.projection.createInversionMatrix(I,q.canonical),Ie={programConfiguration:Q,program:ye,layoutVertexBuffer:be,globeExtVertexBuffer:xe,indexBuffer:_e,uniformValues:El(l,q,ie,te,j,s),tile:ie};if(w){let Me=K.segments.get();for(let Ve of Me)J.push({segments:new o.SegmentVector([Ve]),sortKey:Ve.sortKey,state:Ie})}else J.push({segments:K.segments,sortKey:0,state:Ie})}w&&J.sort(($,q)=>$.sortKey-q.sortKey);let U={useDepthForOcclusion:!N};for(let $ of J){let{programConfiguration:q,program:ie,layoutVertexBuffer:K,globeExtVertexBuffer:Q,indexBuffer:ae,uniformValues:ye,tile:be}=$.state,xe=$.segments;l.terrain&&l.terrain.setupElevationDraw(be,ie,U),l.prepareDrawProgram(T,ie,be.tileID.toUnwrapped()),ie.draw(T,A.TRIANGLES,L,O,V,o.CullFaceMode.disabled,ye,s.id,K,ae,xe,s.paint,I.zoom,q,N?Q:null)}},heatmap:function(l,t,s,p){if(s.paint.get("heatmap-opacity")!==0)if(l.renderPass==="offscreen"){let f=l.context,_=f.gl,b=o.StencilMode.disabled,w=new o.ColorMode([_.ONE,_.ONE],o.Color.transparent,[!0,!0,!0,!0]);(function(V,N,j,J){let U=V.gl,$=N.width*J,q=N.height*J;V.activeTexture.set(U.TEXTURE1),V.viewport.set([0,0,$,q]);let ie=j.heatmapFbo;if(!ie||ie&&(ie.width!==$||ie.height!==q)){ie&&ie.destroy();let K=U.createTexture();U.bindTexture(U.TEXTURE_2D,K),U.texParameteri(U.TEXTURE_2D,U.TEXTURE_WRAP_S,U.CLAMP_TO_EDGE),U.texParameteri(U.TEXTURE_2D,U.TEXTURE_WRAP_T,U.CLAMP_TO_EDGE),U.texParameteri(U.TEXTURE_2D,U.TEXTURE_MIN_FILTER,U.LINEAR),U.texParameteri(U.TEXTURE_2D,U.TEXTURE_MAG_FILTER,U.LINEAR),ie=j.heatmapFbo=V.createFramebuffer($,q,!1),function(Q,ae,ye,be,xe,_e){let te=Q.gl;te.texImage2D(te.TEXTURE_2D,0,te.RGBA,xe,_e,0,te.RGBA,Q.extRenderToTextureHalfFloat?Q.extTextureHalfFloat.HALF_FLOAT_OES:te.UNSIGNED_BYTE,null),be.colorAttachment.set(ye)}(V,0,K,ie,$,q)}else U.bindTexture(U.TEXTURE_2D,ie.colorAttachment.get()),V.bindFramebuffer.set(ie.framebuffer)})(f,l,s,l.transform.projection.name==="globe"?.5:.25),f.clear({color:o.Color.transparent});let T=l.transform,A=T.projection.name==="globe",I=A?["PROJECTION_GLOBE_VIEW"]:null,L=A?o.CullFaceMode.frontCCW:o.CullFaceMode.disabled,O=[o.mercatorXfromLng(T.center.lng),o.mercatorYfromLat(T.center.lat)];for(let V=0;V<p.length;V++){let N=p[V];if(t.hasRenderableParent(N))continue;let j=t.getTile(N),J=j.getBucket(s);if(!J||J.projection.name!==T.projection.name)continue;let U=J.programConfigurations.get(s.id),$=l.useProgram("heatmap",U,I),{zoom:q}=l.transform;l.terrain&&l.terrain.setupElevationDraw(j,$),l.prepareDrawProgram(f,$,N.toUnwrapped());let ie=T.projection.createInversionMatrix(T,N.canonical);$.draw(f,_.TRIANGLES,o.DepthMode.disabled,b,w,L,up(l,N,j,ie,O,q,s.paint.get("heatmap-intensity")),s.id,J.layoutVertexBuffer,J.indexBuffer,J.segments,s.paint,l.transform.zoom,U,A?J.globeExtVertexBuffer:null)}f.viewport.set([0,0,l.width,l.height])}else l.renderPass==="translucent"&&(l.context.setColorMode(l.colorModeForRenderPass()),function(f,_){let b=f.context,w=b.gl,T=_.heatmapFbo;if(!T)return;b.activeTexture.set(w.TEXTURE0),w.bindTexture(w.TEXTURE_2D,T.colorAttachment.get()),b.activeTexture.set(w.TEXTURE1);let A=_.colorRampTexture;A||(A=_.colorRampTexture=new o.Texture(b,_.colorRamp,w.RGBA)),A.bind(w.LINEAR,w.CLAMP_TO_EDGE),f.useProgram("heatmapTexture").draw(b,w.TRIANGLES,o.DepthMode.disabled,o.StencilMode.disabled,f.colorModeForRenderPass(),o.CullFaceMode.disabled,((I,L,O,V)=>({u_image:0,u_color_ramp:1,u_opacity:L.paint.get("heatmap-opacity")}))(0,_),_.id,f.viewportBuffer,f.quadTriangleIndexBuffer,f.viewportSegments,_.paint,f.transform.zoom)}(l,s))},line:function(l,t,s,p){if(l.renderPass!=="translucent")return;let f=s.paint.get("line-opacity"),_=s.paint.get("line-width");if(f.constantOr(1)===0||_.constantOr(1)===0)return;let b=l.depthModeForSublayer(0,o.DepthMode.ReadOnly),w=l.colorModeForRenderPass(),T=l.terrain&&l.terrain.renderingToTexture?1:o.exported.devicePixelRatio,A=s.paint.get("line-dasharray"),I=A.constantOr(1),L=s.layout.get("line-cap"),O=s.paint.get("line-pattern"),V=O.constantOr(1),N=s.paint.get("line-gradient"),j=s.getCrossfadeParameters(),J=V?"linePattern":"line",U=l.context,$=U.gl,q=(K=>{let Q=[];ga(K)&&Q.push("RENDER_LINE_DASH"),K.paint.get("line-gradient")&&Q.push("RENDER_LINE_GRADIENT");let ae=K.paint.get("line-trim-offset");ae[0]===0&&ae[1]===0||Q.push("RENDER_LINE_TRIM_OFFSET");let ye=K.paint.get("line-pattern").constantOr(1),be=K.paint.get("line-opacity").constantOr(1)!==1;return!ye&&be&&Q.push("RENDER_LINE_ALPHA_DISCARD"),Q})(s),ie=q.includes("RENDER_LINE_ALPHA_DISCARD");l.terrain&&l.terrain.clipOrMaskOverlapStencilType()&&(ie=!1);for(let K of p){let Q=t.getTile(K);if(V&&!Q.patternsLoaded())continue;let ae=Q.getBucket(s);if(!ae)continue;l.prepareDrawTile();let ye=ae.programConfigurations.get(s.id),be=l.useProgram(J,ye,q),xe=O.constantOr(null);if(xe&&Q.imageAtlas){let Ue=Q.imageAtlas,je=Ue.patternPositions[xe.to.toString()],Fe=Ue.patternPositions[xe.from.toString()];je&&Fe&&ye.setConstantPatternPositions(je,Fe)}let _e=A.constantOr(null),te=L.constantOr(null);if(!V&&_e&&te&&Q.lineAtlas){let Ue=Q.lineAtlas,je=Ue.getDash(_e.to,te),Fe=Ue.getDash(_e.from,te);je&&Fe&&ye.setConstantPatternPositions(je,Fe)}let[Ie,Me]=s.paint.get("line-trim-offset");(te==="round"||te==="square")&&Ie!==Me&&(Ie===0&&(Ie-=1),Me===1&&(Me+=1));let Ve=l.terrain?K.projMatrix:null,Te=V?pp(l,Q,s,j,Ve,T):Sl(l,Q,s,j,Ve,ae.lineClipsArray.length,T,[Ie,Me]);if(N){let Ue=ae.gradients[s.id],je=Ue.texture;if(s.gradientVersion!==Ue.version){let Fe=256;if(s.stepInterpolant){let Oe=t.getSource().maxzoom,ht=K.canonical.z===Oe?Math.ceil(1<<l.transform.maxZoom-K.canonical.z):1;Fe=o.clamp(o.nextPowerOfTwo(ae.maxLineLength/o.EXTENT*1024*ht),256,U.maxTextureSize)}Ue.gradient=o.renderColorRamp({expression:s.gradientExpression(),evaluationKey:"lineProgress",resolution:Fe,image:Ue.gradient||void 0,clips:ae.lineClipsArray}),Ue.texture?Ue.texture.update(Ue.gradient):Ue.texture=new o.Texture(U,Ue.gradient,$.RGBA),Ue.version=s.gradientVersion,je=Ue.texture}U.activeTexture.set($.TEXTURE1),je.bind(s.stepInterpolant?$.NEAREST:$.LINEAR,$.CLAMP_TO_EDGE)}I&&(U.activeTexture.set($.TEXTURE0),Q.lineAtlasTexture.bind($.LINEAR,$.REPEAT),ye.updatePaintBuffers(j)),V&&(U.activeTexture.set($.TEXTURE0),Q.imageAtlasTexture.bind($.LINEAR,$.CLAMP_TO_EDGE),ye.updatePaintBuffers(j)),l.prepareDrawProgram(U,be,K.toUnwrapped());let tt=Ue=>{be.draw(U,$.TRIANGLES,b,Ue,w,o.CullFaceMode.disabled,Te,s.id,ae.layoutVertexBuffer,ae.indexBuffer,ae.segments,s.paint,l.transform.zoom,ye,ae.layoutVertexBuffer2)};if(ie){let Ue=l.stencilModeForClipping(K).ref;Ue===0&&l.terrain&&U.clear({stencil:0});let je={func:$.EQUAL,mask:255};Te.u_alpha_discard_threshold=.8,tt(new o.StencilMode(je,Ue,255,$.KEEP,$.KEEP,$.INVERT)),Te.u_alpha_discard_threshold=0,tt(new o.StencilMode(je,Ue,255,$.KEEP,$.KEEP,$.KEEP))}else tt(l.stencilModeForClipping(K))}ie&&(l.resetStencilClippingMasks(),l.terrain&&U.clear({stencil:0}))},fill:function(l,t,s,p){let f=s.paint.get("fill-color"),_=s.paint.get("fill-opacity");if(_.constantOr(1)===0)return;let b=l.colorModeForRenderPass(),w=s.paint.get("fill-pattern"),T=l.opaquePassEnabledForLayer()&&!w.constantOr(1)&&f.constantOr(o.Color.transparent).a===1&&_.constantOr(0)===1?"opaque":"translucent";if(l.renderPass===T){let A=l.depthModeForSublayer(1,l.renderPass==="opaque"?o.DepthMode.ReadWrite:o.DepthMode.ReadOnly);zl(l,t,s,p,A,b,!1)}if(l.renderPass==="translucent"&&s.paint.get("fill-antialias")){let A=l.depthModeForSublayer(s.getPaintProperty("fill-outline-color")?2:0,o.DepthMode.ReadOnly);zl(l,t,s,p,A,b,!0)}},"fill-extrusion":function(l,t,s,p){let f=s.paint.get("fill-extrusion-opacity");if(f!==0&&l.renderPass==="translucent"){let _=new o.DepthMode(l.context.gl.LEQUAL,o.DepthMode.ReadWrite,l.depthRangeFor3D);if(f!==1||s.paint.get("fill-extrusion-pattern").constantOr(1))xa(l,t,s,p,_,o.StencilMode.disabled,o.ColorMode.disabled),xa(l,t,s,p,_,l.stencilModeFor3D(),l.colorModeForRenderPass()),l.resetStencilClippingMasks();else{let b=l.colorModeForRenderPass();xa(l,t,s,p,_,o.StencilMode.disabled,b)}}},hillshade:function(l,t,s,p){if(l.renderPass!=="offscreen"&&l.renderPass!=="translucent")return;let f=l.context,_=l.depthModeForSublayer(0,o.DepthMode.ReadOnly),b=l.colorModeForRenderPass(),w=l.terrain&&l.terrain.renderingToTexture,[T,A]=l.renderPass!=="translucent"||w?[{},p]:l.stencilConfigForOverlap(p);for(let I of A){let L=t.getTile(I);if(L.needsHillshadePrepare&&l.renderPass==="offscreen")ca(l,L,s,_,o.StencilMode.disabled,b);else if(l.renderPass==="translucent"){let O=w&&l.terrain?l.terrain.stencilModeForRTTOverlap(I):T[I.overscaledZ];Kc(l,I,L,s,_,O,b)}}f.viewport.set([0,0,l.width,l.height]),l.resetStencilClippingMasks()},raster:function(l,t,s,p,f,_){if(l.renderPass!=="translucent"||s.paint.get("raster-opacity")===0||!p.length)return;let b=l.context,w=b.gl,T=t.getSource(),A=l.useProgram("raster"),I=l.colorModeForRenderPass(),L=l.terrain&&l.terrain.renderingToTexture,[O,V]=T instanceof pe||L?[{},p]:l.stencilConfigForOverlap(p),N=V[V.length-1].overscaledZ,j=!l.options.moving;for(let J of V){let U=L?o.DepthMode.disabled:l.depthModeForSublayer(J.overscaledZ-N,s.paint.get("raster-opacity")===1?o.DepthMode.ReadWrite:o.DepthMode.ReadOnly,w.LESS),$=J.toUnwrapped(),q=t.getTile(J);if(L&&(!q||!q.hasData()))continue;let ie=L?J.projMatrix:l.transform.calculateProjMatrix($,j),K=l.terrain&&L?l.terrain.stencilModeForRTTOverlap(J):O[J.overscaledZ],Q=_?0:s.paint.get("raster-fade-duration");q.registerFadeDuration(Q);let ae=t.findLoadedParent(J,0),ye=yl(q,ae,t,l.transform,Q),be,xe;l.terrain&&l.terrain.prepareDrawTile();let _e=s.paint.get("raster-resampling")==="nearest"?w.NEAREST:w.LINEAR;b.activeTexture.set(w.TEXTURE0),q.texture.bind(_e,w.CLAMP_TO_EDGE),b.activeTexture.set(w.TEXTURE1),ae?(ae.texture.bind(_e,w.CLAMP_TO_EDGE),be=Math.pow(2,ae.tileID.overscaledZ-q.tileID.overscaledZ),xe=[q.tileID.canonical.x*be%1,q.tileID.canonical.y*be%1]):q.texture.bind(_e,w.CLAMP_TO_EDGE);let te=dp(ie,xe||[0,0],be||1,ye,s,T instanceof pe?T.perspectiveTransform:[0,0]);if(l.prepareDrawProgram(b,A,$),T instanceof pe)T.boundsBuffer&&T.boundsSegments&&A.draw(b,w.TRIANGLES,U,o.StencilMode.disabled,I,o.CullFaceMode.disabled,te,s.id,T.boundsBuffer,l.quadTriangleIndexBuffer,T.boundsSegments);else{let{tileBoundsBuffer:Ie,tileBoundsIndexBuffer:Me,tileBoundsSegments:Ve}=l.getTileBoundsBuffers(q);A.draw(b,w.TRIANGLES,U,K,I,o.CullFaceMode.disabled,te,s.id,Ie,Me,Ve)}}l.resetStencilClippingMasks()},background:function(l,t,s,p){let f=s.paint.get("background-color"),_=s.paint.get("background-opacity");if(_===0)return;let b=l.context,w=b.gl,T=l.transform,A=T.tileSize,I=s.paint.get("background-pattern");if(l.isPatternMissing(I))return;let L=!I&&f.a===1&&_===1&&l.opaquePassEnabledForLayer()?"opaque":"translucent";if(l.renderPass!==L)return;let O=o.StencilMode.disabled,V=l.depthModeForSublayer(0,L==="opaque"?o.DepthMode.ReadWrite:o.DepthMode.ReadOnly),N=l.colorModeForRenderPass(),j=l.useProgram(I?"backgroundPattern":"background"),J,U=p;U||(J=l.getBackgroundTiles(),U=Object.values(J).map(q=>q.tileID)),I&&(b.activeTexture.set(w.TEXTURE0),l.imageManager.bind(l.context));let $=s.getCrossfadeParameters();for(let q of U){let ie=q.toUnwrapped(),K=p?q.projMatrix:l.transform.calculateProjMatrix(ie);l.prepareDrawTile();let Q=t?t.getTile(q):J?J[q.key]:new o.Tile(q,A,T.zoom,l),ae=I?go(K,_,l,I,{tileID:q,tileSize:A},$):oh(K,_,f);l.prepareDrawProgram(b,j,ie);let{tileBoundsBuffer:ye,tileBoundsIndexBuffer:be,tileBoundsSegments:xe}=l.getTileBoundsBuffers(Q);j.draw(b,w.TRIANGLES,V,O,N,o.CullFaceMode.disabled,ae,s.id,ye,be,xe)}},sky:function(l,t,s){let p=l.transform,f=p.projection.name==="mercator"||p.projection.name==="globe"?1:o.smoothstep(7,8,p.zoom),_=s.paint.get("sky-opacity")*f;if(_===0)return;let b=l.context,w=s.paint.get("sky-type"),T=new o.DepthMode(b.gl.LEQUAL,o.DepthMode.ReadOnly,[0,1]),A=l.frameCounter/1e3%1;w==="atmosphere"?l.renderPass==="offscreen"?s.needsSkyboxCapture(l)&&(function(I,L,O,V){let N=I.context,j=N.gl,J=L.skyboxFbo;if(!J){J=L.skyboxFbo=N.createFramebuffer(32,32,!1),L.skyboxGeometry=new hh(N),L.skyboxTexture=N.gl.createTexture(),j.bindTexture(j.TEXTURE_CUBE_MAP,L.skyboxTexture),j.texParameteri(j.TEXTURE_CUBE_MAP,j.TEXTURE_WRAP_S,j.CLAMP_TO_EDGE),j.texParameteri(j.TEXTURE_CUBE_MAP,j.TEXTURE_WRAP_T,j.CLAMP_TO_EDGE),j.texParameteri(j.TEXTURE_CUBE_MAP,j.TEXTURE_MIN_FILTER,j.LINEAR),j.texParameteri(j.TEXTURE_CUBE_MAP,j.TEXTURE_MAG_FILTER,j.LINEAR);for(let ie=0;ie<6;++ie)j.texImage2D(j.TEXTURE_CUBE_MAP_POSITIVE_X+ie,0,j.RGBA,32,32,0,j.RGBA,j.UNSIGNED_BYTE,null)}N.bindFramebuffer.set(J.framebuffer),N.viewport.set([0,0,32,32]);let U=L.getCenter(I,!0),$=I.useProgram("skyboxCapture"),q=new Float64Array(16);o.identity(q),o.rotateY(q,q,.5*-Math.PI),xo(N,L,$,q,U,0),o.identity(q),o.rotateY(q,q,.5*Math.PI),xo(N,L,$,q,U,1),o.identity(q),o.rotateX(q,q,.5*-Math.PI),xo(N,L,$,q,U,2),o.identity(q),o.rotateX(q,q,.5*Math.PI),xo(N,L,$,q,U,3),o.identity(q),xo(N,L,$,q,U,4),o.identity(q),o.rotateY(q,q,Math.PI),xo(N,L,$,q,U,5),N.viewport.set([0,0,I.width,I.height])}(l,s),s.markSkyboxValid(l)):l.renderPass==="sky"&&function(I,L,O,V,N){let j=I.context,J=j.gl,U=I.transform,$=I.useProgram("skybox");j.activeTexture.set(J.TEXTURE0),J.bindTexture(J.TEXTURE_CUBE_MAP,L.skyboxTexture);let q=((ie,K,Q,ae,ye)=>({u_matrix:ie,u_sun_direction:K,u_cubemap:0,u_opacity:ae,u_temporal_offset:ye}))(U.skyboxMatrix,L.getCenter(I,!1),0,V,N);I.prepareDrawProgram(j,$),$.draw(j,J.TRIANGLES,O,o.StencilMode.disabled,I.colorModeForRenderPass(),o.CullFaceMode.backCW,q,"skybox",L.skyboxGeometry.vertexBuffer,L.skyboxGeometry.indexBuffer,L.skyboxGeometry.segment)}(l,s,T,_,A):w==="gradient"&&l.renderPass==="sky"&&function(I,L,O,V,N){let j=I.context,J=j.gl,U=I.transform,$=I.useProgram("skyboxGradient");L.skyboxGeometry||(L.skyboxGeometry=new hh(j)),j.activeTexture.set(J.TEXTURE0);let q=L.colorRampTexture;q||(q=L.colorRampTexture=new o.Texture(j,L.colorRamp,J.RGBA)),q.bind(J.LINEAR,J.CLAMP_TO_EDGE);let ie=((K,Q,ae,ye,be)=>({u_matrix:K,u_color_ramp:0,u_center_direction:Q,u_radius:o.degToRad(ae),u_opacity:ye,u_temporal_offset:be}))(U.skyboxMatrix,L.getCenter(I,!1),L.paint.get("sky-gradient-radius"),V,N);I.prepareDrawProgram(j,$),$.draw(j,J.TRIANGLES,O,o.StencilMode.disabled,I.colorModeForRenderPass(),o.CullFaceMode.backCW,ie,"skyboxGradient",L.skyboxGeometry.vertexBuffer,L.skyboxGeometry.indexBuffer,L.skyboxGeometry.segment)}(l,s,T,_,A)},debug:function(l,t,s){for(let p=0;p<s.length;p++)ba(l,t,s[p])},custom:function(l,t,s){let p=l.context,f=s.implementation;if(l.transform.projection.unsupportedLayers&&l.transform.projection.unsupportedLayers.includes("custom"))o.warnOnce("Custom layers are not yet supported with non-mercator projections. Use mercator to enable custom layers.");else if(l.renderPass==="offscreen"){let _=f.prerender;_&&(l.setCustomLayerDefaults(),p.setColorMode(l.colorModeForRenderPass()),_.call(f,p.gl,l.transform.customLayerMatrix()),p.setDirty(),l.setBaseState())}else if(l.renderPass==="translucent"){l.setCustomLayerDefaults(),p.setColorMode(l.colorModeForRenderPass()),p.setStencilMode(o.StencilMode.disabled);let _=f.renderingMode==="3d"?new o.DepthMode(l.context.gl.LEQUAL,o.DepthMode.ReadWrite,l.depthRangeFor3D):l.depthModeForSublayer(0,o.DepthMode.ReadOnly);p.setDepthMode(_),f.render(p.gl,l.transform.customLayerMatrix()),p.setDirty(),l.setBaseState(),p.bindFramebuffer.set(null)}}};class Ea{constructor(t,s){this.context=new Z(t),this.transform=s,this._tileTextures={},this.frameCopies=[],this.loadTimeStamps=[],this.setup(),this.numSublayers=o.SourceCache.maxUnderzooming+o.SourceCache.maxOverzooming+1,this.depthEpsilon=1/Math.pow(2,16),this.crossTileSymbolIndex=new Wc,this.deferredRenderGpuTimeQueries=[],this.gpuTimers={},this.frameCounter=0,this._backgroundTiles={}}updateTerrain(t,s){let p=!!t&&!!t.terrain&&this.transform.projection.supportsTerrain;if(!(p||this._terrain&&this._terrain.enabled))return;this._terrain||(this._terrain=new xl(this,t));let f=this._terrain;this.transform.elevation=p?f:null,f.update(t,this.transform,s)}_updateFog(t){let s=t.fog;if(!s||this.transform.projection.name==="globe"||s.getOpacity(this.transform.pitch)<1||s.properties.get("horizon-blend")<.03)return void(this.transform.fogCullDistSq=null);let[p,f]=s.getFovAdjustedRange(this.transform._fov);if(p>f)return void(this.transform.fogCullDistSq=null);let _=p+.78*(f-p);this.transform.fogCullDistSq=_*_}get terrain(){return this.transform._terrainEnabled()&&this._terrain&&this._terrain.enabled?this._terrain:null}resize(t,s){if(this.width=t*o.exported.devicePixelRatio,this.height=s*o.exported.devicePixelRatio,this.context.viewport.set([0,0,this.width,this.height]),this.style)for(let p of this.style.order)this.style._layers[p].resize()}setup(){let t=this.context,s=new o.StructArrayLayout2i4;s.emplaceBack(0,0),s.emplaceBack(o.EXTENT,0),s.emplaceBack(0,o.EXTENT),s.emplaceBack(o.EXTENT,o.EXTENT),this.tileExtentBuffer=t.createVertexBuffer(s,o.posAttributes.members),this.tileExtentSegments=o.SegmentVector.simpleSegment(0,0,4,2);let p=new o.StructArrayLayout2i4;p.emplaceBack(0,0),p.emplaceBack(o.EXTENT,0),p.emplaceBack(0,o.EXTENT),p.emplaceBack(o.EXTENT,o.EXTENT),this.debugBuffer=t.createVertexBuffer(p,o.posAttributes.members),this.debugSegments=o.SegmentVector.simpleSegment(0,0,4,5);let f=new o.StructArrayLayout2i4;f.emplaceBack(-1,-1),f.emplaceBack(1,-1),f.emplaceBack(-1,1),f.emplaceBack(1,1),this.viewportBuffer=t.createVertexBuffer(f,o.posAttributes.members),this.viewportSegments=o.SegmentVector.simpleSegment(0,0,4,2);let _=new o.StructArrayLayout4i8;_.emplaceBack(0,0,0,0),_.emplaceBack(o.EXTENT,0,o.EXTENT,0),_.emplaceBack(0,o.EXTENT,0,o.EXTENT),_.emplaceBack(o.EXTENT,o.EXTENT,o.EXTENT,o.EXTENT),this.mercatorBoundsBuffer=t.createVertexBuffer(_,o.boundsAttributes.members),this.mercatorBoundsSegments=o.SegmentVector.simpleSegment(0,0,4,2);let b=new o.StructArrayLayout3ui6;b.emplaceBack(0,1,2),b.emplaceBack(2,1,3),this.quadTriangleIndexBuffer=t.createIndexBuffer(b);let w=new o.StructArrayLayout1ui2;for(let A of[0,1,3,2,0])w.emplaceBack(A);this.debugIndexBuffer=t.createIndexBuffer(w),this.emptyTexture=new o.Texture(t,new o.RGBAImage({width:1,height:1},Uint8Array.of(0,0,0,0)),t.gl.RGBA),this.identityMat=o.create();let T=this.context.gl;this.stencilClearMode=new o.StencilMode({func:T.ALWAYS,mask:0},0,255,T.ZERO,T.ZERO,T.ZERO),this.loadTimeStamps.push(o.window.performance.now()),this.atmosphereBuffer=new yp(this.context)}getMercatorTileBoundsBuffers(){return{tileBoundsBuffer:this.mercatorBoundsBuffer,tileBoundsIndexBuffer:this.quadTriangleIndexBuffer,tileBoundsSegments:this.mercatorBoundsSegments}}getTileBoundsBuffers(t){return t._makeTileBoundsBuffers(this.context,this.transform.projection),t._tileBoundsBuffer?{tileBoundsBuffer:t._tileBoundsBuffer,tileBoundsIndexBuffer:t._tileBoundsIndexBuffer,tileBoundsSegments:t._tileBoundsSegments}:this.getMercatorTileBoundsBuffers()}clearStencil(){let t=this.context,s=t.gl;this.nextStencilID=1,this.currentStencilSource=void 0,this._tileClippingMaskIDs={},this.useProgram("clippingMask").draw(t,s.TRIANGLES,o.DepthMode.disabled,this.stencilClearMode,o.ColorMode.disabled,o.CullFaceMode.disabled,as(this.identityMat),"$clipping",this.viewportBuffer,this.quadTriangleIndexBuffer,this.viewportSegments)}resetStencilClippingMasks(){this.terrain||(this.currentStencilSource=void 0,this._tileClippingMaskIDs={})}_renderTileClippingMasks(t,s,p){if(!s||this.currentStencilSource===s.id||!t.isTileClipped()||!p||p.length===0)return;if(this._tileClippingMaskIDs&&!this.terrain){let w=!1;for(let T of p)if(this._tileClippingMaskIDs[T.key]===void 0){w=!0;break}if(!w)return}this.currentStencilSource=s.id;let f=this.context,_=f.gl;this.nextStencilID+p.length>256&&this.clearStencil(),f.setColorMode(o.ColorMode.disabled),f.setDepthMode(o.DepthMode.disabled);let b=this.useProgram("clippingMask");this._tileClippingMaskIDs={};for(let w of p){let T=s.getTile(w),A=this._tileClippingMaskIDs[w.key]=this.nextStencilID++,{tileBoundsBuffer:I,tileBoundsIndexBuffer:L,tileBoundsSegments:O}=this.getTileBoundsBuffers(T);b.draw(f,_.TRIANGLES,o.DepthMode.disabled,new o.StencilMode({func:_.ALWAYS,mask:0},A,255,_.KEEP,_.KEEP,_.REPLACE),o.ColorMode.disabled,o.CullFaceMode.disabled,as(w.projMatrix),"$clipping",I,L,O)}}stencilModeFor3D(){this.currentStencilSource=void 0,this.nextStencilID+1>256&&this.clearStencil();let t=this.nextStencilID++,s=this.context.gl;return new o.StencilMode({func:s.NOTEQUAL,mask:255},t,255,s.KEEP,s.KEEP,s.REPLACE)}stencilModeForClipping(t){if(this.terrain)return this.terrain.stencilModeForRTTOverlap(t);let s=this.context.gl;return new o.StencilMode({func:s.EQUAL,mask:255},this._tileClippingMaskIDs[t.key],0,s.KEEP,s.KEEP,s.REPLACE)}stencilConfigForOverlap(t){let s=this.context.gl,p=t.sort((b,w)=>w.overscaledZ-b.overscaledZ),f=p[p.length-1].overscaledZ,_=p[0].overscaledZ-f+1;if(_>1){this.currentStencilSource=void 0,this.nextStencilID+_>256&&this.clearStencil();let b={};for(let w=0;w<_;w++)b[w+f]=new o.StencilMode({func:s.GEQUAL,mask:255},w+this.nextStencilID,255,s.KEEP,s.KEEP,s.REPLACE);return this.nextStencilID+=_,[b,p]}return[{[f]:o.StencilMode.disabled},p]}colorModeForRenderPass(){let t=this.context.gl;return this._showOverdrawInspector?new o.ColorMode([t.CONSTANT_COLOR,t.ONE],new o.Color(.125,.125,.125,0),[!0,!0,!0,!0]):this.renderPass==="opaque"?o.ColorMode.unblended:o.ColorMode.alphaBlended}depthModeForSublayer(t,s,p){if(!this.opaquePassEnabledForLayer())return o.DepthMode.disabled;let f=1-((1+this.currentLayer)*this.numSublayers+t)*this.depthEpsilon;return new o.DepthMode(p||this.context.gl.LEQUAL,s,[f,f])}opaquePassEnabledForLayer(){return this.currentLayer<this.opaquePassCutoff}render(t,s){this.style=t,this.options=s,this.lineAtlas=t.lineAtlas,this.imageManager=t.imageManager,this.glyphManager=t.glyphManager,this.symbolFadeChange=t.placement.symbolFadeChange(o.exported.now()),this.imageManager.beginFrame();let p=this.style.order,f=this.style._sourceCaches;for(let T in f){let A=f[T];A.used&&A.prepare(this.context)}let _={},b={},w={};for(let T in f){let A=f[T];_[T]=A.getVisibleCoordinates(),b[T]=_[T].slice().reverse(),w[T]=A.getVisibleCoordinates(!0).reverse()}this.opaquePassCutoff=1/0;for(let T=0;T<p.length;T++)if(this.style._layers[p[T]].is3D()){this.opaquePassCutoff=T;break}if(this.terrain&&(this.terrain.updateTileBinding(w),this.opaquePassCutoff=0),this.transform.projection.name!=="globe"||this.globeSharedBuffers||(this.globeSharedBuffers=new o.GlobeSharedBuffers(this.context)),o.isMapAuthenticated(this.context.gl)){this.renderPass="offscreen";for(let T of p){let A=this.style._layers[T],I=t._getLayerSourceCache(A);if(!A.hasOffscreenPass()||A.isHidden(this.transform.zoom))continue;let L=I?b[I.id]:void 0;(A.type==="custom"||A.isSky()||L&&L.length)&&this.renderLayer(this,I,A,L)}if(this.depthRangeFor3D=[0,1-(t.order.length+2)*this.numSublayers*this.depthEpsilon],this.terrain&&(this.style.hasSymbolLayers()||this.style.hasCircleLayers())&&this.terrain.drawDepth(),this.context.bindFramebuffer.set(null),this.context.viewport.set([0,0,this.width,this.height]),this.context.clear({color:s.showOverdrawInspector?o.Color.black:o.Color.transparent,depth:1}),this.clearStencil(),this._showOverdrawInspector=s.showOverdrawInspector,this.renderPass="opaque",!this.terrain)for(this.currentLayer=p.length-1;this.currentLayer>=0;this.currentLayer--){let T=this.style._layers[p[this.currentLayer]],A=t._getLayerSourceCache(T);if(T.isSky())continue;let I=A?b[A.id]:void 0;this._renderTileClippingMasks(T,A,I),this.renderLayer(this,A,T,I)}if(this.style.fog&&this.transform.projection.supportsFog&&function(T,A){let I=T.context,L=I.gl,O=T.transform,V=new o.DepthMode(L.LEQUAL,o.DepthMode.ReadOnly,[0,1]),N=T.useProgram("globeAtmosphere",null,O.projection.name==="globe"?["PROJECTION_GLOBE_VIEW","FOG"]:["FOG"]),j=o.globeToMercatorTransition(O.zoom),J=A.properties.get("color").toArray01(),U=A.properties.get("high-color").toArray01(),$=A.properties.get("space-color").toArray01PremultipliedAlpha(),q=o.identity$1([]);o.rotateY$1(q,q,-o.degToRad(O._center.lng)),o.rotateX$1(q,q,o.degToRad(O._center.lat)),o.rotateZ$1(q,q,O.angle),o.rotateX$1(q,q,-O._pitch);let ie=o.fromQuat(new Float32Array(16),q),K=o.mapValue(A.properties.get("star-intensity"),0,1,0,.25),Q=5e-4,ae=o.mapValue(A.properties.get("horizon-blend"),0,1,Q,.25),ye=o.globeUseCustomAntiAliasing(T,I,O)&&ae===Q?O.worldSize/(2*Math.PI*1.025)-1:O.globeRadius,be=T.frameCounter/1e3%1,xe=o.length(O.globeCenterInViewSpace),_e=Math.sqrt(Math.pow(xe,2)-Math.pow(ye,2)),te=Math.acos(_e/xe),Ie=((Ve,Te,tt,Ue,je,Fe,Oe,ht,rt,mt,et,pt,Ot,Gt)=>({u_frustum_tl:Ve,u_frustum_tr:Te,u_frustum_br:tt,u_frustum_bl:Ue,u_horizon:je,u_transition:Fe,u_fadeout_range:Oe,u_color:ht,u_high_color:rt,u_space_color:mt,u_star_intensity:et,u_star_size:5*o.exported.devicePixelRatio,u_star_density:0,u_temporal_offset:pt,u_horizon_angle:Ot,u_rotation_matrix:Gt}))(O.frustumCorners.TL,O.frustumCorners.TR,O.frustumCorners.BR,O.frustumCorners.BL,O.frustumCorners.horizon,j,ae,J,U,$,K,be,te,ie);T.prepareDrawProgram(I,N);let Me=T.atmosphereBuffer;Me&&N.draw(I,L.TRIANGLES,V,o.StencilMode.disabled,o.ColorMode.alphaBlended,o.CullFaceMode.backCW,Ie,"skybox",Me.vertexBuffer,Me.indexBuffer,Me.segments)}(this,this.style.fog),this.renderPass="sky",(o.globeToMercatorTransition(this.transform.zoom)>0||this.transform.projection.name!=="globe")&&this.transform.isHorizonVisible())for(this.currentLayer=0;this.currentLayer<p.length;this.currentLayer++){let T=this.style._layers[p[this.currentLayer]],A=t._getLayerSourceCache(T);T.isSky()&&this.renderLayer(this,A,T,A?b[A.id]:void 0)}for(this.renderPass="translucent",this.currentLayer=0;this.currentLayer<p.length;){let T=this.style._layers[p[this.currentLayer]],A=t._getLayerSourceCache(T);if(T.isSky()){++this.currentLayer;continue}if(this.terrain&&this.style.isLayerDraped(T)){if(T.isHidden(this.transform.zoom)){++this.currentLayer;continue}this.currentLayer=this.terrain.renderBatch(this.currentLayer);continue}let I=A?(T.type==="symbol"?w:b)[A.id]:void 0;this._renderTileClippingMasks(T,A,A?_[A.id]:void 0),this.renderLayer(this,A,T,I),++this.currentLayer}if(this.terrain&&this.terrain.postRender(),this.options.showTileBoundaries||this.options.showQueryGeometry){let T=null;o.values(this.style._layers).forEach(A=>{let I=t._getLayerSourceCache(A);I&&!A.isHidden(this.transform.zoom)&&(!T||T.getSource().maxzoom<I.getSource().maxzoom)&&(T=I)}),T&&this.options.showTileBoundaries&&wa.debug(this,T,T.getVisibleCoordinates())}this.options.showPadding&&function(T){let A=T.transform.padding;Dl(T,T.transform.height-(A.top||0),3,Fn),Dl(T,A.bottom||0,3,us),va(T,A.left||0,3,lh),va(T,T.transform.width-(A.right||0),3,_o);let I=T.transform.centerPoint;(function(L,O,V,N){Dt(L,O-1,V-10,2,20,N),Dt(L,O-10,V-1,20,2,N)})(T,I.x,T.transform.height-I.y,yo)}(this),this.context.setDefault(),this.frameCounter=(this.frameCounter+1)%Number.MAX_SAFE_INTEGER,this.tileLoaded&&this.options.speedIndexTiming&&(this.loadTimeStamps.push(o.window.performance.now()),this.saveCanvasCopy())}}renderLayer(t,s,p,f){p.isHidden(this.transform.zoom)||(p.type==="background"||p.type==="sky"||p.type==="custom"||f&&f.length)&&(this.id=p.id,this.gpuTimingStart(p),t.transform.projection.unsupportedLayers&&t.transform.projection.unsupportedLayers.includes(p.type)||wa[p.type](t,s,p,f,this.style.placement.variableOffsets,this.options.isInitialLoad),this.gpuTimingEnd())}gpuTimingStart(t){if(!this.options.gpuTiming)return;let s=this.context.extTimerQuery,p=this.gpuTimers[t.id];p||(p=this.gpuTimers[t.id]={calls:0,cpuTime:0,query:s.createQueryEXT()}),p.calls++,s.beginQueryEXT(s.TIME_ELAPSED_EXT,p.query)}gpuTimingDeferredRenderStart(){if(this.options.gpuTimingDeferredRender){let t=this.context.extTimerQuery,s=t.createQueryEXT();this.deferredRenderGpuTimeQueries.push(s),t.beginQueryEXT(t.TIME_ELAPSED_EXT,s)}}gpuTimingDeferredRenderEnd(){if(!this.options.gpuTimingDeferredRender)return;let t=this.context.extTimerQuery;t.endQueryEXT(t.TIME_ELAPSED_EXT)}gpuTimingEnd(){if(!this.options.gpuTiming)return;let t=this.context.extTimerQuery;t.endQueryEXT(t.TIME_ELAPSED_EXT)}collectGpuTimers(){let t=this.gpuTimers;return this.gpuTimers={},t}collectDeferredRenderGpuQueries(){let t=this.deferredRenderGpuTimeQueries;return this.deferredRenderGpuTimeQueries=[],t}queryGpuTimers(t){let s={};for(let p in t){let f=t[p],_=this.context.extTimerQuery,b=_.getQueryObjectEXT(f.query,_.QUERY_RESULT_EXT)/1e6;_.deleteQueryEXT(f.query),s[p]=b}return s}queryGpuTimeDeferredRender(t){if(!this.options.gpuTimingDeferredRender)return 0;let s=this.context.extTimerQuery,p=0;for(let f of t)p+=s.getQueryObjectEXT(f,s.QUERY_RESULT_EXT)/1e6,s.deleteQueryEXT(f);return p}translatePosMatrix(t,s,p,f,_){if(!p[0]&&!p[1])return t;let b=_?f==="map"?this.transform.angle:0:f==="viewport"?-this.transform.angle:0;if(b){let A=Math.sin(b),I=Math.cos(b);p=[p[0]*I-p[1]*A,p[0]*A+p[1]*I]}let w=[_?p[0]:Wr(s,p[0],this.transform.zoom),_?p[1]:Wr(s,p[1],this.transform.zoom),0],T=new Float32Array(16);return o.translate(T,t,w),T}saveTileTexture(t){let s=this._tileTextures[t.size[0]];s?s.push(t):this._tileTextures[t.size[0]]=[t]}getTileTexture(t){let s=this._tileTextures[t];return s&&s.length>0?s.pop():null}isPatternMissing(t){if(!t)return!1;if(!t.from||!t.to)return!0;let s=this.imageManager.getPattern(t.from.toString()),p=this.imageManager.getPattern(t.to.toString());return!s||!p}currentGlobalDefines(){let t=this.terrain&&this.terrain.renderingToTexture,s=this.style&&this.style.fog,p=[];return this.terrain&&!this.terrain.renderingToTexture&&p.push("TERRAIN"),s&&!t&&s.getOpacity(this.transform.pitch)!==0&&p.push("FOG"),t&&p.push("RENDER_TO_TEXTURE"),this._showOverdrawInspector&&p.push("OVERDRAW_INSPECTOR"),p}useProgram(t,s,p){this.cache=this.cache||{};let f=p||[],_=this.currentGlobalDefines().concat(f),b=fa.cacheKey(t,_,s);return this.cache[b]||(this.cache[b]=new fa(this.context,t,aa[t],s,fp[t],_)),this.cache[b]}setCustomLayerDefaults(){this.context.unbindVAO(),this.context.cullFace.setDefault(),this.context.frontFace.setDefault(),this.context.cullFaceSide.setDefault(),this.context.activeTexture.setDefault(),this.context.pixelStoreUnpack.setDefault(),this.context.pixelStoreUnpackPremultiplyAlpha.setDefault(),this.context.pixelStoreUnpackFlipY.setDefault()}setBaseState(){let t=this.context.gl;this.context.cullFace.set(!1),this.context.viewport.set([0,0,this.width,this.height]),this.context.blendEquation.set(t.FUNC_ADD)}initDebugOverlayCanvas(){this.debugOverlayCanvas==null&&(this.debugOverlayCanvas=o.window.document.createElement("canvas"),this.debugOverlayCanvas.width=512,this.debugOverlayCanvas.height=512,this.debugOverlayTexture=new o.Texture(this.context,this.debugOverlayCanvas,this.context.gl.RGBA))}destroy(){this._terrain&&this._terrain.destroy(),this.globeSharedBuffers&&this.globeSharedBuffers.destroy(),this.emptyTexture.destroy(),this.debugOverlayTexture&&this.debugOverlayTexture.destroy(),this.atmosphereBuffer&&this.atmosphereBuffer.destroy()}prepareDrawTile(){this.terrain&&this.terrain.prepareDrawTile()}prepareDrawProgram(t,s,p){if(this.terrain&&this.terrain.renderingToTexture)return;let f=this.style.fog;if(f){let _=f.getOpacity(this.transform.pitch),b=((w,T,A,I,L,O,V,N,j,J,U)=>{let $=w.transform,q=T.properties.get("color").toArray01();q[3]=I;let ie=w.frameCounter/1e3%1;return{u_fog_matrix:A?$.calculateFogTileMatrix(A):w.identityMat,u_fog_range:T.getFovAdjustedRange($._fov),u_fog_color:q,u_fog_horizon_blend:T.properties.get("horizon-blend"),u_fog_temporal_offset:ie,u_frustum_tl:L,u_frustum_tr:O,u_frustum_br:V,u_frustum_bl:N,u_globe_pos:j,u_globe_radius:J,u_viewport:U,u_globe_transition:o.globeToMercatorTransition($.zoom),u_is_globe:+($.projection.name==="globe")}})(this,f,p,_,this.transform.frustumCorners.TL,this.transform.frustumCorners.TR,this.transform.frustumCorners.BR,this.transform.frustumCorners.BL,this.transform.globeCenterInViewSpace,this.transform.globeRadius,[this.transform.width*o.exported.devicePixelRatio,this.transform.height*o.exported.devicePixelRatio]);s.setFogUniformValues(t,b)}}setTileLoadedFlag(t){this.tileLoaded=t}saveCanvasCopy(){this.frameCopies.push(this.canvasCopy()),this.tileLoaded=!1}canvasCopy(){let t=this.context.gl,s=t.createTexture();return t.bindTexture(t.TEXTURE_2D,s),t.copyTexImage2D(t.TEXTURE_2D,0,t.RGBA,0,0,t.drawingBufferWidth,t.drawingBufferHeight,0),s}getCanvasCopiesAndTimestamps(){return{canvasCopies:this.frameCopies,timeStamps:this.loadTimeStamps}}averageElevationNeedsEasing(){if(!this.transform._elevation)return!1;let t=this.style&&this.style.fog;return!!t&&t.getOpacity(this.transform.pitch)!==0}getBackgroundTiles(){let t=this._backgroundTiles,s=this._backgroundTiles={},p=this.transform.coveringTiles({tileSize:512});for(let f of p)s[f.key]=t[f.key]||new o.Tile(f,512,this.transform.tileZoom,this);return s}clearBackgroundTiles(){this._backgroundTiles={}}}class On{constructor(t=0,s=0,p=0,f=0){if(isNaN(t)||t<0||isNaN(s)||s<0||isNaN(p)||p<0||isNaN(f)||f<0)throw new Error("Invalid value for edge-insets, top, bottom, left and right must all be numbers");this.top=t,this.bottom=s,this.left=p,this.right=f}interpolate(t,s,p){return s.top!=null&&t.top!=null&&(this.top=o.number(t.top,s.top,p)),s.bottom!=null&&t.bottom!=null&&(this.bottom=o.number(t.bottom,s.bottom,p)),s.left!=null&&t.left!=null&&(this.left=o.number(t.left,s.left,p)),s.right!=null&&t.right!=null&&(this.right=o.number(t.right,s.right,p)),this}getCenter(t,s){let p=o.clamp((this.left+t-this.right)/2,0,t),f=o.clamp((this.top+s-this.bottom)/2,0,s);return new o.pointGeometry(p,f)}equals(t){return this.top===t.top&&this.bottom===t.bottom&&this.left===t.left&&this.right===t.right}clone(){return new On(this.top,this.bottom,this.left,this.right)}toJSON(){return{top:this.top,bottom:this.bottom,left:this.left,right:this.right}}}function Ta(l,t){let s=o.getColumn(l,3);o.fromQuat(l,t),o.setColumn(l,3,s)}function ps(l,t){let s=o.identity$1([]);return o.rotateZ$1(s,s,-t),o.rotateX$1(s,s,-l),s}function Ca(l,t){let s=[l[0],l[1],0],p=[t[0],t[1],0];if(o.length(s)>=1e-15){let b=o.normalize([],s);o.scale$2(p,b,o.dot(p,b)),t[0]=p[0],t[1]=p[1]}let f=o.cross([],t,l);if(o.len(f)<1e-15)return null;let _=Math.atan2(-f[1],f[0]);return ps(Math.atan2(Math.sqrt(l[0]*l[0]+l[1]*l[1]),-l[2]),_)}class ds{constructor(t,s){this.position=t,this.orientation=s}get position(){return this._position}set position(t){if(t){let s=t instanceof o.MercatorCoordinate?t:new o.MercatorCoordinate(t[0],t[1],t[2]);this._renderWorldCopies&&(s.x=o.wrap(s.x,0,1)),this._position=s}else this._position=null}lookAtPoint(t,s){if(this.orientation=null,!this.position)return;let p=this._elevation?this._elevation.getAtPointOrZero(o.MercatorCoordinate.fromLngLat(t)):0,f=this.position,_=o.MercatorCoordinate.fromLngLat(t,p),b=[_.x-f.x,_.y-f.y,_.z-f.z];s||(s=[0,0,1]),s[2]=Math.abs(s[2]),this.orientation=Ca(b,s)}setPitchBearing(t,s){this.orientation=ps(o.degToRad(t),o.degToRad(-s))}}class vo{constructor(t,s){this._transform=o.identity([]),this.orientation=s,this.position=t}get mercatorPosition(){let t=this.position;return new o.MercatorCoordinate(t[0],t[1],t[2])}get position(){let t=o.getColumn(this._transform,3);return[t[0],t[1],t[2]]}set position(t){var s;t&&o.setColumn(this._transform,3,[(s=t)[0],s[1],s[2],1])}get orientation(){return this._orientation}set orientation(t){this._orientation=t||o.identity$1([]),t&&Ta(this._transform,this._orientation)}getPitchBearing(){let t=this.forward(),s=this.right();return{bearing:Math.atan2(-s[1],s[0]),pitch:Math.atan2(Math.sqrt(t[0]*t[0]+t[1]*t[1]),-t[2])}}setPitchBearing(t,s){this._orientation=ps(t,s),Ta(this._transform,this._orientation)}forward(){let t=o.getColumn(this._transform,2);return[-t[0],-t[1],-t[2]]}up(){let t=o.getColumn(this._transform,1);return[-t[0],-t[1],-t[2]]}right(){let t=o.getColumn(this._transform,0);return[t[0],t[1],t[2]]}getCameraToWorld(t,s){let p=new Float64Array(16);return o.invert(p,this.getWorldToCamera(t,s)),p}getWorldToCameraPosition(t,s,p){let f=this.position;o.scale$2(f,f,-t);let _=new Float64Array(16);return o.fromScaling(_,[p,p,p]),o.translate(_,_,f),_[10]*=s,_}getWorldToCamera(t,s){let p=new Float64Array(16),f=new Float64Array(4),_=this.position;return o.conjugate(f,this._orientation),o.scale$2(_,_,-t),o.fromQuat(p,f),o.translate(p,p,_),p[1]*=-1,p[5]*=-1,p[9]*=-1,p[13]*=-1,p[8]*=s,p[9]*=s,p[10]*=s,p[11]*=s,p}getCameraToClipPerspective(t,s,p,f){let _=new Float64Array(16);return o.perspective(_,t,s,p,f),_}getDistanceToElevation(t){let s=t===0?0:o.mercatorZfromAltitude(t,this.position[1]),p=this.forward();return(s-this.position[2])/p[2]}clone(){return new vo([...this.position],[...this.orientation])}}function We(l,t){let s=fs(l.projection,l.zoom,l.width,l.height),p=function(_,b,w,T,A){let I=new o.LngLat(w.lng-180*jn,w.lat),L=new o.LngLat(w.lng+180*jn,w.lat),O=_.project(I.lng,I.lat),V=_.project(L.lng,L.lat),N=-Math.atan2(V.y-O.y,V.x-O.x),j=o.MercatorCoordinate.fromLngLat(w);j.y=o.clamp(j.y,-.999975,.999975);let J=j.toLngLat(),U=_.project(J.lng,J.lat),$=o.MercatorCoordinate.fromLngLat(J);$.x+=jn;let q=$.toLngLat(),ie=_.project(q.lng,q.lat),K=Un(ie.x-U.x,ie.y-U.y,N),Q=o.MercatorCoordinate.fromLngLat(J);Q.y+=jn;let ae=Q.toLngLat(),ye=_.project(ae.lng,ae.lat),be=Un(ye.x-U.x,ye.y-U.y,N),xe=Math.abs(K.x)/Math.abs(be.y),_e=o.identity([]);o.rotateZ(_e,_e,-N*(1-(A?0:T)));let te=o.identity([]);return o.scale(te,te,[1,1-(1-xe)*T,1]),te[4]=-be.x/be.y*T,o.rotateZ(te,te,N),o.multiply(te,_e,te),te}(l.projection,0,l.center,s,t),f=_r(l);return o.scale(p,p,[f,f,1]),p}function _r(l){let t=l.projection,s=fs(l.projection,l.zoom,l.width,l.height),p=Ll(t,l.center),f=Ll(t,o.LngLat.convert(t.center));return Math.pow(2,p*s+(1-s)*f)}function fs(l,t,s,p,f=1/0){let _=l.range;if(!_)return 0;let b=Math.min(f,Math.max(s,p)),w=Math.log(b/1024)/Math.LN2;return o.smoothstep(_[0]+w,_[1]+w,t)}let jn=1/4e4;function Ll(l,t){let s=o.clamp(t.lat,-o.MAX_MERCATOR_LATITUDE,o.MAX_MERCATOR_LATITUDE),p=new o.LngLat(t.lng-180*jn,s),f=new o.LngLat(t.lng+180*jn,s),_=l.project(p.lng,s),b=l.project(f.lng,s),w=o.MercatorCoordinate.fromLngLat(p),T=o.MercatorCoordinate.fromLngLat(f),A=b.x-_.x,I=b.y-_.y,L=T.x-w.x,O=T.y-w.y,V=Math.sqrt((L*L+O*O)/(A*A+I*I));return Math.log(V)/Math.LN2}function Un(l,t,s){let p=Math.cos(s),f=Math.sin(s);return{x:l*p-t*f,y:l*f+t*p}}class ka{constructor(t,s,p,f,_,b,w){this.tileSize=512,this._renderWorldCopies=_===void 0||_,this._minZoom=t||0,this._maxZoom=s||22,this._minPitch=p??0,this._maxPitch=f??60,this.setProjection(b),this.setMaxBounds(w),this.width=0,this.height=0,this._center=new o.LngLat(0,0),this.zoom=0,this.angle=0,this._fov=.6435011087932844,this._pitch=0,this._nearZ=0,this._farZ=0,this._unmodified=!0,this._edgeInsets=new On,this._projMatrixCache={},this._alignedProjMatrixCache={},this._fogTileMatrixCache={},this._distanceTileDataCache={},this._camera=new vo,this._centerAltitude=0,this._averageElevation=0,this.cameraElevationReference="ground",this._projectionScaler=1,this.globeRadius=0,this.globeCenterInViewSpace=[0,0,0],this._horizonShift=.1}clone(){let t=new ka(this._minZoom,this._maxZoom,this._minPitch,this.maxPitch,this._renderWorldCopies,this.getProjection());return t._elevation=this._elevation,t._centerAltitude=this._centerAltitude,t._centerAltitudeValidForExaggeration=this._centerAltitudeValidForExaggeration,t.tileSize=this.tileSize,t.width=this.width,t.height=this.height,t.cameraElevationReference=this.cameraElevationReference,t._center=this._center,t._setZoom(this.zoom),t._seaLevelZoom=this._seaLevelZoom,t.angle=this.angle,t._fov=this._fov,t._pitch=this._pitch,t._nearZ=this._nearZ,t._farZ=this._farZ,t._averageElevation=this._averageElevation,t._unmodified=this._unmodified,t._edgeInsets=this._edgeInsets.clone(),t._camera=this._camera.clone(),t._calcMatrices(),t.freezeTileCoverage=this.freezeTileCoverage,t.frustumCorners=this.frustumCorners,t}get elevation(){return this._elevation}set elevation(t){this._elevation!==t&&(this._elevation=t,this._updateCameraOnTerrain(),this._calcMatrices())}updateElevation(t){let s=this._elevation&&this._elevation.exaggeration()!==this._centerAltitudeValidForExaggeration;(this._seaLevelZoom==null||s)&&this._updateCameraOnTerrain(),(t||s)&&this._constrainCameraAltitude(),this._calcMatrices()}getProjection(){return o.pick(this.projection,["name","center","parallels"])}setProjection(t){this.projectionOptions=t||{name:"mercator"};let s=this.projection?this.getProjection():void 0;this.projection=o.getProjection(this.projectionOptions);let p=!z(s,this.getProjection());return p&&this._calcMatrices(),p}get minZoom(){return this._minZoom}set minZoom(t){this._minZoom!==t&&(this._minZoom=t,this.zoom=Math.max(this.zoom,t))}get maxZoom(){return this._maxZoom}set maxZoom(t){this._maxZoom!==t&&(this._maxZoom=t,this.zoom=Math.min(this.zoom,t))}get minPitch(){return this._minPitch}set minPitch(t){this._minPitch!==t&&(this._minPitch=t,this.pitch=Math.max(this.pitch,t))}get maxPitch(){return this._maxPitch}set maxPitch(t){this._maxPitch!==t&&(this._maxPitch=t,this.pitch=Math.min(this.pitch,t))}get renderWorldCopies(){return this._renderWorldCopies&&this.projection.supportsWorldCopies===!0}set renderWorldCopies(t){t===void 0?t=!0:t===null&&(t=!1),this._renderWorldCopies=t}get worldSize(){return this.tileSize*this.scale}get cameraWorldSize(){let t=Math.max(this._camera.getDistanceToElevation(this._averageElevation),Number.EPSILON);return this._worldSizeFromZoom(this._zoomFromMercatorZ(t))}get pixelsPerMeter(){return this.projection.pixelsPerMeter(this.center.lat,this.worldSize)}get cameraPixelsPerMeter(){return o.mercatorZfromAltitude(this.center.lat,this.cameraWorldSize)}get centerOffset(){return this.centerPoint._sub(this.size._div(2))}get size(){return new o.pointGeometry(this.width,this.height)}get bearing(){return o.wrap(this.rotation,-180,180)}set bearing(t){this.rotation=t}get rotation(){return-this.angle/Math.PI*180}set rotation(t){let s=-t*Math.PI/180;var p;this.angle!==s&&(this._unmodified=!1,this.angle=s,this._calcMatrices(),this.rotationMatrix=(p=new o.ARRAY_TYPE(4),o.ARRAY_TYPE!=Float32Array&&(p[1]=0,p[2]=0),p[0]=1,p[3]=1,p),function(f,_,b){var w=_[0],T=_[1],A=_[2],I=_[3],L=Math.sin(b),O=Math.cos(b);f[0]=w*O+A*L,f[1]=T*O+I*L,f[2]=w*-L+A*O,f[3]=T*-L+I*O}(this.rotationMatrix,this.rotationMatrix,this.angle))}get pitch(){return this._pitch/Math.PI*180}set pitch(t){let s=o.clamp(t,this.minPitch,this.maxPitch)/180*Math.PI;this._pitch!==s&&(this._unmodified=!1,this._pitch=s,this._calcMatrices())}get fov(){return this._fov/Math.PI*180}set fov(t){t=Math.max(.01,Math.min(60,t)),this._fov!==t&&(this._unmodified=!1,this._fov=t/180*Math.PI,this._calcMatrices())}get averageElevation(){return this._averageElevation}set averageElevation(t){this._averageElevation=t,this._calcFogMatrices(),this._distanceTileDataCache={}}get zoom(){return this._zoom}set zoom(t){let s=Math.min(Math.max(t,this.minZoom),this.maxZoom);this._zoom!==s&&(this._unmodified=!1,this._setZoom(s),this._updateSeaLevelZoom(),this._constrain(),this._calcMatrices())}_setZoom(t){this._zoom=t,this.scale=this.zoomScale(t),this.tileZoom=Math.floor(t),this.zoomFraction=t-this.tileZoom}_updateCameraOnTerrain(){if(!this._elevation||!this._elevation.isDataAvailableAtPoint(this.locationCoordinate(this.center)))return this._centerAltitude=0,this._seaLevelZoom=null,void(this._centerAltitudeValidForExaggeration=void 0);let t=this._elevation;this._centerAltitude=t.getAtPointOrZero(this.locationCoordinate(this.center)),this._centerAltitudeValidForExaggeration=t.exaggeration(),this._updateSeaLevelZoom()}_updateSeaLevelZoom(){this._centerAltitudeValidForExaggeration!==void 0&&(this._seaLevelZoom=this._zoomFromMercatorZ((this.pixelsPerMeter*this._centerAltitude+this.cameraToCenterDistance)/this.worldSize))}sampleAverageElevation(){if(!this._elevation)return 0;let t=this._elevation,s=[[.5,.2],[.3,.5],[.5,.5],[.7,.5],[.5,.8]],p=this.horizonLineFromTop(),f=0,_=0;for(let b=0;b<s.length;b++){let w=new o.pointGeometry(s[b][0]*this.width,p+s[b][1]*(this.height-p)),T=t.pointCoordinate(w);if(!T)continue;let A=1/Math.hypot(T[0]-this._camera.position[0],T[1]-this._camera.position[1]);f+=T[3]*A,_+=A}return _===0?NaN:f/_}get center(){return this._center}set center(t){t.lat===this._center.lat&&t.lng===this._center.lng||(this._unmodified=!1,this._center=t,this._terrainEnabled()&&(this.cameraElevationReference==="ground"?this._updateCameraOnTerrain():this._updateZoomFromElevation()),this._constrain(),this._calcMatrices())}_updateZoomFromElevation(){if(this._seaLevelZoom==null||!this._elevation)return;let t=this._seaLevelZoom,s=this._elevation.getAtPointOrZero(this.locationCoordinate(this.center)),p=this.pixelsPerMeter/this.worldSize*s,f=this._mercatorZfromZoom(t),_=this._mercatorZfromZoom(this._maxZoom),b=Math.max(f-p,_);this._setZoom(this._zoomFromMercatorZ(b))}get padding(){return this._edgeInsets.toJSON()}set padding(t){this._edgeInsets.equals(t)||(this._unmodified=!1,this._edgeInsets.interpolate(this._edgeInsets,t,1),this._calcMatrices())}computeZoomRelativeTo(t){let s=this.rayIntersectionCoordinate(this.pointRayIntersection(this.centerPoint,t.toAltitude())),p;p=t.z<this._camera.position[2]?[s.x,s.y,s.z]:[t.x,t.y,t.z];let f=o.length(o.sub([],this._camera.position,p));return o.clamp(this._zoomFromMercatorZ(f),this._minZoom,this._maxZoom)}setFreeCameraOptions(t){if(!this.height||!t.position&&!t.orientation)return;this._updateCameraState();let s=!1;if(t.orientation&&!o.exactEquals(t.orientation,this._camera.orientation)&&(s=this._setCameraOrientation(t.orientation)),t.position){let p=[t.position.x,t.position.y,t.position.z];o.exactEquals$1(p,this._camera.position)||(this._setCameraPosition(p),s=!0)}s&&(this._updateStateFromCamera(),this.recenterOnTerrain())}getFreeCameraOptions(){this._updateCameraState();let t=this._camera.position,s=new ds;return s.position=new o.MercatorCoordinate(t[0],t[1],t[2]),s.orientation=this._camera.orientation,s._elevation=this.elevation,s._renderWorldCopies=this.renderWorldCopies,s}_setCameraOrientation(t){if(!o.length$1(t))return!1;o.normalize$1(t,t);let s=o.transformQuat([],[0,0,-1],t),p=o.transformQuat([],[0,-1,0],t);if(p[2]<0)return!1;let f=Ca(s,p);return!!f&&(this._camera.orientation=f,!0)}_setCameraPosition(t){let s=this.zoomScale(this.minZoom)*this.tileSize,p=this.zoomScale(this.maxZoom)*this.tileSize,f=this.cameraToCenterDistance;t[2]=o.clamp(t[2],f/p,f/s),this._camera.position=t}get centerPoint(){return this._edgeInsets.getCenter(this.width,this.height)}get fovAboveCenter(){return this._fov*(.5+this.centerOffset.y/this.height)}isPaddingEqual(t){return this._edgeInsets.equals(t)}interpolatePadding(t,s,p){this._unmodified=!1,this._edgeInsets.interpolate(t,s,p),this._constrain(),this._calcMatrices()}coveringZoomLevel(t){let s=(t.roundZoom?Math.round:Math.floor)(this.zoom+this.scaleZoom(this.tileSize/t.tileSize));return Math.max(0,s)}getVisibleUnwrappedCoordinates(t){let s=[new o.UnwrappedTileID(0,t)];if(this.renderWorldCopies){let p=this.pointCoordinate(new o.pointGeometry(0,0)),f=this.pointCoordinate(new o.pointGeometry(this.width,0)),_=this.pointCoordinate(new o.pointGeometry(this.width,this.height)),b=this.pointCoordinate(new o.pointGeometry(0,this.height)),w=Math.floor(Math.min(p.x,f.x,_.x,b.x)),T=Math.floor(Math.max(p.x,f.x,_.x,b.x)),A=1;for(let I=w-A;I<=T+A;I++)I!==0&&s.push(new o.UnwrappedTileID(I,t))}return s}coveringTiles(t){let s=this.coveringZoomLevel(t),p=s,f=this.elevation&&!t.isTerrainDEM,_=this.projection.name==="mercator";if(t.minzoom!==void 0&&s<t.minzoom)return[];t.maxzoom!==void 0&&s>t.maxzoom&&(s=t.maxzoom);let b=this.locationCoordinate(this.center),w=this.center.lat,T=1<<s,A=[T*b.x,T*b.y,0],I=this.projection.name==="globe",L=!I,O=o.Frustum.fromInvProjectionMatrix(this.invProjMatrix,this.worldSize,s,L),V=I?this._camera.mercatorPosition:this.pointCoordinate(this.getCameraPoint()),N=T*o.mercatorZfromAltitude(1,this.center.lat),j=this._camera.position[2]/o.mercatorZfromAltitude(1,this.center.lat),J=[T*V.x,T*V.y,j*(L?1:N)],U=this.cameraToCenterDistance/t.tileSize*(t.roundZoom?1:.502),$=this.pitch<=60&&this._edgeInsets.top<=this._edgeInsets.bottom&&!this._elevation&&!this.projection.isReprojectedInTileSpace?s:0,q=t.isTerrainDEM&&this._elevation?1e4*this._elevation.exaggeration():this._centerAltitude,ie=t.isTerrainDEM?-q:this._elevation?this._elevation.getMinElevationBelowMSL():0,K=this.projection.isReprojectedInTileSpace?_r(this):1,Q=Te=>{let Ue=new o.MercatorCoordinate(Te.x+25e-6,Te.y,Te.z),je=new o.MercatorCoordinate(Te.x,Te.y+25e-6,Te.z),Fe=Te.toLngLat(),Oe=Ue.toLngLat(),ht=je.toLngLat(),rt=this.locationCoordinate(Fe),mt=this.locationCoordinate(Oe),et=this.locationCoordinate(ht),pt=Math.hypot(mt.x-rt.x,mt.y-rt.y),Ot=Math.hypot(et.x-rt.x,et.y-rt.y);return Math.sqrt(pt*Ot)*K/25e-6},ae=Te=>{let tt=q,Ue=ie;return{aabb:o.tileAABB(this,T,0,0,0,Te,Ue,tt,this.projection),zoom:0,x:0,y:0,minZ:Ue,maxZ:tt,wrap:Te,fullyVisible:!1}},ye=[],be=[],xe=s,_e=t.reparseOverscaled?p:s,te=Te=>Te*Te,Ie=te((j-this._centerAltitude)*N),Me=Te=>{if(!this._elevation||!Te.tileID||!_)return;let tt=this._elevation.getMinMaxForTile(Te.tileID),Ue=Te.aabb;tt?(Ue.min[2]=tt.min,Ue.max[2]=tt.max,Ue.center[2]=(Ue.min[2]+Ue.max[2])/2):(Te.shouldSplit=Ve(Te),Te.shouldSplit||(Ue.min[2]=Ue.max[2]=Ue.center[2]=this._centerAltitude))},Ve=Te=>{if(Te.zoom<$)return!0;if(Te.zoom===xe)return!1;if(Te.shouldSplit!=null)return Te.shouldSplit;let tt=Te.aabb.distanceX(J),Ue=Te.aabb.distanceY(J),je=Ie,Fe=1;if(I){je=te(Te.aabb.distanceZ(J));let ht=Math.pow(2,Te.zoom),rt=o.latFromMercatorY((Te.y+1)/ht),mt=o.latFromMercatorY(Te.y/ht),et=Math.min(Math.max(w,rt),mt),pt=o.circumferenceAtLatitude(et)/o.circumferenceAtLatitude(w);if(Fe=et===w?1/Math.max(1,this._mercatorScaleRatio-.3):Math.min(1,pt/this._mercatorScaleRatio),this.zoom<=o.GLOBE_ZOOM_THRESHOLD_MIN&&Te.zoom===xe-1&&pt>=.9)return!0}else if(f&&(je=te(Te.aabb.distanceZ(J)*N)),this.projection.isReprojectedInTileSpace&&p<=5){let ht=Math.pow(2,Te.zoom),rt=Q(new o.MercatorCoordinate((Te.x+.5)/ht,(Te.y+.5)/ht));Fe=rt>.85?1:rt}let Oe=tt*tt+Ue*Ue+je;return Oe<te((1<<xe-Te.zoom)*U*Fe*((ht,rt)=>{if(rt*te(.707)<ht)return 1;let mt=Math.sqrt(rt/ht);return mt/(1.4144271570014144+(Math.pow(1.1,mt-1.4144271570014144+1)-1)/(1.1-1)-1)})(Math.max(je,Ie),Oe))};if(this.renderWorldCopies)for(let Te=1;Te<=3;Te++)ye.push(ae(-Te)),ye.push(ae(Te));for(ye.push(ae(0));ye.length>0;){let Te=ye.pop(),tt=Te.x,Ue=Te.y,je=Te.fullyVisible;if(!je){let Fe=Te.aabb.intersects(O);if(Fe===0)continue;je=Fe===2}if(Te.zoom!==xe&&Ve(Te))for(let Fe=0;Fe<4;Fe++){let Oe=(tt<<1)+Fe%2,ht=(Ue<<1)+(Fe>>1),rt={aabb:_?Te.aabb.quadrant(Fe):o.tileAABB(this,T,Te.zoom+1,Oe,ht,Te.wrap,Te.minZ,Te.maxZ,this.projection),zoom:Te.zoom+1,x:Oe,y:ht,wrap:Te.wrap,fullyVisible:je,tileID:void 0,shouldSplit:void 0,minZ:Te.minZ,maxZ:Te.maxZ};f&&!I&&(rt.tileID=new o.OverscaledTileID(Te.zoom+1===xe?_e:Te.zoom+1,Te.wrap,Te.zoom+1,Oe,ht),Me(rt)),ye.push(rt)}else{let Fe=Te.zoom===xe?_e:Te.zoom;if(t.minzoom&&t.minzoom>Fe)continue;let Oe=A[0]-(.5+tt+(Te.wrap<<Te.zoom))*(1<<s-Te.zoom),ht=A[1]-.5-Ue,rt=Te.tileID?Te.tileID:new o.OverscaledTileID(Fe,Te.wrap,Te.zoom,tt,Ue);be.push({tileID:rt,distanceSq:Oe*Oe+ht*ht})}}if(this.fogCullDistSq){let Te=this.fogCullDistSq,tt=this.horizonLineFromTop();be=be.filter(Ue=>{let je=[0,0,0,1],Fe=[o.EXTENT,o.EXTENT,0,1],Oe=this.calculateFogTileMatrix(Ue.tileID.toUnwrapped());o.transformMat4$1(je,je,Oe),o.transformMat4$1(Fe,Fe,Oe);let ht=o.getAABBPointSquareDist(je,Fe);if(ht===0)return!0;let rt=!1,mt=this._elevation;if(mt&&ht>Te&&tt!==0){let et=this.calculateProjMatrix(Ue.tileID.toUnwrapped()),pt;t.isTerrainDEM||(pt=mt.getMinMaxForTile(Ue.tileID)),pt||(pt={min:ie,max:q});let Ot=o.furthestTileCorner(this.rotation),Gt=[Ot[0]*o.EXTENT,Ot[1]*o.EXTENT,pt.max];o.transformMat4(Gt,Gt,et),rt=(1-Gt[1])*this.height*.5<tt}return ht<Te||rt})}return be.sort((Te,tt)=>Te.distanceSq-tt.distanceSq).map(Te=>Te.tileID)}resize(t,s){this.width=t,this.height=s,this.pixelsToGLUnits=[2/t,-2/s],this._constrain(),this._calcMatrices()}get unmodified(){return this._unmodified}zoomScale(t){return Math.pow(2,t)}scaleZoom(t){return Math.log(t)/Math.LN2}project(t){let s=o.clamp(t.lat,-o.MAX_MERCATOR_LATITUDE,o.MAX_MERCATOR_LATITUDE),p=this.projection.project(t.lng,s);return new o.pointGeometry(p.x*this.worldSize,p.y*this.worldSize)}unproject(t){return this.projection.unproject(t.x/this.worldSize,t.y/this.worldSize)}get point(){return this.project(this.center)}setLocationAtPoint(t,s){let p,f,_=this.centerPoint;if(this.projection.name==="globe"){let w=this.worldSize;p=(s.x-_.x)/w,f=(s.y-_.y)/w}else{let w=this.pointCoordinate(s),T=this.pointCoordinate(_);p=w.x-T.x,f=w.y-T.y}let b=this.locationCoordinate(t);this.setLocation(new o.MercatorCoordinate(b.x-p,b.y-f))}setLocation(t){this.center=this.coordinateLocation(t),this.projection.wrap&&(this.center=this.center.wrap())}locationPoint(t){return this.projection.locationPoint(this,t)}locationPoint3D(t){return this.projection.locationPoint(this,t,!0)}pointLocation(t){return this.coordinateLocation(this.pointCoordinate(t))}pointLocation3D(t){return this.coordinateLocation(this.pointCoordinate3D(t))}locationCoordinate(t,s){let p=s?o.mercatorZfromAltitude(s,t.lat):void 0,f=this.projection.project(t.lng,t.lat);return new o.MercatorCoordinate(f.x,f.y,p)}coordinateLocation(t){return this.projection.unproject(t.x,t.y)}pointRayIntersection(t,s){let p=s??this._centerAltitude,f=[t.x,t.y,0,1],_=[t.x,t.y,1,1];o.transformMat4$1(f,f,this.pixelMatrixInverse),o.transformMat4$1(_,_,this.pixelMatrixInverse);let b=_[3];o.scale$1(f,f,1/f[3]),o.scale$1(_,_,1/b);let w=f[2],T=_[2];return{p0:f,p1:_,t:w===T?0:(p-w)/(T-w)}}screenPointToMercatorRay(t){let s=[t.x,t.y,0,1],p=[t.x,t.y,1,1];return o.transformMat4$1(s,s,this.pixelMatrixInverse),o.transformMat4$1(p,p,this.pixelMatrixInverse),o.scale$1(s,s,1/s[3]),o.scale$1(p,p,1/p[3]),s[2]=o.mercatorZfromAltitude(s[2],this._center.lat)*this.worldSize,p[2]=o.mercatorZfromAltitude(p[2],this._center.lat)*this.worldSize,o.scale$1(s,s,1/this.worldSize),o.scale$1(p,p,1/this.worldSize),new o.Ray([s[0],s[1],s[2]],o.normalize([],o.sub([],p,s)))}rayIntersectionCoordinate(t){let{p0:s,p1:p,t:f}=t,_=o.mercatorZfromAltitude(s[2],this._center.lat),b=o.mercatorZfromAltitude(p[2],this._center.lat);return new o.MercatorCoordinate(o.number(s[0],p[0],f)/this.worldSize,o.number(s[1],p[1],f)/this.worldSize,o.number(_,b,f))}pointCoordinate(t,s=this._centerAltitude){return this.projection.pointCoordinate(this,t.x,t.y,s)}pointCoordinate3D(t){if(!this.elevation)return this.pointCoordinate(t);let s=this.projection.pointCoordinate3D(this,t.x,t.y);if(s)return new o.MercatorCoordinate(s[0],s[1],s[2]);let p=0,f=this.horizonLineFromTop();if(t.y>f)return this.pointCoordinate(t);let _=.02*f,b=t.clone();for(let w=0;w<10&&f-p>_;w++){b.y=o.number(p,f,.66);let T=this.projection.pointCoordinate3D(this,b.x,b.y);T?(f=b.y,s=T):p=b.y}return s?new o.MercatorCoordinate(s[0],s[1],s[2]):this.pointCoordinate(t)}isPointAboveHorizon(t){return this.projection.isPointAboveHorizon(this,t)}_coordinatePoint(t,s){let p=s&&this.elevation?this.elevation.getAtPointOrZero(t,this._centerAltitude):this._centerAltitude,f=[t.x*this.worldSize,t.y*this.worldSize,p+t.toAltitude(),1];return o.transformMat4$1(f,f,this.pixelMatrix),f[3]>0?new o.pointGeometry(f[0]/f[3],f[1]/f[3]):new o.pointGeometry(Number.MAX_VALUE,Number.MAX_VALUE)}_getBounds(t,s){let p=new o.pointGeometry(this._edgeInsets.left,this._edgeInsets.top),f=new o.pointGeometry(this.width-this._edgeInsets.right,this._edgeInsets.top),_=new o.pointGeometry(this.width-this._edgeInsets.right,this.height-this._edgeInsets.bottom),b=new o.pointGeometry(this._edgeInsets.left,this.height-this._edgeInsets.bottom),w=this.pointCoordinate(p,t),T=this.pointCoordinate(f,t),A=this.pointCoordinate(_,s),I=this.pointCoordinate(b,s),L=(O,V)=>(V.y-O.y)/(V.x-O.x);return w.y>1&&T.y>=0?w=new o.MercatorCoordinate((1-I.y)/L(I,w)+I.x,1):w.y<0&&T.y<=1&&(w=new o.MercatorCoordinate(-I.y/L(I,w)+I.x,0)),T.y>1&&w.y>=0?T=new o.MercatorCoordinate((1-A.y)/L(A,T)+A.x,1):T.y<0&&w.y<=1&&(T=new o.MercatorCoordinate(-A.y/L(A,T)+A.x,0)),new o.LngLatBounds().extend(this.coordinateLocation(w)).extend(this.coordinateLocation(T)).extend(this.coordinateLocation(I)).extend(this.coordinateLocation(A))}_getBounds3D(){let t=this.elevation;if(!t.visibleDemTiles.length)return this._getBounds(0,0);let s=t.visibleDemTiles.reduce((p,f)=>{if(f.dem){let _=f.dem.tree;p.min=Math.min(p.min,_.minimums[0]),p.max=Math.max(p.max,_.maximums[0])}return p},{min:Number.MAX_VALUE,max:0});return this._getBounds(s.min*t.exaggeration(),s.max*t.exaggeration())}getBounds(){return this._terrainEnabled()?this._getBounds3D():this._getBounds(0,0)}horizonLineFromTop(t=!0){let s=this.height/2/Math.tan(this._fov/2)/Math.tan(Math.max(this._pitch,.1))+this.centerOffset.y,p=this.height/2-s*(1-this._horizonShift);return t?Math.max(0,p):p}getMaxBounds(){return this.maxBounds}setMaxBounds(t){this.maxBounds=t,this.minLat=-o.MAX_MERCATOR_LATITUDE,this.maxLat=o.MAX_MERCATOR_LATITUDE,this.minLng=-180,this.maxLng=180,t&&(this.minLat=t.getSouth(),this.maxLat=t.getNorth(),this.minLng=t.getWest(),this.maxLng=t.getEast(),this.maxLng<this.minLng&&(this.maxLng+=360)),this.worldMinX=o.mercatorXfromLng(this.minLng)*this.tileSize,this.worldMaxX=o.mercatorXfromLng(this.maxLng)*this.tileSize,this.worldMinY=o.mercatorYfromLat(this.maxLat)*this.tileSize,this.worldMaxY=o.mercatorYfromLat(this.minLat)*this.tileSize,this._constrain()}calculatePosMatrix(t,s){return this.projection.createTileMatrix(this,s,t)}calculateDistanceTileData(t){let s=t.key,p=this._distanceTileDataCache;if(p[s])return p[s];let f=t.canonical,_=1/this.height,b=this.cameraWorldSize/this.zoomScale(f.z),w=(f.x+Math.pow(2,f.z)*t.wrap)*b,T=f.y*b,A=this.point,I=this.angle,L=Math.sin(-I),O=-Math.cos(-I);return p[s]={bearing:[L,O],center:[(A.x-w)*_,(A.y-T)*_],scale:b/o.EXTENT*_},p[s]}calculateFogTileMatrix(t){let s=t.key,p=this._fogTileMatrixCache;if(p[s])return p[s];let f=this.projection.createTileMatrix(this,this.cameraWorldSize,t);return o.multiply(f,this.worldToFogMatrix,f),p[s]=new Float32Array(f),p[s]}calculateProjMatrix(t,s=!1){let p=t.key,f=s?this._alignedProjMatrixCache:this._projMatrixCache;if(f[p])return f[p];let _=this.calculatePosMatrix(t,this.worldSize);return o.multiply(_,this.projection.isReprojectedInTileSpace?this.mercatorMatrix:s?this.alignedProjMatrix:this.projMatrix,_),f[p]=new Float32Array(_),f[p]}calculatePixelsToTileUnitsMatrix(t){let s=t.tileID.key,p=this._pixelsToTileUnitsCache;if(p[s])return p[s];let f=function(_,b){let{scale:w}=_.tileTransform,T=w*o.EXTENT/(_.tileSize*Math.pow(2,b.zoom-_.tileID.overscaledZ+_.tileID.canonical.z));return A=new Float32Array(4),O=(I=b.inverseAdjustmentMatrix)[1],V=I[2],N=I[3],J=(L=[T,T])[1],A[0]=I[0]*(j=L[0]),A[1]=O*j,A[2]=V*J,A[3]=N*J,A;var A,I,L,O,V,N,j,J}(t,this);return p[s]=f,p[s]}customLayerMatrix(){return this.mercatorMatrix.slice()}recenterOnTerrain(){if(!this._elevation||this.projection.name==="globe")return;let t=this._elevation;this._updateCameraState();let s=o.mercatorZfromAltitude(1,this._center.lat)*this.worldSize,p=this._computeCameraPosition(s),f=this._camera.forward(),_=o.mercatorZfromAltitude(1,this._center.lat);p[2]/=_,f[2]/=_,o.normalize(f,f);let b=t.raycast(p,f,t.exaggeration());if(b){let w=o.scaleAndAdd([],p,f,b),T=new o.MercatorCoordinate(w[0],w[1],o.mercatorZfromAltitude(w[2],o.latFromMercatorY(w[1]))),A=(T.z+o.length([T.x-p[0],T.y-p[1],T.z-p[2]*_]))*this._projectionScaler;this._seaLevelZoom=this._zoomFromMercatorZ(A),this._centerAltitude=T.toAltitude(),this._center=this.coordinateLocation(T),this._updateZoomFromElevation(),this._constrain(),this._calcMatrices()}}_constrainCameraAltitude(){if(!this._elevation)return;let t=this._elevation;this._updateCameraState();let s=o.mercatorZfromAltitude(1,this._center.lat)*this.worldSize,p=this._computeCameraPosition(s),f=t.getAtPointOrZero(new o.MercatorCoordinate(...p)),_=this._minimumHeightOverTerrain()*Math.cos(o.degToRad(this._maxPitch)),b=this._camera.position[2]-this.pixelsPerMeter/this.worldSize*f;if(b<_){let w=this.locationCoordinate(this._center,this._centerAltitude),T=[w.x-p[0],w.y-p[1],w.z-p[2]],A=o.length(T);T[2]-=(_-b)/this._projectionScaler;let I=o.length(T);if(I===0)return;o.scale$2(T,T,A/I*this._projectionScaler),this._camera.position=[w.x-T[0],w.y-T[1],w.z*this._projectionScaler-T[2]],this._camera.orientation=Ca(T,this._camera.up()),this._updateStateFromCamera()}}_constrain(){if(!this.center||!this.width||!this.height||this._constraining)return;if(this._constraining=!0,this.projection.isReprojectedInTileSpace){let L=this.center;return L.lat=o.clamp(L.lat,this.minLat,this.maxLat),!this.maxBounds&&this.renderWorldCopies||(L.lng=o.clamp(L.lng,this.minLng,this.maxLng)),this.center=L,void(this._constraining=!1)}let t=this._unmodified,{x:s,y:p}=this.point,f=0,_=s,b=p,w=this.width/2,T=this.height/2,A=this.worldMinY*this.scale,I=this.worldMaxY*this.scale;if(p-T<A&&(b=A+T),p+T>I&&(b=I-T),I-A<this.height&&(f=Math.max(f,this.height/(I-A)),b=(I+A)/2),this.maxBounds||!this._renderWorldCopies||!this.projection.wrap){let L=this.worldMinX*this.scale,O=this.worldMaxX*this.scale,V=this.worldSize/2-(L+O)/2;_=(s+V+this.worldSize)%this.worldSize-V,_-w<L&&(_=L+w),_+w>O&&(_=O-w),O-L<this.width&&(f=Math.max(f,this.width/(O-L)),_=(O+L)/2)}_===s&&b===p||(this.center=this.unproject(new o.pointGeometry(_,b))),f&&(this.zoom+=this.scaleZoom(f)),this._constrainCameraAltitude(),this._unmodified=t,this._constraining=!1}_minZoomForBounds(){let t=Math.max(0,this.scaleZoom(this.height/(this.worldMaxY-this.worldMinY)));return this.maxBounds&&(t=Math.max(t,this.scaleZoom(this.width/(this.worldMaxX-this.worldMinX)))),t}_maxCameraBoundsDistance(){return this._mercatorZfromZoom(this._minZoomForBounds())}_calcMatrices(){if(!this.height)return;let t=this.centerOffset,s=this.pixelsPerMeter;if(this.projection.name==="globe"){let K=o.mercatorZfromAltitude(1,this.center.lat)*this.worldSize,Q=o.mercatorZfromAltitude(1,o.GLOBE_SCALE_MATCH_LATITUDE)*this.worldSize;this._mercatorScaleRatio=K/Q}let p=fs(this.projection,this.zoom,this.width,this.height,1024);this._projectionScaler=this.projection.pixelSpaceConversion(this.center.lat,this.worldSize,p),this.cameraToCenterDistance=this.getCameraToCenterDistance(this.projection),this._updateCameraState(),this._farZ=this.projection.farthestPixelDistance(this),this._nearZ=this.height/50;let f=this._camera.getWorldToCamera(this.worldSize,this.projection.zAxisUnit==="meters"?s:1),_=this._camera.getCameraToClipPerspective(this._fov,this.width/this.height,this._nearZ,this._farZ);_[8]=2*-t.x/this.width,_[9]=2*t.y/this.height;let b=o.mul([],_,f);if(this.projection.isReprojectedInTileSpace){let K=this.locationCoordinate(this.center),Q=o.identity([]);o.translate(Q,Q,[K.x*this.worldSize,K.y*this.worldSize,0]),o.multiply(Q,Q,We(this)),o.translate(Q,Q,[-K.x*this.worldSize,-K.y*this.worldSize,0]),o.multiply(b,b,Q),this.inverseAdjustmentMatrix=function(ae){let ye=We(ae,!0);return li([],[ye[0],ye[1],ye[4],ye[5]])}(this)}else this.inverseAdjustmentMatrix=[1,0,0,1];this.mercatorMatrix=o.scale([],b,[this.worldSize,this.worldSize,this.worldSize/s,1]),this.projMatrix=b,this.invProjMatrix=o.invert(new Float64Array(16),this.projMatrix);let w=o.invert([],_);this.frustumCorners=o.FrustumCorners.fromInvProjectionMatrix(w,this.horizonLineFromTop(),this.height);let T=new Float32Array(16);o.identity(T),o.scale(T,T,[1,-1,1]),o.rotateX(T,T,this._pitch),o.rotateZ(T,T,this.angle);let A=o.perspective(new Float32Array(16),this._fov,this.width/this.height,this._nearZ,this._farZ),I=(Math.PI/2-this._pitch)*(this.height/this._fov)*this._horizonShift;A[8]=2*-t.x/this.width,A[9]=2*(t.y+I)/this.height,this.skyboxMatrix=o.multiply(T,A,T);let L=this.point,O=L.x,V=L.y,N=this.width%2/2,j=this.height%2/2,J=Math.cos(this.angle),U=Math.sin(this.angle),$=O-Math.round(O)+J*N+U*j,q=V-Math.round(V)+J*j+U*N,ie=new Float64Array(b);if(o.translate(ie,ie,[$>.5?$-1:$,q>.5?q-1:q,0]),this.alignedProjMatrix=ie,b=o.create(),o.scale(b,b,[this.width/2,-this.height/2,1]),o.translate(b,b,[1,-1,0]),this.labelPlaneMatrix=b,b=o.create(),o.scale(b,b,[1,-1,1]),o.translate(b,b,[-1,-1,0]),o.scale(b,b,[2/this.width,2/this.height,1]),this.glCoordMatrix=b,this.pixelMatrix=o.multiply(new Float64Array(16),this.labelPlaneMatrix,this.projMatrix),this._calcFogMatrices(),this._distanceTileDataCache={},b=o.invert(new Float64Array(16),this.pixelMatrix),!b)throw new Error("failed to invert matrix");if(this.pixelMatrixInverse=b,this.projection.name==="globe"||this.mercatorFromTransition){this.globeMatrix=o.calculateGlobeMatrix(this);let K=[this.globeMatrix[12],this.globeMatrix[13],this.globeMatrix[14]];this.globeCenterInViewSpace=o.transformMat4(K,K,f),this.globeRadius=this.worldSize/2/Math.PI-1}else this.globeMatrix=b;this._projMatrixCache={},this._alignedProjMatrixCache={},this._pixelsToTileUnitsCache={}}_calcFogMatrices(){this._fogTileMatrixCache={};let t=this.cameraWorldSize,s=this.cameraPixelsPerMeter,p=this._camera.position,f=1/this.height/this._projectionScaler,_=[t,t,s];o.scale$2(_,_,f),o.scale$2(p,p,-1),o.multiply$2(p,p,_);let b=o.create();o.translate(b,b,p),o.scale(b,b,_),this.mercatorFogMatrix=b,this.worldToFogMatrix=this._camera.getWorldToCameraPosition(t,s,f)}_computeCameraPosition(t){let s=(t=t||this.pixelsPerMeter)/this.pixelsPerMeter,p=this._camera.forward(),f=this.point,_=this._mercatorZfromZoom(this._seaLevelZoom?this._seaLevelZoom:this._zoom)*s-t/this.worldSize*this._centerAltitude;return[f.x/this.worldSize-p[0]*_,f.y/this.worldSize-p[1]*_,t/this.worldSize*this._centerAltitude-p[2]*_]}_updateCameraState(){this.height&&(this._camera.setPitchBearing(this._pitch,this.angle),this._camera.position=this._computeCameraPosition())}_translateCameraConstrained(t){let s=this._maxCameraBoundsDistance()*Math.cos(this._pitch),p=t[2],f=1;p>0&&(f=Math.min((s-this._camera.position[2])/p,1)),this._camera.position=o.scaleAndAdd([],this._camera.position,t,f),this._updateStateFromCamera(),this.projection.wrap&&(this.center=this.center.wrap())}_updateStateFromCamera(){let t=this._camera.position,s=this._camera.forward(),{pitch:p,bearing:f}=this._camera.getPitchBearing(),_=o.mercatorZfromAltitude(this._centerAltitude,this.center.lat)*this._projectionScaler,b=this._mercatorZfromZoom(this._maxZoom)*Math.cos(o.degToRad(this._maxPitch)),w=Math.max((t[2]-_)/Math.cos(p),b),T=this._zoomFromMercatorZ(w);o.scaleAndAdd(t,t,s,w),this._pitch=o.clamp(p,o.degToRad(this.minPitch),o.degToRad(this.maxPitch)),this.angle=o.wrap(f,-Math.PI,Math.PI),this._setZoom(o.clamp(T,this._minZoom,this._maxZoom)),this._updateSeaLevelZoom(),this._center=this.coordinateLocation(new o.MercatorCoordinate(t[0],t[1],t[2])),this._unmodified=!1,this._constrain(),this._calcMatrices()}_worldSizeFromZoom(t){return Math.pow(2,t)*this.tileSize}_mercatorZfromZoom(t){return this.cameraToCenterDistance/this._worldSizeFromZoom(t)}_minimumHeightOverTerrain(){let t=Math.min((this._seaLevelZoom!=null?this._seaLevelZoom:this._zoom)+2,this._maxZoom);return this._mercatorZfromZoom(t)}_zoomFromMercatorZ(t){return this.scaleZoom(this.cameraToCenterDistance/(t*this.tileSize))}_terrainEnabled(){return!(!this._elevation||!this.projection.supportsTerrain&&(o.warnOnce("Terrain is not yet supported with alternate projections. Use mercator or globe to enable terrain."),1))}anyCornerOffEdge(t,s){let p=Math.min(t.x,s.x),f=Math.max(t.x,s.x),_=Math.min(t.y,s.y),b=Math.max(t.y,s.y);if(_<this.horizonLineFromTop(!1))return!0;if(this.projection.name!=="mercator")return!1;let w=[new o.pointGeometry(p,_),new o.pointGeometry(f,b),new o.pointGeometry(p,b),new o.pointGeometry(f,_)],T=this.renderWorldCopies?-3:0,A=this.renderWorldCopies?4:1;for(let I of w){let L=this.pointRayIntersection(I);if(L.t<0)return!0;let O=this.rayIntersectionCoordinate(L);if(O.x<T||O.y<0||O.x>A||O.y>1)return!0}return!1}isHorizonVisible(){return this.pitch+o.radToDeg(this.fovAboveCenter)>88||this.anyCornerOffEdge(new o.pointGeometry(0,0),new o.pointGeometry(this.width,this.height))}zoomDeltaToMovement(t,s){let p=o.length(o.sub([],this._camera.position,t)),f=this._zoomFromMercatorZ(p)+s;return p-this._mercatorZfromZoom(f)}getCameraPoint(){if(this.projection.name==="globe"){let t=function(s,p){let f=[s[0],s[1],s[2],1];o.transformMat4$1(f,f,p);let _=Math.max(f[3],1e-6);return[f[0]/_,f[1]/_,f[2]/_,_]}([this.globeMatrix[12],this.globeMatrix[13],this.globeMatrix[14]],this.pixelMatrix);return new o.pointGeometry(t[0],t[1])}{let t=Math.tan(this._pitch)*(this.cameraToCenterDistance||1);return this.centerPoint.add(new o.pointGeometry(0,t))}}getCameraToCenterDistance(t){let s=fs(t,this.zoom,this.width,this.height,1024),p=t.pixelSpaceConversion(this.center.lat,this.worldSize,s);return .5/Math.tan(.5*this._fov)*this.height*p}}function ms(l,t){let s=!1,p=null,f=()=>{p=null,s&&(l(),p=setTimeout(f,t),s=!1)};return()=>(s=!0,p||f(),p)}class Bl{constructor(t){this._hashName=t&&encodeURIComponent(t),o.bindAll(["_getCurrentHash","_onHashChange","_updateHash"],this),this._updateHash=ms(this._updateHashUnthrottled.bind(this),300)}addTo(t){return this._map=t,o.window.addEventListener("hashchange",this._onHashChange,!1),t.on("moveend",this._updateHash),this}remove(){return this._map?(this._map.off("moveend",this._updateHash),o.window.removeEventListener("hashchange",this._onHashChange,!1),clearTimeout(this._updateHash()),this._map=void 0,this):this}getHashString(t){let s=this._map;if(!s)return"";let p=s.getCenter(),f=Math.round(100*s.getZoom())/100,_=Math.ceil((f*Math.LN2+Math.log(512/360/.5))/Math.LN10),b=Math.pow(10,_),w=Math.round(p.lng*b)/b,T=Math.round(p.lat*b)/b,A=s.getBearing(),I=s.getPitch(),L="";if(L+=t?`/${w}/${T}/${f}`:`${f}/${T}/${w}`,(A||I)&&(L+="/"+Math.round(10*A)/10),I&&(L+=`/${Math.round(I)}`),this._hashName){let O=this._hashName,V=!1,N=o.window.location.hash.slice(1).split("&").map(j=>{let J=j.split("=")[0];return J===O?(V=!0,`${J}=${L}`):j}).filter(j=>j);return V||N.push(`${O}=${L}`),`#${N.join("&")}`}return`#${L}`}_getCurrentHash(){let t=o.window.location.hash.replace("#","");if(this._hashName){let s;return t.split("&").map(p=>p.split("=")).forEach(p=>{p[0]===this._hashName&&(s=p)}),(s&&s[1]||"").split("/")}return t.split("/")}_onHashChange(){let t=this._map;if(!t)return!1;let s=this._getCurrentHash();if(s.length>=3&&!s.some(p=>isNaN(p))){let p=t.dragRotate.isEnabled()&&t.touchZoomRotate.isEnabled()?+(s[3]||0):t.getBearing();return t.jumpTo({center:[+s[2],+s[1]],zoom:+s[0],bearing:p,pitch:+(s[4]||0)}),!0}return!1}_updateHashUnthrottled(){let t=o.window.location.href.replace(/(#.+)?$/,this.getHashString());o.window.history.replaceState(o.window.history.state,null,t)}}let Vn={linearity:.3,easing:o.bezier(0,0,.3,1)},ph=o.extend({deceleration:2500,maxSpeed:1400},Vn),dh=o.extend({deceleration:20,maxSpeed:1400},Vn),bo=o.extend({deceleration:1e3,maxSpeed:360},Vn),xp=o.extend({deceleration:1e3,maxSpeed:90},Vn);class vp{constructor(t){this._map=t,this.clear()}clear(){this._inertiaBuffer=[]}record(t){this._drainInertiaBuffer(),this._inertiaBuffer.push({time:o.exported.now(),settings:t})}_drainInertiaBuffer(){let t=this._inertiaBuffer,s=o.exported.now();for(;t.length>0&&s-t[0].time>160;)t.shift()}_onMoveEnd(t){if(this._drainInertiaBuffer(),this._inertiaBuffer.length<2)return;let s={zoom:0,bearing:0,pitch:0,pan:new o.pointGeometry(0,0),pinchAround:void 0,around:void 0};for(let{settings:_}of this._inertiaBuffer)s.zoom+=_.zoomDelta||0,s.bearing+=_.bearingDelta||0,s.pitch+=_.pitchDelta||0,_.panDelta&&s.pan._add(_.panDelta),_.around&&(s.around=_.around),_.pinchAround&&(s.pinchAround=_.pinchAround);let p=this._inertiaBuffer[this._inertiaBuffer.length-1].time-this._inertiaBuffer[0].time,f={};if(s.pan.mag()){let _=Nn(s.pan.mag(),p,o.extend({},ph,t||{}));f.offset=s.pan.mult(_.amount/s.pan.mag()),f.center=this._map.transform.center,gs(f,_)}if(s.zoom){let _=Nn(s.zoom,p,dh);f.zoom=this._map.transform.zoom+_.amount,gs(f,_)}if(s.bearing){let _=Nn(s.bearing,p,bo);f.bearing=this._map.transform.bearing+o.clamp(_.amount,-179,179),gs(f,_)}if(s.pitch){let _=Nn(s.pitch,p,xp);f.pitch=this._map.transform.pitch+_.amount,gs(f,_)}if(f.zoom||f.bearing){let _=s.pinchAround===void 0?s.around:s.pinchAround;f.around=_?this._map.unproject(_):this._map.getCenter()}return this.clear(),f.noMoveStart=!0,f}}function gs(l,t){(!l.duration||l.duration<t.duration)&&(l.duration=t.duration,l.easing=t.easing)}function Nn(l,t,s){let{maxSpeed:p,linearity:f,deceleration:_}=s,b=o.clamp(l*f/(t/1e3),-p,p),w=Math.abs(b)/(_*f);return{easing:s.easing,duration:1e3*w,amount:b*(w/2)}}class Ni extends o.Event{preventDefault(){this._defaultPrevented=!0}get defaultPrevented(){return this._defaultPrevented}constructor(t,s,p,f={}){let _=Je(s.getCanvasContainer(),p),b=s.unproject(_);super(t,o.extend({point:_,lngLat:b,originalEvent:p},f)),this._defaultPrevented=!1,this.target=s}}class _s extends o.Event{preventDefault(){this._defaultPrevented=!0}get defaultPrevented(){return this._defaultPrevented}constructor(t,s,p){let f=t==="touchend"?p.changedTouches:p.touches,_=Et(s.getCanvasContainer(),f),b=_.map(T=>s.unproject(T)),w=_.reduce((T,A,I,L)=>T.add(A.div(L.length)),new o.pointGeometry(0,0));super(t,{points:_,point:w,lngLats:b,lngLat:s.unproject(w),originalEvent:p}),this._defaultPrevented=!1}}class fh extends o.Event{preventDefault(){this._defaultPrevented=!0}get defaultPrevented(){return this._defaultPrevented}constructor(t,s,p){super(t,{originalEvent:p}),this._defaultPrevented=!1}}class Sa{constructor(t,s){this._map=t,this._clickTolerance=s.clickTolerance}reset(){this._mousedownPos=void 0}wheel(t){return this._firePreventable(new fh(t.type,this._map,t))}mousedown(t,s){return this._mousedownPos=s,this._firePreventable(new Ni(t.type,this._map,t))}mouseup(t){this._map.fire(new Ni(t.type,this._map,t))}preclick(t){let s=o.extend({},t);s.type="preclick",this._map.fire(new Ni(s.type,this._map,s))}click(t,s){this._mousedownPos&&this._mousedownPos.dist(s)>=this._clickTolerance||(this.preclick(t),this._map.fire(new Ni(t.type,this._map,t)))}dblclick(t){return this._firePreventable(new Ni(t.type,this._map,t))}mouseover(t){this._map.fire(new Ni(t.type,this._map,t))}mouseout(t){this._map.fire(new Ni(t.type,this._map,t))}touchstart(t){return this._firePreventable(new _s(t.type,this._map,t))}touchmove(t){this._map.fire(new _s(t.type,this._map,t))}touchend(t){this._map.fire(new _s(t.type,this._map,t))}touchcancel(t){this._map.fire(new _s(t.type,this._map,t))}_firePreventable(t){if(this._map.fire(t),t.defaultPrevented)return{}}isEnabled(){return!0}isActive(){return!1}enable(){}disable(){}}class Rl{constructor(t){this._map=t}reset(){this._delayContextMenu=!1,this._contextMenuEvent=void 0}mousemove(t){this._map.fire(new Ni(t.type,this._map,t))}mousedown(){this._delayContextMenu=!0}mouseup(){this._delayContextMenu=!1,this._contextMenuEvent&&(this._map.fire(new Ni("contextmenu",this._map,this._contextMenuEvent)),delete this._contextMenuEvent)}contextmenu(t){this._delayContextMenu?this._contextMenuEvent=t:this._map.fire(new Ni(t.type,this._map,t)),this._map.listens("contextmenu")&&t.preventDefault()}isEnabled(){return!0}isActive(){return!1}enable(){}disable(){}}class mh{constructor(t,s){this._map=t,this._el=t.getCanvasContainer(),this._container=t.getContainer(),this._clickTolerance=s.clickTolerance||1}isEnabled(){return!!this._enabled}isActive(){return!!this._active}enable(){this.isEnabled()||(this._enabled=!0)}disable(){this.isEnabled()&&(this._enabled=!1)}mousedown(t,s){this.isEnabled()&&t.shiftKey&&t.button===0&&(Ke(),this._startPos=this._lastPos=s,this._active=!0)}mousemoveWindow(t,s){if(!this._active)return;let p=s;if(this._lastPos.equals(p)||!this._box&&p.dist(this._startPos)<this._clickTolerance)return;let f=this._startPos;this._lastPos=p,this._box||(this._box=oe("div","mapboxgl-boxzoom",this._container),this._container.classList.add("mapboxgl-crosshair"),this._fireEvent("boxzoomstart",t));let _=Math.min(f.x,p.x),b=Math.max(f.x,p.x),w=Math.min(f.y,p.y),T=Math.max(f.y,p.y);this._map._requestDomTask(()=>{this._box&&(this._box.style.transform=`translate(${_}px,${w}px)`,this._box.style.width=b-_+"px",this._box.style.height=T-w+"px")})}mouseupWindow(t,s){if(!this._active||t.button!==0)return;let p=this._startPos,f=s;if(this.reset(),wt(),p.x!==f.x||p.y!==f.y)return this._map.fire(new o.Event("boxzoomend",{originalEvent:t})),{cameraAnimation:_=>_.fitScreenCoordinates(p,f,this._map.getBearing(),{linear:!1})};this._fireEvent("boxzoomcancel",t)}keydown(t){this._active&&t.keyCode===27&&(this.reset(),this._fireEvent("boxzoomcancel",t))}blur(){this.reset()}reset(){this._active=!1,this._container.classList.remove("mapboxgl-crosshair"),this._box&&(this._box.remove(),this._box=null),Ye(),delete this._startPos,delete this._lastPos}_fireEvent(t,s){return this._map.fire(new o.Event(t,{originalEvent:s}))}}function Aa(l,t){let s={};for(let p=0;p<l.length;p++)s[l[p].identifier]=t[p];return s}class gh{constructor(t){this.reset(),this.numTouches=t.numTouches}reset(){this.centroid=void 0,this.startTime=0,this.touches={},this.aborted=!1}touchstart(t,s,p){(this.centroid||p.length>this.numTouches)&&(this.aborted=!0),this.aborted||(this.startTime===0&&(this.startTime=t.timeStamp),p.length===this.numTouches&&(this.centroid=function(f){let _=new o.pointGeometry(0,0);for(let b of f)_._add(b);return _.div(f.length)}(s),this.touches=Aa(p,s)))}touchmove(t,s,p){if(this.aborted||!this.centroid)return;let f=Aa(p,s);for(let _ in this.touches){let b=this.touches[_],w=f[_];(!w||w.dist(b)>30)&&(this.aborted=!0)}}touchend(t,s,p){if((!this.centroid||t.timeStamp-this.startTime>500)&&(this.aborted=!0),p.length===0){let f=!this.aborted&&this.centroid;if(this.reset(),f)return f}}}class Ma{constructor(t){this.singleTap=new gh(t),this.numTaps=t.numTaps,this.reset()}reset(){this.lastTime=1/0,this.lastTap=void 0,this.count=0,this.singleTap.reset()}touchstart(t,s,p){this.singleTap.touchstart(t,s,p)}touchmove(t,s,p){this.singleTap.touchmove(t,s,p)}touchend(t,s,p){let f=this.singleTap.touchend(t,s,p);if(f){let _=t.timeStamp-this.lastTime<500,b=!this.lastTap||this.lastTap.dist(f)<30;if(_&&b||this.reset(),this.count++,this.lastTime=t.timeStamp,this.lastTap=f,this.count===this.numTaps)return this.reset(),f}}}class _h{constructor(){this._zoomIn=new Ma({numTouches:1,numTaps:2}),this._zoomOut=new Ma({numTouches:2,numTaps:1}),this.reset()}reset(){this._active=!1,this._zoomIn.reset(),this._zoomOut.reset()}touchstart(t,s,p){this._zoomIn.touchstart(t,s,p),this._zoomOut.touchstart(t,s,p)}touchmove(t,s,p){this._zoomIn.touchmove(t,s,p),this._zoomOut.touchmove(t,s,p)}touchend(t,s,p){let f=this._zoomIn.touchend(t,s,p),_=this._zoomOut.touchend(t,s,p);return f?(this._active=!0,t.preventDefault(),setTimeout(()=>this.reset(),0),{cameraAnimation:b=>b.easeTo({duration:300,zoom:b.getZoom()+1,around:b.unproject(f)},{originalEvent:t})}):_?(this._active=!0,t.preventDefault(),setTimeout(()=>this.reset(),0),{cameraAnimation:b=>b.easeTo({duration:300,zoom:b.getZoom()-1,around:b.unproject(_)},{originalEvent:t})}):void 0}touchcancel(){this.reset()}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}}let wo={0:1,2:2};class Ia{constructor(t){this.reset(),this._clickTolerance=t.clickTolerance||1}blur(){this.reset()}reset(){this._active=!1,this._moved=!1,this._lastPoint=void 0,this._eventButton=void 0}_correctButton(t,s){return!1}_move(t,s){return{}}mousedown(t,s){if(this._lastPoint)return;let p=It(t);this._correctButton(t,p)&&(this._lastPoint=s,this._eventButton=p)}mousemoveWindow(t,s){let p=this._lastPoint;if(p){if(t.preventDefault(),this._eventButton!=null&&function(f,_){let b=wo[_];return f.buttons===void 0||(f.buttons&b)!==b}(t,this._eventButton))this.reset();else if(this._moved||!(s.dist(p)<this._clickTolerance))return this._moved=!0,this._lastPoint=s,this._move(p,s)}}mouseupWindow(t){this._lastPoint&&It(t)===this._eventButton&&(this._moved&&wt(),this.reset())}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}}class yh extends Ia{mousedown(t,s){super.mousedown(t,s),this._lastPoint&&(this._active=!0)}_correctButton(t,s){return s===0&&!t.ctrlKey}_move(t,s){return{around:s,panDelta:s.sub(t)}}}class Fl extends Ia{_correctButton(t,s){return s===0&&t.ctrlKey||s===2}_move(t,s){let p=.8*(s.x-t.x);if(p)return this._active=!0,{bearingDelta:p}}contextmenu(t){t.preventDefault()}}class Ol extends Ia{_correctButton(t,s){return s===0&&t.ctrlKey||s===2}_move(t,s){let p=-.5*(s.y-t.y);if(p)return this._active=!0,{pitchDelta:p}}contextmenu(t){t.preventDefault()}}class xh{constructor(t,s){this._map=t,this._el=t.getCanvasContainer(),this._minTouches=1,this._clickTolerance=s.clickTolerance||1,this.reset(),o.bindAll(["_addTouchPanBlocker","_showTouchPanBlockerAlert"],this)}reset(){this._active=!1,this._touches={},this._sum=new o.pointGeometry(0,0)}touchstart(t,s,p){return this._calculateTransform(t,s,p)}touchmove(t,s,p){if(this._active&&!(p.length<this._minTouches)){if(this._map._cooperativeGestures&&!this._map.isMoving()){if(p.length===1)return void this._showTouchPanBlockerAlert();this._alertContainer.style.visibility!=="hidden"&&(this._alertContainer.style.visibility="hidden",clearTimeout(this._alertTimer))}return t.preventDefault(),this._calculateTransform(t,s,p)}}touchend(t,s,p){this._calculateTransform(t,s,p),this._active&&p.length<this._minTouches&&this.reset()}touchcancel(){this.reset()}_calculateTransform(t,s,p){p.length>0&&(this._active=!0);let f=Aa(p,s),_=new o.pointGeometry(0,0),b=new o.pointGeometry(0,0),w=0;for(let A in f){let I=f[A],L=this._touches[A];L&&(_._add(I),b._add(I.sub(L)),w++,f[A]=I)}if(this._touches=f,w<this._minTouches||!b.mag())return;let T=b.div(w);return this._sum._add(T),this._sum.mag()<this._clickTolerance?void 0:{around:_.div(w),panDelta:T}}enable(){this._enabled=!0,this._map._cooperativeGestures&&(this._addTouchPanBlocker(),this._el.classList.add("mapboxgl-touch-pan-blocker-override","mapboxgl-scrollable-page"))}disable(){this._enabled=!1,this._map._cooperativeGestures&&(clearTimeout(this._alertTimer),this._alertContainer.remove(),this._el.classList.remove("mapboxgl-touch-pan-blocker-override","mapboxgl-scrollable-page")),this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}_addTouchPanBlocker(){this._map&&!this._alertContainer&&(this._alertContainer=oe("div","mapboxgl-touch-pan-blocker",this._map._container),this._alertContainer.textContent=this._map._getUIString("TouchPanBlocker.Message"),this._alertContainer.style.fontSize=`${Math.max(10,Math.min(24,Math.floor(.05*this._el.clientWidth)))}px`)}_showTouchPanBlockerAlert(){this._alertContainer.style.visibility==="hidden"&&(this._alertContainer.style.visibility="visible"),this._alertContainer.classList.add("mapboxgl-touch-pan-blocker-show"),clearTimeout(this._alertTimer),this._alertTimer=setTimeout(()=>{this._alertContainer.classList.remove("mapboxgl-touch-pan-blocker-show")},500)}}class za{constructor(){this.reset()}reset(){this._active=!1,this._firstTwoTouches=void 0}_start(t){}_move(t,s,p){return{}}touchstart(t,s,p){this._firstTwoTouches||p.length<2||(this._firstTwoTouches=[p[0].identifier,p[1].identifier],this._start([s[0],s[1]]))}touchmove(t,s,p){let f=this._firstTwoTouches;if(!f)return;t.preventDefault();let[_,b]=f,w=Ti(p,s,_),T=Ti(p,s,b);if(!w||!T)return;let A=this._aroundCenter?null:w.add(T).div(2);return this._move([w,T],A,t)}touchend(t,s,p){if(!this._firstTwoTouches)return;let[f,_]=this._firstTwoTouches,b=Ti(p,s,f),w=Ti(p,s,_);b&&w||(this._active&&wt(),this.reset())}touchcancel(){this.reset()}enable(t){this._enabled=!0,this._aroundCenter=!!t&&t.around==="center"}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}}function Ti(l,t,s){for(let p=0;p<l.length;p++)if(l[p].identifier===s)return t[p]}function vh(l,t){return Math.log(l/t)/Math.LN2}class bh extends za{reset(){super.reset(),this._distance=0,this._startDistance=0}_start(t){this._startDistance=this._distance=t[0].dist(t[1])}_move(t,s){let p=this._distance;if(this._distance=t[0].dist(t[1]),this._active||!(Math.abs(vh(this._distance,this._startDistance))<.1))return this._active=!0,{zoomDelta:vh(this._distance,p),pinchAround:s}}}function wh(l,t){return 180*l.angleWith(t)/Math.PI}class bp extends za{reset(){super.reset(),this._minDiameter=0,this._startVector=void 0,this._vector=void 0}_start(t){this._startVector=this._vector=t[0].sub(t[1]),this._minDiameter=t[0].dist(t[1])}_move(t,s){let p=this._vector;if(this._vector=t[0].sub(t[1]),this._active||!this._isBelowThreshold(this._vector))return this._active=!0,{bearingDelta:wh(this._vector,p),pinchAround:s}}_isBelowThreshold(t){this._minDiameter=Math.min(this._minDiameter,t.mag());let s=25/(Math.PI*this._minDiameter)*360,p=wh(t,this._startVector);return Math.abs(p)<s}}function Ar(l){return Math.abs(l.y)>Math.abs(l.x)}class Eh extends za{constructor(t){super(),this._map=t}reset(){super.reset(),this._valid=void 0,this._firstMove=void 0,this._lastPoints=void 0}_start(t){this._lastPoints=t,Ar(t[0].sub(t[1]))&&(this._valid=!1)}_move(t,s,p){let f=this._lastPoints;if(!f)return;let _=t[0].sub(f[0]),b=t[1].sub(f[1]);return this._map._cooperativeGestures&&p.touches.length<3||(this._valid=this.gestureBeginsVertically(_,b,p.timeStamp),!this._valid)?void 0:(this._lastPoints=t,this._active=!0,{pitchDelta:(_.y+b.y)/2*-.5})}gestureBeginsVertically(t,s,p){if(this._valid!==void 0)return this._valid;let f=t.mag()>=2,_=s.mag()>=2;if(!f&&!_)return;if(!f||!_)return this._firstMove==null&&(this._firstMove=p),p-this._firstMove<100&&void 0;let b=t.y>0==s.y>0;return Ar(t)&&Ar(s)&&b}}let Eo={panStep:100,bearingStep:15,pitchStep:10};class Or{constructor(){let t=Eo;this._panStep=t.panStep,this._bearingStep=t.bearingStep,this._pitchStep=t.pitchStep,this._rotationDisabled=!1}blur(){this.reset()}reset(){this._active=!1}keydown(t){if(t.altKey||t.ctrlKey||t.metaKey)return;let s=0,p=0,f=0,_=0,b=0;switch(t.keyCode){case 61:case 107:case 171:case 187:s=1;break;case 189:case 109:case 173:s=-1;break;case 37:t.shiftKey?p=-1:(t.preventDefault(),_=-1);break;case 39:t.shiftKey?p=1:(t.preventDefault(),_=1);break;case 38:t.shiftKey?f=1:(t.preventDefault(),b=-1);break;case 40:t.shiftKey?f=-1:(t.preventDefault(),b=1);break;default:return}return this._rotationDisabled&&(p=0,f=0),{cameraAnimation:w=>{let T=w.getZoom();w.easeTo({duration:300,easeId:"keyboardHandler",easing:Pa,zoom:s?Math.round(T)+s*(t.shiftKey?2:1):T,bearing:w.getBearing()+p*this._bearingStep,pitch:w.getPitch()+f*this._pitchStep,offset:[-_*this._panStep,-b*this._panStep],center:w.getCenter()},{originalEvent:t})}}}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}disableRotation(){this._rotationDisabled=!0}enableRotation(){this._rotationDisabled=!1}}function Pa(l){return l*(2-l)}let He=4.000244140625;class Th{constructor(t,s){this._map=t,this._el=t.getCanvasContainer(),this._handler=s,this._delta=0,this._defaultZoomRate=.01,this._wheelZoomRate=.0022222222222222222,o.bindAll(["_onTimeout","_addScrollZoomBlocker","_showBlockerAlert","_isFullscreen"],this)}setZoomRate(t){this._defaultZoomRate=t}setWheelZoomRate(t){this._wheelZoomRate=t}isEnabled(){return!!this._enabled}isActive(){return!!this._active||this._finishTimeout!==void 0}isZooming(){return!!this._zooming}enable(t){this.isEnabled()||(this._enabled=!0,this._aroundCenter=!!t&&t.around==="center",this._map._cooperativeGestures&&this._addScrollZoomBlocker())}disable(){this.isEnabled()&&(this._enabled=!1,this._map._cooperativeGestures&&(clearTimeout(this._alertTimer),this._alertContainer.remove()))}wheel(t){if(!this.isEnabled())return;if(this._map._cooperativeGestures){if(!(t.ctrlKey||t.metaKey||this.isZooming()||this._isFullscreen()))return void this._showBlockerAlert();this._alertContainer.style.visibility!=="hidden"&&(this._alertContainer.style.visibility="hidden",clearTimeout(this._alertTimer))}let s=t.deltaMode===o.window.WheelEvent.DOM_DELTA_LINE?40*t.deltaY:t.deltaY,p=o.exported.now(),f=p-(this._lastWheelEventTime||0);this._lastWheelEventTime=p,s!==0&&s%He==0?this._type="wheel":s!==0&&Math.abs(s)<4?this._type="trackpad":f>400?(this._type=null,this._lastValue=s,this._timeout=setTimeout(this._onTimeout,40,t)):this._type||(this._type=Math.abs(f*s)<200?"trackpad":"wheel",this._timeout&&(clearTimeout(this._timeout),this._timeout=null,s+=this._lastValue)),t.shiftKey&&s&&(s/=4),this._type&&(this._lastWheelEvent=t,this._delta-=s,this._active||this._start(t)),t.preventDefault()}_onTimeout(t){this._type="wheel",this._delta-=this._lastValue,this._active||this._start(t)}_start(t){if(!this._delta)return;this._frameId&&(this._frameId=null),this._active=!0,this.isZooming()||(this._zooming=!0),this._finishTimeout&&(clearTimeout(this._finishTimeout),delete this._finishTimeout);let s=Je(this._el,t);this._aroundPoint=this._aroundCenter?this._map.transform.centerPoint:s,this._aroundCoord=this._map.transform.pointCoordinate3D(this._aroundPoint),this._targetZoom=void 0,this._frameId||(this._frameId=!0,this._handler._triggerRenderFrame())}renderFrame(){if(!this._frameId||(this._frameId=null,!this.isActive()))return;let t=this._map.transform,s=()=>t._terrainEnabled()&&this._aroundCoord?t.computeZoomRelativeTo(this._aroundCoord):t.zoom;if(this._delta!==0){let T=this._type==="wheel"&&Math.abs(this._delta)>He?this._wheelZoomRate:this._defaultZoomRate,A=2/(1+Math.exp(-Math.abs(this._delta*T)));this._delta<0&&A!==0&&(A=1/A);let I=s(),L=Math.pow(2,I),O=typeof this._targetZoom=="number"?t.zoomScale(this._targetZoom):L;this._targetZoom=Math.min(t.maxZoom,Math.max(t.minZoom,t.scaleZoom(O*A))),this._type==="wheel"&&(this._startZoom=s(),this._easing=this._smoothOutEasing(200)),this._delta=0}let p=typeof this._targetZoom=="number"?this._targetZoom:s(),f=this._startZoom,_=this._easing,b,w=!1;if(this._type==="wheel"&&f&&_){let T=Math.min((o.exported.now()-this._lastWheelEventTime)/200,1),A=_(T);b=o.number(f,p,A),T<1?this._frameId||(this._frameId=!0):w=!0}else b=p,w=!0;return this._active=!0,w&&(this._active=!1,this._finishTimeout=setTimeout(()=>{this._zooming=!1,this._handler._triggerRenderFrame(),delete this._targetZoom,delete this._finishTimeout},200)),{noInertia:!0,needsRenderFrame:!w,zoomDelta:b-s(),around:this._aroundPoint,aroundCoord:this._aroundCoord,originalEvent:this._lastWheelEvent}}_smoothOutEasing(t){let s=o.ease;if(this._prevEase){let p=this._prevEase,f=(o.exported.now()-p.start)/p.duration,_=p.easing(f+.01)-p.easing(f),b=.27/Math.sqrt(_*_+1e-4)*.01,w=Math.sqrt(.0729-b*b);s=o.bezier(b,w,.25,1)}return this._prevEase={start:o.exported.now(),duration:t,easing:s},s}blur(){this.reset()}reset(){this._active=!1}_addScrollZoomBlocker(){this._map&&!this._alertContainer&&(this._alertContainer=oe("div","mapboxgl-scroll-zoom-blocker",this._map._container),this._alertContainer.textContent=/(Mac|iPad)/i.test(o.window.navigator.userAgent)?this._map._getUIString("ScrollZoomBlocker.CmdMessage"):this._map._getUIString("ScrollZoomBlocker.CtrlMessage"),this._alertContainer.style.fontSize=`${Math.max(10,Math.min(24,Math.floor(.05*this._el.clientWidth)))}px`)}_isFullscreen(){return!!o.window.document.fullscreenElement||!!o.window.document.webkitFullscreenElement}_showBlockerAlert(){this._alertContainer.style.visibility==="hidden"&&(this._alertContainer.style.visibility="visible"),this._alertContainer.classList.add("mapboxgl-scroll-zoom-blocker-show"),clearTimeout(this._alertTimer),this._alertTimer=setTimeout(()=>{this._alertContainer.classList.remove("mapboxgl-scroll-zoom-blocker-show")},200)}}class Ch{constructor(t,s){this._clickZoom=t,this._tapZoom=s}enable(){this._clickZoom.enable(),this._tapZoom.enable()}disable(){this._clickZoom.disable(),this._tapZoom.disable()}isEnabled(){return this._clickZoom.isEnabled()&&this._tapZoom.isEnabled()}isActive(){return this._clickZoom.isActive()||this._tapZoom.isActive()}}class ys{constructor(){this.reset()}reset(){this._active=!1}blur(){this.reset()}dblclick(t,s){return t.preventDefault(),{cameraAnimation:p=>{p.easeTo({duration:300,zoom:p.getZoom()+(t.shiftKey?-1:1),around:p.unproject(s)},{originalEvent:t})}}}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}}class xs{constructor(){this._tap=new Ma({numTouches:1,numTaps:1}),this.reset()}reset(){this._active=!1,this._swipePoint=void 0,this._swipeTouch=0,this._tapTime=0,this._tap.reset()}touchstart(t,s,p){this._swipePoint||(this._tapTime&&t.timeStamp-this._tapTime>500&&this.reset(),this._tapTime?p.length>0&&(this._swipePoint=s[0],this._swipeTouch=p[0].identifier):this._tap.touchstart(t,s,p))}touchmove(t,s,p){if(this._tapTime){if(this._swipePoint){if(p[0].identifier!==this._swipeTouch)return;let f=s[0],_=f.y-this._swipePoint.y;return this._swipePoint=f,t.preventDefault(),this._active=!0,{zoomDelta:_/128}}}else this._tap.touchmove(t,s,p)}touchend(t,s,p){this._tapTime?this._swipePoint&&p.length===0&&this.reset():this._tap.touchend(t,s,p)&&(this._tapTime=t.timeStamp)}touchcancel(){this.reset()}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}}class kh{constructor(t,s,p){this._el=t,this._mousePan=s,this._touchPan=p}enable(t){this._inertiaOptions=t||{},this._mousePan.enable(),this._touchPan.enable(),this._el.classList.add("mapboxgl-touch-drag-pan")}disable(){this._mousePan.disable(),this._touchPan.disable(),this._el.classList.remove("mapboxgl-touch-drag-pan")}isEnabled(){return this._mousePan.isEnabled()&&this._touchPan.isEnabled()}isActive(){return this._mousePan.isActive()||this._touchPan.isActive()}}class Sh{constructor(t,s,p){this._pitchWithRotate=t.pitchWithRotate,this._mouseRotate=s,this._mousePitch=p}enable(){this._mouseRotate.enable(),this._pitchWithRotate&&this._mousePitch.enable()}disable(){this._mouseRotate.disable(),this._mousePitch.disable()}isEnabled(){return this._mouseRotate.isEnabled()&&(!this._pitchWithRotate||this._mousePitch.isEnabled())}isActive(){return this._mouseRotate.isActive()||this._mousePitch.isActive()}}class Ah{constructor(t,s,p,f){this._el=t,this._touchZoom=s,this._touchRotate=p,this._tapDragZoom=f,this._rotationDisabled=!1,this._enabled=!0}enable(t){this._touchZoom.enable(t),this._rotationDisabled||this._touchRotate.enable(t),this._tapDragZoom.enable(),this._el.classList.add("mapboxgl-touch-zoom-rotate")}disable(){this._touchZoom.disable(),this._touchRotate.disable(),this._tapDragZoom.disable(),this._el.classList.remove("mapboxgl-touch-zoom-rotate")}isEnabled(){return this._touchZoom.isEnabled()&&(this._rotationDisabled||this._touchRotate.isEnabled())&&this._tapDragZoom.isEnabled()}isActive(){return this._touchZoom.isActive()||this._touchRotate.isActive()||this._tapDragZoom.isActive()}disableRotation(){this._rotationDisabled=!0,this._touchRotate.disable()}enableRotation(){this._rotationDisabled=!1,this._touchZoom.isEnabled()&&this._touchRotate.enable()}}let vs=l=>l.zoom||l.drag||l.pitch||l.rotate;class Mh extends o.Event{}class Ih{constructor(){this.constants=[1,1,.01],this.radius=0}setup(t,s){let p=o.sub([],s,t);this.radius=o.length(p[2]<0?o.div([],p,this.constants):[p[0],p[1],0])}projectRay(t){o.div(t,t,this.constants),o.normalize(t,t),o.mul$1(t,t,this.constants);let s=o.scale$2([],t,this.radius);if(s[2]>0){let p=o.scale$2([],[0,0,1],o.dot(s,[0,0,1])),f=o.scale$2([],o.normalize([],[s[0],s[1],0]),this.radius),_=o.add([],s,o.scale$2([],o.sub([],o.add([],f,p),s),2));s[0]=_[0],s[1]=_[1]}return s}}function bs(l){return l.panDelta&&l.panDelta.mag()||l.zoomDelta||l.bearingDelta||l.pitchDelta}class Da{constructor(t,s){this._map=t,this._el=this._map.getCanvasContainer(),this._handlers=[],this._handlersById={},this._changes=[],this._inertia=new vp(t),this._bearingSnap=s.bearingSnap,this._previousActiveHandlers={},this._trackingEllipsoid=new Ih,this._dragOrigin=null,this._eventsInProgress={},this._addDefaultHandlers(s),o.bindAll(["handleEvent","handleWindowEvent"],this);let p=this._el;this._listeners=[[p,"touchstart",{passive:!0}],[p,"touchmove",{passive:!1}],[p,"touchend",void 0],[p,"touchcancel",void 0],[p,"mousedown",void 0],[p,"mousemove",void 0],[p,"mouseup",void 0],[o.window.document,"mousemove",{capture:!0}],[o.window.document,"mouseup",void 0],[p,"mouseover",void 0],[p,"mouseout",void 0],[p,"dblclick",void 0],[p,"click",void 0],[p,"keydown",{capture:!1}],[p,"keyup",void 0],[p,"wheel",{passive:!1}],[p,"contextmenu",void 0],[o.window,"blur",void 0]];for(let[f,_,b]of this._listeners)f.addEventListener(_,f===o.window.document?this.handleWindowEvent:this.handleEvent,b)}destroy(){for(let[t,s,p]of this._listeners)t.removeEventListener(s,t===o.window.document?this.handleWindowEvent:this.handleEvent,p)}_addDefaultHandlers(t){let s=this._map,p=s.getCanvasContainer();this._add("mapEvent",new Sa(s,t));let f=s.boxZoom=new mh(s,t);this._add("boxZoom",f);let _=new _h,b=new ys;s.doubleClickZoom=new Ch(b,_),this._add("tapZoom",_),this._add("clickZoom",b);let w=new xs;this._add("tapDragZoom",w);let T=s.touchPitch=new Eh(s);this._add("touchPitch",T);let A=new Fl(t),I=new Ol(t);s.dragRotate=new Sh(t,A,I),this._add("mouseRotate",A,["mousePitch"]),this._add("mousePitch",I,["mouseRotate"]);let L=new yh(t),O=new xh(s,t);s.dragPan=new kh(p,L,O),this._add("mousePan",L),this._add("touchPan",O,["touchZoom","touchRotate"]);let V=new bp,N=new bh;s.touchZoomRotate=new Ah(p,N,V,w),this._add("touchRotate",V,["touchPan","touchZoom"]),this._add("touchZoom",N,["touchPan","touchRotate"]),this._add("blockableMapEvent",new Rl(s));let j=s.scrollZoom=new Th(s,this);this._add("scrollZoom",j,["mousePan"]);let J=s.keyboard=new Or;this._add("keyboard",J);for(let U of["boxZoom","doubleClickZoom","tapDragZoom","touchPitch","dragRotate","dragPan","touchZoomRotate","scrollZoom","keyboard"])t.interactive&&t[U]&&s[U].enable(t[U])}_add(t,s,p){this._handlers.push({handlerName:t,handler:s,allowed:p}),this._handlersById[t]=s}stop(t){if(!this._updatingCamera){for(let{handler:s}of this._handlers)s.reset();this._inertia.clear(),this._fireEvents({},{},t),this._changes=[]}}isActive(){for(let{handler:t}of this._handlers)if(t.isActive())return!0;return!1}isZooming(){return!!this._eventsInProgress.zoom||this._map.scrollZoom.isZooming()}isRotating(){return!!this._eventsInProgress.rotate}isMoving(){return!!vs(this._eventsInProgress)||this.isZooming()}_blockedByActive(t,s,p){for(let f in t)if(f!==p&&(!s||s.indexOf(f)<0))return!0;return!1}handleWindowEvent(t){this.handleEvent(t,`${t.type}Window`)}_getMapTouches(t){let s=[];for(let p of t)this._el.contains(p.target)&&s.push(p);return s}handleEvent(t,s){this._updatingCamera=!0;let p=t.type==="renderFrame",f=p?void 0:t,_={needsRenderFrame:!1},b={},w={},T=t.touches?this._getMapTouches(t.touches):void 0,A=T?Et(this._el,T):p?void 0:Je(this._el,t);for(let{handlerName:O,handler:V,allowed:N}of this._handlers){if(!V.isEnabled())continue;let j;this._blockedByActive(w,N,O)?V.reset():V[s||t.type]&&(j=V[s||t.type](t,A,T),this.mergeHandlerResult(_,b,j,O,f),j&&j.needsRenderFrame&&this._triggerRenderFrame()),(j||V.isActive())&&(w[O]=V)}let I={};for(let O in this._previousActiveHandlers)w[O]||(I[O]=f);this._previousActiveHandlers=w,(Object.keys(I).length||bs(_))&&(this._changes.push([_,b,I]),this._triggerRenderFrame()),(Object.keys(w).length||bs(_))&&this._map._stop(!0),this._updatingCamera=!1;let{cameraAnimation:L}=_;L&&(this._inertia.clear(),this._fireEvents({},{},!0),this._changes=[],L(this._map))}mergeHandlerResult(t,s,p,f,_){if(!p)return;o.extend(t,p);let b={handlerName:f,originalEvent:p.originalEvent||_};p.zoomDelta!==void 0&&(s.zoom=b),p.panDelta!==void 0&&(s.drag=b),p.pitchDelta!==void 0&&(s.pitch=b),p.bearingDelta!==void 0&&(s.rotate=b)}_applyChanges(){let t={},s={},p={};for(let[f,_,b]of this._changes)f.panDelta&&(t.panDelta=(t.panDelta||new o.pointGeometry(0,0))._add(f.panDelta)),f.zoomDelta&&(t.zoomDelta=(t.zoomDelta||0)+f.zoomDelta),f.bearingDelta&&(t.bearingDelta=(t.bearingDelta||0)+f.bearingDelta),f.pitchDelta&&(t.pitchDelta=(t.pitchDelta||0)+f.pitchDelta),f.around!==void 0&&(t.around=f.around),f.aroundCoord!==void 0&&(t.aroundCoord=f.aroundCoord),f.pinchAround!==void 0&&(t.pinchAround=f.pinchAround),f.noInertia&&(t.noInertia=f.noInertia),o.extend(s,_),o.extend(p,b);this._updateMapTransform(t,s,p),this._changes=[]}_updateMapTransform(t,s,p){let f=this._map,_=f.transform,b=$=>[$.x,$.y,$.z];if(($=>{let q=this._eventsInProgress.drag;return q&&!this._handlersById[q.handlerName].isActive()})()&&!bs(t)){let $=_.zoom;_.cameraElevationReference="sea",_.recenterOnTerrain(),_.cameraElevationReference="ground",$!==_.zoom&&this._map._update(!0)}if(!bs(t))return void this._fireEvents(s,p,!0);let{panDelta:w,zoomDelta:T,bearingDelta:A,pitchDelta:I,around:L,aroundCoord:O,pinchAround:V}=t;V!==void 0&&(L=V),($=>s.drag&&!this._eventsInProgress.drag)()&&L&&(this._dragOrigin=b(_.pointCoordinate3D(L)),this._trackingEllipsoid.setup(_._camera.position,this._dragOrigin)),_.cameraElevationReference="sea",f._stop(!0),L=L||f.transform.centerPoint,A&&(_.bearing+=A),I&&(_.pitch+=I),_._updateCameraState();let N=[0,0,0];if(w){let $=_.pointCoordinate(L);if(_.projection.name==="globe"){let q=o.latFromMercatorY($.y),ie=_.center.lat,K=Math.min(o.mercatorZfromAltitude(1,q)/o.mercatorZfromAltitude(1,ie),2);w=w.rotate(-_.angle),N[0]=-w.x/_.worldSize*K,N[1]=-w.y/_.worldSize*K}else{let q=_.pointCoordinate(L.sub(w));$&&q&&(N[0]=q.x-$.x,N[1]=q.y-$.y)}}let j=_.zoom,J=[0,0,0];if(T){let $=b(O||_.pointCoordinate3D(L)),q={dir:o.normalize([],o.sub([],$,_._camera.position))};if(q.dir[2]<0){let ie=_.zoomDeltaToMovement($,T);o.scale$2(J,q.dir,ie)}}let U=o.add(N,N,J);_._translateCameraConstrained(U),T&&Math.abs(_.zoom-j)>1e-4&&_.recenterOnTerrain(),_.cameraElevationReference="ground",this._map._update(),t.noInertia||this._inertia.record(t),this._fireEvents(s,p,!0)}_fireEvents(t,s,p){let f=vs(this._eventsInProgress),_=vs(t),b={};for(let I in t){let{originalEvent:L}=t[I];this._eventsInProgress[I]||(b[`${I}start`]=L),this._eventsInProgress[I]=t[I]}!f&&_&&this._fireEvent("movestart",_.originalEvent);for(let I in b)this._fireEvent(I,b[I]);_&&this._fireEvent("move",_.originalEvent);for(let I in t){let{originalEvent:L}=t[I];this._fireEvent(I,L)}let w={},T;for(let I in this._eventsInProgress){let{handlerName:L,originalEvent:O}=this._eventsInProgress[I];this._handlersById[L].isActive()||(delete this._eventsInProgress[I],T=s[L]||O,w[`${I}end`]=T)}for(let I in w)this._fireEvent(I,w[I]);let A=vs(this._eventsInProgress);if(p&&(f||_)&&!A){this._updatingCamera=!0;let I=this._inertia._onMoveEnd(this._map.dragPan._inertiaOptions),L=O=>O!==0&&-this._bearingSnap<O&&O<this._bearingSnap;I?(L(I.bearing||this._map.getBearing())&&(I.bearing=0),this._map.easeTo(I,{originalEvent:T})):(this._map.fire(new o.Event("moveend",{originalEvent:T})),L(this._map.getBearing())&&this._map.resetNorth()),this._updatingCamera=!1}}_fireEvent(t,s){this._map.fire(new o.Event(t,s?{originalEvent:s}:{}))}_requestFrame(){return this._map.triggerRepaint(),this._map._renderTaskQueue.add(t=>{this._frameId=void 0,this.handleEvent(new Mh("renderFrame",{timeStamp:t})),this._applyChanges()})}_triggerRenderFrame(){this._frameId===void 0&&(this._frameId=this._requestFrame())}}let La="map.setFreeCameraOptions(...) and map.getFreeCameraOptions() are not yet supported for non-mercator projections.";class Ba extends o.Evented{constructor(t,s){super(),this._moving=!1,this._zooming=!1,this.transform=t,this._bearingSnap=s.bearingSnap,o.bindAll(["_renderFrameCallback"],this)}getCenter(){return new o.LngLat(this.transform.center.lng,this.transform.center.lat)}setCenter(t,s){return this.jumpTo({center:t},s)}panBy(t,s,p){return t=o.pointGeometry.convert(t).mult(-1),this.panTo(this.transform.center,o.extend({offset:t},s),p)}panTo(t,s,p){return this.easeTo(o.extend({center:t},s),p)}getZoom(){return this.transform.zoom}setZoom(t,s){return this.jumpTo({zoom:t},s),this}zoomTo(t,s,p){return this.easeTo(o.extend({zoom:t},s),p)}zoomIn(t,s){return this.zoomTo(this.getZoom()+1,t,s),this}zoomOut(t,s){return this.zoomTo(this.getZoom()-1,t,s),this}getBearing(){return this.transform.bearing}setBearing(t,s){return this.jumpTo({bearing:t},s),this}getPadding(){return this.transform.padding}setPadding(t,s){return this.jumpTo({padding:t},s),this}rotateTo(t,s,p){return this.easeTo(o.extend({bearing:t},s),p)}resetNorth(t,s){return this.rotateTo(0,o.extend({duration:1e3},t),s),this}resetNorthPitch(t,s){return this.easeTo(o.extend({bearing:0,pitch:0,duration:1e3},t),s),this}snapToNorth(t,s){return Math.abs(this.getBearing())<this._bearingSnap?this.resetNorth(t,s):this}getPitch(){return this.transform.pitch}setPitch(t,s){return this.jumpTo({pitch:t},s),this}cameraForBounds(t,s){this.transform.projection.name==="globe"&&o.warnOnce('Globe projection does not support cameraForBounds API, this API may behave unexpectedly."'),t=o.LngLatBounds.convert(t);let p=s&&s.bearing||0;return this._cameraForBoxAndBearing(t.getNorthWest(),t.getSouthEast(),p,s)}_extendCameraOptions(t){let s={top:0,bottom:0,right:0,left:0};if(typeof(t=o.extend({padding:s,offset:[0,0],maxZoom:this.transform.maxZoom},t)).padding=="number"){let p=t.padding;t.padding={top:p,bottom:p,right:p,left:p}}return t.padding=o.extend(s,t.padding),t}_cameraForBoxAndBearing(t,s,p,f){let _=this._extendCameraOptions(f),b=this.transform,w=b.padding,T=b.project(o.LngLat.convert(t)),A=b.project(o.LngLat.convert(s)),I=new o.pointGeometry(T.x,A.y),L=new o.pointGeometry(A.x,T.y),O=-o.degToRad(p),V=T.rotate(O),N=A.rotate(O),j=I.rotate(O),J=L.rotate(O),U=new o.pointGeometry(Math.max(V.x,N.x,j.x,J.x),Math.max(V.y,N.y,j.y,J.y)),$=new o.pointGeometry(Math.min(V.x,N.x,j.x,J.x),Math.min(V.y,N.y,j.y,J.y)),q=U.sub($),ie=(b.width-((w.left||0)+(w.right||0)+_.padding.left+_.padding.right))/q.x,K=(b.height-((w.top||0)+(w.bottom||0)+_.padding.top+_.padding.bottom))/q.y;if(K<0||ie<0)return void o.warnOnce("Map cannot fit within canvas with the given bounds, padding, and/or offset.");let Q=Math.min(b.scaleZoom(b.scale*Math.min(ie,K)),_.maxZoom),ae=typeof _.offset.x=="number"&&typeof _.offset.y=="number"?new o.pointGeometry(_.offset.x,_.offset.y):o.pointGeometry.convert(_.offset),ye=new o.pointGeometry((_.padding.left-_.padding.right)/2,(_.padding.top-_.padding.bottom)/2).rotate(p*Math.PI/180),be=ae.add(ye).mult(b.scale/b.zoomScale(Q));return{center:b.unproject(T.add(A).div(2).sub(be)),zoom:Q,bearing:p}}_cameraForBox(t,s,p,f,_){let b=this._extendCameraOptions(_);p=p||0,f=f||0,t=o.LngLat.convert(t),s=o.LngLat.convert(s);let w=this.transform.clone();w.padding=b.padding;let T=this.getFreeCameraOptions(),A=new o.LngLat(.5*(t.lng+s.lng),.5*(t.lat+s.lat)),I=.5*(p+f);if(w._camera.position[2]<o.mercatorZfromAltitude(I,A.lat))return void o.warnOnce("Map cannot fit within canvas with the given bounds, padding, and/or offset.");T.lookAtPoint(A),w.setFreeCameraOptions(T);let L=o.MercatorCoordinate.fromLngLat(t),O=o.MercatorCoordinate.fromLngLat(s),V=w.pointRayIntersection(w.centerPoint,I),N=[(j=w.rayIntersectionCoordinate(V)).x,j.y,j.z];var j;let J=w.screenPointToMercatorRay(w.centerPoint),U=w.projection.name!=="globe",$,q=0;do{let ie=Math.floor(w.zoom),K=1<<ie,Q=Math.min(K*L.x,K*O.x),ae=Math.min(K*L.y,K*O.y),ye=Math.max(K*L.x,K*O.x),be=Math.max(K*L.y,K*O.y),xe=new o.Aabb([Q,ae,p],[ye,be,f]),_e=o.Frustum.fromInvProjectionMatrix(w.invProjMatrix,w.worldSize,ie,U);if(xe.intersects(_e)!==2){$&&(w._camera.position=o.scaleAndAdd([],w._camera.position,J.dir,-$),w._updateStateFromCamera());break}let te=o.sub([],w._camera.position,N);$=.5*o.length(te),w._camera.position=o.scaleAndAdd([],w._camera.position,J.dir,$);try{w._updateStateFromCamera()}catch{return void o.warnOnce("Map cannot fit within canvas with the given bounds, padding, and/or offset.")}}while(++q<10);return{center:w.center,zoom:w.zoom,bearing:w.bearing,pitch:w.pitch}}fitBounds(t,s,p){return this.transform.projection.name==="globe"&&o.warnOnce("Globe projection does not support fitBounds API, this API may behave unexpectedly."),this._fitInternal(this.cameraForBounds(t,s),s,p)}_raycastElevationBox(t,s){let p=this.transform.elevation;if(!p)return;let f=new o.pointGeometry(t.x,s.y),_=new o.pointGeometry(s.x,t.y),b=p.pointCoordinate(t);if(!b)return;let w=p.pointCoordinate(s);if(!w)return;let T=p.pointCoordinate(f);if(!T)return;let A=p.pointCoordinate(_);if(!A)return;let I=new o.MercatorCoordinate(b[0],b[1]).toLngLat(),L=new o.MercatorCoordinate(w[0],w[1]).toLngLat(),O=new o.MercatorCoordinate(T[0],T[1]).toLngLat(),V=new o.MercatorCoordinate(A[0],A[1]).toLngLat(),N=Math.min(I.lng,Math.min(L.lng,Math.min(O.lng,V.lng))),j=Math.min(I.lat,Math.min(L.lat,Math.min(O.lat,V.lat))),J=Math.max(I.lng,Math.max(L.lng,Math.max(O.lng,V.lng))),U=Math.max(I.lat,Math.max(L.lat,Math.max(O.lat,V.lat))),$=Math.min(b[3],Math.min(w[3],Math.min(T[3],A[3]))),q=Math.max(b[3],Math.max(w[3],Math.max(T[3],A[3])));return{minLngLat:new o.LngLat(N,j),maxLngLat:new o.LngLat(J,U),minAltitude:$,maxAltitude:q}}fitScreenCoordinates(t,s,p,f,_){let b,w,T,A;this.transform.projection.name==="globe"&&o.warnOnce("Globe projection does not support fitScreenCoordinates API, this API may behave unexpectedly.");let I=o.pointGeometry.convert(t),L=o.pointGeometry.convert(s),O=this._raycastElevationBox(I,L);if(O)b=O.minLngLat,w=O.maxLngLat,T=O.minAltitude,A=O.maxAltitude;else{if(this.transform.anyCornerOffEdge(I,L))return this;b=this.transform.pointLocation(I),w=this.transform.pointLocation(L)}return this._fitInternal(this.transform.pitch===0?this._cameraForBoxAndBearing(this.transform.pointLocation(o.pointGeometry.convert(t)),this.transform.pointLocation(o.pointGeometry.convert(s)),p,f):this._cameraForBox(b,w,T,A,f),f,_)}_fitInternal(t,s,p){return t?(delete(s=o.extend(t,s)).padding,s.linear?this.easeTo(s,p):this.flyTo(s,p)):this}jumpTo(t,s){this.stop();let p=t.preloadOnly?this.transform.clone():this.transform,f=!1,_=!1,b=!1;return"zoom"in t&&p.zoom!==+t.zoom&&(f=!0,p.zoom=+t.zoom),t.center!==void 0&&(p.center=o.LngLat.convert(t.center)),"bearing"in t&&p.bearing!==+t.bearing&&(_=!0,p.bearing=+t.bearing),"pitch"in t&&p.pitch!==+t.pitch&&(b=!0,p.pitch=+t.pitch),t.padding==null||p.isPaddingEqual(t.padding)||(p.padding=t.padding),t.preloadOnly?(this._preloadTiles(p),this):(this.fire(new o.Event("movestart",s)).fire(new o.Event("move",s)),f&&this.fire(new o.Event("zoomstart",s)).fire(new o.Event("zoom",s)).fire(new o.Event("zoomend",s)),_&&this.fire(new o.Event("rotatestart",s)).fire(new o.Event("rotate",s)).fire(new o.Event("rotateend",s)),b&&this.fire(new o.Event("pitchstart",s)).fire(new o.Event("pitch",s)).fire(new o.Event("pitchend",s)),this.fire(new o.Event("moveend",s)))}getFreeCameraOptions(){return this.transform.projection.supportsFreeCamera||o.warnOnce(La),this.transform.getFreeCameraOptions()}setFreeCameraOptions(t,s){let p=this.transform;if(!p.projection.supportsFreeCamera)return o.warnOnce(La),this;this.stop();let f=p.zoom,_=p.pitch,b=p.bearing;p.setFreeCameraOptions(t);let w=f!==p.zoom,T=_!==p.pitch,A=b!==p.bearing;return this.fire(new o.Event("movestart",s)).fire(new o.Event("move",s)),w&&this.fire(new o.Event("zoomstart",s)).fire(new o.Event("zoom",s)).fire(new o.Event("zoomend",s)),A&&this.fire(new o.Event("rotatestart",s)).fire(new o.Event("rotate",s)).fire(new o.Event("rotateend",s)),T&&this.fire(new o.Event("pitchstart",s)).fire(new o.Event("pitch",s)).fire(new o.Event("pitchend",s)),this.fire(new o.Event("moveend",s)),this}easeTo(t,s){this._stop(!1,t.easeId),((t=o.extend({offset:[0,0],duration:500,easing:o.ease},t)).animate===!1||!t.essential&&o.exported.prefersReducedMotion)&&(t.duration=0);let p=this.transform,f=this.getZoom(),_=this.getBearing(),b=this.getPitch(),w=this.getPadding(),T="zoom"in t?+t.zoom:f,A="bearing"in t?this._normalizeBearing(t.bearing,_):_,I="pitch"in t?+t.pitch:b,L="padding"in t?t.padding:p.padding,O=o.pointGeometry.convert(t.offset),V,N,j;if(p.projection.name==="globe"){let be=o.MercatorCoordinate.fromLngLat(p.center),xe=O.rotate(-p.angle);be.x+=xe.x/p.worldSize,be.y+=xe.y/p.worldSize;let _e=be.toLngLat(),te=o.LngLat.convert(t.center||_e);this._normalizeCenter(te),V=p.centerPoint.add(xe),N=new o.pointGeometry(be.x,be.y).mult(p.worldSize),j=new o.pointGeometry(o.mercatorXfromLng(te.lng),o.mercatorYfromLat(te.lat)).mult(p.worldSize).sub(N)}else{V=p.centerPoint.add(O);let be=p.pointLocation(V),xe=o.LngLat.convert(t.center||be);this._normalizeCenter(xe),N=p.project(be),j=p.project(xe).sub(N)}let J=p.zoomScale(T-f),U,$;t.around&&(U=o.LngLat.convert(t.around),$=p.locationPoint(U));let q=this._zooming||T!==f,ie=this._rotating||_!==A,K=this._pitching||I!==b,Q=!p.isPaddingEqual(L),ae=be=>xe=>{if(q&&(be.zoom=o.number(f,T,xe)),ie&&(be.bearing=o.number(_,A,xe)),K&&(be.pitch=o.number(b,I,xe)),Q&&(be.interpolatePadding(w,L,xe),V=be.centerPoint.add(O)),U)be.setLocationAtPoint(U,$);else{let _e=be.zoomScale(be.zoom-f),te=T>f?Math.min(2,J):Math.max(.5,J),Ie=Math.pow(te,1-xe),Me=be.unproject(N.add(j.mult(xe*Ie)).mult(_e));be.setLocationAtPoint(be.renderWorldCopies?Me.wrap():Me,V)}return t.preloadOnly||this._fireMoveEvents(s),be};if(t.preloadOnly){let be=this._emulate(ae,t.duration,p);return this._preloadTiles(be),this}let ye={moving:this._moving,zooming:this._zooming,rotating:this._rotating,pitching:this._pitching};return this._zooming=q,this._rotating=ie,this._pitching=K,this._padding=Q,this._easeId=t.easeId,this._prepareEase(s,t.noMoveStart,ye),this._ease(ae(p),be=>{p.recenterOnTerrain(),this._afterEase(s,be)},t),this}_prepareEase(t,s,p={}){this._moving=!0,this.transform.cameraElevationReference="sea",s||p.moving||this.fire(new o.Event("movestart",t)),this._zooming&&!p.zooming&&this.fire(new o.Event("zoomstart",t)),this._rotating&&!p.rotating&&this.fire(new o.Event("rotatestart",t)),this._pitching&&!p.pitching&&this.fire(new o.Event("pitchstart",t))}_fireMoveEvents(t){this.fire(new o.Event("move",t)),this._zooming&&this.fire(new o.Event("zoom",t)),this._rotating&&this.fire(new o.Event("rotate",t)),this._pitching&&this.fire(new o.Event("pitch",t))}_afterEase(t,s){if(this._easeId&&s&&this._easeId===s)return;this._easeId=void 0,this.transform.cameraElevationReference="ground";let p=this._zooming,f=this._rotating,_=this._pitching;this._moving=!1,this._zooming=!1,this._rotating=!1,this._pitching=!1,this._padding=!1,p&&this.fire(new o.Event("zoomend",t)),f&&this.fire(new o.Event("rotateend",t)),_&&this.fire(new o.Event("pitchend",t)),this.fire(new o.Event("moveend",t))}flyTo(t,s){if(!t.essential&&o.exported.prefersReducedMotion){let je=o.pick(t,["center","zoom","bearing","pitch","around"]);return this.jumpTo(je,s)}this.stop(),t=o.extend({offset:[0,0],speed:1.2,curve:1.42,easing:o.ease},t);let p=this.transform,f=this.getZoom(),_=this.getBearing(),b=this.getPitch(),w=this.getPadding(),T="zoom"in t?o.clamp(+t.zoom,p.minZoom,p.maxZoom):f,A="bearing"in t?this._normalizeBearing(t.bearing,_):_,I="pitch"in t?+t.pitch:b,L="padding"in t?t.padding:p.padding,O=p.zoomScale(T-f),V=o.pointGeometry.convert(t.offset),N=p.centerPoint.add(V),j=p.pointLocation(N),J=o.LngLat.convert(t.center||j);this._normalizeCenter(J);let U=p.project(j),$=p.project(J).sub(U),q=t.curve,ie=Math.max(p.width,p.height),K=ie/O,Q=$.mag();if("minZoom"in t){let je=o.clamp(Math.min(t.minZoom,f,T),p.minZoom,p.maxZoom),Fe=ie/p.zoomScale(je-f);q=Math.sqrt(Fe/Q*2)}let ae=q*q;function ye(je){let Fe=(K*K-ie*ie+(je?-1:1)*ae*ae*Q*Q)/(2*(je?K:ie)*ae*Q);return Math.log(Math.sqrt(Fe*Fe+1)-Fe)}function be(je){return(Math.exp(je)-Math.exp(-je))/2}function xe(je){return(Math.exp(je)+Math.exp(-je))/2}let _e=ye(0),te=function(je){return xe(_e)/xe(_e+q*je)},Ie=function(je){return ie*((xe(_e)*(be(Fe=_e+q*je)/xe(Fe))-be(_e))/ae)/Q;var Fe},Me=(ye(1)-_e)/q;if(Math.abs(Q)<1e-6||!isFinite(Me)){if(Math.abs(ie-K)<1e-6)return this.easeTo(t,s);let je=K<ie?-1:1;Me=Math.abs(Math.log(K/ie))/q,Ie=function(){return 0},te=function(Fe){return Math.exp(je*q*Fe)}}t.duration="duration"in t?+t.duration:1e3*Me/("screenSpeed"in t?+t.screenSpeed/q:+t.speed),t.maxDuration&&t.duration>t.maxDuration&&(t.duration=0);let Ve=_!==A,Te=I!==b,tt=!p.isPaddingEqual(L),Ue=je=>Fe=>{let Oe=Fe*Me,ht=1/te(Oe);je.zoom=Fe===1?T:f+je.scaleZoom(ht),Ve&&(je.bearing=o.number(_,A,Fe)),Te&&(je.pitch=o.number(b,I,Fe)),tt&&(je.interpolatePadding(w,L,Fe),N=je.centerPoint.add(V));let rt=Fe===1?J:je.unproject(U.add($.mult(Ie(Oe))).mult(ht));return je.setLocationAtPoint(je.renderWorldCopies?rt.wrap():rt,N),je._updateCameraOnTerrain(),t.preloadOnly||this._fireMoveEvents(s),je};if(t.preloadOnly){let je=this._emulate(Ue,t.duration,p);return this._preloadTiles(je),this}return this._zooming=!0,this._rotating=Ve,this._pitching=Te,this._padding=tt,this._prepareEase(s,!1),this._ease(Ue(p),()=>this._afterEase(s),t),this}isEasing(){return!!this._easeFrameId}stop(){return this._stop()}_stop(t,s){if(this._easeFrameId&&(this._cancelRenderFrame(this._easeFrameId),this._easeFrameId=void 0,this._onEaseFrame=void 0),this._onEaseEnd){let p=this._onEaseEnd;this._onEaseEnd=void 0,p.call(this,s)}if(!t){let p=this.handlers;p&&p.stop(!1)}return this}_ease(t,s,p){p.animate===!1||p.duration===0?(t(1),s()):(this._easeStart=o.exported.now(),this._easeOptions=p,this._onEaseFrame=t,this._onEaseEnd=s,this._easeFrameId=this._requestRenderFrame(this._renderFrameCallback))}_renderFrameCallback(){let t=Math.min((o.exported.now()-this._easeStart)/this._easeOptions.duration,1),s=this._onEaseFrame;s&&s(this._easeOptions.easing(t)),t<1?this._easeFrameId=this._requestRenderFrame(this._renderFrameCallback):this.stop()}_normalizeBearing(t,s){t=o.wrap(t,-180,180);let p=Math.abs(t-s);return Math.abs(t-360-s)<p&&(t-=360),Math.abs(t+360-s)<p&&(t+=360),t}_normalizeCenter(t){let s=this.transform;if(!s.renderWorldCopies||s.maxBounds)return;let p=t.lng-s.center.lng;t.lng+=p>180?-360:p<-180?360:0}_emulate(t,s,p){let f=Math.ceil(15*s/1e3),_=[],b=t(p.clone());for(let w=0;w<=f;w++){let T=b(w/f);_.push(T.clone())}return _}}class jl{constructor(t={}){this.options=t,o.bindAll(["_toggleAttribution","_updateEditLink","_updateData","_updateCompact"],this)}getDefaultPosition(){return"bottom-right"}onAdd(t){let s=this.options&&this.options.compact;return this._map=t,this._container=oe("div","mapboxgl-ctrl mapboxgl-ctrl-attrib"),this._compactButton=oe("button","mapboxgl-ctrl-attrib-button",this._container),oe("span","mapboxgl-ctrl-icon",this._compactButton).setAttribute("aria-hidden","true"),this._compactButton.type="button",this._compactButton.addEventListener("click",this._toggleAttribution),this._setElementTitle(this._compactButton,"ToggleAttribution"),this._innerContainer=oe("div","mapboxgl-ctrl-attrib-inner",this._container),this._innerContainer.setAttribute("role","list"),s&&this._container.classList.add("mapboxgl-compact"),this._updateAttributions(),this._updateEditLink(),this._map.on("styledata",this._updateData),this._map.on("sourcedata",this._updateData),this._map.on("moveend",this._updateEditLink),s===void 0&&(this._map.on("resize",this._updateCompact),this._updateCompact()),this._container}onRemove(){this._container.remove(),this._map.off("styledata",this._updateData),this._map.off("sourcedata",this._updateData),this._map.off("moveend",this._updateEditLink),this._map.off("resize",this._updateCompact),this._map=void 0,this._attribHTML=void 0}_setElementTitle(t,s){let p=this._map._getUIString(`AttributionControl.${s}`);t.setAttribute("aria-label",p),t.removeAttribute("title"),t.firstElementChild&&t.firstElementChild.setAttribute("title",p)}_toggleAttribution(){this._container.classList.contains("mapboxgl-compact-show")?(this._container.classList.remove("mapboxgl-compact-show"),this._compactButton.setAttribute("aria-expanded","false")):(this._container.classList.add("mapboxgl-compact-show"),this._compactButton.setAttribute("aria-expanded","true"))}_updateEditLink(){let t=this._editLink;t||(t=this._editLink=this._container.querySelector(".mapbox-improve-map"));let s=[{key:"owner",value:this.styleOwner},{key:"id",value:this.styleId},{key:"access_token",value:this._map._requestManager._customAccessToken||o.config.ACCESS_TOKEN}];if(t){let p=s.reduce((f,_,b)=>(_.value&&(f+=`${_.key}=${_.value}${b<s.length-1?"&":""}`),f),"?");t.href=`${o.config.FEEDBACK_URL}/${p}${this._map._hash?this._map._hash.getHashString(!0):""}`,t.rel="noopener nofollow",this._setElementTitle(t,"MapFeedback")}}_updateData(t){!t||t.sourceDataType!=="metadata"&&t.sourceDataType!=="visibility"&&t.dataType!=="style"||(this._updateAttributions(),this._updateEditLink())}_updateAttributions(){if(!this._map.style)return;let t=[];if(this._map.style.stylesheet){let f=this._map.style.stylesheet;this.styleOwner=f.owner,this.styleId=f.id}let s=this._map.style._sourceCaches;for(let f in s){let _=s[f];if(_.used){let b=_.getSource();b.attribution&&t.indexOf(b.attribution)<0&&t.push(b.attribution)}}t.sort((f,_)=>f.length-_.length),t=t.filter((f,_)=>{for(let b=_+1;b<t.length;b++)if(t[b].indexOf(f)>=0)return!1;return!0}),this.options.customAttribution&&(Array.isArray(this.options.customAttribution)?t=[...this.options.customAttribution,...t]:t.unshift(this.options.customAttribution));let p=t.join(" | ");p!==this._attribHTML&&(this._attribHTML=p,t.length?(this._innerContainer.innerHTML=p,this._container.classList.remove("mapboxgl-attrib-empty")):this._container.classList.add("mapboxgl-attrib-empty"),this._editLink=null)}_updateCompact(){this._map.getCanvasContainer().offsetWidth<=640?this._container.classList.add("mapboxgl-compact"):this._container.classList.remove("mapboxgl-compact","mapboxgl-compact-show")}}class Ul{constructor(){o.bindAll(["_updateLogo","_updateCompact"],this)}onAdd(t){this._map=t,this._container=oe("div","mapboxgl-ctrl");let s=oe("a","mapboxgl-ctrl-logo");return s.target="_blank",s.rel="noopener nofollow",s.href="https://www.mapbox.com/",s.setAttribute("aria-label",this._map._getUIString("LogoControl.Title")),s.setAttribute("rel","noopener nofollow"),this._container.appendChild(s),this._container.style.display="none",this._map.on("sourcedata",this._updateLogo),this._updateLogo(),this._map.on("resize",this._updateCompact),this._updateCompact(),this._container}onRemove(){this._container.remove(),this._map.off("sourcedata",this._updateLogo),this._map.off("resize",this._updateCompact)}getDefaultPosition(){return"bottom-left"}_updateLogo(t){t&&t.sourceDataType!=="metadata"||(this._container.style.display=this._logoRequired()?"block":"none")}_logoRequired(){if(!this._map.style)return!0;let t=this._map.style._sourceCaches;if(Object.entries(t).length===0)return!0;for(let s in t){let p=t[s].getSource();if(p.hasOwnProperty("mapbox_logo")&&!p.mapbox_logo)return!1}return!0}_updateCompact(){let t=this._container.children;if(t.length){let s=t[0];this._map.getCanvasContainer().offsetWidth<250?s.classList.add("mapboxgl-compact"):s.classList.remove("mapboxgl-compact")}}}class Vl{constructor(){this._queue=[],this._id=0,this._cleared=!1,this._currentlyRunning=!1}add(t){let s=++this._id;return this._queue.push({callback:t,id:s,cancelled:!1}),s}remove(t){let s=this._currentlyRunning,p=s?this._queue.concat(s):this._queue;for(let f of p)if(f.id===t)return void(f.cancelled=!0)}run(t=0){let s=this._currentlyRunning=this._queue;this._queue=[];for(let p of s)if(!p.cancelled&&(p.callback(t),this._cleared))break;this._cleared=!1,this._currentlyRunning=!1}clear(){this._currentlyRunning&&(this._cleared=!0),this._queue=[]}}function Nl(l,t,s){if(l=new o.LngLat(l.lng,l.lat),t){let p=new o.LngLat(l.lng-360,l.lat),f=new o.LngLat(l.lng+360,l.lat),_=360*Math.ceil(Math.abs(l.lng-s.center.lng)/360),b=s.locationPoint(l).distSqr(t),w=t.x<0||t.y<0||t.x>s.width||t.y>s.height;s.locationPoint(p).distSqr(t)<b&&(w||Math.abs(p.lng-s.center.lng)<_)?l=p:s.locationPoint(f).distSqr(t)<b&&(w||Math.abs(f.lng-s.center.lng)<_)&&(l=f)}for(;Math.abs(l.lng-s.center.lng)>180;){let p=s.locationPoint(l);if(p.x>=0&&p.y>=0&&p.x<=s.width&&p.y<=s.height)break;l.lng>s.center.lng?l.lng-=360:l.lng+=360}return l}let Ra={center:"translate(-50%,-50%)",top:"translate(-50%,0)","top-left":"translate(0,0)","top-right":"translate(-100%,0)",bottom:"translate(-50%,-100%)","bottom-left":"translate(0,-100%)","bottom-right":"translate(-100%,-100%)",left:"translate(0,-50%)",right:"translate(-100%,-50%)"};class Fa extends o.Evented{constructor(t,s){if(super(),(t instanceof o.window.HTMLElement||s)&&(t=o.extend({element:t},s)),o.bindAll(["_update","_onMove","_onUp","_addDragHandler","_onMapClick","_onKeyPress","_clearFadeTimer"],this),this._anchor=t&&t.anchor||"center",this._color=t&&t.color||"#3FB1CE",this._scale=t&&t.scale||1,this._draggable=t&&t.draggable||!1,this._clickTolerance=t&&t.clickTolerance||0,this._isDragging=!1,this._state="inactive",this._rotation=t&&t.rotation||0,this._rotationAlignment=t&&t.rotationAlignment||"auto",this._pitchAlignment=t&&t.pitchAlignment&&t.pitchAlignment||"auto",this._updateMoving=()=>this._update(!0),t&&t.element)this._element=t.element,this._offset=o.pointGeometry.convert(t&&t.offset||[0,0]);else{this._defaultMarker=!0,this._element=oe("div");let f=41,_=27,b=Ee("svg",{display:"block",height:f*this._scale+"px",width:_*this._scale+"px",viewBox:`0 0 ${_} ${f}`},this._element),w=Ee("radialGradient",{id:"shadowGradient"},Ee("defs",{},b));Ee("stop",{offset:"10%","stop-opacity":.4},w),Ee("stop",{offset:"100%","stop-opacity":.05},w),Ee("ellipse",{cx:13.5,cy:34.8,rx:10.5,ry:5.25,fill:"url(#shadowGradient)"},b),Ee("path",{fill:this._color,d:"M27,13.5C27,19.07 20.25,27 14.75,34.5C14.02,35.5 12.98,35.5 12.25,34.5C6.75,27 0,19.22 0,13.5C0,6.04 6.04,0 13.5,0C20.96,0 27,6.04 27,13.5Z"},b),Ee("path",{opacity:.25,d:"M13.5,0C6.04,0 0,6.04 0,13.5C0,19.22 6.75,27 12.25,34.5C13,35.52 14.02,35.5 14.75,34.5C20.25,27 27,19.07 27,13.5C27,6.04 20.96,0 13.5,0ZM13.5,1C20.42,1 26,6.58 26,13.5C26,15.9 24.5,19.18 22.22,22.74C19.95,26.3 16.71,30.14 13.94,33.91C13.74,34.18 13.61,34.32 13.5,34.44C13.39,34.32 13.26,34.18 13.06,33.91C10.28,30.13 7.41,26.31 5.02,22.77C2.62,19.23 1,15.95 1,13.5C1,6.58 6.58,1 13.5,1Z"},b),Ee("circle",{fill:"white",cx:13.5,cy:13.5,r:5.5},b),this._offset=o.pointGeometry.convert(t&&t.offset||[0,-14])}this._element.hasAttribute("aria-label")||this._element.setAttribute("aria-label","Map marker"),this._element.classList.add("mapboxgl-marker"),this._element.addEventListener("dragstart",f=>{f.preventDefault()}),this._element.addEventListener("mousedown",f=>{f.preventDefault()});let p=this._element.classList;for(let f in Ra)p.remove(`mapboxgl-marker-anchor-${f}`);p.add(`mapboxgl-marker-anchor-${this._anchor}`),this._popup=null}addTo(t){return t===this._map||(this.remove(),this._map=t,t.getCanvasContainer().appendChild(this._element),t.on("move",this._updateMoving),t.on("moveend",this._update),t.on("remove",this._clearFadeTimer),t._addMarker(this),this.setDraggable(this._draggable),this._update(),t.on("click",this._onMapClick)),this}remove(){let t=this._map;return t&&(t.off("click",this._onMapClick),t.off("move",this._updateMoving),t.off("moveend",this._update),t.off("mousedown",this._addDragHandler),t.off("touchstart",this._addDragHandler),t.off("mouseup",this._onUp),t.off("touchend",this._onUp),t.off("mousemove",this._onMove),t.off("touchmove",this._onMove),t.off("remove",this._clearFadeTimer),t._removeMarker(this),this._map=void 0),this._clearFadeTimer(),this._element.remove(),this._popup&&this._popup.remove(),this}getLngLat(){return this._lngLat}setLngLat(t){return this._lngLat=o.LngLat.convert(t),this._pos=null,this._popup&&this._popup.setLngLat(this._lngLat),this._update(!0),this}getElement(){return this._element}setPopup(t){if(this._popup&&(this._popup.remove(),this._popup=null,this._element.removeAttribute("role"),this._element.removeEventListener("keypress",this._onKeyPress),this._originalTabIndex||this._element.removeAttribute("tabindex")),t){if(!("offset"in t.options)){let f=Math.sqrt(Math.pow(13.5,2)/2);t.options.offset=this._defaultMarker?{top:[0,0],"top-left":[0,0],"top-right":[0,0],bottom:[0,-38.1],"bottom-left":[f,-1*(38.1-13.5+f)],"bottom-right":[-f,-1*(38.1-13.5+f)],left:[13.5,-1*(38.1-13.5)],right:[-13.5,-1*(38.1-13.5)]}:this._offset}this._popup=t,t._marker=this,this._lngLat&&this._popup.setLngLat(this._lngLat),this._element.setAttribute("role","button"),this._originalTabIndex=this._element.getAttribute("tabindex"),this._originalTabIndex||this._element.setAttribute("tabindex","0"),this._element.addEventListener("keypress",this._onKeyPress),this._element.setAttribute("aria-expanded","false")}return this}_onKeyPress(t){let s=t.code,p=t.charCode||t.keyCode;s!=="Space"&&s!=="Enter"&&p!==32&&p!==13||this.togglePopup()}_onMapClick(t){let s=t.originalEvent.target,p=this._element;this._popup&&(s===p||p.contains(s))&&this.togglePopup()}getPopup(){return this._popup}togglePopup(){let t=this._popup;return t?(t.isOpen()?(t.remove(),this._element.setAttribute("aria-expanded","false")):this._map&&(t.addTo(this._map),this._element.setAttribute("aria-expanded","true")),this):this}_behindTerrain(){let t=this._map;if(!t)return!1;let s=t.unproject(this._pos),p=t.getFreeCameraOptions();if(!p.position)return!1;let f=p.position.toLngLat();return f.distanceTo(s)<.9*f.distanceTo(this._lngLat)}_evaluateOpacity(){let t=this._map;if(!t)return;let s=this._pos;if(!s||s.x<0||s.x>t.transform.width||s.y<0||s.y>t.transform.height)return void this._clearFadeTimer();let p=t.unproject(s),f;t._usingGlobe()&&o.isLngLatBehindGlobe(t.transform,this._lngLat)?f=0:(f=1-t._queryFogOpacity(p),t.transform._terrainEnabled()&&t.getTerrain()&&this._behindTerrain()&&(f*=.2)),this._element.style.opacity=`${f}`,this._element.style.pointerEvents=f>0?"auto":"none",this._popup&&this._popup._setOpacity(f),this._fadeTimer=null}_clearFadeTimer(){this._fadeTimer&&(clearTimeout(this._fadeTimer),this._fadeTimer=null)}_updateDOM(){let t=this._pos;if(!t||!this._map)return;let s=this._calculateXYTransform()+this._calculateZTransform(),p=this._offset.mult(this._scale);this._element.style.transform=`
            translate(${t.x}px,${t.y}px) ${Ra[this._anchor]}
            ${s}
            translate(${p.x}px,${p.y}px)
        `}_calculateXYTransform(){let t=this._pos,s=this._map;if(this.getPitchAlignment()!=="map"||!s||!t)return"";if(!s._usingGlobe()){let T=s.getPitch();return T?`rotateX(${T}deg)`:""}let p=o.radToDeg(o.globeTiltAtLngLat(s.transform,this._lngLat)),f=t.sub(o.globeCenterToScreenPoint(s.transform)),_=p/(Math.abs(f.x)+Math.abs(f.y)),b=f.x*_,w=-f.y*_;return w||b?`rotateX(${w}deg) rotateY(${b}deg)`:""}_calculateZTransform(){let t=this._calculateRotation();return t?`rotateZ(${t}deg)`:""}_calculateRotation(){if(this._rotationAlignment==="viewport"||this._rotationAlignment==="auto")return this._rotation;if(this._map&&this._rotationAlignment==="map"){let t=this._map;if(this._pos&&t&&t._usingGlobe()){let s=t.project(new o.LngLat(this._lngLat.lng,this._lngLat.lat+.001)),p=t.project(new o.LngLat(this._lngLat.lng,this._lngLat.lat-.001)).sub(s);return this._rotation+o.radToDeg(Math.atan2(p.y,p.x))-90}return this._rotation-this._map.getBearing()}return 0}_update(t){o.window.cancelAnimationFrame(this._updateFrameId);let s=this._map;s&&(s.transform.renderWorldCopies&&(this._lngLat=Nl(this._lngLat,this._pos,s.transform)),this._pos=s.project(this._lngLat),t===!0?this._updateFrameId=o.window.requestAnimationFrame(()=>{this._element&&this._pos&&this._anchor&&(this._pos=this._pos.round(),this._updateDOM())}):this._pos=this._pos.round(),s._requestDomTask(()=>{this._map&&(this._element&&this._pos&&this._anchor&&this._updateDOM(),(s._usingGlobe()||s.getTerrain()||s.getFog())&&!this._fadeTimer&&(this._fadeTimer=setTimeout(this._evaluateOpacity.bind(this),60)))}))}getOffset(){return this._offset}setOffset(t){return this._offset=o.pointGeometry.convert(t),this._update(),this}_onMove(t){let s=this._map;if(s){if(!this._isDragging){let p=this._clickTolerance||s._clickTolerance;this._isDragging=t.point.dist(this._pointerdownPos)>=p}this._isDragging&&(this._pos=t.point.sub(this._positionDelta),this._lngLat=s.unproject(this._pos),this.setLngLat(this._lngLat),this._element.style.pointerEvents="none",this._state==="pending"&&(this._state="active",this.fire(new o.Event("dragstart"))),this.fire(new o.Event("drag")))}}_onUp(){this._element.style.pointerEvents="auto",this._positionDelta=null,this._pointerdownPos=null,this._isDragging=!1;let t=this._map;t&&(t.off("mousemove",this._onMove),t.off("touchmove",this._onMove)),this._state==="active"&&this.fire(new o.Event("dragend")),this._state="inactive"}_addDragHandler(t){let s=this._map;s&&this._element.contains(t.originalEvent.target)&&(t.preventDefault(),this._positionDelta=t.point.sub(this._pos),this._pointerdownPos=t.point,this._state="pending",s.on("mousemove",this._onMove),s.on("touchmove",this._onMove),s.once("mouseup",this._onUp),s.once("touchend",this._onUp))}setDraggable(t){this._draggable=!!t;let s=this._map;return s&&(t?(s.on("mousedown",this._addDragHandler),s.on("touchstart",this._addDragHandler)):(s.off("mousedown",this._addDragHandler),s.off("touchstart",this._addDragHandler))),this}isDraggable(){return this._draggable}setRotation(t){return this._rotation=t||0,this._update(),this}getRotation(){return this._rotation}setRotationAlignment(t){return this._rotationAlignment=t||"auto",this._update(),this}getRotationAlignment(){return this._rotationAlignment==="auto"?"viewport":this._rotationAlignment}setPitchAlignment(t){return this._pitchAlignment=t||"auto",this._update(),this}getPitchAlignment(){return this._pitchAlignment==="auto"?this.getRotationAlignment():this._pitchAlignment}}class zh{constructor(t){this.jumpTo(t)}getValue(t){if(t<=this._startTime)return this._start;if(t>=this._endTime)return this._end;let s=o.easeCubicInOut((t-this._startTime)/(this._endTime-this._startTime));return this._start*(1-s)+this._end*s}isEasing(t){return t>=this._startTime&&t<=this._endTime}jumpTo(t){this._startTime=-1/0,this._endTime=-1/0,this._start=t,this._end=t}easeTo(t,s,p){this._start=this.getValue(s),this._end=t,this._startTime=s,this._endTime=s+p}}let Gl={"AttributionControl.ToggleAttribution":"Toggle attribution","AttributionControl.MapFeedback":"Map feedback","FullscreenControl.Enter":"Enter fullscreen","FullscreenControl.Exit":"Exit fullscreen","GeolocateControl.FindMyLocation":"Find my location","GeolocateControl.LocationNotAvailable":"Location not available","LogoControl.Title":"Mapbox logo","Map.Title":"Map","NavigationControl.ResetBearing":"Reset bearing to north","NavigationControl.ZoomIn":"Zoom in","NavigationControl.ZoomOut":"Zoom out","ScrollZoomBlocker.CtrlMessage":"Use ctrl + scroll to zoom the map","ScrollZoomBlocker.CmdMessage":"Use \u2318 + scroll to zoom the map","TouchPanBlocker.Message":"Use two fingers to move the map"},Ph={center:[0,0],zoom:0,bearing:0,pitch:0,minZoom:-2,maxZoom:22,minPitch:0,maxPitch:85,interactive:!0,scrollZoom:!0,boxZoom:!0,dragRotate:!0,dragPan:!0,keyboard:!0,doubleClickZoom:!0,touchZoomRotate:!0,touchPitch:!0,cooperativeGestures:!1,bearingSnap:7,clickTolerance:3,pitchWithRotate:!0,hash:!1,attributionControl:!0,failIfMajorPerformanceCaveat:!1,preserveDrawingBuffer:!1,trackResize:!0,optimizeForTerrain:!0,renderWorldCopies:!0,refreshExpiredTiles:!0,minTileCacheSize:null,maxTileCacheSize:null,localIdeographFontFamily:"sans-serif",localFontFamily:null,transformRequest:null,accessToken:null,fadeDuration:300,crossSourceCollisions:!0};function Oa(l){l.parentNode&&l.parentNode.removeChild(l)}let Dh={showCompass:!0,showZoom:!0,visualizePitch:!1};class Lh{constructor(t,s,p=!1){this._clickTolerance=10,this.element=s,this.mouseRotate=new Fl({clickTolerance:t.dragRotate._mouseRotate._clickTolerance}),this.map=t,p&&(this.mousePitch=new Ol({clickTolerance:t.dragRotate._mousePitch._clickTolerance})),o.bindAll(["mousedown","mousemove","mouseup","touchstart","touchmove","touchend","reset"],this),s.addEventListener("mousedown",this.mousedown),s.addEventListener("touchstart",this.touchstart,{passive:!1}),s.addEventListener("touchmove",this.touchmove),s.addEventListener("touchend",this.touchend),s.addEventListener("touchcancel",this.reset)}down(t,s){this.mouseRotate.mousedown(t,s),this.mousePitch&&this.mousePitch.mousedown(t,s),Ke()}move(t,s){let p=this.map,f=this.mouseRotate.mousemoveWindow(t,s),_=f&&f.bearingDelta;if(_&&p.setBearing(p.getBearing()+_),this.mousePitch){let b=this.mousePitch.mousemoveWindow(t,s),w=b&&b.pitchDelta;w&&p.setPitch(p.getPitch()+w)}}off(){let t=this.element;t.removeEventListener("mousedown",this.mousedown),t.removeEventListener("touchstart",this.touchstart,{passive:!1}),t.removeEventListener("touchmove",this.touchmove),t.removeEventListener("touchend",this.touchend),t.removeEventListener("touchcancel",this.reset),this.offTemp()}offTemp(){Ye(),o.window.removeEventListener("mousemove",this.mousemove),o.window.removeEventListener("mouseup",this.mouseup)}mousedown(t){this.down(o.extend({},t,{ctrlKey:!0,preventDefault:()=>t.preventDefault()}),Je(this.element,t)),o.window.addEventListener("mousemove",this.mousemove),o.window.addEventListener("mouseup",this.mouseup)}mousemove(t){this.move(t,Je(this.element,t))}mouseup(t){this.mouseRotate.mouseupWindow(t),this.mousePitch&&this.mousePitch.mouseupWindow(t),this.offTemp()}touchstart(t){t.targetTouches.length!==1?this.reset():(this._startPos=this._lastPos=Et(this.element,t.targetTouches)[0],this.down({type:"mousedown",button:0,ctrlKey:!0,preventDefault:()=>t.preventDefault()},this._startPos))}touchmove(t){t.targetTouches.length!==1?this.reset():(this._lastPos=Et(this.element,t.targetTouches)[0],this.move({preventDefault:()=>t.preventDefault()},this._lastPos))}touchend(t){t.targetTouches.length===0&&this._startPos&&this._lastPos&&this._startPos.dist(this._lastPos)<this._clickTolerance&&this.element.click(),this.reset()}reset(){this.mouseRotate.reset(),this.mousePitch&&this.mousePitch.reset(),delete this._startPos,delete this._lastPos,this.offTemp()}}let $l={positionOptions:{enableHighAccuracy:!1,maximumAge:0,timeout:6e3},fitBoundsOptions:{maxZoom:15},trackUserLocation:!1,showAccuracyCircle:!0,showUserLocation:!0,showUserHeading:!1},Bh={maxWidth:100,unit:"metric"};function ql(l,t,s){let p=Zl(t),f=p/t,_={kilometer:"km",meter:"m",mile:"mi",foot:"ft","nautical-mile":"nm"}[s];this._map._requestDomTask(()=>{this._container.style.width=l*f+"px",this._container.innerHTML=`${p}&nbsp;${_}`})}function Zl(l){let t=Math.pow(10,`${Math.floor(l)}`.length-1),s=l/t;return s=s>=10?10:s>=5?5:s>=3?3:s>=2?2:s>=1?1:function(p){let f=Math.pow(10,Math.ceil(-Math.log(p)/Math.LN10));return Math.round(p*f)/f}(s),t*s}let Wl={closeButton:!0,closeOnClick:!0,focusAfterOpen:!0,className:"",maxWidth:"240px"},Hl=["a[href]","[tabindex]:not([tabindex='-1'])","[contenteditable]:not([contenteditable='false'])","button:not([disabled])","input:not([disabled])","select:not([disabled])","textarea:not([disabled])"].join(", ");function ja(l=new o.pointGeometry(0,0),t="bottom"){if(typeof l=="number"){let s=Math.round(Math.sqrt(.5*Math.pow(l,2)));switch(t){case"top":return new o.pointGeometry(0,l);case"top-left":return new o.pointGeometry(s,s);case"top-right":return new o.pointGeometry(-s,s);case"bottom":return new o.pointGeometry(0,-l);case"bottom-left":return new o.pointGeometry(s,-s);case"bottom-right":return new o.pointGeometry(-s,-s);case"left":return new o.pointGeometry(l,0);case"right":return new o.pointGeometry(-l,0)}return new o.pointGeometry(0,0)}return l instanceof o.pointGeometry||Array.isArray(l)?o.pointGeometry.convert(l):o.pointGeometry.convert(l[t]||[0,0])}let Ua={version:o.version,supported:B,setRTLTextPlugin:o.setRTLTextPlugin,getRTLTextPluginStatus:o.getRTLTextPluginStatus,Map:class extends Ba{constructor(l){if((l=o.extend({},Ph,l)).minZoom!=null&&l.maxZoom!=null&&l.minZoom>l.maxZoom)throw new Error("maxZoom must be greater than or equal to minZoom");if(l.minPitch!=null&&l.maxPitch!=null&&l.minPitch>l.maxPitch)throw new Error("maxPitch must be greater than or equal to minPitch");if(l.minPitch!=null&&l.minPitch<0)throw new Error("minPitch must be greater than or equal to 0");if(l.maxPitch!=null&&l.maxPitch>85)throw new Error("maxPitch must be less than or equal to 85");if(l.antialias&&o.isSafariWithAntialiasingBug(o.window)&&(l.antialias=!1,o.warnOnce("Antialiasing is disabled for this WebGL context to avoid browser bug: https://github.com/mapbox/mapbox-gl-js/issues/11609")),super(new ka(l.minZoom,l.maxZoom,l.minPitch,l.maxPitch,l.renderWorldCopies),l),this._interactive=l.interactive,this._minTileCacheSize=l.minTileCacheSize,this._maxTileCacheSize=l.maxTileCacheSize,this._failIfMajorPerformanceCaveat=l.failIfMajorPerformanceCaveat,this._preserveDrawingBuffer=l.preserveDrawingBuffer,this._antialias=l.antialias,this._trackResize=l.trackResize,this._bearingSnap=l.bearingSnap,this._refreshExpiredTiles=l.refreshExpiredTiles,this._fadeDuration=l.fadeDuration,this._isInitialLoad=!0,this._crossSourceCollisions=l.crossSourceCollisions,this._crossFadingFactor=1,this._collectResourceTiming=l.collectResourceTiming,this._optimizeForTerrain=l.optimizeForTerrain,this._language=l.language==="auto"?o.window.navigator.language:l.language,this._worldview=l.worldview,this._renderTaskQueue=new Vl,this._domRenderTaskQueue=new Vl,this._controls=[],this._markers=[],this._mapId=o.uniqueId(),this._locale=o.extend({},Gl,l.locale),this._clickTolerance=l.clickTolerance,this._cooperativeGestures=l.cooperativeGestures,this._containerWidth=0,this._containerHeight=0,this._averageElevationLastSampledAt=-1/0,this._averageElevationExaggeration=0,this._averageElevation=new zh(0),this._explicitProjection=null,this._requestManager=new o.RequestManager(l.transformRequest,l.accessToken,l.testMode),this._silenceAuthErrors=!!l.testMode,typeof l.container=="string"){if(this._container=o.window.document.getElementById(l.container),!this._container)throw new Error(`Container '${l.container}' not found.`)}else{if(!(l.container instanceof o.window.HTMLElement))throw new Error("Invalid type: 'container' must be a String or HTMLElement.");this._container=l.container}if(this._container.childNodes.length>0&&o.warnOnce("The map container element should be empty, otherwise the map's interactivity will be negatively impacted. If you want to display a message when WebGL is not supported, use the Mapbox GL Supported plugin instead."),l.maxBounds&&this.setMaxBounds(l.maxBounds),o.bindAll(["_onWindowOnline","_onWindowResize","_onMapScroll","_contextLost","_contextRestored"],this),this._setupContainer(),this._setupPainter(),this.painter===void 0)throw new Error("Failed to initialize WebGL.");this.on("move",()=>this._update(!1)),this.on("moveend",()=>this._update(!1)),this.on("zoom",()=>this._update(!0)),o.window!==void 0&&(o.window.addEventListener("online",this._onWindowOnline,!1),o.window.addEventListener("resize",this._onWindowResize,!1),o.window.addEventListener("orientationchange",this._onWindowResize,!1),o.window.addEventListener("webkitfullscreenchange",this._onWindowResize,!1)),this.handlers=new Da(this,l),this._localFontFamily=l.localFontFamily,this._localIdeographFontFamily=l.localIdeographFontFamily,l.style&&this.setStyle(l.style,{localFontFamily:this._localFontFamily,localIdeographFontFamily:this._localIdeographFontFamily}),l.projection&&this.setProjection(l.projection),this._hash=l.hash&&new Bl(typeof l.hash=="string"&&l.hash||void 0).addTo(this),this._hash&&this._hash._onHashChange()||(this.jumpTo({center:l.center,zoom:l.zoom,bearing:l.bearing,pitch:l.pitch}),l.bounds&&(this.resize(),this.fitBounds(l.bounds,o.extend({},l.fitBoundsOptions,{duration:0})))),this.resize(),l.attributionControl&&this.addControl(new jl({customAttribution:l.customAttribution})),this._logoControl=new Ul,this.addControl(this._logoControl,l.logoPosition),this.on("style.load",()=>{this.transform.unmodified&&this.jumpTo(this.style.stylesheet)}),this.on("data",t=>{this._update(t.dataType==="style"),this.fire(new o.Event(`${t.dataType}data`,t))}),this.on("dataloading",t=>{this.fire(new o.Event(`${t.dataType}dataloading`,t))})}_getMapId(){return this._mapId}addControl(l,t){if(t===void 0&&(t=l.getDefaultPosition?l.getDefaultPosition():"top-right"),!l||!l.onAdd)return this.fire(new o.ErrorEvent(new Error("Invalid argument to map.addControl(). Argument must be a control with onAdd and onRemove methods.")));let s=l.onAdd(this);this._controls.push(l);let p=this._controlPositions[t];return t.indexOf("bottom")!==-1?p.insertBefore(s,p.firstChild):p.appendChild(s),this}removeControl(l){if(!l||!l.onRemove)return this.fire(new o.ErrorEvent(new Error("Invalid argument to map.removeControl(). Argument must be a control with onAdd and onRemove methods.")));let t=this._controls.indexOf(l);return t>-1&&this._controls.splice(t,1),l.onRemove(this),this}hasControl(l){return this._controls.indexOf(l)>-1}getContainer(){return this._container}getCanvasContainer(){return this._canvasContainer}getCanvas(){return this._canvas}resize(l){if(this._updateContainerDimensions(),this._containerWidth===this.transform.width&&this._containerHeight===this.transform.height)return this;this._resizeCanvas(this._containerWidth,this._containerHeight),this.transform.resize(this._containerWidth,this._containerHeight),this.painter.resize(Math.ceil(this._containerWidth),Math.ceil(this._containerHeight));let t=!this._moving;return t&&this.fire(new o.Event("movestart",l)).fire(new o.Event("move",l)),this.fire(new o.Event("resize",l)),t&&this.fire(new o.Event("moveend",l)),this}getBounds(){return this.transform.projection.name==="globe"&&o.warnOnce('Globe projection does not support getBounds API, this API may behave unexpectedly."'),this.transform.getBounds()}getMaxBounds(){return this.transform.getMaxBounds()||null}setMaxBounds(l){return this.transform.setMaxBounds(o.LngLatBounds.convert(l)),this._update()}setMinZoom(l){if((l=l??-2)>=-2&&l<=this.transform.maxZoom)return this.transform.minZoom=l,this._update(),this.getZoom()<l?this.setZoom(l):this.fire(new o.Event("zoomstart")).fire(new o.Event("zoom")).fire(new o.Event("zoomend")),this;throw new Error("minZoom must be between -2 and the current maxZoom, inclusive")}getMinZoom(){return this.transform.minZoom}setMaxZoom(l){if((l=l??22)>=this.transform.minZoom)return this.transform.maxZoom=l,this._update(),this.getZoom()>l?this.setZoom(l):this.fire(new o.Event("zoomstart")).fire(new o.Event("zoom")).fire(new o.Event("zoomend")),this;throw new Error("maxZoom must be greater than the current minZoom")}getMaxZoom(){return this.transform.maxZoom}setMinPitch(l){if((l=l??0)<0)throw new Error("minPitch must be greater than or equal to 0");if(l>=0&&l<=this.transform.maxPitch)return this.transform.minPitch=l,this._update(),this.getPitch()<l?this.setPitch(l):this.fire(new o.Event("pitchstart")).fire(new o.Event("pitch")).fire(new o.Event("pitchend")),this;throw new Error("minPitch must be between 0 and the current maxPitch, inclusive")}getMinPitch(){return this.transform.minPitch}setMaxPitch(l){if((l=l??85)>85)throw new Error("maxPitch must be less than or equal to 85");if(l>=this.transform.minPitch)return this.transform.maxPitch=l,this._update(),this.getPitch()>l?this.setPitch(l):this.fire(new o.Event("pitchstart")).fire(new o.Event("pitch")).fire(new o.Event("pitchend")),this;throw new Error("maxPitch must be greater than or equal to minPitch")}getMaxPitch(){return this.transform.maxPitch}getRenderWorldCopies(){return this.transform.renderWorldCopies}setRenderWorldCopies(l){return this.transform.renderWorldCopies=l,this._update()}getLanguage(){return this._language}setLanguage(l){if(this._language=l==="auto"?o.window.navigator.language:l,this.style)for(let t in this.style._sourceCaches){let s=this.style._sourceCaches[t]._source;s._setLanguage&&s._setLanguage(this._language)}for(let t of this._controls)t._setLanguage&&t._setLanguage(this._language);return this}getWorldview(){return this._worldview}setWorldview(l){if(this._worldview=l,this.style)for(let t in this.style._sourceCaches){let s=this.style._sourceCaches[t]._source;s._setWorldview&&s._setWorldview(l)}return this}getProjection(){return this._explicitProjection?this._explicitProjection:this.style&&this.style.stylesheet&&this.style.stylesheet.projection?this.style.stylesheet.projection:{name:"mercator",center:[0,0]}}_usingGlobe(){return this.transform.projection.name==="globe"}setProjection(l){return this._lazyInitEmptyStyle(),l?typeof l=="string"&&(l={name:l}):l=null,this._updateProjection(l)}_updateProjection(l){let t=this.getProjection();l===null&&(this._explicitProjection=null);let s=l||this.getProjection(),p;if(s&&s.name==="globe"&&this.transform.zoom>=o.GLOBE_ZOOM_THRESHOLD_MAX?(p=this.transform.setProjection({name:"mercator"}),this.transform.mercatorFromTransition=!0):(p=this.transform.setProjection(s),this.transform.mercatorFromTransition=!1),l&&(this._explicitProjection=l.name==="globe"?{name:"globe",center:[0,0]}:this.transform.getProjection()),this.style.applyProjectionUpdate(),p){if(t.name==="globe"&&this.getProjection().name==="globe")this.style._forceSymbolLayerUpdate();else{this.painter.clearBackgroundTiles();for(let f in this.style._sourceCaches)this.style._sourceCaches[f].clearTiles()}this._update(!0)}return this}project(l){return this.transform.locationPoint3D(o.LngLat.convert(l))}unproject(l){return this.transform.pointLocation3D(o.pointGeometry.convert(l))}isMoving(){return this._moving||this.handlers&&this.handlers.isMoving()||!1}isZooming(){return this._zooming||this.handlers&&this.handlers.isZooming()||!1}isRotating(){return this._rotating||this.handlers&&this.handlers.isRotating()||!1}_createDelegatedListener(l,t,s){if(l==="mouseenter"||l==="mouseover"){let p=!1,f=b=>{let w=t.filter(A=>this.getLayer(A)),T=w.length?this.queryRenderedFeatures(b.point,{layers:w}):[];T.length?p||(p=!0,s.call(this,new Ni(l,this,b.originalEvent,{features:T}))):p=!1},_=()=>{p=!1};return{layers:new Set(t),listener:s,delegates:{mousemove:f,mouseout:_}}}if(l==="mouseleave"||l==="mouseout"){let p=!1,f=b=>{let w=t.filter(T=>this.getLayer(T));(w.length?this.queryRenderedFeatures(b.point,{layers:w}):[]).length?p=!0:p&&(p=!1,s.call(this,new Ni(l,this,b.originalEvent)))},_=b=>{p&&(p=!1,s.call(this,new Ni(l,this,b.originalEvent)))};return{layers:new Set(t),listener:s,delegates:{mousemove:f,mouseout:_}}}{let p=f=>{let _=t.filter(w=>this.getLayer(w)),b=_.length?this.queryRenderedFeatures(f.point,{layers:_}):[];b.length&&(f.features=b,s.call(this,f),delete f.features)};return{layers:new Set(t),listener:s,delegates:{[l]:p}}}}on(l,t,s){if(s===void 0)return super.on(l,t);Array.isArray(t)||(t=[t]);let p=this._createDelegatedListener(l,t,s);this._delegatedListeners=this._delegatedListeners||{},this._delegatedListeners[l]=this._delegatedListeners[l]||[],this._delegatedListeners[l].push(p);for(let f in p.delegates)this.on(f,p.delegates[f]);return this}once(l,t,s){if(s===void 0)return super.once(l,t);Array.isArray(t)||(t=[t]);let p=this._createDelegatedListener(l,t,s);for(let f in p.delegates)this.once(f,p.delegates[f]);return this}off(l,t,s){if(s===void 0)return super.off(l,t);t=new Set(Array.isArray(t)?t:[t]);let p=(_,b)=>{if(_.size!==b.size)return!1;for(let w of _)if(!b.has(w))return!1;return!0},f=this._delegatedListeners?this._delegatedListeners[l]:void 0;return f&&(_=>{for(let b=0;b<_.length;b++){let w=_[b];if(w.listener===s&&p(w.layers,t)){for(let T in w.delegates)this.off(T,w.delegates[T]);return _.splice(b,1),this}}})(f),this}queryRenderedFeatures(l,t){return this.style?(t!==void 0||l===void 0||l instanceof o.pointGeometry||Array.isArray(l)||(t=l,l=void 0),this.style.queryRenderedFeatures(l=l||[[0,0],[this.transform.width,this.transform.height]],t=t||{},this.transform)):[]}querySourceFeatures(l,t){return this.style.querySourceFeatures(l,t)}queryTerrainElevation(l,t){let s=this.transform.elevation;return s?(t=o.extend({},{exaggerated:!0},t),s.getAtPoint(o.MercatorCoordinate.fromLngLat(l),null,t.exaggerated)):null}setStyle(l,t){return(t=o.extend({},{localIdeographFontFamily:this._localIdeographFontFamily,localFontFamily:this._localFontFamily},t)).diff!==!1&&t.localIdeographFontFamily===this._localIdeographFontFamily&&t.localFontFamily===this._localFontFamily&&this.style&&l?(this._diffStyle(l,t),this):(this._localIdeographFontFamily=t.localIdeographFontFamily,this._localFontFamily=t.localFontFamily,this._updateStyle(l,t))}_getUIString(l){let t=this._locale[l];if(t==null)throw new Error(`Missing UI string '${l}'`);return t}_updateStyle(l,t){return this.style&&(this.style.setEventedParent(null),this.style._remove(),this.style=void 0),l&&(this.style=new Sr(this,t||{}),this.style.setEventedParent(this,{style:this.style}),typeof l=="string"?this.style.loadURL(l):this.style.loadJSON(l)),this._updateTerrain(),this}_lazyInitEmptyStyle(){this.style||(this.style=new Sr(this,{}),this.style.setEventedParent(this,{style:this.style}),this.style.loadEmpty())}_diffStyle(l,t){if(typeof l=="string"){let s=this._requestManager.normalizeStyleURL(l),p=this._requestManager.transformRequest(s,o.ResourceType.Style);o.getJSON(p,(f,_)=>{f?this.fire(new o.ErrorEvent(f)):_&&this._updateDiff(_,t)})}else typeof l=="object"&&this._updateDiff(l,t)}_updateDiff(l,t){try{this.style.setState(l)&&this._update(!0)}catch(s){o.warnOnce(`Unable to perform style diff: ${s.message||s.error||s}.  Rebuilding the style from scratch.`),this._updateStyle(l,t)}}getStyle(){if(this.style)return this.style.serialize()}isStyleLoaded(){return this.style?this.style.loaded():(o.warnOnce("There is no style added to the map."),!1)}addSource(l,t){return this._lazyInitEmptyStyle(),this.style.addSource(l,t),this._update(!0)}isSourceLoaded(l){return!!this.style&&this.style._isSourceCacheLoaded(l)}areTilesLoaded(){let l=this.style&&this.style._sourceCaches;for(let t in l){let s=l[t]._tiles;for(let p in s){let f=s[p];if(f.state!=="loaded"&&f.state!=="errored")return!1}}return!0}addSourceType(l,t,s){this._lazyInitEmptyStyle(),this.style.addSourceType(l,t,s)}removeSource(l){return this.style.removeSource(l),this._updateTerrain(),this._update(!0)}getSource(l){return this.style.getSource(l)}addImage(l,t,{pixelRatio:s=1,sdf:p=!1,stretchX:f,stretchY:_,content:b}={}){if(this._lazyInitEmptyStyle(),t instanceof o.window.HTMLImageElement||o.window.ImageBitmap&&t instanceof o.window.ImageBitmap){let{width:w,height:T,data:A}=o.exported.getImageData(t);this.style.addImage(l,{data:new o.RGBAImage({width:w,height:T},A),pixelRatio:s,stretchX:f,stretchY:_,content:b,sdf:p,version:0})}else if(t.width===void 0||t.height===void 0)this.fire(new o.ErrorEvent(new Error("Invalid arguments to map.addImage(). The second argument must be an `HTMLImageElement`, `ImageData`, `ImageBitmap`, or object with `width`, `height`, and `data` properties with the same format as `ImageData`")));else{let{width:w,height:T}=t,A=t;this.style.addImage(l,{data:new o.RGBAImage({width:w,height:T},new Uint8Array(A.data)),pixelRatio:s,stretchX:f,stretchY:_,content:b,sdf:p,version:0,userImage:A}),A.onAdd&&A.onAdd(this,l)}}updateImage(l,t){let s=this.style.getImage(l);if(!s)return void this.fire(new o.ErrorEvent(new Error("The map has no image with that id. If you are adding a new image use `map.addImage(...)` instead.")));let p=t instanceof o.window.HTMLImageElement||o.window.ImageBitmap&&t instanceof o.window.ImageBitmap?o.exported.getImageData(t):t,{width:f,height:_}=p;f!==void 0&&_!==void 0?f===s.data.width&&_===s.data.height?(s.data.replace(p.data,!(t instanceof o.window.HTMLImageElement||o.window.ImageBitmap&&t instanceof o.window.ImageBitmap)),this.style.updateImage(l,s)):this.fire(new o.ErrorEvent(new Error(`The width and height of the updated image (${f}, ${_})
                must be that same as the previous version of the image
                (${s.data.width}, ${s.data.height})`))):this.fire(new o.ErrorEvent(new Error("Invalid arguments to map.updateImage(). The second argument must be an `HTMLImageElement`, `ImageData`, `ImageBitmap`, or object with `width`, `height`, and `data` properties with the same format as `ImageData`")))}hasImage(l){return l?!!this.style.getImage(l):(this.fire(new o.ErrorEvent(new Error("Missing required image id"))),!1)}removeImage(l){this.style.removeImage(l)}loadImage(l,t){o.getImage(this._requestManager.transformRequest(l,o.ResourceType.Image),(s,p)=>{t(s,p instanceof o.window.HTMLImageElement?o.exported.getImageData(p):p)})}listImages(){return this.style.listImages()}addLayer(l,t){return this._lazyInitEmptyStyle(),this.style.addLayer(l,t),this._update(!0)}moveLayer(l,t){return this.style.moveLayer(l,t),this._update(!0)}removeLayer(l){return this.style.removeLayer(l),this._update(!0)}getLayer(l){return this.style.getLayer(l)}setLayerZoomRange(l,t,s){return this.style.setLayerZoomRange(l,t,s),this._update(!0)}setFilter(l,t,s={}){return this.style.setFilter(l,t,s),this._update(!0)}getFilter(l){return this.style.getFilter(l)}setPaintProperty(l,t,s,p={}){return this.style.setPaintProperty(l,t,s,p),this._update(!0)}getPaintProperty(l,t){return this.style.getPaintProperty(l,t)}setLayoutProperty(l,t,s,p={}){return this.style.setLayoutProperty(l,t,s,p),this._update(!0)}getLayoutProperty(l,t){return this.style.getLayoutProperty(l,t)}setLight(l,t={}){return this._lazyInitEmptyStyle(),this.style.setLight(l,t),this._update(!0)}getLight(){return this.style.getLight()}setTerrain(l){return this._lazyInitEmptyStyle(),!l&&this.transform.projection.requiresDraping?this.style.setTerrainForDraping():this.style.setTerrain(l),this._averageElevationLastSampledAt=-1/0,this._update(!0)}getTerrain(){return this.style?this.style.getTerrain():null}setFog(l){return this._lazyInitEmptyStyle(),this.style.setFog(l),this._update(!0)}getFog(){return this.style?this.style.getFog():null}_queryFogOpacity(l){return this.style&&this.style.fog?this.style.fog.getOpacityAtLatLng(o.LngLat.convert(l),this.transform):0}setFeatureState(l,t){return this.style.setFeatureState(l,t),this._update()}removeFeatureState(l,t){return this.style.removeFeatureState(l,t),this._update()}getFeatureState(l){return this.style.getFeatureState(l)}_updateContainerDimensions(){if(!this._container)return;let l=this._container.getBoundingClientRect().width||400,t=this._container.getBoundingClientRect().height||300,s,p,f,_=this._container;for(;_&&(!p||!f);){let b=o.window.getComputedStyle(_).transform;b&&b!=="none"&&(s=b.match(/matrix.*\((.+)\)/)[1].split(", "),s[0]&&s[0]!=="0"&&s[0]!=="1"&&(p=s[0]),s[3]&&s[3]!=="0"&&s[3]!=="1"&&(f=s[3])),_=_.parentElement}this._containerWidth=p?Math.abs(l/p):l,this._containerHeight=f?Math.abs(t/f):t}_detectMissingCSS(){o.window.getComputedStyle(this._missingCSSCanary).getPropertyValue("background-color")!=="rgb(250, 128, 114)"&&o.warnOnce("This page appears to be missing CSS declarations for Mapbox GL JS, which may cause the map to display incorrectly. Please ensure your page includes mapbox-gl.css, as described in https://www.mapbox.com/mapbox-gl-js/api/.")}_setupContainer(){let l=this._container;l.classList.add("mapboxgl-map"),(this._missingCSSCanary=oe("div","mapboxgl-canary",l)).style.visibility="hidden",this._detectMissingCSS();let t=this._canvasContainer=oe("div","mapboxgl-canvas-container",l);this._interactive&&t.classList.add("mapboxgl-interactive"),this._canvas=oe("canvas","mapboxgl-canvas",t),this._canvas.addEventListener("webglcontextlost",this._contextLost,!1),this._canvas.addEventListener("webglcontextrestored",this._contextRestored,!1),this._canvas.setAttribute("tabindex","0"),this._canvas.setAttribute("aria-label",this._getUIString("Map.Title")),this._canvas.setAttribute("role","region"),this._updateContainerDimensions(),this._resizeCanvas(this._containerWidth,this._containerHeight);let s=this._controlContainer=oe("div","mapboxgl-control-container",l),p=this._controlPositions={};["top-left","top-right","bottom-left","bottom-right"].forEach(f=>{p[f]=oe("div",`mapboxgl-ctrl-${f}`,s)}),this._container.addEventListener("scroll",this._onMapScroll,!1)}_resizeCanvas(l,t){let s=o.exported.devicePixelRatio||1;this._canvas.width=s*Math.ceil(l),this._canvas.height=s*Math.ceil(t),this._canvas.style.width=`${l}px`,this._canvas.style.height=`${t}px`}_addMarker(l){this._markers.push(l)}_removeMarker(l){let t=this._markers.indexOf(l);t!==-1&&this._markers.splice(t,1)}_setupPainter(){let l=o.extend({},B.webGLContextAttributes,{failIfMajorPerformanceCaveat:this._failIfMajorPerformanceCaveat,preserveDrawingBuffer:this._preserveDrawingBuffer,antialias:this._antialias||!1}),t=this._canvas.getContext("webgl",l)||this._canvas.getContext("experimental-webgl",l);t?(o.storeAuthState(t,!0),this.painter=new Ea(t,this.transform),this.on("data",s=>{s.dataType==="source"&&this.painter.setTileLoadedFlag(!0)}),o.exported$1.testSupport(t)):this.fire(new o.ErrorEvent(new Error("Failed to initialize WebGL")))}_contextLost(l){l.preventDefault(),this._frame&&(this._frame.cancel(),this._frame=null),this.fire(new o.Event("webglcontextlost",{originalEvent:l}))}_contextRestored(l){this._setupPainter(),this.resize(),this._update(),this.fire(new o.Event("webglcontextrestored",{originalEvent:l}))}_onMapScroll(l){if(l.target===this._container)return this._container.scrollTop=0,this._container.scrollLeft=0,!1}loaded(){return!this._styleDirty&&!this._sourcesDirty&&!!this.style&&this.style.loaded()}_update(l){return this.style?(this._styleDirty=this._styleDirty||l,this._sourcesDirty=!0,this.triggerRepaint(),this):this}_requestRenderFrame(l){return this._update(),this._renderTaskQueue.add(l)}_cancelRenderFrame(l){this._renderTaskQueue.remove(l)}_requestDomTask(l){!this.loaded()||this.loaded()&&!this.isMoving()?l():this._domRenderTaskQueue.add(l)}_render(l){let t,s=this.painter.context.extTimerQuery,p=o.exported.now();if(this.listens("gpu-timing-frame")&&(t=s.createQueryEXT(),s.beginQueryEXT(s.TIME_ELAPSED_EXT,t)),this.painter.context.setDirty(),this.painter.setBaseState(),this._renderTaskQueue.run(l),this._domRenderTaskQueue.run(l),this._removed)return;this.getProjection().name==="globe"&&(this.transform.zoom>=o.GLOBE_ZOOM_THRESHOLD_MAX?this.transform.projection.name==="globe"&&this._updateProjection():this.transform.projection.name==="mercator"&&this._updateProjection());let f=!1,_=this._isInitialLoad?0:this._fadeDuration;if(this.style&&this._styleDirty){this._styleDirty=!1;let T=this.transform.zoom,A=this.transform.pitch,I=o.exported.now();this.style.zoomHistory.update(T,I);let L=new o.EvaluationParameters(T,{now:I,fadeDuration:_,pitch:A,zoomHistory:this.style.zoomHistory,transition:this.style.getTransition()}),O=L.crossFadingFactor();O===1&&O===this._crossFadingFactor||(f=!0,this._crossFadingFactor=O),this.style.update(L)}this.style&&this.style.fog&&this.style.fog.hasTransition()&&(this.style._markersNeedUpdate=!0,this._sourcesDirty=!0);let b=!1;if(this.style&&this._sourcesDirty?(this._sourcesDirty=!1,this.painter._updateFog(this.style),this._updateTerrain(),b=this._updateAverageElevation(p),this.style._updateSources(this.transform),this._forceMarkerUpdate()):b=this._updateAverageElevation(p),this._placementDirty=this.style&&this.style._updatePlacement(this.painter.transform,this.showCollisionBoxes,_,this._crossSourceCollisions),this.style&&this.painter.render(this.style,{showTileBoundaries:this.showTileBoundaries,showTerrainWireframe:this.showTerrainWireframe,showOverdrawInspector:this._showOverdrawInspector,showQueryGeometry:!!this._showQueryGeometry,rotating:this.isRotating(),zooming:this.isZooming(),moving:this.isMoving(),fadeDuration:_,isInitialLoad:this._isInitialLoad,showPadding:this.showPadding,gpuTiming:!!this.listens("gpu-timing-layer"),gpuTimingDeferredRender:!!this.listens("gpu-timing-deferred-render"),speedIndexTiming:this.speedIndexTiming}),this.fire(new o.Event("render")),this.loaded()&&!this._loaded&&(this._loaded=!0,this.fire(new o.Event("load"))),this.style&&(this.style.hasTransitions()||f)&&(this._styleDirty=!0),this.style&&!this._placementDirty&&this.style._releaseSymbolFadeTiles(),t){let T=o.exported.now()-p;s.endQueryEXT(s.TIME_ELAPSED_EXT,t),setTimeout(()=>{let A=s.getQueryObjectEXT(t,s.QUERY_RESULT_EXT)/1e6;s.deleteQueryEXT(t),this.fire(new o.Event("gpu-timing-frame",{cpuTime:T,gpuTime:A})),o.window.performance.mark("frame-gpu",{startTime:p,detail:{gpuTime:A}})},50)}if(this.listens("gpu-timing-layer")){let T=this.painter.collectGpuTimers();setTimeout(()=>{let A=this.painter.queryGpuTimers(T);this.fire(new o.Event("gpu-timing-layer",{layerTimes:A}))},50)}if(this.listens("gpu-timing-deferred-render")){let T=this.painter.collectDeferredRenderGpuQueries();setTimeout(()=>{let A=this.painter.queryGpuTimeDeferredRender(T);this.fire(new o.Event("gpu-timing-deferred-render",{gpuTime:A}))},50)}let w=this._sourcesDirty||this._styleDirty||this._placementDirty||b;if(w||this._repaint)this.triggerRepaint();else{let T=!this.isMoving()&&this.loaded();if(T&&(b=this._updateAverageElevation(p,!0)),b)this.triggerRepaint();else if(this._triggerFrame(!1),T&&(this.fire(new o.Event("idle")),this._isInitialLoad=!1,this.speedIndexTiming)){let A=this._calculateSpeedIndex();this.fire(new o.Event("speedindexcompleted",{speedIndex:A})),this.speedIndexTiming=!1}}!this._loaded||this._fullyLoaded||w||(this._fullyLoaded=!0,this._authenticate())}_forceMarkerUpdate(){for(let l of this._markers)l._update()}_updateAverageElevation(l,t=!1){let s=p=>(this.transform.averageElevation=p,this._update(!1),!0);if(!this.painter.averageElevationNeedsEasing())return this.transform.averageElevation!==0&&s(0);if((t||l-this._averageElevationLastSampledAt>500)&&!this._averageElevation.isEasing(l)){let p=this.transform.averageElevation,f=this.transform.sampleAverageElevation(),_=!1;this.transform.elevation&&(_=this.transform.elevation.exaggeration()!==this._averageElevationExaggeration,this._averageElevationExaggeration=this.transform.elevation.exaggeration()),isNaN(f)?f=0:this._averageElevationLastSampledAt=l;let b=Math.abs(p-f);if(b>1){if(this._isInitialLoad||_)return this._averageElevation.jumpTo(f),s(f);this._averageElevation.easeTo(f,l,300)}else if(b>1e-4)return this._averageElevation.jumpTo(f),s(f)}return!!this._averageElevation.isEasing(l)&&s(this._averageElevation.getValue(l))}_authenticate(){o.getMapSessionAPI(this._getMapId(),this._requestManager._skuToken,this._requestManager._customAccessToken,l=>{if(l&&(l.message===o.AUTH_ERR_MSG||l.status===401)){let t=this.painter.context.gl;o.storeAuthState(t,!1),this._logoControl instanceof Ul&&this._logoControl._updateLogo(),t&&t.clear(t.DEPTH_BUFFER_BIT|t.COLOR_BUFFER_BIT|t.STENCIL_BUFFER_BIT),this._silenceAuthErrors||this.fire(new o.ErrorEvent(new Error("A valid Mapbox access token is required to use Mapbox GL JS. To create an account or a new access token, visit https://account.mapbox.com/")))}}),o.postMapLoadEvent(this._getMapId(),this._requestManager._skuToken,this._requestManager._customAccessToken,()=>{})}_updateTerrain(){this.painter.updateTerrain(this.style,this.isMoving()||this.isRotating()||this.isZooming())}_calculateSpeedIndex(){let l=this.painter.canvasCopy(),t=this.painter.getCanvasCopiesAndTimestamps();t.timeStamps.push(performance.now());let s=this.painter.context.gl,p=s.createFramebuffer();function f(_){s.framebufferTexture2D(s.FRAMEBUFFER,s.COLOR_ATTACHMENT0,s.TEXTURE_2D,_,0);let b=new Uint8Array(s.drawingBufferWidth*s.drawingBufferHeight*4);return s.readPixels(0,0,s.drawingBufferWidth,s.drawingBufferHeight,s.RGBA,s.UNSIGNED_BYTE,b),b}return s.bindFramebuffer(s.FRAMEBUFFER,p),this._canvasPixelComparison(f(l),t.canvasCopies.map(f),t.timeStamps)}_canvasPixelComparison(l,t,s){let p=s[1]-s[0],f=l.length/4;for(let _=0;_<t.length;_++){let b=t[_],w=0;for(let T=0;T<b.length;T+=4)b[T]===l[T]&&b[T+1]===l[T+1]&&b[T+2]===l[T+2]&&b[T+3]===l[T+3]&&(w+=1);p+=(s[_+2]-s[_+1])*(1-w/f)}return p}remove(){this._hash&&this._hash.remove();for(let t of this._controls)t.onRemove(this);this._controls=[],this._frame&&(this._frame.cancel(),this._frame=null),this._renderTaskQueue.clear(),this._domRenderTaskQueue.clear(),this.style&&this.style.destroy(),this.painter.destroy(),this.handlers&&this.handlers.destroy(),this.handlers=void 0,this.setStyle(null),o.window!==void 0&&(o.window.removeEventListener("resize",this._onWindowResize,!1),o.window.removeEventListener("orientationchange",this._onWindowResize,!1),o.window.removeEventListener("webkitfullscreenchange",this._onWindowResize,!1),o.window.removeEventListener("online",this._onWindowOnline,!1));let l=this.painter.context.gl.getExtension("WEBGL_lose_context");l&&l.loseContext(),Oa(this._canvasContainer),Oa(this._controlContainer),Oa(this._missingCSSCanary),this._container.classList.remove("mapboxgl-map"),o.removeAuthState(this.painter.context.gl),this._removed=!0,this.fire(new o.Event("remove"))}triggerRepaint(){this._triggerFrame(!0)}_triggerFrame(l){this._renderNextFrame=this._renderNextFrame||l,this.style&&!this._frame&&(this._frame=o.exported.frame(t=>{let s=!!this._renderNextFrame;this._frame=null,this._renderNextFrame=null,s&&this._render(t)}))}_preloadTiles(l){let t=this.style?Object.values(this.style._sourceCaches):[];return o.asyncAll(t,(s,p)=>s._preloadTiles(l,p),()=>{this.triggerRepaint()}),this}_onWindowOnline(){this._update()}_onWindowResize(l){this._trackResize&&this.resize({originalEvent:l})._update()}get showTileBoundaries(){return!!this._showTileBoundaries}set showTileBoundaries(l){this._showTileBoundaries!==l&&(this._showTileBoundaries=l,this._update())}get showTerrainWireframe(){return!!this._showTerrainWireframe}set showTerrainWireframe(l){this._showTerrainWireframe!==l&&(this._showTerrainWireframe=l,this._update())}get speedIndexTiming(){return!!this._speedIndexTiming}set speedIndexTiming(l){this._speedIndexTiming!==l&&(this._speedIndexTiming=l,this._update())}get showPadding(){return!!this._showPadding}set showPadding(l){this._showPadding!==l&&(this._showPadding=l,this._update())}get showCollisionBoxes(){return!!this._showCollisionBoxes}set showCollisionBoxes(l){this._showCollisionBoxes!==l&&(this._showCollisionBoxes=l,l?this.style._generateCollisionBoxes():this._update())}get showOverdrawInspector(){return!!this._showOverdrawInspector}set showOverdrawInspector(l){this._showOverdrawInspector!==l&&(this._showOverdrawInspector=l,this._update())}get repaint(){return!!this._repaint}set repaint(l){this._repaint!==l&&(this._repaint=l,this.triggerRepaint())}get vertices(){return!!this._vertices}set vertices(l){this._vertices=l,this._update()}_setCacheLimits(l,t){o.setCacheLimits(l,t)}get version(){return o.version}},NavigationControl:class{constructor(l){this.options=o.extend({},Dh,l),this._container=oe("div","mapboxgl-ctrl mapboxgl-ctrl-group"),this._container.addEventListener("contextmenu",t=>t.preventDefault()),this.options.showZoom&&(o.bindAll(["_setButtonTitle","_updateZoomButtons"],this),this._zoomInButton=this._createButton("mapboxgl-ctrl-zoom-in",t=>{this._map&&this._map.zoomIn({},{originalEvent:t})}),oe("span","mapboxgl-ctrl-icon",this._zoomInButton).setAttribute("aria-hidden","true"),this._zoomOutButton=this._createButton("mapboxgl-ctrl-zoom-out",t=>{this._map&&this._map.zoomOut({},{originalEvent:t})}),oe("span","mapboxgl-ctrl-icon",this._zoomOutButton).setAttribute("aria-hidden","true")),this.options.showCompass&&(o.bindAll(["_rotateCompassArrow"],this),this._compass=this._createButton("mapboxgl-ctrl-compass",t=>{let s=this._map;s&&(this.options.visualizePitch?s.resetNorthPitch({},{originalEvent:t}):s.resetNorth({},{originalEvent:t}))}),this._compassIcon=oe("span","mapboxgl-ctrl-icon",this._compass),this._compassIcon.setAttribute("aria-hidden","true"))}_updateZoomButtons(){let l=this._map;if(!l)return;let t=l.getZoom(),s=t===l.getMaxZoom(),p=t===l.getMinZoom();this._zoomInButton.disabled=s,this._zoomOutButton.disabled=p,this._zoomInButton.setAttribute("aria-disabled",s.toString()),this._zoomOutButton.setAttribute("aria-disabled",p.toString())}_rotateCompassArrow(){let l=this._map;if(!l)return;let t=this.options.visualizePitch?`scale(${1/Math.pow(Math.cos(l.transform.pitch*(Math.PI/180)),.5)}) rotateX(${l.transform.pitch}deg) rotateZ(${l.transform.angle*(180/Math.PI)}deg)`:`rotate(${l.transform.angle*(180/Math.PI)}deg)`;l._requestDomTask(()=>{this._compassIcon&&(this._compassIcon.style.transform=t)})}onAdd(l){return this._map=l,this.options.showZoom&&(this._setButtonTitle(this._zoomInButton,"ZoomIn"),this._setButtonTitle(this._zoomOutButton,"ZoomOut"),l.on("zoom",this._updateZoomButtons),this._updateZoomButtons()),this.options.showCompass&&(this._setButtonTitle(this._compass,"ResetBearing"),this.options.visualizePitch&&l.on("pitch",this._rotateCompassArrow),l.on("rotate",this._rotateCompassArrow),this._rotateCompassArrow(),this._handler=new Lh(l,this._compass,this.options.visualizePitch)),this._container}onRemove(){let l=this._map;l&&(this._container.remove(),this.options.showZoom&&l.off("zoom",this._updateZoomButtons),this.options.showCompass&&(this.options.visualizePitch&&l.off("pitch",this._rotateCompassArrow),l.off("rotate",this._rotateCompassArrow),this._handler&&this._handler.off(),this._handler=void 0),this._map=void 0)}_createButton(l,t){let s=oe("button",l,this._container);return s.type="button",s.addEventListener("click",t),s}_setButtonTitle(l,t){if(!this._map)return;let s=this._map._getUIString(`NavigationControl.${t}`);l.setAttribute("aria-label",s),l.firstElementChild&&l.firstElementChild.setAttribute("title",s)}},GeolocateControl:class extends o.Evented{constructor(l){super(),this.options=o.extend({geolocation:o.window.navigator.geolocation},$l,l),o.bindAll(["_onSuccess","_onError","_onZoom","_finish","_setupUI","_updateCamera","_updateMarker","_updateMarkerRotation","_onDeviceOrientation"],this),this._updateMarkerRotationThrottled=ms(this._updateMarkerRotation,20),this._numberOfWatches=0}onAdd(l){return this._map=l,this._container=oe("div","mapboxgl-ctrl mapboxgl-ctrl-group"),this._checkGeolocationSupport(this._setupUI),this._container}onRemove(){this._geolocationWatchID!==void 0&&(this.options.geolocation.clearWatch(this._geolocationWatchID),this._geolocationWatchID=void 0),this.options.showUserLocation&&this._userLocationDotMarker&&this._userLocationDotMarker.remove(),this.options.showAccuracyCircle&&this._accuracyCircleMarker&&this._accuracyCircleMarker.remove(),this._container.remove(),this._map.off("zoom",this._onZoom),this._map=void 0,this._numberOfWatches=0,this._noTimeout=!1}_checkGeolocationSupport(l){this._supportsGeolocation!==void 0?l(this._supportsGeolocation):o.window.navigator.permissions!==void 0?o.window.navigator.permissions.query({name:"geolocation"}).then(t=>{this._supportsGeolocation=t.state!=="denied",l(this._supportsGeolocation)}):(this._supportsGeolocation=!!this.options.geolocation,l(this._supportsGeolocation))}_isOutOfMapMaxBounds(l){let t=this._map.getMaxBounds(),s=l.coords;return!!t&&(s.longitude<t.getWest()||s.longitude>t.getEast()||s.latitude<t.getSouth()||s.latitude>t.getNorth())}_setErrorState(){switch(this._watchState){case"WAITING_ACTIVE":this._watchState="ACTIVE_ERROR",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-active-error");break;case"ACTIVE_LOCK":this._watchState="ACTIVE_ERROR",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-active-error"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-waiting");break;case"BACKGROUND":this._watchState="BACKGROUND_ERROR",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-background"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-background-error"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-waiting")}}_onSuccess(l){if(this._map){if(this._isOutOfMapMaxBounds(l))return this._setErrorState(),this.fire(new o.Event("outofmaxbounds",l)),this._updateMarker(),void this._finish();if(this.options.trackUserLocation)switch(this._lastKnownPosition=l,this._watchState){case"WAITING_ACTIVE":case"ACTIVE_LOCK":case"ACTIVE_ERROR":this._watchState="ACTIVE_LOCK",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active-error"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-active");break;case"BACKGROUND":case"BACKGROUND_ERROR":this._watchState="BACKGROUND",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-background-error"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-background")}this.options.showUserLocation&&this._watchState!=="OFF"&&this._updateMarker(l),this.options.trackUserLocation&&this._watchState!=="ACTIVE_LOCK"||this._updateCamera(l),this.options.showUserLocation&&this._dotElement.classList.remove("mapboxgl-user-location-dot-stale"),this.fire(new o.Event("geolocate",l)),this._finish()}}_updateCamera(l){let t=new o.LngLat(l.coords.longitude,l.coords.latitude),s=l.coords.accuracy,p=this._map.getBearing(),f=o.extend({bearing:p},this.options.fitBoundsOptions);this._map.fitBounds(t.toBounds(s),f,{geolocateSource:!0})}_updateMarker(l){if(l){let t=new o.LngLat(l.coords.longitude,l.coords.latitude);this._accuracyCircleMarker.setLngLat(t).addTo(this._map),this._userLocationDotMarker.setLngLat(t).addTo(this._map),this._accuracy=l.coords.accuracy,this.options.showUserLocation&&this.options.showAccuracyCircle&&this._updateCircleRadius()}else this._userLocationDotMarker.remove(),this._accuracyCircleMarker.remove()}_updateCircleRadius(){let l=this._map.transform,t=o.mercatorZfromAltitude(1,l._center.lat)*l.worldSize,s=Math.ceil(2*this._accuracy*t);this._circleElement.style.width=`${s}px`,this._circleElement.style.height=`${s}px`}_onZoom(){this.options.showUserLocation&&this.options.showAccuracyCircle&&this._updateCircleRadius()}_updateMarkerRotation(){this._userLocationDotMarker&&typeof this._heading=="number"?(this._userLocationDotMarker.setRotation(this._heading),this._dotElement.classList.add("mapboxgl-user-location-show-heading")):(this._dotElement.classList.remove("mapboxgl-user-location-show-heading"),this._userLocationDotMarker.setRotation(0))}_onError(l){if(this._map){if(this.options.trackUserLocation)if(l.code===1){this._watchState="OFF",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active-error"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-background"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-background-error"),this._geolocateButton.disabled=!0;let t=this._map._getUIString("GeolocateControl.LocationNotAvailable");this._geolocateButton.setAttribute("aria-label",t),this._geolocateButton.firstElementChild&&this._geolocateButton.firstElementChild.setAttribute("title",t),this._geolocationWatchID!==void 0&&this._clearWatch()}else{if(l.code===3&&this._noTimeout)return;this._setErrorState()}this._watchState!=="OFF"&&this.options.showUserLocation&&this._dotElement.classList.add("mapboxgl-user-location-dot-stale"),this.fire(new o.Event("error",l)),this._finish()}}_finish(){this._timeoutId&&clearTimeout(this._timeoutId),this._timeoutId=void 0}_setupUI(l){if(this._container.addEventListener("contextmenu",t=>t.preventDefault()),this._geolocateButton=oe("button","mapboxgl-ctrl-geolocate",this._container),oe("span","mapboxgl-ctrl-icon",this._geolocateButton).setAttribute("aria-hidden","true"),this._geolocateButton.type="button",l===!1){o.warnOnce("Geolocation support is not available so the GeolocateControl will be disabled.");let t=this._map._getUIString("GeolocateControl.LocationNotAvailable");this._geolocateButton.disabled=!0,this._geolocateButton.setAttribute("aria-label",t),this._geolocateButton.firstElementChild&&this._geolocateButton.firstElementChild.setAttribute("title",t)}else{let t=this._map._getUIString("GeolocateControl.FindMyLocation");this._geolocateButton.setAttribute("aria-label",t),this._geolocateButton.firstElementChild&&this._geolocateButton.firstElementChild.setAttribute("title",t)}this.options.trackUserLocation&&(this._geolocateButton.setAttribute("aria-pressed","false"),this._watchState="OFF"),this.options.showUserLocation&&(this._dotElement=oe("div","mapboxgl-user-location"),this._dotElement.appendChild(oe("div","mapboxgl-user-location-dot")),this._dotElement.appendChild(oe("div","mapboxgl-user-location-heading")),this._userLocationDotMarker=new Fa({element:this._dotElement,rotationAlignment:"map",pitchAlignment:"map"}),this._circleElement=oe("div","mapboxgl-user-location-accuracy-circle"),this._accuracyCircleMarker=new Fa({element:this._circleElement,pitchAlignment:"map"}),this.options.trackUserLocation&&(this._watchState="OFF"),this._map.on("zoom",this._onZoom)),this._geolocateButton.addEventListener("click",this.trigger.bind(this)),this._setup=!0,this.options.trackUserLocation&&this._map.on("movestart",t=>{t.geolocateSource||this._watchState!=="ACTIVE_LOCK"||t.originalEvent&&t.originalEvent.type==="resize"||(this._watchState="BACKGROUND",this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-background"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active"),this.fire(new o.Event("trackuserlocationend")))})}_onDeviceOrientation(l){this._userLocationDotMarker&&(l.webkitCompassHeading?this._heading=l.webkitCompassHeading:l.absolute===!0&&(this._heading=-1*l.alpha),this._updateMarkerRotationThrottled())}trigger(){if(!this._setup)return o.warnOnce("Geolocate control triggered before added to a map"),!1;if(this.options.trackUserLocation){switch(this._watchState){case"OFF":this._watchState="WAITING_ACTIVE",this.fire(new o.Event("trackuserlocationstart"));break;case"WAITING_ACTIVE":case"ACTIVE_LOCK":case"ACTIVE_ERROR":case"BACKGROUND_ERROR":this._numberOfWatches--,this._noTimeout=!1,this._watchState="OFF",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active-error"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-background"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-background-error"),this.fire(new o.Event("trackuserlocationend"));break;case"BACKGROUND":this._watchState="ACTIVE_LOCK",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-background"),this._lastKnownPosition&&this._updateCamera(this._lastKnownPosition),this.fire(new o.Event("trackuserlocationstart"))}switch(this._watchState){case"WAITING_ACTIVE":this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-active");break;case"ACTIVE_LOCK":this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-active");break;case"ACTIVE_ERROR":this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-active-error");break;case"BACKGROUND":this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-background");break;case"BACKGROUND_ERROR":this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-background-error")}if(this._watchState==="OFF"&&this._geolocationWatchID!==void 0)this._clearWatch();else if(this._geolocationWatchID===void 0){let l;this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.setAttribute("aria-pressed","true"),this._numberOfWatches++,this._numberOfWatches>1?(l={maximumAge:6e5,timeout:0},this._noTimeout=!0):(l=this.options.positionOptions,this._noTimeout=!1),this._geolocationWatchID=this.options.geolocation.watchPosition(this._onSuccess,this._onError,l),this.options.showUserHeading&&this._addDeviceOrientationListener()}}else this.options.geolocation.getCurrentPosition(this._onSuccess,this._onError,this.options.positionOptions),this._timeoutId=setTimeout(this._finish,1e4);return!0}_addDeviceOrientationListener(){let l=()=>{o.window.addEventListener("ondeviceorientationabsolute"in o.window?"deviceorientationabsolute":"deviceorientation",this._onDeviceOrientation)};o.window.DeviceMotionEvent!==void 0&&typeof o.window.DeviceMotionEvent.requestPermission=="function"?DeviceOrientationEvent.requestPermission().then(t=>{t==="granted"&&l()}).catch(console.error):l()}_clearWatch(){this.options.geolocation.clearWatch(this._geolocationWatchID),o.window.removeEventListener("deviceorientation",this._onDeviceOrientation),o.window.removeEventListener("deviceorientationabsolute",this._onDeviceOrientation),this._geolocationWatchID=void 0,this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.setAttribute("aria-pressed","false"),this.options.showUserLocation&&this._updateMarker(null)}},AttributionControl:jl,ScaleControl:class{constructor(l){this.options=o.extend({},Bh,l),function(){try{return new Intl.NumberFormat("en",{style:"unit",unitDisplay:"narrow",unit:"meter"}),!0}catch{return!1}}()||(this._setScale=ql.bind(this)),o.bindAll(["_update","_setScale","setUnit"],this)}getDefaultPosition(){return"bottom-left"}_update(){let l=this.options.maxWidth||100,t=this._map,s=t._containerHeight/2,p=t._containerWidth/2-l/2,f=t.unproject([p,s]),_=t.unproject([p+l,s]),b=f.distanceTo(_);if(this.options.unit==="imperial"){let w=3.2808*b;w>5280?this._setScale(l,w/5280,"mile"):this._setScale(l,w,"foot")}else this.options.unit==="nautical"?this._setScale(l,b/1852,"nautical-mile"):b>=1e3?this._setScale(l,b/1e3,"kilometer"):this._setScale(l,b,"meter")}_setScale(l,t,s){let p=Zl(t),f=p/t;this._map._requestDomTask(()=>{this._container.style.width=l*f+"px",this._container.innerHTML=s!=="nautical-mile"?new Intl.NumberFormat(this._language,{style:"unit",unitDisplay:"narrow",unit:s}).format(p):`${p}&nbsp;nm`})}onAdd(l){return this._map=l,this._language=l.getLanguage(),this._container=oe("div","mapboxgl-ctrl mapboxgl-ctrl-scale",l.getContainer()),this._container.dir="auto",this._map.on("move",this._update),this._update(),this._container}onRemove(){this._container.remove(),this._map.off("move",this._update),this._map=void 0}_setLanguage(l){this._language=l,this._update()}setUnit(l){this.options.unit=l,this._update()}},FullscreenControl:class{constructor(l){this._fullscreen=!1,l&&l.container&&(l.container instanceof o.window.HTMLElement?this._container=l.container:o.warnOnce("Full screen control 'container' must be a DOM element.")),o.bindAll(["_onClickFullscreen","_changeIcon"],this),"onfullscreenchange"in o.window.document?this._fullscreenchange="fullscreenchange":"onwebkitfullscreenchange"in o.window.document&&(this._fullscreenchange="webkitfullscreenchange")}onAdd(l){return this._map=l,this._container||(this._container=this._map.getContainer()),this._controlContainer=oe("div","mapboxgl-ctrl mapboxgl-ctrl-group"),this._checkFullscreenSupport()?this._setupUI():(this._controlContainer.style.display="none",o.warnOnce("This device does not support fullscreen mode.")),this._controlContainer}onRemove(){this._controlContainer.remove(),this._map=null,o.window.document.removeEventListener(this._fullscreenchange,this._changeIcon)}_checkFullscreenSupport(){return!(!o.window.document.fullscreenEnabled&&!o.window.document.webkitFullscreenEnabled)}_setupUI(){let l=this._fullscreenButton=oe("button","mapboxgl-ctrl-fullscreen",this._controlContainer);oe("span","mapboxgl-ctrl-icon",l).setAttribute("aria-hidden","true"),l.type="button",this._updateTitle(),this._fullscreenButton.addEventListener("click",this._onClickFullscreen),o.window.document.addEventListener(this._fullscreenchange,this._changeIcon)}_updateTitle(){let l=this._getTitle();this._fullscreenButton.setAttribute("aria-label",l),this._fullscreenButton.firstElementChild&&this._fullscreenButton.firstElementChild.setAttribute("title",l)}_getTitle(){return this._map._getUIString(this._isFullscreen()?"FullscreenControl.Exit":"FullscreenControl.Enter")}_isFullscreen(){return this._fullscreen}_changeIcon(){(o.window.document.fullscreenElement||o.window.document.webkitFullscreenElement)===this._container!==this._fullscreen&&(this._fullscreen=!this._fullscreen,this._fullscreenButton.classList.toggle("mapboxgl-ctrl-shrink"),this._fullscreenButton.classList.toggle("mapboxgl-ctrl-fullscreen"),this._updateTitle())}_onClickFullscreen(){this._isFullscreen()?o.window.document.exitFullscreen?o.window.document.exitFullscreen():o.window.document.webkitCancelFullScreen&&o.window.document.webkitCancelFullScreen():this._container.requestFullscreen?this._container.requestFullscreen():this._container.webkitRequestFullscreen&&this._container.webkitRequestFullscreen()}},Popup:class extends o.Evented{constructor(l){super(),this.options=o.extend(Object.create(Wl),l),o.bindAll(["_update","_onClose","remove","_onMouseEvent"],this),this._classList=new Set(l&&l.className?l.className.trim().split(/\s+/):[])}addTo(l){return this._map&&this.remove(),this._map=l,this.options.closeOnClick&&l.on("preclick",this._onClose),this.options.closeOnMove&&l.on("move",this._onClose),l.on("remove",this.remove),this._update(),this._focusFirstElement(),this._trackPointer?(l.on("mousemove",this._onMouseEvent),l.on("mouseup",this._onMouseEvent),l._canvasContainer.classList.add("mapboxgl-track-pointer")):l.on("move",this._update),this.fire(new o.Event("open")),this}isOpen(){return!!this._map}remove(){this._content&&this._content.remove(),this._container&&(this._container.remove(),this._container=void 0);let l=this._map;return l&&(l.off("move",this._update),l.off("move",this._onClose),l.off("preclick",this._onClose),l.off("click",this._onClose),l.off("remove",this.remove),l.off("mousemove",this._onMouseEvent),l.off("mouseup",this._onMouseEvent),l.off("drag",this._onMouseEvent),this._map=void 0),this.fire(new o.Event("close")),this}getLngLat(){return this._lngLat}setLngLat(l){this._lngLat=o.LngLat.convert(l),this._pos=null,this._trackPointer=!1,this._update();let t=this._map;return t&&(t.on("move",this._update),t.off("mousemove",this._onMouseEvent),t._canvasContainer.classList.remove("mapboxgl-track-pointer")),this}trackPointer(){this._trackPointer=!0,this._pos=null,this._update();let l=this._map;return l&&(l.off("move",this._update),l.on("mousemove",this._onMouseEvent),l.on("drag",this._onMouseEvent),l._canvasContainer.classList.add("mapboxgl-track-pointer")),this}getElement(){return this._container}setText(l){return this.setDOMContent(o.window.document.createTextNode(l))}setHTML(l){let t=o.window.document.createDocumentFragment(),s=o.window.document.createElement("body"),p;for(s.innerHTML=l;p=s.firstChild,p;)t.appendChild(p);return this.setDOMContent(t)}getMaxWidth(){return this._container&&this._container.style.maxWidth}setMaxWidth(l){return this.options.maxWidth=l,this._update(),this}setDOMContent(l){let t=this._content;if(t)for(;t.hasChildNodes();)t.firstChild&&t.removeChild(t.firstChild);else t=this._content=oe("div","mapboxgl-popup-content",this._container||void 0);if(t.appendChild(l),this.options.closeButton){let s=this._closeButton=oe("button","mapboxgl-popup-close-button",t);s.type="button",s.setAttribute("aria-label","Close popup"),s.setAttribute("aria-hidden","true"),s.innerHTML="&#215;",s.addEventListener("click",this._onClose)}return this._update(),this._focusFirstElement(),this}addClassName(l){return this._classList.add(l),this._updateClassList(),this}removeClassName(l){return this._classList.delete(l),this._updateClassList(),this}setOffset(l){return this.options.offset=l,this._update(),this}toggleClassName(l){let t;return this._classList.delete(l)?t=!1:(this._classList.add(l),t=!0),this._updateClassList(),t}_onMouseEvent(l){this._update(l.point)}_getAnchor(l){if(this.options.anchor)return this.options.anchor;let t=this._map,s=this._container,p=this._pos;if(!t||!s||!p)return"bottom";let f=s.offsetWidth,_=s.offsetHeight,b=p.x<f/2,w=p.x>t.transform.width-f/2;if(p.y+l<_)return b?"top-left":w?"top-right":"top";if(p.y>t.transform.height-_){if(b)return"bottom-left";if(w)return"bottom-right"}return b?"left":w?"right":"bottom"}_updateClassList(){let l=this._container;if(!l)return;let t=[...this._classList];t.push("mapboxgl-popup"),this._anchor&&t.push(`mapboxgl-popup-anchor-${this._anchor}`),this._trackPointer&&t.push("mapboxgl-popup-track-pointer"),l.className=t.join(" ")}_update(l){let t=this._map,s=this._content;if(!t||!this._lngLat&&!this._trackPointer||!s)return;let p=this._container;if(p||(p=this._container=oe("div","mapboxgl-popup",t.getContainer()),this._tip=oe("div","mapboxgl-popup-tip",p),p.appendChild(s)),this.options.maxWidth&&p.style.maxWidth!==this.options.maxWidth&&(p.style.maxWidth=this.options.maxWidth),t.transform.renderWorldCopies&&!this._trackPointer&&(this._lngLat=Nl(this._lngLat,this._pos,t.transform)),!this._trackPointer||l){let f=this._pos=this._trackPointer&&l?l:t.project(this._lngLat),_=ja(this.options.offset),b=this._anchor=this._getAnchor(_.y),w=ja(this.options.offset,b),T=f.add(w).round();t._requestDomTask(()=>{this._container&&b&&(this._container.style.transform=`${Ra[b]} translate(${T.x}px,${T.y}px)`)})}if(!this._marker&&t._usingGlobe()){let f=o.isLngLatBehindGlobe(t.transform,this._lngLat)?0:1;this._setOpacity(f)}this._updateClassList()}_focusFirstElement(){if(!this.options.focusAfterOpen||!this._container)return;let l=this._container.querySelector(Hl);l&&l.focus()}_onClose(){this.remove()}_setOpacity(l){this._container&&(this._container.style.opacity=`${l}`),this._content&&(this._content.style.pointerEvents=l?"auto":"none")}},Marker:Fa,Style:Sr,LngLat:o.LngLat,LngLatBounds:o.LngLatBounds,Point:o.pointGeometry,MercatorCoordinate:o.MercatorCoordinate,FreeCameraOptions:ds,Evented:o.Evented,config:o.config,prewarm:function(){Rt().acquire(ot)},clearPrewarmedResources:function(){let l=_t;l&&(l.isPreloaded()&&l.numActive()===1?(l.release(ot),_t=null):console.warn("Could not clear WebWorkers since there are active Map instances that still reference it. The pre-warmed WebWorker pool can only be cleared when all map instances have been removed with map.remove()"))},get accessToken(){return o.config.ACCESS_TOKEN},set accessToken(l){o.config.ACCESS_TOKEN=l},get baseApiUrl(){return o.config.API_URL},set baseApiUrl(l){o.config.API_URL=l},get workerCount(){return ct.workerCount},set workerCount(l){ct.workerCount=l},get maxParallelImageRequests(){return o.config.MAX_PARALLEL_IMAGE_REQUESTS},set maxParallelImageRequests(l){o.config.MAX_PARALLEL_IMAGE_REQUESTS=l},clearStorage(l){o.clearTileCache(l)},workerUrl:"",workerClass:null,setNow:o.exported.setNow,restoreNow:o.exported.restoreNow};return Ua});var C=g;return C})});var pn=Object.create(null);pn.open="0";pn.close="1";pn.ping="2";pn.pong="3";pn.message="4";pn.upgrade="5";pn.noop="6";var Ec=Object.create(null);Object.keys(pn).forEach(c=>{Ec[pn[c]]=c});var a_={type:"error",data:"parser error"};var yx=typeof Blob=="function"||typeof Blob<"u"&&Object.prototype.toString.call(Blob)==="[object BlobConstructor]",xx=typeof ArrayBuffer=="function",vx=c=>typeof ArrayBuffer.isView=="function"?ArrayBuffer.isView(c):c&&c.buffer instanceof ArrayBuffer,bx=({type:c,data:u},g,v)=>yx&&u instanceof Blob?g?v(u):l_(u,v):xx&&(u instanceof ArrayBuffer||vx(u))?g?v(u):l_(new Blob([u]),v):v(pn[c]+(u||"")),l_=(c,u)=>{let g=new FileReader;return g.onload=function(){let v=g.result.split(",")[1];u("b"+v)},g.readAsDataURL(c)},wu=bx;var c_="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/",Tc=typeof Uint8Array>"u"?[]:new Uint8Array(256);for(let c=0;c<c_.length;c++)Tc[c_.charCodeAt(c)]=c;var h_=c=>{let u=c.length*.75,g=c.length,v,C=0,o,z,B,H;c[c.length-1]==="="&&(u--,c[c.length-2]==="="&&u--);let Y=new ArrayBuffer(u),oe=new Uint8Array(Y);for(v=0;v<g;v+=4)o=Tc[c.charCodeAt(v)],z=Tc[c.charCodeAt(v+1)],B=Tc[c.charCodeAt(v+2)],H=Tc[c.charCodeAt(v+3)],oe[C++]=o<<2|z>>4,oe[C++]=(z&15)<<4|B>>2,oe[C++]=(B&3)<<6|H&63;return Y};var wx=typeof ArrayBuffer=="function",Ex=(c,u)=>{if(typeof c!="string")return{type:"message",data:u_(c,u)};let g=c.charAt(0);return g==="b"?{type:"message",data:Tx(c.substring(1),u)}:Ec[g]?c.length>1?{type:Ec[g],data:c.substring(1)}:{type:Ec[g]}:a_},Tx=(c,u)=>{if(wx){let g=h_(c);return u_(g,u)}else return{base64:!0,data:c}},u_=(c,u)=>{switch(u){case"blob":return c instanceof ArrayBuffer?new Blob([c]):c;case"arraybuffer":default:return c}},Eu=Ex;var p_=String.fromCharCode(30),d_=(c,u)=>{let g=c.length,v=new Array(g),C=0;c.forEach((o,z)=>{wu(o,!1,B=>{v[z]=B,++C===g&&u(v.join(p_))})})},f_=(c,u)=>{let g=c.split(p_),v=[];for(let C=0;C<g.length;C++){let o=Eu(g[C],u);if(v.push(o),o.type==="error")break}return v},kd=4;function ai(c){if(c)return Cx(c)}function Cx(c){for(var u in ai.prototype)c[u]=ai.prototype[u];return c}ai.prototype.on=ai.prototype.addEventListener=function(c,u){return this._callbacks=this._callbacks||{},(this._callbacks["$"+c]=this._callbacks["$"+c]||[]).push(u),this};ai.prototype.once=function(c,u){function g(){this.off(c,g),u.apply(this,arguments)}return g.fn=u,this.on(c,g),this};ai.prototype.off=ai.prototype.removeListener=ai.prototype.removeAllListeners=ai.prototype.removeEventListener=function(c,u){if(this._callbacks=this._callbacks||{},arguments.length==0)return this._callbacks={},this;var g=this._callbacks["$"+c];if(!g)return this;if(arguments.length==1)return delete this._callbacks["$"+c],this;for(var v,C=0;C<g.length;C++)if(v=g[C],v===u||v.fn===u){g.splice(C,1);break}return g.length===0&&delete this._callbacks["$"+c],this};ai.prototype.emit=function(c){this._callbacks=this._callbacks||{};for(var u=new Array(arguments.length-1),g=this._callbacks["$"+c],v=1;v<arguments.length;v++)u[v-1]=arguments[v];if(g){g=g.slice(0);for(var v=0,C=g.length;v<C;++v)g[v].apply(this,u)}return this};ai.prototype.emitReserved=ai.prototype.emit;ai.prototype.listeners=function(c){return this._callbacks=this._callbacks||{},this._callbacks["$"+c]||[]};ai.prototype.hasListeners=function(c){return!!this.listeners(c).length};var qr=(()=>typeof self<"u"?self:typeof window<"u"?window:Function("return this")())();function Tu(c,...u){return u.reduce((g,v)=>(c.hasOwnProperty(v)&&(g[v]=c[v]),g),{})}var kx=setTimeout,Sx=clearTimeout;function Yn(c,u){u.useNativeTimers?(c.setTimeoutFn=kx.bind(qr),c.clearTimeoutFn=Sx.bind(qr)):(c.setTimeoutFn=setTimeout.bind(qr),c.clearTimeoutFn=clearTimeout.bind(qr))}var Ax=1.33;function m_(c){return typeof c=="string"?Mx(c):Math.ceil((c.byteLength||c.size)*Ax)}function Mx(c){let u=0,g=0;for(let v=0,C=c.length;v<C;v++)u=c.charCodeAt(v),u<128?g+=1:u<2048?g+=2:u<55296||u>=57344?g+=3:(v++,g+=4);return g}var Sd=class extends Error{constructor(u,g,v){super(u),this.description=g,this.context=v,this.type="TransportError"}},Rs=class extends ai{constructor(u){super(),this.writable=!1,Yn(this,u),this.opts=u,this.query=u.query,this.readyState="",this.socket=u.socket}onError(u,g,v){return super.emitReserved("error",new Sd(u,g,v)),this}open(){return(this.readyState==="closed"||this.readyState==="")&&(this.readyState="opening",this.doOpen()),this}close(){return(this.readyState==="opening"||this.readyState==="open")&&(this.doClose(),this.onClose()),this}send(u){this.readyState==="open"&&this.write(u)}onOpen(){this.readyState="open",this.writable=!0,super.emitReserved("open")}onData(u){let g=Eu(u,this.socket.binaryType);this.onPacket(g)}onPacket(u){super.emitReserved("packet",u)}onClose(u){this.readyState="closed",super.emitReserved("close",u)}};var x_="0123456789ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz-_".split(""),Ad=64,Ix={},g_=0,Cu=0,__;function y_(c){let u="";do u=x_[c%Ad]+u,c=Math.floor(c/Ad);while(c>0);return u}function ku(){let c=y_(+new Date);return c!==__?(g_=0,__=c):c+"."+y_(g_++)}for(;Cu<Ad;Cu++)Ix[x_[Cu]]=Cu;function Su(c){let u="";for(let g in c)c.hasOwnProperty(g)&&(u.length&&(u+="&"),u+=encodeURIComponent(g)+"="+encodeURIComponent(c[g]));return u}function v_(c){let u={},g=c.split("&");for(let v=0,C=g.length;v<C;v++){let o=g[v].split("=");u[decodeURIComponent(o[0])]=decodeURIComponent(o[1])}return u}var b_=!1;try{b_=typeof XMLHttpRequest<"u"&&"withCredentials"in new XMLHttpRequest}catch{}var w_=b_;function Md(c){let u=c.xdomain;try{if(typeof XMLHttpRequest<"u"&&(!u||w_))return new XMLHttpRequest}catch{}if(!u)try{return new qr[["Active"].concat("Object").join("X")]("Microsoft.XMLHTTP")}catch{}}function zx(){}var Px=function(){return new Md({xdomain:!1}).responseType!=null}(),Au=class extends Rs{constructor(u){if(super(u),this.polling=!1,typeof location<"u"){let v=location.protocol==="https:",C=location.port;C||(C=v?"443":"80"),this.xd=typeof location<"u"&&u.hostname!==location.hostname||C!==u.port,this.xs=u.secure!==v}let g=u&&u.forceBase64;this.supportsBinary=Px&&!g}get name(){return"polling"}doOpen(){this.poll()}pause(u){this.readyState="pausing";let g=()=>{this.readyState="paused",u()};if(this.polling||!this.writable){let v=0;this.polling&&(v++,this.once("pollComplete",function(){--v||g()})),this.writable||(v++,this.once("drain",function(){--v||g()}))}else g()}poll(){this.polling=!0,this.doPoll(),this.emitReserved("poll")}onData(u){let g=v=>{if(this.readyState==="opening"&&v.type==="open"&&this.onOpen(),v.type==="close")return this.onClose({description:"transport closed by the server"}),!1;this.onPacket(v)};f_(u,this.socket.binaryType).forEach(g),this.readyState!=="closed"&&(this.polling=!1,this.emitReserved("pollComplete"),this.readyState==="open"&&this.poll())}doClose(){let u=()=>{this.write([{type:"close"}])};this.readyState==="open"?u():this.once("open",u)}write(u){this.writable=!1,d_(u,g=>{this.doWrite(g,()=>{this.writable=!0,this.emitReserved("drain")})})}uri(){let u=this.query||{},g=this.opts.secure?"https":"http",v="";this.opts.timestampRequests!==!1&&(u[this.opts.timestampParam]=ku()),!this.supportsBinary&&!u.sid&&(u.b64=1),this.opts.port&&(g==="https"&&Number(this.opts.port)!==443||g==="http"&&Number(this.opts.port)!==80)&&(v=":"+this.opts.port);let C=Su(u),o=this.opts.hostname.indexOf(":")!==-1;return g+"://"+(o?"["+this.opts.hostname+"]":this.opts.hostname)+v+this.opts.path+(C.length?"?"+C:"")}request(u={}){return Object.assign(u,{xd:this.xd,xs:this.xs},this.opts),new Zr(this.uri(),u)}doWrite(u,g){let v=this.request({method:"POST",data:u});v.on("success",g),v.on("error",(C,o)=>{this.onError("xhr post error",C,o)})}doPoll(){let u=this.request();u.on("data",this.onData.bind(this)),u.on("error",(g,v)=>{this.onError("xhr poll error",g,v)}),this.pollXhr=u}},Zr=class extends ai{constructor(u,g){super(),Yn(this,g),this.opts=g,this.method=g.method||"GET",this.uri=u,this.async=g.async!==!1,this.data=g.data!==void 0?g.data:null,this.create()}create(){let u=Tu(this.opts,"agent","pfx","key","passphrase","cert","ca","ciphers","rejectUnauthorized","autoUnref");u.xdomain=!!this.opts.xd,u.xscheme=!!this.opts.xs;let g=this.xhr=new Md(u);try{g.open(this.method,this.uri,this.async);try{if(this.opts.extraHeaders){g.setDisableHeaderCheck&&g.setDisableHeaderCheck(!0);for(let v in this.opts.extraHeaders)this.opts.extraHeaders.hasOwnProperty(v)&&g.setRequestHeader(v,this.opts.extraHeaders[v])}}catch{}if(this.method==="POST")try{g.setRequestHeader("Content-type","text/plain;charset=UTF-8")}catch{}try{g.setRequestHeader("Accept","*/*")}catch{}"withCredentials"in g&&(g.withCredentials=this.opts.withCredentials),this.opts.requestTimeout&&(g.timeout=this.opts.requestTimeout),g.onreadystatechange=()=>{g.readyState===4&&(g.status===200||g.status===1223?this.onLoad():this.setTimeoutFn(()=>{this.onError(typeof g.status=="number"?g.status:0)},0))},g.send(this.data)}catch(v){this.setTimeoutFn(()=>{this.onError(v)},0);return}typeof document<"u"&&(this.index=Zr.requestsCount++,Zr.requests[this.index]=this)}onError(u){this.emitReserved("error",u,this.xhr),this.cleanup(!0)}cleanup(u){if(!(typeof this.xhr>"u"||this.xhr===null)){if(this.xhr.onreadystatechange=zx,u)try{this.xhr.abort()}catch{}typeof document<"u"&&delete Zr.requests[this.index],this.xhr=null}}onLoad(){let u=this.xhr.responseText;u!==null&&(this.emitReserved("data",u),this.emitReserved("success"),this.cleanup())}abort(){this.cleanup()}};Zr.requestsCount=0;Zr.requests={};if(typeof document<"u"){if(typeof attachEvent=="function")attachEvent("onunload",E_);else if(typeof addEventListener=="function"){let c="onpagehide"in qr?"pagehide":"unload";addEventListener(c,E_,!1)}}function E_(){for(let c in Zr.requests)Zr.requests.hasOwnProperty(c)&&Zr.requests[c].abort()}var T_=(()=>typeof Promise=="function"&&typeof Promise.resolve=="function"?u=>Promise.resolve().then(u):(u,g)=>g(u,0))(),Cc=qr.WebSocket||qr.MozWebSocket,Mu=!0,C_="arraybuffer";var k_=typeof navigator<"u"&&typeof navigator.product=="string"&&navigator.product.toLowerCase()==="reactnative",Iu=class extends Rs{constructor(u){super(u),this.supportsBinary=!u.forceBase64}get name(){return"websocket"}doOpen(){if(!this.check())return;let u=this.uri(),g=this.opts.protocols,v=k_?{}:Tu(this.opts,"agent","perMessageDeflate","pfx","key","passphrase","cert","ca","ciphers","rejectUnauthorized","localAddress","protocolVersion","origin","maxPayload","family","checkServerIdentity");this.opts.extraHeaders&&(v.headers=this.opts.extraHeaders);try{this.ws=Mu&&!k_?g?new Cc(u,g):new Cc(u):new Cc(u,g,v)}catch(C){return this.emitReserved("error",C)}this.ws.binaryType=this.socket.binaryType||C_,this.addEventListeners()}addEventListeners(){this.ws.onopen=()=>{this.opts.autoUnref&&this.ws._socket.unref(),this.onOpen()},this.ws.onclose=u=>this.onClose({description:"websocket connection closed",context:u}),this.ws.onmessage=u=>this.onData(u.data),this.ws.onerror=u=>this.onError("websocket error",u)}write(u){this.writable=!1;for(let g=0;g<u.length;g++){let v=u[g],C=g===u.length-1;wu(v,this.supportsBinary,o=>{let z={};Mu||(v.options&&(z.compress=v.options.compress),this.opts.perMessageDeflate&&(typeof o=="string"?Buffer.byteLength(o):o.length)<this.opts.perMessageDeflate.threshold&&(z.compress=!1));try{Mu?this.ws.send(o):this.ws.send(o,z)}catch{}C&&T_(()=>{this.writable=!0,this.emitReserved("drain")},this.setTimeoutFn)})}}doClose(){typeof this.ws<"u"&&(this.ws.close(),this.ws=null)}uri(){let u=this.query||{},g=this.opts.secure?"wss":"ws",v="";this.opts.port&&(g==="wss"&&Number(this.opts.port)!==443||g==="ws"&&Number(this.opts.port)!==80)&&(v=":"+this.opts.port),this.opts.timestampRequests&&(u[this.opts.timestampParam]=ku()),this.supportsBinary||(u.b64=1);let C=Su(u),o=this.opts.hostname.indexOf(":")!==-1;return g+"://"+(o?"["+this.opts.hostname+"]":this.opts.hostname)+v+this.opts.path+(C.length?"?"+C:"")}check(){return!!Cc}};var Id={websocket:Iu,polling:Au};var Dx=/^(?:(?![^:@]+:[^:@\/]*@)(http|https|ws|wss):\/\/)?((?:(([^:@]*)(?::([^:@]*))?)?@)?((?:[a-f0-9]{0,4}:){2,7}[a-f0-9]{0,4}|[^:\/?#]*)(?::(\d*))?)(((\/(?:[^?#](?![^?#\/]*\.[^?#\/.]+(?:[?#]|$)))*\/?)?([^?#\/]*))(?:\?([^#]*))?(?:#(.*))?)/,Lx=["source","protocol","authority","userInfo","user","password","host","port","relative","path","directory","file","query","anchor"];function rl(c){let u=c,g=c.indexOf("["),v=c.indexOf("]");g!=-1&&v!=-1&&(c=c.substring(0,g)+c.substring(g,v).replace(/:/g,";")+c.substring(v,c.length));let C=Dx.exec(c||""),o={},z=14;for(;z--;)o[Lx[z]]=C[z]||"";return g!=-1&&v!=-1&&(o.source=u,o.host=o.host.substring(1,o.host.length-1).replace(/;/g,":"),o.authority=o.authority.replace("[","").replace("]","").replace(/;/g,":"),o.ipv6uri=!0),o.pathNames=Bx(o,o.path),o.queryKey=Rx(o,o.query),o}function Bx(c,u){let g=/\/{2,9}/g,v=u.replace(g,"/").split("/");return(u.substr(0,1)=="/"||u.length===0)&&v.splice(0,1),u.substr(u.length-1,1)=="/"&&v.splice(v.length-1,1),v}function Rx(c,u){let g={};return u.replace(/(?:^|&)([^&=]*)=?([^&]*)/g,function(v,C,o){C&&(g[C]=o)}),g}var Pr=class extends ai{constructor(u,g={}){super(),u&&typeof u=="object"&&(g=u,u=null),u?(u=rl(u),g.hostname=u.host,g.secure=u.protocol==="https"||u.protocol==="wss",g.port=u.port,u.query&&(g.query=u.query)):g.host&&(g.hostname=rl(g.host).host),Yn(this,g),this.secure=g.secure!=null?g.secure:typeof location<"u"&&location.protocol==="https:",g.hostname&&!g.port&&(g.port=this.secure?"443":"80"),this.hostname=g.hostname||(typeof location<"u"?location.hostname:"localhost"),this.port=g.port||(typeof location<"u"&&location.port?location.port:this.secure?"443":"80"),this.transports=g.transports||["polling","websocket"],this.readyState="",this.writeBuffer=[],this.prevBufferLen=0,this.opts=Object.assign({path:"/engine.io",agent:!1,withCredentials:!1,upgrade:!0,timestampParam:"t",rememberUpgrade:!1,rejectUnauthorized:!0,perMessageDeflate:{threshold:1024},transportOptions:{},closeOnBeforeunload:!0},g),this.opts.path=this.opts.path.replace(/\/$/,"")+"/",typeof this.opts.query=="string"&&(this.opts.query=v_(this.opts.query)),this.id=null,this.upgrades=null,this.pingInterval=null,this.pingTimeout=null,this.pingTimeoutTimer=null,typeof addEventListener=="function"&&(this.opts.closeOnBeforeunload&&addEventListener("beforeunload",()=>{this.transport&&(this.transport.removeAllListeners(),this.transport.close())},!1),this.hostname!=="localhost"&&(this.offlineEventListener=()=>{this.onClose("transport close",{description:"network connection lost"})},addEventListener("offline",this.offlineEventListener,!1))),this.open()}createTransport(u){let g=Object.assign({},this.opts.query);g.EIO=kd,g.transport=u,this.id&&(g.sid=this.id);let v=Object.assign({},this.opts.transportOptions[u],this.opts,{query:g,socket:this,hostname:this.hostname,secure:this.secure,port:this.port});return new Id[u](v)}open(){let u;if(this.opts.rememberUpgrade&&Pr.priorWebsocketSuccess&&this.transports.indexOf("websocket")!==-1)u="websocket";else if(this.transports.length===0){this.setTimeoutFn(()=>{this.emitReserved("error","No transports available")},0);return}else u=this.transports[0];this.readyState="opening";try{u=this.createTransport(u)}catch{this.transports.shift(),this.open();return}u.open(),this.setTransport(u)}setTransport(u){this.transport&&this.transport.removeAllListeners(),this.transport=u,u.on("drain",this.onDrain.bind(this)).on("packet",this.onPacket.bind(this)).on("error",this.onError.bind(this)).on("close",g=>this.onClose("transport close",g))}probe(u){let g=this.createTransport(u),v=!1;Pr.priorWebsocketSuccess=!1;let C=()=>{v||(g.send([{type:"ping",data:"probe"}]),g.once("packet",Ee=>{if(!v)if(Ee.type==="pong"&&Ee.data==="probe"){if(this.upgrading=!0,this.emitReserved("upgrading",g),!g)return;Pr.priorWebsocketSuccess=g.name==="websocket",this.transport.pause(()=>{v||this.readyState!=="closed"&&(oe(),this.setTransport(g),g.send([{type:"upgrade"}]),this.emitReserved("upgrade",g),g=null,this.upgrading=!1,this.flush())})}else{let Ae=new Error("probe error");Ae.transport=g.name,this.emitReserved("upgradeError",Ae)}}))};function o(){v||(v=!0,oe(),g.close(),g=null)}let z=Ee=>{let Ae=new Error("probe error: "+Ee);Ae.transport=g.name,o(),this.emitReserved("upgradeError",Ae)};function B(){z("transport closed")}function H(){z("socket closed")}function Y(Ee){g&&Ee.name!==g.name&&o()}let oe=()=>{g.removeListener("open",C),g.removeListener("error",z),g.removeListener("close",B),this.off("close",H),this.off("upgrading",Y)};g.once("open",C),g.once("error",z),g.once("close",B),this.once("close",H),this.once("upgrading",Y),g.open()}onOpen(){if(this.readyState="open",Pr.priorWebsocketSuccess=this.transport.name==="websocket",this.emitReserved("open"),this.flush(),this.readyState==="open"&&this.opts.upgrade&&this.transport.pause){let u=0,g=this.upgrades.length;for(;u<g;u++)this.probe(this.upgrades[u])}}onPacket(u){if(this.readyState==="opening"||this.readyState==="open"||this.readyState==="closing")switch(this.emitReserved("packet",u),this.emitReserved("heartbeat"),u.type){case"open":this.onHandshake(JSON.parse(u.data));break;case"ping":this.resetPingTimeout(),this.sendPacket("pong"),this.emitReserved("ping"),this.emitReserved("pong");break;case"error":let g=new Error("server error");g.code=u.data,this.onError(g);break;case"message":this.emitReserved("data",u.data),this.emitReserved("message",u.data);break}}onHandshake(u){this.emitReserved("handshake",u),this.id=u.sid,this.transport.query.sid=u.sid,this.upgrades=this.filterUpgrades(u.upgrades),this.pingInterval=u.pingInterval,this.pingTimeout=u.pingTimeout,this.maxPayload=u.maxPayload,this.onOpen(),this.readyState!=="closed"&&this.resetPingTimeout()}resetPingTimeout(){this.clearTimeoutFn(this.pingTimeoutTimer),this.pingTimeoutTimer=this.setTimeoutFn(()=>{this.onClose("ping timeout")},this.pingInterval+this.pingTimeout),this.opts.autoUnref&&this.pingTimeoutTimer.unref()}onDrain(){this.writeBuffer.splice(0,this.prevBufferLen),this.prevBufferLen=0,this.writeBuffer.length===0?this.emitReserved("drain"):this.flush()}flush(){if(this.readyState!=="closed"&&this.transport.writable&&!this.upgrading&&this.writeBuffer.length){let u=this.getWritablePackets();this.transport.send(u),this.prevBufferLen=u.length,this.emitReserved("flush")}}getWritablePackets(){if(!(this.maxPayload&&this.transport.name==="polling"&&this.writeBuffer.length>1))return this.writeBuffer;let g=1;for(let v=0;v<this.writeBuffer.length;v++){let C=this.writeBuffer[v].data;if(C&&(g+=m_(C)),v>0&&g>this.maxPayload)return this.writeBuffer.slice(0,v);g+=2}return this.writeBuffer}write(u,g,v){return this.sendPacket("message",u,g,v),this}send(u,g,v){return this.sendPacket("message",u,g,v),this}sendPacket(u,g,v,C){if(typeof g=="function"&&(C=g,g=void 0),typeof v=="function"&&(C=v,v=null),this.readyState==="closing"||this.readyState==="closed")return;v=v||{},v.compress=v.compress!==!1;let o={type:u,data:g,options:v};this.emitReserved("packetCreate",o),this.writeBuffer.push(o),C&&this.once("flush",C),this.flush()}close(){let u=()=>{this.onClose("forced close"),this.transport.close()},g=()=>{this.off("upgrade",g),this.off("upgradeError",g),u()},v=()=>{this.once("upgrade",g),this.once("upgradeError",g)};return(this.readyState==="opening"||this.readyState==="open")&&(this.readyState="closing",this.writeBuffer.length?this.once("drain",()=>{this.upgrading?v():u()}):this.upgrading?v():u()),this}onError(u){Pr.priorWebsocketSuccess=!1,this.emitReserved("error",u),this.onClose("transport error",u)}onClose(u,g){(this.readyState==="opening"||this.readyState==="open"||this.readyState==="closing")&&(this.clearTimeoutFn(this.pingTimeoutTimer),this.transport.removeAllListeners("close"),this.transport.close(),this.transport.removeAllListeners(),typeof removeEventListener=="function"&&removeEventListener("offline",this.offlineEventListener,!1),this.readyState="closed",this.id=null,this.emitReserved("close",u,g),this.writeBuffer=[],this.prevBufferLen=0)}filterUpgrades(u){let g=[],v=0,C=u.length;for(;v<C;v++)~this.transports.indexOf(u[v])&&g.push(u[v]);return g}};Pr.protocol=kd;var kw=Pr.protocol;function S_(c,u="",g){let v=c;g=g||typeof location<"u"&&location,c==null&&(c=g.protocol+"//"+g.host),typeof c=="string"&&(c.charAt(0)==="/"&&(c.charAt(1)==="/"?c=g.protocol+c:c=g.host+c),/^(https?|wss?):\/\//.test(c)||(typeof g<"u"?c=g.protocol+"//"+c:c="https://"+c),v=rl(c)),v.port||(/^(http|ws)$/.test(v.protocol)?v.port="80":/^(http|ws)s$/.test(v.protocol)&&(v.port="443")),v.path=v.path||"/";let o=v.host.indexOf(":")!==-1?"["+v.host+"]":v.host;return v.id=v.protocol+"://"+o+":"+v.port+u,v.href=v.protocol+"://"+o+(g&&g.port===v.port?"":":"+v.port),v}var Bd={};mx(Bd,{Decoder:()=>Ac,Encoder:()=>Dd,PacketType:()=>Nt,protocol:()=>z_});var Fx=typeof ArrayBuffer=="function",Ox=c=>typeof ArrayBuffer.isView=="function"?ArrayBuffer.isView(c):c.buffer instanceof ArrayBuffer,A_=Object.prototype.toString,jx=typeof Blob=="function"||typeof Blob<"u"&&A_.call(Blob)==="[object BlobConstructor]",Ux=typeof File=="function"||typeof File<"u"&&A_.call(File)==="[object FileConstructor]";function Sc(c){return Fx&&(c instanceof ArrayBuffer||Ox(c))||jx&&c instanceof Blob||Ux&&c instanceof File}function kc(c,u){if(!c||typeof c!="object")return!1;if(Array.isArray(c)){for(let g=0,v=c.length;g<v;g++)if(kc(c[g]))return!0;return!1}if(Sc(c))return!0;if(c.toJSON&&typeof c.toJSON=="function"&&arguments.length===1)return kc(c.toJSON(),!0);for(let g in c)if(Object.prototype.hasOwnProperty.call(c,g)&&kc(c[g]))return!0;return!1}function M_(c){let u=[],g=c.data,v=c;return v.data=zd(g,u),v.attachments=u.length,{packet:v,buffers:u}}function zd(c,u){if(!c)return c;if(Sc(c)){let g={_placeholder:!0,num:u.length};return u.push(c),g}else if(Array.isArray(c)){let g=new Array(c.length);for(let v=0;v<c.length;v++)g[v]=zd(c[v],u);return g}else if(typeof c=="object"&&!(c instanceof Date)){let g={};for(let v in c)Object.prototype.hasOwnProperty.call(c,v)&&(g[v]=zd(c[v],u));return g}return c}function I_(c,u){return c.data=Pd(c.data,u),c.attachments=void 0,c}function Pd(c,u){if(!c)return c;if(c&&c._placeholder===!0){if(typeof c.num=="number"&&c.num>=0&&c.num<u.length)return u[c.num];throw new Error("illegal attachments")}else if(Array.isArray(c))for(let g=0;g<c.length;g++)c[g]=Pd(c[g],u);else if(typeof c=="object")for(let g in c)Object.prototype.hasOwnProperty.call(c,g)&&(c[g]=Pd(c[g],u));return c}var z_=5,Nt;(function(c){c[c.CONNECT=0]="CONNECT",c[c.DISCONNECT=1]="DISCONNECT",c[c.EVENT=2]="EVENT",c[c.ACK=3]="ACK",c[c.CONNECT_ERROR=4]="CONNECT_ERROR",c[c.BINARY_EVENT=5]="BINARY_EVENT",c[c.BINARY_ACK=6]="BINARY_ACK"})(Nt||(Nt={}));var Dd=class{constructor(u){this.replacer=u}encode(u){return(u.type===Nt.EVENT||u.type===Nt.ACK)&&kc(u)?(u.type=u.type===Nt.EVENT?Nt.BINARY_EVENT:Nt.BINARY_ACK,this.encodeAsBinary(u)):[this.encodeAsString(u)]}encodeAsString(u){let g=""+u.type;return(u.type===Nt.BINARY_EVENT||u.type===Nt.BINARY_ACK)&&(g+=u.attachments+"-"),u.nsp&&u.nsp!=="/"&&(g+=u.nsp+","),u.id!=null&&(g+=u.id),u.data!=null&&(g+=JSON.stringify(u.data,this.replacer)),g}encodeAsBinary(u){let g=M_(u),v=this.encodeAsString(g.packet),C=g.buffers;return C.unshift(v),C}},Ac=class extends ai{constructor(u){super(),this.reviver=u}add(u){let g;if(typeof u=="string"){if(this.reconstructor)throw new Error("got plaintext data when reconstructing a packet");g=this.decodeString(u),g.type===Nt.BINARY_EVENT||g.type===Nt.BINARY_ACK?(this.reconstructor=new Ld(g),g.attachments===0&&super.emitReserved("decoded",g)):super.emitReserved("decoded",g)}else if(Sc(u)||u.base64)if(this.reconstructor)g=this.reconstructor.takeBinaryData(u),g&&(this.reconstructor=null,super.emitReserved("decoded",g));else throw new Error("got binary data when not reconstructing a packet");else throw new Error("Unknown type: "+u)}decodeString(u){let g=0,v={type:Number(u.charAt(0))};if(Nt[v.type]===void 0)throw new Error("unknown packet type "+v.type);if(v.type===Nt.BINARY_EVENT||v.type===Nt.BINARY_ACK){let o=g+1;for(;u.charAt(++g)!=="-"&&g!=u.length;);let z=u.substring(o,g);if(z!=Number(z)||u.charAt(g)!=="-")throw new Error("Illegal attachments");v.attachments=Number(z)}if(u.charAt(g+1)==="/"){let o=g+1;for(;++g&&!(u.charAt(g)===","||g===u.length););v.nsp=u.substring(o,g)}else v.nsp="/";let C=u.charAt(g+1);if(C!==""&&Number(C)==C){let o=g+1;for(;++g;){let z=u.charAt(g);if(z==null||Number(z)!=z){--g;break}if(g===u.length)break}v.id=Number(u.substring(o,g+1))}if(u.charAt(++g)){let o=this.tryParse(u.substr(g));if(Ac.isPayloadValid(v.type,o))v.data=o;else throw new Error("invalid payload")}return v}tryParse(u){try{return JSON.parse(u,this.reviver)}catch{return!1}}static isPayloadValid(u,g){switch(u){case Nt.CONNECT:return typeof g=="object";case Nt.DISCONNECT:return g===void 0;case Nt.CONNECT_ERROR:return typeof g=="string"||typeof g=="object";case Nt.EVENT:case Nt.BINARY_EVENT:return Array.isArray(g)&&g.length>0;case Nt.ACK:case Nt.BINARY_ACK:return Array.isArray(g)}}destroy(){this.reconstructor&&this.reconstructor.finishedReconstruction()}},Ld=class{constructor(u){this.packet=u,this.buffers=[],this.reconPack=u}takeBinaryData(u){if(this.buffers.push(u),this.buffers.length===this.reconPack.attachments){let g=I_(this.reconPack,this.buffers);return this.finishedReconstruction(),g}return null}finishedReconstruction(){this.reconPack=null,this.buffers=[]}};function Dr(c,u,g){return c.on(u,g),function(){c.off(u,g)}}var Vx=Object.freeze({connect:1,connect_error:1,disconnect:1,disconnecting:1,newListener:1,removeListener:1}),nl=class extends ai{constructor(u,g,v){super(),this.connected=!1,this.receiveBuffer=[],this.sendBuffer=[],this.ids=0,this.acks={},this.flags={},this.io=u,this.nsp=g,v&&v.auth&&(this.auth=v.auth),this.io._autoConnect&&this.open()}get disconnected(){return!this.connected}subEvents(){if(this.subs)return;let u=this.io;this.subs=[Dr(u,"open",this.onopen.bind(this)),Dr(u,"packet",this.onpacket.bind(this)),Dr(u,"error",this.onerror.bind(this)),Dr(u,"close",this.onclose.bind(this))]}get active(){return!!this.subs}connect(){return this.connected?this:(this.subEvents(),this.io._reconnecting||this.io.open(),this.io._readyState==="open"&&this.onopen(),this)}open(){return this.connect()}send(...u){return u.unshift("message"),this.emit.apply(this,u),this}emit(u,...g){if(Vx.hasOwnProperty(u))throw new Error('"'+u+'" is a reserved event name');g.unshift(u);let v={type:Nt.EVENT,data:g};if(v.options={},v.options.compress=this.flags.compress!==!1,typeof g[g.length-1]=="function"){let z=this.ids++,B=g.pop();this._registerAckCallback(z,B),v.id=z}let C=this.io.engine&&this.io.engine.transport&&this.io.engine.transport.writable;return this.flags.volatile&&(!C||!this.connected)||(this.connected?(this.notifyOutgoingListeners(v),this.packet(v)):this.sendBuffer.push(v)),this.flags={},this}_registerAckCallback(u,g){let v=this.flags.timeout;if(v===void 0){this.acks[u]=g;return}let C=this.io.setTimeoutFn(()=>{delete this.acks[u];for(let o=0;o<this.sendBuffer.length;o++)this.sendBuffer[o].id===u&&this.sendBuffer.splice(o,1);g.call(this,new Error("operation has timed out"))},v);this.acks[u]=(...o)=>{this.io.clearTimeoutFn(C),g.apply(this,[null,...o])}}packet(u){u.nsp=this.nsp,this.io._packet(u)}onopen(){typeof this.auth=="function"?this.auth(u=>{this.packet({type:Nt.CONNECT,data:u})}):this.packet({type:Nt.CONNECT,data:this.auth})}onerror(u){this.connected||this.emitReserved("connect_error",u)}onclose(u,g){this.connected=!1,delete this.id,this.emitReserved("disconnect",u,g)}onpacket(u){if(u.nsp===this.nsp)switch(u.type){case Nt.CONNECT:if(u.data&&u.data.sid){let C=u.data.sid;this.onconnect(C)}else this.emitReserved("connect_error",new Error("It seems you are trying to reach a Socket.IO server in v2.x with a v3.x client, but they are not compatible (more information here: https://socket.io/docs/v3/migrating-from-2-x-to-3-0/)"));break;case Nt.EVENT:case Nt.BINARY_EVENT:this.onevent(u);break;case Nt.ACK:case Nt.BINARY_ACK:this.onack(u);break;case Nt.DISCONNECT:this.ondisconnect();break;case Nt.CONNECT_ERROR:this.destroy();let v=new Error(u.data.message);v.data=u.data.data,this.emitReserved("connect_error",v);break}}onevent(u){let g=u.data||[];u.id!=null&&g.push(this.ack(u.id)),this.connected?this.emitEvent(g):this.receiveBuffer.push(Object.freeze(g))}emitEvent(u){if(this._anyListeners&&this._anyListeners.length){let g=this._anyListeners.slice();for(let v of g)v.apply(this,u)}super.emit.apply(this,u)}ack(u){let g=this,v=!1;return function(...C){v||(v=!0,g.packet({type:Nt.ACK,id:u,data:C}))}}onack(u){let g=this.acks[u.id];typeof g=="function"&&(g.apply(this,u.data),delete this.acks[u.id])}onconnect(u){this.id=u,this.connected=!0,this.emitBuffered(),this.emitReserved("connect")}emitBuffered(){this.receiveBuffer.forEach(u=>this.emitEvent(u)),this.receiveBuffer=[],this.sendBuffer.forEach(u=>{this.notifyOutgoingListeners(u),this.packet(u)}),this.sendBuffer=[]}ondisconnect(){this.destroy(),this.onclose("io server disconnect")}destroy(){this.subs&&(this.subs.forEach(u=>u()),this.subs=void 0),this.io._destroy(this)}disconnect(){return this.connected&&this.packet({type:Nt.DISCONNECT}),this.destroy(),this.connected&&this.onclose("io client disconnect"),this}close(){return this.disconnect()}compress(u){return this.flags.compress=u,this}get volatile(){return this.flags.volatile=!0,this}timeout(u){return this.flags.timeout=u,this}onAny(u){return this._anyListeners=this._anyListeners||[],this._anyListeners.push(u),this}prependAny(u){return this._anyListeners=this._anyListeners||[],this._anyListeners.unshift(u),this}offAny(u){if(!this._anyListeners)return this;if(u){let g=this._anyListeners;for(let v=0;v<g.length;v++)if(u===g[v])return g.splice(v,1),this}else this._anyListeners=[];return this}listenersAny(){return this._anyListeners||[]}onAnyOutgoing(u){return this._anyOutgoingListeners=this._anyOutgoingListeners||[],this._anyOutgoingListeners.push(u),this}prependAnyOutgoing(u){return this._anyOutgoingListeners=this._anyOutgoingListeners||[],this._anyOutgoingListeners.unshift(u),this}offAnyOutgoing(u){if(!this._anyOutgoingListeners)return this;if(u){let g=this._anyOutgoingListeners;for(let v=0;v<g.length;v++)if(u===g[v])return g.splice(v,1),this}else this._anyOutgoingListeners=[];return this}listenersAnyOutgoing(){return this._anyOutgoingListeners||[]}notifyOutgoingListeners(u){if(this._anyOutgoingListeners&&this._anyOutgoingListeners.length){let g=this._anyOutgoingListeners.slice();for(let v of g)v.apply(this,u.data)}}};function Fs(c){c=c||{},this.ms=c.min||100,this.max=c.max||1e4,this.factor=c.factor||2,this.jitter=c.jitter>0&&c.jitter<=1?c.jitter:0,this.attempts=0}Fs.prototype.duration=function(){var c=this.ms*Math.pow(this.factor,this.attempts++);if(this.jitter){var u=Math.random(),g=Math.floor(u*this.jitter*c);c=(Math.floor(u*10)&1)==0?c-g:c+g}return Math.min(c,this.max)|0};Fs.prototype.reset=function(){this.attempts=0};Fs.prototype.setMin=function(c){this.ms=c};Fs.prototype.setMax=function(c){this.max=c};Fs.prototype.setJitter=function(c){this.jitter=c};var ol=class extends ai{constructor(u,g){var v;super(),this.nsps={},this.subs=[],u&&typeof u=="object"&&(g=u,u=void 0),g=g||{},g.path=g.path||"/socket.io",this.opts=g,Yn(this,g),this.reconnection(g.reconnection!==!1),this.reconnectionAttempts(g.reconnectionAttempts||1/0),this.reconnectionDelay(g.reconnectionDelay||1e3),this.reconnectionDelayMax(g.reconnectionDelayMax||5e3),this.randomizationFactor((v=g.randomizationFactor)!==null&&v!==void 0?v:.5),this.backoff=new Fs({min:this.reconnectionDelay(),max:this.reconnectionDelayMax(),jitter:this.randomizationFactor()}),this.timeout(g.timeout==null?2e4:g.timeout),this._readyState="closed",this.uri=u;let C=g.parser||Bd;this.encoder=new C.Encoder,this.decoder=new C.Decoder,this._autoConnect=g.autoConnect!==!1,this._autoConnect&&this.open()}reconnection(u){return arguments.length?(this._reconnection=!!u,this):this._reconnection}reconnectionAttempts(u){return u===void 0?this._reconnectionAttempts:(this._reconnectionAttempts=u,this)}reconnectionDelay(u){var g;return u===void 0?this._reconnectionDelay:(this._reconnectionDelay=u,(g=this.backoff)===null||g===void 0||g.setMin(u),this)}randomizationFactor(u){var g;return u===void 0?this._randomizationFactor:(this._randomizationFactor=u,(g=this.backoff)===null||g===void 0||g.setJitter(u),this)}reconnectionDelayMax(u){var g;return u===void 0?this._reconnectionDelayMax:(this._reconnectionDelayMax=u,(g=this.backoff)===null||g===void 0||g.setMax(u),this)}timeout(u){return arguments.length?(this._timeout=u,this):this._timeout}maybeReconnectOnOpen(){!this._reconnecting&&this._reconnection&&this.backoff.attempts===0&&this.reconnect()}open(u){if(~this._readyState.indexOf("open"))return this;this.engine=new Pr(this.uri,this.opts);let g=this.engine,v=this;this._readyState="opening",this.skipReconnect=!1;let C=Dr(g,"open",function(){v.onopen(),u&&u()}),o=Dr(g,"error",z=>{v.cleanup(),v._readyState="closed",this.emitReserved("error",z),u?u(z):v.maybeReconnectOnOpen()});if(this._timeout!==!1){let z=this._timeout;z===0&&C();let B=this.setTimeoutFn(()=>{C(),g.close(),g.emit("error",new Error("timeout"))},z);this.opts.autoUnref&&B.unref(),this.subs.push(function(){clearTimeout(B)})}return this.subs.push(C),this.subs.push(o),this}connect(u){return this.open(u)}onopen(){this.cleanup(),this._readyState="open",this.emitReserved("open");let u=this.engine;this.subs.push(Dr(u,"ping",this.onping.bind(this)),Dr(u,"data",this.ondata.bind(this)),Dr(u,"error",this.onerror.bind(this)),Dr(u,"close",this.onclose.bind(this)),Dr(this.decoder,"decoded",this.ondecoded.bind(this)))}onping(){this.emitReserved("ping")}ondata(u){this.decoder.add(u)}ondecoded(u){this.emitReserved("packet",u)}onerror(u){this.emitReserved("error",u)}socket(u,g){let v=this.nsps[u];return v||(v=new nl(this,u,g),this.nsps[u]=v),v}_destroy(u){let g=Object.keys(this.nsps);for(let v of g)if(this.nsps[v].active)return;this._close()}_packet(u){let g=this.encoder.encode(u);for(let v=0;v<g.length;v++)this.engine.write(g[v],u.options)}cleanup(){this.subs.forEach(u=>u()),this.subs.length=0,this.decoder.destroy()}_close(){this.skipReconnect=!0,this._reconnecting=!1,this.onclose("forced close"),this.engine&&this.engine.close()}disconnect(){return this._close()}onclose(u,g){this.cleanup(),this.backoff.reset(),this._readyState="closed",this.emitReserved("close",u,g),this._reconnection&&!this.skipReconnect&&this.reconnect()}reconnect(){if(this._reconnecting||this.skipReconnect)return this;let u=this;if(this.backoff.attempts>=this._reconnectionAttempts)this.backoff.reset(),this.emitReserved("reconnect_failed"),this._reconnecting=!1;else{let g=this.backoff.duration();this._reconnecting=!0;let v=this.setTimeoutFn(()=>{u.skipReconnect||(this.emitReserved("reconnect_attempt",u.backoff.attempts),!u.skipReconnect&&u.open(C=>{C?(u._reconnecting=!1,u.reconnect(),this.emitReserved("reconnect_error",C)):u.onreconnect()}))},g);this.opts.autoUnref&&v.unref(),this.subs.push(function(){clearTimeout(v)})}}onreconnect(){let u=this.backoff.attempts;this._reconnecting=!1,this.backoff.reset(),this.emitReserved("reconnect",u)}};var Mc={};function Ic(c,u){typeof c=="object"&&(u=c,c=void 0),u=u||{};let g=S_(c,u.path||"/socket.io"),v=g.source,C=g.id,o=g.path,z=Mc[C]&&o in Mc[C].nsps,B=u.forceNew||u["force new connection"]||u.multiplex===!1||z,H;return B?H=new ol(v,u):(Mc[C]||(Mc[C]=new ol(v,u)),H=Mc[C]),g.query&&!u.query&&(u.query=g.queryKey),H.socket(g.path,u)}Object.assign(Ic,{Manager:ol,Socket:nl,io:Ic,connect:Ic});var zu;function U_(c){return zu=zu||document.createElement("textarea"),zu.innerHTML="&"+c+";",zu.value}var Nx=Object.prototype.hasOwnProperty;function Gx(c,u){return c?Nx.call(c,u):!1}function V_(c){var u=[].slice.call(arguments,1);return u.forEach(function(g){if(!!g){if(typeof g!="object")throw new TypeError(g+"must be object");Object.keys(g).forEach(function(v){c[v]=g[v]})}}),c}var $x=/\\([\\!"#$%&'()*+,.\/:;<=>?@[\]^_`{|}~-])/g;function zc(c){return c.indexOf("\\")<0?c:c.replace($x,"$1")}function N_(c){return!(c>=55296&&c<=57343||c>=64976&&c<=65007||(c&65535)===65535||(c&65535)===65534||c>=0&&c<=8||c===11||c>=14&&c<=31||c>=127&&c<=159||c>1114111)}function Vd(c){if(c>65535){c-=65536;var u=55296+(c>>10),g=56320+(c&1023);return String.fromCharCode(u,g)}return String.fromCharCode(c)}var qx=/&([a-z#][a-z0-9]{1,31});/gi,Zx=/^#((?:x[a-f0-9]{1,8}|[0-9]{1,8}))/i;function Wx(c,u){var g=0,v=U_(u);return u!==v?v:u.charCodeAt(0)===35&&Zx.test(u)&&(g=u[1].toLowerCase()==="x"?parseInt(u.slice(2),16):parseInt(u.slice(1),10),N_(g))?Vd(g):c}function Os(c){return c.indexOf("&")<0?c:c.replace(qx,Wx)}var Hx=/[&<>"]/,Xx=/[&<>"]/g,Kx={"&":"&amp;","<":"&lt;",">":"&gt;",'"':"&quot;"};function Yx(c){return Kx[c]}function Cr(c){return Hx.test(c)?c.replace(Xx,Yx):c}var st={};st.blockquote_open=function(){return`<blockquote>
`};st.blockquote_close=function(c,u){return"</blockquote>"+js(c,u)};st.code=function(c,u){return c[u].block?"<pre><code>"+Cr(c[u].content)+"</code></pre>"+js(c,u):"<code>"+Cr(c[u].content)+"</code>"};st.fence=function(c,u,g,v,C){var o=c[u],z="",B=g.langPrefix,H="",Y,oe,Ee;if(o.params){if(Y=o.params.split(/\s+/g),oe=Y.join(" "),Gx(C.rules.fence_custom,Y[0]))return C.rules.fence_custom[Y[0]](c,u,g,v,C);H=Cr(Os(zc(oe))),z=' class="'+B+H+'"'}return g.highlight?Ee=g.highlight.apply(g.highlight,[o.content].concat(Y))||Cr(o.content):Ee=Cr(o.content),"<pre><code"+z+">"+Ee+"</code></pre>"+js(c,u)};st.fence_custom={};st.heading_open=function(c,u){return"<h"+c[u].hLevel+">"};st.heading_close=function(c,u){return"</h"+c[u].hLevel+`>
`};st.hr=function(c,u,g){return(g.xhtmlOut?"<hr />":"<hr>")+js(c,u)};st.bullet_list_open=function(){return`<ul>
`};st.bullet_list_close=function(c,u){return"</ul>"+js(c,u)};st.list_item_open=function(){return"<li>"};st.list_item_close=function(){return`</li>
`};st.ordered_list_open=function(c,u){var g=c[u],v=g.order>1?' start="'+g.order+'"':"";return"<ol"+v+`>
`};st.ordered_list_close=function(c,u){return"</ol>"+js(c,u)};st.paragraph_open=function(c,u){return c[u].tight?"":"<p>"};st.paragraph_close=function(c,u){var g=!(c[u].tight&&u&&c[u-1].type==="inline"&&!c[u-1].content);return(c[u].tight?"":"</p>")+(g?js(c,u):"")};st.link_open=function(c,u,g){var v=c[u].title?' title="'+Cr(Os(c[u].title))+'"':"",C=g.linkTarget?' target="'+g.linkTarget+'"':"";return'<a href="'+Cr(c[u].href)+'"'+v+C+">"};st.link_close=function(){return"</a>"};st.image=function(c,u,g){var v=' src="'+Cr(c[u].src)+'"',C=c[u].title?' title="'+Cr(Os(c[u].title))+'"':"",o=' alt="'+(c[u].alt?Cr(Os(zc(c[u].alt))):"")+'"',z=g.xhtmlOut?" /":"";return"<img"+v+o+C+z+">"};st.table_open=function(){return`<table>
`};st.table_close=function(){return`</table>
`};st.thead_open=function(){return`<thead>
`};st.thead_close=function(){return`</thead>
`};st.tbody_open=function(){return`<tbody>
`};st.tbody_close=function(){return`</tbody>
`};st.tr_open=function(){return"<tr>"};st.tr_close=function(){return`</tr>
`};st.th_open=function(c,u){var g=c[u];return"<th"+(g.align?' style="text-align:'+g.align+'"':"")+">"};st.th_close=function(){return"</th>"};st.td_open=function(c,u){var g=c[u];return"<td"+(g.align?' style="text-align:'+g.align+'"':"")+">"};st.td_close=function(){return"</td>"};st.strong_open=function(){return"<strong>"};st.strong_close=function(){return"</strong>"};st.em_open=function(){return"<em>"};st.em_close=function(){return"</em>"};st.del_open=function(){return"<del>"};st.del_close=function(){return"</del>"};st.ins_open=function(){return"<ins>"};st.ins_close=function(){return"</ins>"};st.mark_open=function(){return"<mark>"};st.mark_close=function(){return"</mark>"};st.sub=function(c,u){return"<sub>"+Cr(c[u].content)+"</sub>"};st.sup=function(c,u){return"<sup>"+Cr(c[u].content)+"</sup>"};st.hardbreak=function(c,u,g){return g.xhtmlOut?`<br />
`:`<br>
`};st.softbreak=function(c,u,g){return g.breaks?g.xhtmlOut?`<br />
`:`<br>
`:`
`};st.text=function(c,u){return Cr(c[u].content)};st.htmlblock=function(c,u){return c[u].content};st.htmltag=function(c,u){return c[u].content};st.abbr_open=function(c,u){return'<abbr title="'+Cr(Os(c[u].title))+'">'};st.abbr_close=function(){return"</abbr>"};st.footnote_ref=function(c,u){var g=Number(c[u].id+1).toString(),v="fnref"+g;return c[u].subId>0&&(v+=":"+c[u].subId),'<sup class="footnote-ref"><a href="#fn'+g+'" id="'+v+'">['+g+"]</a></sup>"};st.footnote_block_open=function(c,u,g){var v=g.xhtmlOut?`<hr class="footnotes-sep" />
`:`<hr class="footnotes-sep">
`;return v+`<section class="footnotes">
<ol class="footnotes-list">
`};st.footnote_block_close=function(){return`</ol>
</section>
`};st.footnote_open=function(c,u){var g=Number(c[u].id+1).toString();return'<li id="fn'+g+'"  class="footnote-item">'};st.footnote_close=function(){return`</li>
`};st.footnote_anchor=function(c,u){var g=Number(c[u].id+1).toString(),v="fnref"+g;return c[u].subId>0&&(v+=":"+c[u].subId),' <a href="#'+v+'" class="footnote-backref">\u21A9</a>'};st.dl_open=function(){return`<dl>
`};st.dt_open=function(){return"<dt>"};st.dd_open=function(){return"<dd>"};st.dl_close=function(){return`</dl>
`};st.dt_close=function(){return`</dt>
`};st.dd_close=function(){return`</dd>
`};function G_(c,u){return++u>=c.length-2?u:c[u].type==="paragraph_open"&&c[u].tight&&c[u+1].type==="inline"&&c[u+1].content.length===0&&c[u+2].type==="paragraph_close"&&c[u+2].tight?G_(c,u+2):u}var js=st.getBreak=function(u,g){return g=G_(u,g),g<u.length&&u[g].type==="list_item_close"?"":`
`};function Gd(){this.rules=V_({},st),this.getBreak=st.getBreak}Gd.prototype.renderInline=function(c,u,g){for(var v=this.rules,C=c.length,o=0,z="";C--;)z+=v[c[o].type](c,o++,u,g,this);return z};Gd.prototype.render=function(c,u,g){for(var v=this.rules,C=c.length,o=-1,z="";++o<C;)c[o].type==="inline"?z+=this.renderInline(c[o].children,u,g):z+=v[c[o].type](c,o,u,g,this);return z};function Lr(){this.__rules__=[],this.__cache__=null}Lr.prototype.__find__=function(c){for(var u=this.__rules__.length,g=-1;u--;)if(this.__rules__[++g].name===c)return g;return-1};Lr.prototype.__compile__=function(){var c=this,u=[""];c.__rules__.forEach(function(g){!g.enabled||g.alt.forEach(function(v){u.indexOf(v)<0&&u.push(v)})}),c.__cache__={},u.forEach(function(g){c.__cache__[g]=[],c.__rules__.forEach(function(v){!v.enabled||g&&v.alt.indexOf(g)<0||c.__cache__[g].push(v.fn)})})};Lr.prototype.at=function(c,u,g){var v=this.__find__(c),C=g||{};if(v===-1)throw new Error("Parser rule not found: "+c);this.__rules__[v].fn=u,this.__rules__[v].alt=C.alt||[],this.__cache__=null};Lr.prototype.before=function(c,u,g,v){var C=this.__find__(c),o=v||{};if(C===-1)throw new Error("Parser rule not found: "+c);this.__rules__.splice(C,0,{name:u,enabled:!0,fn:g,alt:o.alt||[]}),this.__cache__=null};Lr.prototype.after=function(c,u,g,v){var C=this.__find__(c),o=v||{};if(C===-1)throw new Error("Parser rule not found: "+c);this.__rules__.splice(C+1,0,{name:u,enabled:!0,fn:g,alt:o.alt||[]}),this.__cache__=null};Lr.prototype.push=function(c,u,g){var v=g||{};this.__rules__.push({name:c,enabled:!0,fn:u,alt:v.alt||[]}),this.__cache__=null};Lr.prototype.enable=function(c,u){c=Array.isArray(c)?c:[c],u&&this.__rules__.forEach(function(g){g.enabled=!1}),c.forEach(function(g){var v=this.__find__(g);if(v<0)throw new Error("Rules manager: invalid rule name "+g);this.__rules__[v].enabled=!0},this),this.__cache__=null};Lr.prototype.disable=function(c){c=Array.isArray(c)?c:[c],c.forEach(function(u){var g=this.__find__(u);if(g<0)throw new Error("Rules manager: invalid rule name "+u);this.__rules__[g].enabled=!1},this),this.__cache__=null};Lr.prototype.getRules=function(c){return this.__cache__===null&&this.__compile__(),this.__cache__[c]||[]};function Jx(c){c.inlineMode?c.tokens.push({type:"inline",content:c.src.replace(/\n/g," ").trim(),level:0,lines:[0,1],children:[]}):c.block.parse(c.src,c.options,c.env,c.tokens)}function Us(c,u,g,v,C){this.src=c,this.env=v,this.options=g,this.parser=u,this.tokens=C,this.pos=0,this.posMax=this.src.length,this.level=0,this.pending="",this.pendingLevel=0,this.cache=[],this.isInLabel=!1,this.linkLevel=0,this.linkContent="",this.labelUnmatchedScopes=0}Us.prototype.pushPending=function(){this.tokens.push({type:"text",content:this.pending,level:this.pendingLevel}),this.pending=""};Us.prototype.push=function(c){this.pending&&this.pushPending(),this.tokens.push(c),this.pendingLevel=this.level};Us.prototype.cacheSet=function(c,u){for(var g=this.cache.length;g<=c;g++)this.cache.push(0);this.cache[c]=u};Us.prototype.cacheGet=function(c){return c<this.cache.length?this.cache[c]:0};function Pc(c,u){var g,v,C,o=-1,z=c.posMax,B=c.pos,H=c.isInLabel;if(c.isInLabel)return-1;if(c.labelUnmatchedScopes)return c.labelUnmatchedScopes--,-1;for(c.pos=u+1,c.isInLabel=!0,g=1;c.pos<z;){if(C=c.src.charCodeAt(c.pos),C===91)g++;else if(C===93&&(g--,g===0)){v=!0;break}c.parser.skipToken(c)}return v?(o=c.pos,c.labelUnmatchedScopes=0):c.labelUnmatchedScopes=g-1,c.pos=B,c.isInLabel=H,o}function Qx(c,u,g,v){var C,o,z,B,H,Y;if(c.charCodeAt(0)!==42||c.charCodeAt(1)!==91||c.indexOf("]:")===-1||(C=new Us(c,u,g,v,[]),o=Pc(C,1),o<0||c.charCodeAt(o+1)!==58))return-1;for(B=C.posMax,z=o+2;z<B&&C.src.charCodeAt(z)!==10;z++);return H=c.slice(2,o),Y=c.slice(o+2,z).trim(),Y.length===0?-1:(v.abbreviations||(v.abbreviations={}),typeof v.abbreviations[":"+H]>"u"&&(v.abbreviations[":"+H]=Y),z)}function ev(c){var u=c.tokens,g,v,C,o;if(!c.inlineMode){for(g=1,v=u.length-1;g<v;g++)if(u[g-1].type==="paragraph_open"&&u[g].type==="inline"&&u[g+1].type==="paragraph_close"){for(C=u[g].content;C.length&&(o=Qx(C,c.inline,c.options,c.env),!(o<0));)C=C.slice(o).trim();u[g].content=C,C.length||(u[g-1].tight=!0,u[g+1].tight=!0)}}}function Nd(c){var u=Os(c);try{u=decodeURI(u)}catch{}return encodeURI(u)}function $_(c,u){var g,v,C,o=u,z=c.posMax;if(c.src.charCodeAt(u)===60){for(u++;u<z;){if(g=c.src.charCodeAt(u),g===10)return!1;if(g===62)return C=Nd(zc(c.src.slice(o+1,u))),c.parser.validateLink(C)?(c.pos=u+1,c.linkContent=C,!0):!1;if(g===92&&u+1<z){u+=2;continue}u++}return!1}for(v=0;u<z&&(g=c.src.charCodeAt(u),!(g===32||g<32||g===127));){if(g===92&&u+1<z){u+=2;continue}if(g===40&&(v++,v>1)||g===41&&(v--,v<0))break;u++}return o===u||(C=zc(c.src.slice(o,u)),!c.parser.validateLink(C))?!1:(c.linkContent=C,c.pos=u,!0)}function q_(c,u){var g,v=u,C=c.posMax,o=c.src.charCodeAt(u);if(o!==34&&o!==39&&o!==40)return!1;for(u++,o===40&&(o=41);u<C;){if(g=c.src.charCodeAt(u),g===o)return c.pos=u+1,c.linkContent=zc(c.src.slice(v+1,u)),!0;if(g===92&&u+1<C){u+=2;continue}u++}return!1}function Z_(c){return c.trim().replace(/\s+/g," ").toUpperCase()}function tv(c,u,g,v){var C,o,z,B,H,Y,oe,Ee,Ae;if(c.charCodeAt(0)!==91||c.indexOf("]:")===-1||(C=new Us(c,u,g,v,[]),o=Pc(C,0),o<0||c.charCodeAt(o+1)!==58))return-1;for(B=C.posMax,z=o+2;z<B&&(H=C.src.charCodeAt(z),!(H!==32&&H!==10));z++);if(!$_(C,z))return-1;for(oe=C.linkContent,z=C.pos,Y=z,z=z+1;z<B&&(H=C.src.charCodeAt(z),!(H!==32&&H!==10));z++);for(z<B&&Y!==z&&q_(C,z)?(Ee=C.linkContent,z=C.pos):(Ee="",z=Y);z<B&&C.src.charCodeAt(z)===32;)z++;return z<B&&C.src.charCodeAt(z)!==10?-1:(Ae=Z_(c.slice(1,o)),typeof v.references[Ae]>"u"&&(v.references[Ae]={title:Ee,href:oe}),z)}function iv(c){var u=c.tokens,g,v,C,o;if(c.env.references=c.env.references||{},!c.inlineMode){for(g=1,v=u.length-1;g<v;g++)if(u[g].type==="inline"&&u[g-1].type==="paragraph_open"&&u[g+1].type==="paragraph_close"){for(C=u[g].content;C.length&&(o=tv(C,c.inline,c.options,c.env),!(o<0));)C=C.slice(o).trim();u[g].content=C,C.length||(u[g-1].tight=!0,u[g+1].tight=!0)}}}function rv(c){var u=c.tokens,g,v,C;for(v=0,C=u.length;v<C;v++)g=u[v],g.type==="inline"&&c.inline.parse(g.content,c.options,c.env,g.children)}function nv(c){var u,g,v,C,o,z,B,H,Y,oe=0,Ee=!1,Ae={};if(!!c.env.footnotes&&(c.tokens=c.tokens.filter(function(Ce){return Ce.type==="footnote_reference_open"?(Ee=!0,H=[],Y=Ce.label,!1):Ce.type==="footnote_reference_close"?(Ee=!1,Ae[":"+Y]=H,!1):(Ee&&H.push(Ce),!Ee)}),!!c.env.footnotes.list)){for(z=c.env.footnotes.list,c.tokens.push({type:"footnote_block_open",level:oe++}),u=0,g=z.length;u<g;u++){for(c.tokens.push({type:"footnote_open",id:u,level:oe++}),z[u].tokens?(B=[],B.push({type:"paragraph_open",tight:!1,level:oe++}),B.push({type:"inline",content:"",level:oe,children:z[u].tokens}),B.push({type:"paragraph_close",tight:!1,level:--oe})):z[u].label&&(B=Ae[":"+z[u].label]),c.tokens=c.tokens.concat(B),c.tokens[c.tokens.length-1].type==="paragraph_close"?o=c.tokens.pop():o=null,C=z[u].count>0?z[u].count:1,v=0;v<C;v++)c.tokens.push({type:"footnote_anchor",id:u,subId:v,level:oe});o&&c.tokens.push(o),c.tokens.push({type:"footnote_close",level:--oe})}c.tokens.push({type:"footnote_block_close",level:--oe})}}var P_=` 
()[]'".,!?-`;function Rd(c){return c.replace(/([-()\[\]{}+?*.$\^|,:#<!\\])/g,"\\$1")}function ov(c){var u,g,v,C,o,z,B,H,Y,oe,Ee,Ae,Ce=c.tokens;if(!!c.env.abbreviations){for(c.env.abbrRegExp||(Ae="(^|["+P_.split("").map(Rd).join("")+"])("+Object.keys(c.env.abbreviations).map(function(Ge){return Ge.substr(1)}).sort(function(Ge,Ke){return Ke.length-Ge.length}).map(Rd).join("|")+")($|["+P_.split("").map(Rd).join("")+"])",c.env.abbrRegExp=new RegExp(Ae,"g")),oe=c.env.abbrRegExp,g=0,v=Ce.length;g<v;g++)if(Ce[g].type==="inline"){for(C=Ce[g].children,u=C.length-1;u>=0;u--)if(o=C[u],o.type==="text"){for(H=0,z=o.content,oe.lastIndex=0,Y=o.level,B=[];Ee=oe.exec(z);)oe.lastIndex>H&&B.push({type:"text",content:z.slice(H,Ee.index+Ee[1].length),level:Y}),B.push({type:"abbr_open",title:c.env.abbreviations[":"+Ee[2]],level:Y++}),B.push({type:"text",content:Ee[2],level:Y}),B.push({type:"abbr_close",level:--Y}),H=oe.lastIndex-Ee[3].length;!B.length||(H<z.length&&B.push({type:"text",content:z.slice(H),level:Y}),Ce[g].children=C=[].concat(C.slice(0,u),B,C.slice(u+1)))}}}}var sv=/\+-|\.\.|\?\?\?\?|!!!!|,,|--/,av=/\((c|tm|r|p)\)/ig,lv={c:"\xA9",r:"\xAE",p:"\xA7",tm:"\u2122"};function cv(c){return c.indexOf("(")<0?c:c.replace(av,function(u,g){return lv[g.toLowerCase()]})}function hv(c){var u,g,v,C,o;if(!!c.options.typographer){for(o=c.tokens.length-1;o>=0;o--)if(c.tokens[o].type==="inline")for(C=c.tokens[o].children,u=C.length-1;u>=0;u--)g=C[u],g.type==="text"&&(v=g.content,v=cv(v),sv.test(v)&&(v=v.replace(/\+-/g,"\xB1").replace(/\.{2,}/g,"\u2026").replace(/([?!])/g,"$1..").replace(/([?!]){4,}/g,"$1$1$1").replace(/,{2,}/g,",").replace(/(^|[^-])---([^-]|$)/mg,"$1\u2014$2").replace(/(^|\s)--(\s|$)/mg,"$1\u2013$2").replace(/(^|[^-\s])--([^-\s]|$)/mg,"$1\u2013$2")),g.content=v)}}var uv=/['"]/,D_=/['"]/g,pv=/[-\s()\[\]]/,L_="\u2019";function B_(c,u){return u<0||u>=c.length?!1:!pv.test(c[u])}function sl(c,u,g){return c.substr(0,u)+g+c.substr(u+1)}function dv(c){var u,g,v,C,o,z,B,H,Y,oe,Ee,Ae,Ce,Ge,Ke,Ye,ut;if(!!c.options.typographer){for(ut=[],Ke=c.tokens.length-1;Ke>=0;Ke--)if(c.tokens[Ke].type==="inline")for(Ye=c.tokens[Ke].children,ut.length=0,u=0;u<Ye.length;u++){if(g=Ye[u],g.type!=="text"||uv.test(g.text))continue;for(B=Ye[u].level,Ce=ut.length-1;Ce>=0&&!(ut[Ce].level<=B);Ce--);ut.length=Ce+1,v=g.content,o=0,z=v.length;e:for(;o<z&&(D_.lastIndex=o,C=D_.exec(v),!!C);){if(H=!B_(v,C.index-1),o=C.index+1,Ge=C[0]==="'",Y=!B_(v,o),!Y&&!H){Ge&&(g.content=sl(g.content,C.index,L_));continue}if(Ee=!Y,Ae=!H,Ae){for(Ce=ut.length-1;Ce>=0&&(oe=ut[Ce],!(ut[Ce].level<B));Ce--)if(oe.single===Ge&&ut[Ce].level===B){oe=ut[Ce],Ge?(Ye[oe.token].content=sl(Ye[oe.token].content,oe.pos,c.options.quotes[2]),g.content=sl(g.content,C.index,c.options.quotes[3])):(Ye[oe.token].content=sl(Ye[oe.token].content,oe.pos,c.options.quotes[0]),g.content=sl(g.content,C.index,c.options.quotes[1])),ut.length=Ce;continue e}}Ee?ut.push({token:u,pos:C.index,single:Ge,level:B}):Ae&&Ge&&(g.content=sl(g.content,C.index,L_))}}}}var Fd=[["block",Jx],["abbr",ev],["references",iv],["inline",rv],["footnote_tail",nv],["abbr2",ov],["replacements",hv],["smartquotes",dv]];function W_(){this.options={},this.ruler=new Lr;for(var c=0;c<Fd.length;c++)this.ruler.push(Fd[c][0],Fd[c][1])}W_.prototype.process=function(c){var u,g,v;for(v=this.ruler.getRules(""),u=0,g=v.length;u<g;u++)v[u](c)};function Vs(c,u,g,v,C){var o,z,B,H,Y,oe,Ee;for(this.src=c,this.parser=u,this.options=g,this.env=v,this.tokens=C,this.bMarks=[],this.eMarks=[],this.tShift=[],this.blkIndent=0,this.line=0,this.lineMax=0,this.tight=!1,this.parentType="root",this.ddIndent=-1,this.level=0,this.result="",z=this.src,oe=0,Ee=!1,B=H=oe=0,Y=z.length;H<Y;H++){if(o=z.charCodeAt(H),!Ee)if(o===32){oe++;continue}else Ee=!0;(o===10||H===Y-1)&&(o!==10&&H++,this.bMarks.push(B),this.eMarks.push(H),this.tShift.push(oe),Ee=!1,oe=0,B=H+1)}this.bMarks.push(z.length),this.eMarks.push(z.length),this.tShift.push(0),this.lineMax=this.bMarks.length-1}Vs.prototype.isEmpty=function(u){return this.bMarks[u]+this.tShift[u]>=this.eMarks[u]};Vs.prototype.skipEmptyLines=function(u){for(var g=this.lineMax;u<g&&!(this.bMarks[u]+this.tShift[u]<this.eMarks[u]);u++);return u};Vs.prototype.skipSpaces=function(u){for(var g=this.src.length;u<g&&this.src.charCodeAt(u)===32;u++);return u};Vs.prototype.skipChars=function(u,g){for(var v=this.src.length;u<v&&this.src.charCodeAt(u)===g;u++);return u};Vs.prototype.skipCharsBack=function(u,g,v){if(u<=v)return u;for(;u>v;)if(g!==this.src.charCodeAt(--u))return u+1;return u};Vs.prototype.getLines=function(u,g,v,C){var o,z,B,H,Y,oe=u;if(u>=g)return"";if(oe+1===g)return z=this.bMarks[oe]+Math.min(this.tShift[oe],v),B=C?this.eMarks[oe]+1:this.eMarks[oe],this.src.slice(z,B);for(H=new Array(g-u),o=0;oe<g;oe++,o++)Y=this.tShift[oe],Y>v&&(Y=v),Y<0&&(Y=0),z=this.bMarks[oe]+Y,oe+1<g||C?B=this.eMarks[oe]+1:B=this.eMarks[oe],H[o]=this.src.slice(z,B);return H.join("")};function fv(c,u,g){var v,C;if(c.tShift[u]-c.blkIndent<4)return!1;for(C=v=u+1;v<g;){if(c.isEmpty(v)){v++;continue}if(c.tShift[v]-c.blkIndent>=4){v++,C=v;continue}break}return c.line=v,c.tokens.push({type:"code",content:c.getLines(u,C,4+c.blkIndent,!0),block:!0,lines:[u,c.line],level:c.level}),!0}function mv(c,u,g,v){var C,o,z,B,H,Y=!1,oe=c.bMarks[u]+c.tShift[u],Ee=c.eMarks[u];if(oe+3>Ee||(C=c.src.charCodeAt(oe),C!==126&&C!==96)||(H=oe,oe=c.skipChars(oe,C),o=oe-H,o<3)||(z=c.src.slice(oe,Ee).trim(),z.indexOf("`")>=0))return!1;if(v)return!0;for(B=u;B++,!(B>=g||(oe=H=c.bMarks[B]+c.tShift[B],Ee=c.eMarks[B],oe<Ee&&c.tShift[B]<c.blkIndent));)if(c.src.charCodeAt(oe)===C&&!(c.tShift[B]-c.blkIndent>=4)&&(oe=c.skipChars(oe,C),!(oe-H<o)&&(oe=c.skipSpaces(oe),!(oe<Ee)))){Y=!0;break}return o=c.tShift[u],c.line=B+(Y?1:0),c.tokens.push({type:"fence",params:z,content:c.getLines(u+1,B,o,!0),lines:[u,c.line],level:c.level}),!0}function gv(c,u,g,v){var C,o,z,B,H,Y,oe,Ee,Ae,Ce,Ge,Ke=c.bMarks[u]+c.tShift[u],Ye=c.eMarks[u];if(Ke>Ye||c.src.charCodeAt(Ke++)!==62||c.level>=c.options.maxNesting)return!1;if(v)return!0;for(c.src.charCodeAt(Ke)===32&&Ke++,H=c.blkIndent,c.blkIndent=0,B=[c.bMarks[u]],c.bMarks[u]=Ke,Ke=Ke<Ye?c.skipSpaces(Ke):Ke,o=Ke>=Ye,z=[c.tShift[u]],c.tShift[u]=Ke-c.bMarks[u],Ee=c.parser.ruler.getRules("blockquote"),C=u+1;C<g&&(Ke=c.bMarks[C]+c.tShift[C],Ye=c.eMarks[C],!(Ke>=Ye));C++){if(c.src.charCodeAt(Ke++)===62){c.src.charCodeAt(Ke)===32&&Ke++,B.push(c.bMarks[C]),c.bMarks[C]=Ke,Ke=Ke<Ye?c.skipSpaces(Ke):Ke,o=Ke>=Ye,z.push(c.tShift[C]),c.tShift[C]=Ke-c.bMarks[C];continue}if(o)break;for(Ge=!1,Ae=0,Ce=Ee.length;Ae<Ce;Ae++)if(Ee[Ae](c,C,g,!0)){Ge=!0;break}if(Ge)break;B.push(c.bMarks[C]),z.push(c.tShift[C]),c.tShift[C]=-1337}for(Y=c.parentType,c.parentType="blockquote",c.tokens.push({type:"blockquote_open",lines:oe=[u,0],level:c.level++}),c.parser.tokenize(c,u,C),c.tokens.push({type:"blockquote_close",level:--c.level}),c.parentType=Y,oe[1]=c.line,Ae=0;Ae<z.length;Ae++)c.bMarks[Ae+u]=B[Ae],c.tShift[Ae+u]=z[Ae];return c.blkIndent=H,!0}function _v(c,u,g,v){var C,o,z,B=c.bMarks[u],H=c.eMarks[u];if(B+=c.tShift[u],B>H||(C=c.src.charCodeAt(B++),C!==42&&C!==45&&C!==95))return!1;for(o=1;B<H;){if(z=c.src.charCodeAt(B++),z!==C&&z!==32)return!1;z===C&&o++}return o<3?!1:(v||(c.line=u+1,c.tokens.push({type:"hr",lines:[u,c.line],level:c.level})),!0)}function R_(c,u){var g,v,C;return v=c.bMarks[u]+c.tShift[u],C=c.eMarks[u],v>=C||(g=c.src.charCodeAt(v++),g!==42&&g!==45&&g!==43)||v<C&&c.src.charCodeAt(v)!==32?-1:v}function F_(c,u){var g,v=c.bMarks[u]+c.tShift[u],C=c.eMarks[u];if(v+1>=C||(g=c.src.charCodeAt(v++),g<48||g>57))return-1;for(;;){if(v>=C)return-1;if(g=c.src.charCodeAt(v++),!(g>=48&&g<=57)){if(g===41||g===46)break;return-1}}return v<C&&c.src.charCodeAt(v)!==32?-1:v}function yv(c,u){var g,v,C=c.level+2;for(g=u+2,v=c.tokens.length-2;g<v;g++)c.tokens[g].level===C&&c.tokens[g].type==="paragraph_open"&&(c.tokens[g+2].tight=!0,c.tokens[g].tight=!0,g+=2)}function xv(c,u,g,v){var C,o,z,B,H,Y,oe,Ee,Ae,Ce,Ge,Ke,Ye,ut,wt,Je,Et,It,Ht=!0,li,Bt,Ci,ki;if((Ee=F_(c,u))>=0)Ye=!0;else if((Ee=R_(c,u))>=0)Ye=!1;else return!1;if(c.level>=c.options.maxNesting)return!1;if(Ke=c.src.charCodeAt(Ee-1),v)return!0;for(wt=c.tokens.length,Ye?(oe=c.bMarks[u]+c.tShift[u],Ge=Number(c.src.substr(oe,Ee-oe-1)),c.tokens.push({type:"ordered_list_open",order:Ge,lines:Et=[u,0],level:c.level++})):c.tokens.push({type:"bullet_list_open",lines:Et=[u,0],level:c.level++}),C=u,Je=!1,li=c.parser.ruler.getRules("list");C<g&&(ut=c.skipSpaces(Ee),Ae=c.eMarks[C],ut>=Ae?Ce=1:Ce=ut-Ee,Ce>4&&(Ce=1),Ce<1&&(Ce=1),o=Ee-c.bMarks[C]+Ce,c.tokens.push({type:"list_item_open",lines:It=[u,0],level:c.level++}),B=c.blkIndent,H=c.tight,z=c.tShift[u],Y=c.parentType,c.tShift[u]=ut-c.bMarks[u],c.blkIndent=o,c.tight=!0,c.parentType="list",c.parser.tokenize(c,u,g,!0),(!c.tight||Je)&&(Ht=!1),Je=c.line-u>1&&c.isEmpty(c.line-1),c.blkIndent=B,c.tShift[u]=z,c.tight=H,c.parentType=Y,c.tokens.push({type:"list_item_close",level:--c.level}),C=u=c.line,It[1]=C,ut=c.bMarks[u],!(C>=g||c.isEmpty(C)||c.tShift[C]<c.blkIndent));){for(ki=!1,Bt=0,Ci=li.length;Bt<Ci;Bt++)if(li[Bt](c,C,g,!0)){ki=!0;break}if(ki)break;if(Ye){if(Ee=F_(c,C),Ee<0)break}else if(Ee=R_(c,C),Ee<0)break;if(Ke!==c.src.charCodeAt(Ee-1))break}return c.tokens.push({type:Ye?"ordered_list_close":"bullet_list_close",level:--c.level}),Et[1]=C,c.line=C,Ht&&yv(c,wt),!0}function vv(c,u,g,v){var C,o,z,B,H,Y=c.bMarks[u]+c.tShift[u],oe=c.eMarks[u];if(Y+4>oe||c.src.charCodeAt(Y)!==91||c.src.charCodeAt(Y+1)!==94||c.level>=c.options.maxNesting)return!1;for(B=Y+2;B<oe;B++){if(c.src.charCodeAt(B)===32)return!1;if(c.src.charCodeAt(B)===93)break}return B===Y+2||B+1>=oe||c.src.charCodeAt(++B)!==58?!1:(v||(B++,c.env.footnotes||(c.env.footnotes={}),c.env.footnotes.refs||(c.env.footnotes.refs={}),H=c.src.slice(Y+2,B-2),c.env.footnotes.refs[":"+H]=-1,c.tokens.push({type:"footnote_reference_open",label:H,level:c.level++}),C=c.bMarks[u],o=c.tShift[u],z=c.parentType,c.tShift[u]=c.skipSpaces(B)-B,c.bMarks[u]=B,c.blkIndent+=4,c.parentType="footnote",c.tShift[u]<c.blkIndent&&(c.tShift[u]+=c.blkIndent,c.bMarks[u]-=c.blkIndent),c.parser.tokenize(c,u,g,!0),c.parentType=z,c.blkIndent-=4,c.tShift[u]=o,c.bMarks[u]=C,c.tokens.push({type:"footnote_reference_close",level:--c.level})),!0)}function bv(c,u,g,v){var C,o,z,B=c.bMarks[u]+c.tShift[u],H=c.eMarks[u];if(B>=H||(C=c.src.charCodeAt(B),C!==35||B>=H))return!1;for(o=1,C=c.src.charCodeAt(++B);C===35&&B<H&&o<=6;)o++,C=c.src.charCodeAt(++B);return o>6||B<H&&C!==32?!1:(v||(H=c.skipCharsBack(H,32,B),z=c.skipCharsBack(H,35,B),z>B&&c.src.charCodeAt(z-1)===32&&(H=z),c.line=u+1,c.tokens.push({type:"heading_open",hLevel:o,lines:[u,c.line],level:c.level}),B<H&&c.tokens.push({type:"inline",content:c.src.slice(B,H).trim(),level:c.level+1,lines:[u,c.line],children:[]}),c.tokens.push({type:"heading_close",hLevel:o,level:c.level})),!0)}function wv(c,u,g){var v,C,o,z=u+1;return z>=g||c.tShift[z]<c.blkIndent||c.tShift[z]-c.blkIndent>3||(C=c.bMarks[z]+c.tShift[z],o=c.eMarks[z],C>=o)||(v=c.src.charCodeAt(C),v!==45&&v!==61)||(C=c.skipChars(C,v),C=c.skipSpaces(C),C<o)?!1:(C=c.bMarks[u]+c.tShift[u],c.line=z+1,c.tokens.push({type:"heading_open",hLevel:v===61?1:2,lines:[u,c.line],level:c.level}),c.tokens.push({type:"inline",content:c.src.slice(C,c.eMarks[u]).trim(),level:c.level+1,lines:[u,c.line-1],children:[]}),c.tokens.push({type:"heading_close",hLevel:v===61?1:2,level:c.level}),!0)}var H_={};["article","aside","button","blockquote","body","canvas","caption","col","colgroup","dd","div","dl","dt","embed","fieldset","figcaption","figure","footer","form","h1","h2","h3","h4","h5","h6","header","hgroup","hr","iframe","li","map","object","ol","output","p","pre","progress","script","section","style","table","tbody","td","textarea","tfoot","th","tr","thead","ul","video"].forEach(function(c){H_[c]=!0});var Ev=/^<([a-zA-Z]{1,15})[\s\/>]/,Tv=/^<\/([a-zA-Z]{1,15})[\s>]/;function Cv(c){var u=c|32;return u>=97&&u<=122}function kv(c,u,g,v){var C,o,z,B=c.bMarks[u],H=c.eMarks[u],Y=c.tShift[u];if(B+=Y,!c.options.html||Y>3||B+2>=H||c.src.charCodeAt(B)!==60)return!1;if(C=c.src.charCodeAt(B+1),C===33||C===63){if(v)return!0}else if(C===47||Cv(C)){if(C===47){if(o=c.src.slice(B,H).match(Tv),!o)return!1}else if(o=c.src.slice(B,H).match(Ev),!o)return!1;if(H_[o[1].toLowerCase()]!==!0)return!1;if(v)return!0}else return!1;for(z=u+1;z<c.lineMax&&!c.isEmpty(z);)z++;return c.line=z,c.tokens.push({type:"htmlblock",level:c.level,lines:[u,c.line],content:c.getLines(u,z,0,!0)}),!0}function Od(c,u){var g=c.bMarks[u]+c.blkIndent,v=c.eMarks[u];return c.src.substr(g,v-g)}function Sv(c,u,g,v){var C,o,z,B,H,Y,oe,Ee,Ae,Ce,Ge;if(u+2>g||(H=u+1,c.tShift[H]<c.blkIndent)||(z=c.bMarks[H]+c.tShift[H],z>=c.eMarks[H])||(C=c.src.charCodeAt(z),C!==124&&C!==45&&C!==58)||(o=Od(c,u+1),!/^[-:| ]+$/.test(o))||(Y=o.split("|"),Y<=2))return!1;for(Ee=[],B=0;B<Y.length;B++){if(Ae=Y[B].trim(),!Ae){if(B===0||B===Y.length-1)continue;return!1}if(!/^:?-+:?$/.test(Ae))return!1;Ae.charCodeAt(Ae.length-1)===58?Ee.push(Ae.charCodeAt(0)===58?"center":"right"):Ae.charCodeAt(0)===58?Ee.push("left"):Ee.push("")}if(o=Od(c,u).trim(),o.indexOf("|")===-1||(Y=o.replace(/^\||\|$/g,"").split("|"),Ee.length!==Y.length))return!1;if(v)return!0;for(c.tokens.push({type:"table_open",lines:Ce=[u,0],level:c.level++}),c.tokens.push({type:"thead_open",lines:[u,u+1],level:c.level++}),c.tokens.push({type:"tr_open",lines:[u,u+1],level:c.level++}),B=0;B<Y.length;B++)c.tokens.push({type:"th_open",align:Ee[B],lines:[u,u+1],level:c.level++}),c.tokens.push({type:"inline",content:Y[B].trim(),lines:[u,u+1],level:c.level,children:[]}),c.tokens.push({type:"th_close",level:--c.level});for(c.tokens.push({type:"tr_close",level:--c.level}),c.tokens.push({type:"thead_close",level:--c.level}),c.tokens.push({type:"tbody_open",lines:Ge=[u+2,0],level:c.level++}),H=u+2;H<g&&!(c.tShift[H]<c.blkIndent||(o=Od(c,H).trim(),o.indexOf("|")===-1));H++){for(Y=o.replace(/^\||\|$/g,"").split("|"),c.tokens.push({type:"tr_open",level:c.level++}),B=0;B<Y.length;B++)c.tokens.push({type:"td_open",align:Ee[B],level:c.level++}),oe=Y[B].substring(Y[B].charCodeAt(0)===124?1:0,Y[B].charCodeAt(Y[B].length-1)===124?Y[B].length-1:Y[B].length).trim(),c.tokens.push({type:"inline",content:oe,level:c.level,children:[]}),c.tokens.push({type:"td_close",level:--c.level});c.tokens.push({type:"tr_close",level:--c.level})}return c.tokens.push({type:"tbody_close",level:--c.level}),c.tokens.push({type:"table_close",level:--c.level}),Ce[1]=Ge[1]=H,c.line=H,!0}function Pu(c,u){var g,v,C=c.bMarks[u]+c.tShift[u],o=c.eMarks[u];return C>=o||(v=c.src.charCodeAt(C++),v!==126&&v!==58)||(g=c.skipSpaces(C),C===g)||g>=o?-1:g}function Av(c,u){var g,v,C=c.level+2;for(g=u+2,v=c.tokens.length-2;g<v;g++)c.tokens[g].level===C&&c.tokens[g].type==="paragraph_open"&&(c.tokens[g+2].tight=!0,c.tokens[g].tight=!0,g+=2)}function Mv(c,u,g,v){var C,o,z,B,H,Y,oe,Ee,Ae,Ce,Ge,Ke,Ye,ut;if(v)return c.ddIndent<0?!1:Pu(c,u)>=0;if(oe=u+1,c.isEmpty(oe)&&++oe>g||c.tShift[oe]<c.blkIndent||(C=Pu(c,oe),C<0)||c.level>=c.options.maxNesting)return!1;Y=c.tokens.length,c.tokens.push({type:"dl_open",lines:H=[u,0],level:c.level++}),z=u,o=oe;e:for(;;){for(ut=!0,Ye=!1,c.tokens.push({type:"dt_open",lines:[z,z],level:c.level++}),c.tokens.push({type:"inline",content:c.getLines(z,z+1,c.blkIndent,!1).trim(),level:c.level+1,lines:[z,z],children:[]}),c.tokens.push({type:"dt_close",level:--c.level});;){if(c.tokens.push({type:"dd_open",lines:B=[oe,0],level:c.level++}),Ke=c.tight,Ae=c.ddIndent,Ee=c.blkIndent,Ge=c.tShift[o],Ce=c.parentType,c.blkIndent=c.ddIndent=c.tShift[o]+2,c.tShift[o]=C-c.bMarks[o],c.tight=!0,c.parentType="deflist",c.parser.tokenize(c,o,g,!0),(!c.tight||Ye)&&(ut=!1),Ye=c.line-o>1&&c.isEmpty(c.line-1),c.tShift[o]=Ge,c.tight=Ke,c.parentType=Ce,c.blkIndent=Ee,c.ddIndent=Ae,c.tokens.push({type:"dd_close",level:--c.level}),B[1]=oe=c.line,oe>=g||c.tShift[oe]<c.blkIndent)break e;if(C=Pu(c,oe),C<0)break;o=oe}if(oe>=g||(z=oe,c.isEmpty(z))||c.tShift[z]<c.blkIndent||(o=z+1,o>=g)||(c.isEmpty(o)&&o++,o>=g)||c.tShift[o]<c.blkIndent||(C=Pu(c,o),C<0))break}return c.tokens.push({type:"dl_close",level:--c.level}),H[1]=oe,c.line=oe,ut&&Av(c,Y),!0}function Iv(c,u){var g,v,C,o,z,B=u+1,H;if(g=c.lineMax,B<g&&!c.isEmpty(B)){for(H=c.parser.ruler.getRules("paragraph");B<g&&!c.isEmpty(B);B++)if(!(c.tShift[B]-c.blkIndent>3)){for(C=!1,o=0,z=H.length;o<z;o++)if(H[o](c,B,g,!0)){C=!0;break}if(C)break}}return v=c.getLines(u,B,c.blkIndent,!1).trim(),c.line=B,v.length&&(c.tokens.push({type:"paragraph_open",tight:!1,lines:[u,c.line],level:c.level}),c.tokens.push({type:"inline",content:v,level:c.level+1,lines:[u,c.line],children:[]}),c.tokens.push({type:"paragraph_close",tight:!1,level:c.level})),!0}var Du=[["code",fv],["fences",mv,["paragraph","blockquote","list"]],["blockquote",gv,["paragraph","blockquote","list"]],["hr",_v,["paragraph","blockquote","list"]],["list",xv,["paragraph","blockquote"]],["footnote",vv,["paragraph"]],["heading",bv,["paragraph","blockquote"]],["lheading",wv],["htmlblock",kv,["paragraph","blockquote"]],["table",Sv,["paragraph"]],["deflist",Mv,["paragraph"]],["paragraph",Iv]];function $d(){this.ruler=new Lr;for(var c=0;c<Du.length;c++)this.ruler.push(Du[c][0],Du[c][1],{alt:(Du[c][2]||[]).slice()})}$d.prototype.tokenize=function(c,u,g){for(var v=this.ruler.getRules(""),C=v.length,o=u,z=!1,B,H;o<g&&(c.line=o=c.skipEmptyLines(o),!(o>=g||c.tShift[o]<c.blkIndent));){for(H=0;H<C&&(B=v[H](c,o,g,!1),!B);H++);if(c.tight=!z,c.isEmpty(c.line-1)&&(z=!0),o=c.line,o<g&&c.isEmpty(o)){if(z=!0,o++,o<g&&c.parentType==="list"&&c.isEmpty(o))break;c.line=o}}};var zv=/[\n\t]/g,Pv=/\r[\n\u0085]|[\u2424\u2028\u0085]/g,Dv=/\u00a0/g;$d.prototype.parse=function(c,u,g,v){var C,o=0,z=0;if(!c)return[];c=c.replace(Dv," "),c=c.replace(Pv,`
`),c.indexOf("	")>=0&&(c=c.replace(zv,function(B,H){var Y;return c.charCodeAt(H)===10?(o=H+1,z=0,B):(Y="    ".slice((H-o-z)%4),z=H-o+1,Y)})),C=new Vs(c,this,u,g,v),this.tokenize(C,C.line,C.lineMax)};function Lv(c){switch(c){case 10:case 92:case 96:case 42:case 95:case 94:case 91:case 93:case 33:case 38:case 60:case 62:case 123:case 125:case 36:case 37:case 64:case 126:case 43:case 61:case 58:return!0;default:return!1}}function Bv(c,u){for(var g=c.pos;g<c.posMax&&!Lv(c.src.charCodeAt(g));)g++;return g===c.pos?!1:(u||(c.pending+=c.src.slice(c.pos,g)),c.pos=g,!0)}function Rv(c,u){var g,v,C=c.pos;if(c.src.charCodeAt(C)!==10)return!1;if(g=c.pending.length-1,v=c.posMax,!u)if(g>=0&&c.pending.charCodeAt(g)===32)if(g>=1&&c.pending.charCodeAt(g-1)===32){for(var o=g-2;o>=0;o--)if(c.pending.charCodeAt(o)!==32){c.pending=c.pending.substring(0,o+1);break}c.push({type:"hardbreak",level:c.level})}else c.pending=c.pending.slice(0,-1),c.push({type:"softbreak",level:c.level});else c.push({type:"softbreak",level:c.level});for(C++;C<v&&c.src.charCodeAt(C)===32;)C++;return c.pos=C,!0}var qd=[];for(jd=0;jd<256;jd++)qd.push(0);var jd;"\\!\"#$%&'()*+,./:;<=>?@[]^_`{|}~-".split("").forEach(function(c){qd[c.charCodeAt(0)]=1});function Fv(c,u){var g,v=c.pos,C=c.posMax;if(c.src.charCodeAt(v)!==92)return!1;if(v++,v<C){if(g=c.src.charCodeAt(v),g<256&&qd[g]!==0)return u||(c.pending+=c.src[v]),c.pos+=2,!0;if(g===10){for(u||c.push({type:"hardbreak",level:c.level}),v++;v<C&&c.src.charCodeAt(v)===32;)v++;return c.pos=v,!0}}return u||(c.pending+="\\"),c.pos++,!0}function Ov(c,u){var g,v,C,o,z,B=c.pos,H=c.src.charCodeAt(B);if(H!==96)return!1;for(g=B,B++,v=c.posMax;B<v&&c.src.charCodeAt(B)===96;)B++;for(C=c.src.slice(g,B),o=z=B;(o=c.src.indexOf("`",z))!==-1;){for(z=o+1;z<v&&c.src.charCodeAt(z)===96;)z++;if(z-o===C.length)return u||c.push({type:"code",content:c.src.slice(B,o).replace(/[ \n]+/g," ").trim(),block:!1,level:c.level}),c.pos=z,!0}return u||(c.pending+=C),c.pos+=C.length,!0}function jv(c,u){var g,v,C,o=c.posMax,z=c.pos,B,H;if(c.src.charCodeAt(z)!==126||u||z+4>=o||c.src.charCodeAt(z+1)!==126||c.level>=c.options.maxNesting||(B=z>0?c.src.charCodeAt(z-1):-1,H=c.src.charCodeAt(z+2),B===126)||H===126||H===32||H===10)return!1;for(v=z+2;v<o&&c.src.charCodeAt(v)===126;)v++;if(v>z+3)return c.pos+=v-z,u||(c.pending+=c.src.slice(z,v)),!0;for(c.pos=z+2,C=1;c.pos+1<o;){if(c.src.charCodeAt(c.pos)===126&&c.src.charCodeAt(c.pos+1)===126&&(B=c.src.charCodeAt(c.pos-1),H=c.pos+2<o?c.src.charCodeAt(c.pos+2):-1,H!==126&&B!==126&&(B!==32&&B!==10?C--:H!==32&&H!==10&&C++,C<=0))){g=!0;break}c.parser.skipToken(c)}return g?(c.posMax=c.pos,c.pos=z+2,u||(c.push({type:"del_open",level:c.level++}),c.parser.tokenize(c),c.push({type:"del_close",level:--c.level})),c.pos=c.posMax+2,c.posMax=o,!0):(c.pos=z,!1)}function Uv(c,u){var g,v,C,o=c.posMax,z=c.pos,B,H;if(c.src.charCodeAt(z)!==43||u||z+4>=o||c.src.charCodeAt(z+1)!==43||c.level>=c.options.maxNesting||(B=z>0?c.src.charCodeAt(z-1):-1,H=c.src.charCodeAt(z+2),B===43)||H===43||H===32||H===10)return!1;for(v=z+2;v<o&&c.src.charCodeAt(v)===43;)v++;if(v!==z+2)return c.pos+=v-z,u||(c.pending+=c.src.slice(z,v)),!0;for(c.pos=z+2,C=1;c.pos+1<o;){if(c.src.charCodeAt(c.pos)===43&&c.src.charCodeAt(c.pos+1)===43&&(B=c.src.charCodeAt(c.pos-1),H=c.pos+2<o?c.src.charCodeAt(c.pos+2):-1,H!==43&&B!==43&&(B!==32&&B!==10?C--:H!==32&&H!==10&&C++,C<=0))){g=!0;break}c.parser.skipToken(c)}return g?(c.posMax=c.pos,c.pos=z+2,u||(c.push({type:"ins_open",level:c.level++}),c.parser.tokenize(c),c.push({type:"ins_close",level:--c.level})),c.pos=c.posMax+2,c.posMax=o,!0):(c.pos=z,!1)}function Vv(c,u){var g,v,C,o=c.posMax,z=c.pos,B,H;if(c.src.charCodeAt(z)!==61||u||z+4>=o||c.src.charCodeAt(z+1)!==61||c.level>=c.options.maxNesting||(B=z>0?c.src.charCodeAt(z-1):-1,H=c.src.charCodeAt(z+2),B===61)||H===61||H===32||H===10)return!1;for(v=z+2;v<o&&c.src.charCodeAt(v)===61;)v++;if(v!==z+2)return c.pos+=v-z,u||(c.pending+=c.src.slice(z,v)),!0;for(c.pos=z+2,C=1;c.pos+1<o;){if(c.src.charCodeAt(c.pos)===61&&c.src.charCodeAt(c.pos+1)===61&&(B=c.src.charCodeAt(c.pos-1),H=c.pos+2<o?c.src.charCodeAt(c.pos+2):-1,H!==61&&B!==61&&(B!==32&&B!==10?C--:H!==32&&H!==10&&C++,C<=0))){g=!0;break}c.parser.skipToken(c)}return g?(c.posMax=c.pos,c.pos=z+2,u||(c.push({type:"mark_open",level:c.level++}),c.parser.tokenize(c),c.push({type:"mark_close",level:--c.level})),c.pos=c.posMax+2,c.posMax=o,!0):(c.pos=z,!1)}function O_(c){return c>=48&&c<=57||c>=65&&c<=90||c>=97&&c<=122}function j_(c,u){var g=u,v,C,o,z=!0,B=!0,H=c.posMax,Y=c.src.charCodeAt(u);for(v=u>0?c.src.charCodeAt(u-1):-1;g<H&&c.src.charCodeAt(g)===Y;)g++;return g>=H&&(z=!1),o=g-u,o>=4?z=B=!1:(C=g<H?c.src.charCodeAt(g):-1,(C===32||C===10)&&(z=!1),(v===32||v===10)&&(B=!1),Y===95&&(O_(v)&&(z=!1),O_(C)&&(B=!1))),{can_open:z,can_close:B,delims:o}}function Nv(c,u){var g,v,C,o,z,B,H,Y=c.posMax,oe=c.pos,Ee=c.src.charCodeAt(oe);if(Ee!==95&&Ee!==42||u)return!1;if(H=j_(c,oe),g=H.delims,!H.can_open)return c.pos+=g,u||(c.pending+=c.src.slice(oe,c.pos)),!0;if(c.level>=c.options.maxNesting)return!1;for(c.pos=oe+g,B=[g];c.pos<Y;){if(c.src.charCodeAt(c.pos)===Ee){if(H=j_(c,c.pos),v=H.delims,H.can_close){for(o=B.pop(),z=v;o!==z;){if(z<o){B.push(o-z);break}if(z-=o,B.length===0)break;c.pos+=o,o=B.pop()}if(B.length===0){g=o,C=!0;break}c.pos+=v;continue}H.can_open&&B.push(v),c.pos+=v;continue}c.parser.skipToken(c)}return C?(c.posMax=c.pos,c.pos=oe+g,u||((g===2||g===3)&&c.push({type:"strong_open",level:c.level++}),(g===1||g===3)&&c.push({type:"em_open",level:c.level++}),c.parser.tokenize(c),(g===1||g===3)&&c.push({type:"em_close",level:--c.level}),(g===2||g===3)&&c.push({type:"strong_close",level:--c.level})),c.pos=c.posMax+g,c.posMax=Y,!0):(c.pos=oe,!1)}var Gv=/\\([ \\!"#$%&'()*+,.\/:;<=>?@[\]^_`{|}~-])/g;function $v(c,u){var g,v,C=c.posMax,o=c.pos;if(c.src.charCodeAt(o)!==126||u||o+2>=C||c.level>=c.options.maxNesting)return!1;for(c.pos=o+1;c.pos<C;){if(c.src.charCodeAt(c.pos)===126){g=!0;break}c.parser.skipToken(c)}return!g||o+1===c.pos||(v=c.src.slice(o+1,c.pos),v.match(/(^|[^\\])(\\\\)*\s/))?(c.pos=o,!1):(c.posMax=c.pos,c.pos=o+1,u||c.push({type:"sub",level:c.level,content:v.replace(Gv,"$1")}),c.pos=c.posMax+1,c.posMax=C,!0)}var qv=/\\([ \\!"#$%&'()*+,.\/:;<=>?@[\]^_`{|}~-])/g;function Zv(c,u){var g,v,C=c.posMax,o=c.pos;if(c.src.charCodeAt(o)!==94||u||o+2>=C||c.level>=c.options.maxNesting)return!1;for(c.pos=o+1;c.pos<C;){if(c.src.charCodeAt(c.pos)===94){g=!0;break}c.parser.skipToken(c)}return!g||o+1===c.pos||(v=c.src.slice(o+1,c.pos),v.match(/(^|[^\\])(\\\\)*\s/))?(c.pos=o,!1):(c.posMax=c.pos,c.pos=o+1,u||c.push({type:"sup",level:c.level,content:v.replace(qv,"$1")}),c.pos=c.posMax+1,c.posMax=C,!0)}function Wv(c,u){var g,v,C,o,z,B,H,Y,oe=!1,Ee=c.pos,Ae=c.posMax,Ce=c.pos,Ge=c.src.charCodeAt(Ce);if(Ge===33&&(oe=!0,Ge=c.src.charCodeAt(++Ce)),Ge!==91||c.level>=c.options.maxNesting||(g=Ce+1,v=Pc(c,Ce),v<0))return!1;if(B=v+1,B<Ae&&c.src.charCodeAt(B)===40){for(B++;B<Ae&&(Y=c.src.charCodeAt(B),!(Y!==32&&Y!==10));B++);if(B>=Ae)return!1;for(Ce=B,$_(c,B)?(o=c.linkContent,B=c.pos):o="",Ce=B;B<Ae&&(Y=c.src.charCodeAt(B),!(Y!==32&&Y!==10));B++);if(B<Ae&&Ce!==B&&q_(c,B))for(z=c.linkContent,B=c.pos;B<Ae&&(Y=c.src.charCodeAt(B),!(Y!==32&&Y!==10));B++);else z="";if(B>=Ae||c.src.charCodeAt(B)!==41)return c.pos=Ee,!1;B++}else{if(c.linkLevel>0)return!1;for(;B<Ae&&(Y=c.src.charCodeAt(B),!(Y!==32&&Y!==10));B++);if(B<Ae&&c.src.charCodeAt(B)===91&&(Ce=B+1,B=Pc(c,B),B>=0?C=c.src.slice(Ce,B++):B=Ce-1),C||(typeof C>"u"&&(B=v+1),C=c.src.slice(g,v)),H=c.env.references[Z_(C)],!H)return c.pos=Ee,!1;o=H.href,z=H.title}return u||(c.pos=g,c.posMax=v,oe?c.push({type:"image",src:o,title:z,alt:c.src.substr(g,v-g),level:c.level}):(c.push({type:"link_open",href:o,title:z,level:c.level++}),c.linkLevel++,c.parser.tokenize(c),c.linkLevel--,c.push({type:"link_close",level:--c.level}))),c.pos=B,c.posMax=Ae,!0}function Hv(c,u){var g,v,C,o,z=c.posMax,B=c.pos;return B+2>=z||c.src.charCodeAt(B)!==94||c.src.charCodeAt(B+1)!==91||c.level>=c.options.maxNesting||(g=B+2,v=Pc(c,B+1),v<0)?!1:(u||(c.env.footnotes||(c.env.footnotes={}),c.env.footnotes.list||(c.env.footnotes.list=[]),C=c.env.footnotes.list.length,c.pos=g,c.posMax=v,c.push({type:"footnote_ref",id:C,level:c.level}),c.linkLevel++,o=c.tokens.length,c.parser.tokenize(c),c.env.footnotes.list[C]={tokens:c.tokens.splice(o)},c.linkLevel--),c.pos=v+1,c.posMax=z,!0)}function Xv(c,u){var g,v,C,o,z=c.posMax,B=c.pos;if(B+3>z||!c.env.footnotes||!c.env.footnotes.refs||c.src.charCodeAt(B)!==91||c.src.charCodeAt(B+1)!==94||c.level>=c.options.maxNesting)return!1;for(v=B+2;v<z;v++){if(c.src.charCodeAt(v)===32||c.src.charCodeAt(v)===10)return!1;if(c.src.charCodeAt(v)===93)break}return v===B+2||v>=z||(v++,g=c.src.slice(B+2,v-1),typeof c.env.footnotes.refs[":"+g]>"u")?!1:(u||(c.env.footnotes.list||(c.env.footnotes.list=[]),c.env.footnotes.refs[":"+g]<0?(C=c.env.footnotes.list.length,c.env.footnotes.list[C]={label:g,count:0},c.env.footnotes.refs[":"+g]=C):C=c.env.footnotes.refs[":"+g],o=c.env.footnotes.list[C].count,c.env.footnotes.list[C].count++,c.push({type:"footnote_ref",id:C,subId:o,level:c.level})),c.pos=v,c.posMax=z,!0)}var Kv=["coap","doi","javascript","aaa","aaas","about","acap","cap","cid","crid","data","dav","dict","dns","file","ftp","geo","go","gopher","h323","http","https","iax","icap","im","imap","info","ipp","iris","iris.beep","iris.xpc","iris.xpcs","iris.lwz","ldap","mailto","mid","msrp","msrps","mtqp","mupdate","news","nfs","ni","nih","nntp","opaquelocktoken","pop","pres","rtsp","service","session","shttp","sieve","sip","sips","sms","snmp","soap.beep","soap.beeps","tag","tel","telnet","tftp","thismessage","tn3270","tip","tv","urn","vemmi","ws","wss","xcon","xcon-userid","xmlrpc.beep","xmlrpc.beeps","xmpp","z39.50r","z39.50s","adiumxtra","afp","afs","aim","apt","attachment","aw","beshare","bitcoin","bolo","callto","chrome","chrome-extension","com-eventbrite-attendee","content","cvs","dlna-playsingle","dlna-playcontainer","dtn","dvb","ed2k","facetime","feed","finger","fish","gg","git","gizmoproject","gtalk","hcp","icon","ipn","irc","irc6","ircs","itms","jar","jms","keyparc","lastfm","ldaps","magnet","maps","market","message","mms","ms-help","msnim","mumble","mvn","notes","oid","palm","paparazzi","platform","proxy","psyc","query","res","resource","rmi","rsync","rtmp","secondlife","sftp","sgn","skype","smb","soldat","spotify","ssh","steam","svn","teamspeak","things","udp","unreal","ut2004","ventrilo","view-source","webcal","wtai","wyciwyg","xfire","xri","ymsgr"],Yv=/^<([a-zA-Z0-9.!#$%&'*+\/=?^_`{|}~-]+@[a-zA-Z0-9](?:[a-zA-Z0-9-]{0,61}[a-zA-Z0-9])?(?:\.[a-zA-Z0-9](?:[a-zA-Z0-9-]{0,61}[a-zA-Z0-9])?)*)>/,Jv=/^<([a-zA-Z.\-]{1,25}):([^<>\x00-\x20]*)>/;function Qv(c,u){var g,v,C,o,z,B=c.pos;return c.src.charCodeAt(B)!==60||(g=c.src.slice(B),g.indexOf(">")<0)?!1:(v=g.match(Jv),v?Kv.indexOf(v[1].toLowerCase())<0||(o=v[0].slice(1,-1),z=Nd(o),!c.parser.validateLink(o))?!1:(u||(c.push({type:"link_open",href:z,level:c.level}),c.push({type:"text",content:o,level:c.level+1}),c.push({type:"link_close",level:c.level})),c.pos+=v[0].length,!0):(C=g.match(Yv),C?(o=C[0].slice(1,-1),z=Nd("mailto:"+o),c.parser.validateLink(z)?(u||(c.push({type:"link_open",href:z,level:c.level}),c.push({type:"text",content:o,level:c.level+1}),c.push({type:"link_close",level:c.level})),c.pos+=C[0].length,!0):!1):!1))}function Lu(c,u){return c=c.source,u=u||"",function g(v,C){return v?(C=C.source||C,c=c.replace(v,C),g):new RegExp(c,u)}}var eb=/[a-zA-Z_:][a-zA-Z0-9:._-]*/,tb=/[^"'=<>`\x00-\x20]+/,ib=/'[^']*'/,rb=/"[^"]*"/,nb=Lu(/(?:unquoted|single_quoted|double_quoted)/)("unquoted",tb)("single_quoted",ib)("double_quoted",rb)(),ob=Lu(/(?:\s+attr_name(?:\s*=\s*attr_value)?)/)("attr_name",eb)("attr_value",nb)(),sb=Lu(/<[A-Za-z][A-Za-z0-9]*attribute*\s*\/?>/)("attribute",ob)(),ab=/<\/[A-Za-z][A-Za-z0-9]*\s*>/,lb=/<!---->|<!--(?:-?[^>-])(?:-?[^-])*-->/,cb=/<[?].*?[?]>/,hb=/<![A-Z]+\s+[^>]*>/,ub=/<!\[CDATA\[[\s\S]*?\]\]>/,pb=Lu(/^(?:open_tag|close_tag|comment|processing|declaration|cdata)/)("open_tag",sb)("close_tag",ab)("comment",lb)("processing",cb)("declaration",hb)("cdata",ub)();function db(c){var u=c|32;return u>=97&&u<=122}function fb(c,u){var g,v,C,o=c.pos;return!c.options.html||(C=c.posMax,c.src.charCodeAt(o)!==60||o+2>=C)||(g=c.src.charCodeAt(o+1),g!==33&&g!==63&&g!==47&&!db(g))||(v=c.src.slice(o).match(pb),!v)?!1:(u||c.push({type:"htmltag",content:c.src.slice(o,o+v[0].length),level:c.level}),c.pos+=v[0].length,!0)}var mb=/^&#((?:x[a-f0-9]{1,8}|[0-9]{1,8}));/i,gb=/^&([a-z][a-z0-9]{1,31});/i;function _b(c,u){var g,v,C,o=c.pos,z=c.posMax;if(c.src.charCodeAt(o)!==38)return!1;if(o+1<z){if(g=c.src.charCodeAt(o+1),g===35){if(C=c.src.slice(o).match(mb),C)return u||(v=C[1][0].toLowerCase()==="x"?parseInt(C[1].slice(1),16):parseInt(C[1],10),c.pending+=N_(v)?Vd(v):Vd(65533)),c.pos+=C[0].length,!0}else if(C=c.src.slice(o).match(gb),C){var B=U_(C[1]);if(C[1]!==B)return u||(c.pending+=B),c.pos+=C[0].length,!0}}return u||(c.pending+="&"),c.pos++,!0}var Ud=[["text",Bv],["newline",Rv],["escape",Fv],["backticks",Ov],["del",jv],["ins",Uv],["mark",Vv],["emphasis",Nv],["sub",$v],["sup",Zv],["links",Wv],["footnote_inline",Hv],["footnote_ref",Xv],["autolink",Qv],["htmltag",fb],["entity",_b]];function Bu(){this.ruler=new Lr;for(var c=0;c<Ud.length;c++)this.ruler.push(Ud[c][0],Ud[c][1]);this.validateLink=yb}Bu.prototype.skipToken=function(c){var u=this.ruler.getRules(""),g=u.length,v=c.pos,C,o;if((o=c.cacheGet(v))>0){c.pos=o;return}for(C=0;C<g;C++)if(u[C](c,!0)){c.cacheSet(v,c.pos);return}c.pos++,c.cacheSet(v,c.pos)};Bu.prototype.tokenize=function(c){for(var u=this.ruler.getRules(""),g=u.length,v=c.posMax,C,o;c.pos<v;){for(o=0;o<g&&(C=u[o](c,!1),!C);o++);if(C){if(c.pos>=v)break;continue}c.pending+=c.src[c.pos++]}c.pending&&c.pushPending()};Bu.prototype.parse=function(c,u,g,v){var C=new Us(c,this,u,g,v);this.tokenize(C)};function yb(c){var u=["vbscript","javascript","file","data"],g=c.trim().toLowerCase();return g=Os(g),!(g.indexOf(":")!==-1&&u.indexOf(g.split(":")[0])!==-1)}var xb={options:{html:!1,xhtmlOut:!1,breaks:!1,langPrefix:"language-",linkTarget:"",typographer:!1,quotes:"\u201C\u201D\u2018\u2019",highlight:null,maxNesting:20},components:{core:{rules:["block","inline","references","replacements","smartquotes","references","abbr2","footnote_tail"]},block:{rules:["blockquote","code","fences","footnote","heading","hr","htmlblock","lheading","list","paragraph","table"]},inline:{rules:["autolink","backticks","del","emphasis","entity","escape","footnote_ref","htmltag","links","newline","text"]}}},vb={options:{html:!1,xhtmlOut:!1,breaks:!1,langPrefix:"language-",linkTarget:"",typographer:!1,quotes:"\u201C\u201D\u2018\u2019",highlight:null,maxNesting:20},components:{core:{},block:{},inline:{}}},bb={options:{html:!0,xhtmlOut:!0,breaks:!1,langPrefix:"language-",linkTarget:"",typographer:!1,quotes:"\u201C\u201D\u2018\u2019",highlight:null,maxNesting:20},components:{core:{rules:["block","inline","references","abbr2"]},block:{rules:["blockquote","code","fences","heading","hr","htmlblock","lheading","list","paragraph"]},inline:{rules:["autolink","backticks","emphasis","entity","escape","htmltag","links","newline","text"]}}},wb={default:xb,full:vb,commonmark:bb};function X_(c,u,g){this.src=u,this.env=g,this.options=c.options,this.tokens=[],this.inlineMode=!1,this.inline=c.inline,this.block=c.block,this.renderer=c.renderer,this.typographer=c.typographer}function Jn(c,u){typeof c!="string"&&(u=c,c="default"),u&&u.linkify!=null&&console.warn(`linkify option is removed. Use linkify plugin instead:

import Remarkable from 'remarkable';
import linkify from 'remarkable/linkify';
new Remarkable().use(linkify)
`),this.inline=new Bu,this.block=new $d,this.core=new W_,this.renderer=new Gd,this.ruler=new Lr,this.options={},this.configure(wb[c]),this.set(u||{})}Jn.prototype.set=function(c){V_(this.options,c)};Jn.prototype.configure=function(c){var u=this;if(!c)throw new Error("Wrong `remarkable` preset, check name/content");c.options&&u.set(c.options),c.components&&Object.keys(c.components).forEach(function(g){c.components[g].rules&&u[g].ruler.enable(c.components[g].rules,!0)})};Jn.prototype.use=function(c,u){return c(this,u),this};Jn.prototype.parse=function(c,u){var g=new X_(this,c,u);return this.core.process(g),g.tokens};Jn.prototype.render=function(c,u){return u=u||{},this.renderer.render(this.parse(c,u),this.options,u)};Jn.prototype.parseInline=function(c,u){var g=new X_(this,c,u);return g.inlineMode=!0,this.core.process(g),g.tokens};Jn.prototype.renderInline=function(c,u){return u=u||{},this.renderer.render(this.parseInline(c,u),this.options,u)};function kt(c,u,g,v){return new(g||(g=Promise))(function(C,o){function z(Y){try{H(v.next(Y))}catch(oe){o(oe)}}function B(Y){try{H(v.throw(Y))}catch(oe){o(oe)}}function H(Y){var oe;Y.done?C(Y.value):(oe=Y.value,oe instanceof g?oe:new g(function(Ee){Ee(oe)})).then(z,B)}H((v=v.apply(c,u||[])).next())})}function Mi(c,u,g,v){if(g==="a"&&!v)throw new TypeError("Private accessor was defined without a getter");if(typeof u=="function"?c!==u||!v:!u.has(c))throw new TypeError("Cannot read private member from an object whose class did not declare it");return g==="m"?v:g==="a"?v.call(c):v?v.value:u.get(c)}function Kd(c,u,g,v,C){if(v==="m")throw new TypeError("Private method is not writable");if(v==="a"&&!C)throw new TypeError("Private accessor was defined without a setter");if(typeof u=="function"?c!==u||!C:!u.has(c))throw new TypeError("Cannot write private member to an object whose class did not declare it");return v==="a"?C.call(c,g):C?C.value=g:u.set(c,g),g}async function Sf(c,u={}){let{local:g=!1,version:v="latest",cdnUrl:C,...o}=u,z=function(Ae,Ce,Ge){let Ke=`https://cdn.jsdelivr.net/npm/emojibase-data@${Ce}/${Ae}`;return typeof Ge=="function"?Ke=Ge(Ae,Ce):typeof Ge=="string"&&(Ke=`${Ge}/${Ae}`),Ke}(c,v,C),B=g?localStorage:sessionStorage,H=`emojibase/${v}/${c}`,Y=B.getItem(H);if(Y)return Promise.resolve(JSON.parse(Y));let oe=await fetch(z,{credentials:"omit",mode:"cors",redirect:"error",...o});if(!oe.ok)throw new Error("Failed to load Emojibase dataset.");let Ee=await oe.json();try{B.setItem(H,JSON.stringify(Ee))}catch{}return Ee}var Eb={discord:"joypixels",slack:"iamcal"};async function K_(c,u,g){var v;return Sf(`${c}/shortcodes/${(v=Eb[u])!==null&&v!==void 0?v:u}.json`,g)}function Bc(c,u){if(u.length===0)return c;let g=new Set(c.shortcodes);return u.forEach(v=>{let C=v[c.hexcode];Array.isArray(C)?C.forEach(o=>g.add(o)):C&&g.add(C)}),c.shortcodes=[...g],c.skins&&c.skins.forEach(v=>{Bc(v,u)}),c}async function Y_(c,u={}){let{compact:g=!1,flat:v=!1,shortcodes:C=[],...o}=u,z=await Sf(`${c}/${g?"compact":"data"}.json`,o),B=[];return C.length>0&&(B=await Promise.all(C.map(H=>{let Y;if(H.includes("/")){let[oe,Ee]=H.split("/");Y=K_(oe,Ee,o)}else Y=K_(c,H,o);return Y.catch(()=>({}))}))),v?function(H,Y=[]){let oe=[];return H.forEach(Ee=>{if(Ee.skins){let{skins:Ae,...Ce}=Ee;oe.push(Bc(Ce,Y)),Ae.forEach(Ge=>{let Ke={...Ge};Ce.tags&&(Ke.tags=[...Ce.tags]),oe.push(Bc(Ke,Y))})}else oe.push(Bc(Ee,Y))}),oe}(z,B):function(H,Y){return Y.length===0||H.forEach(oe=>{Bc(oe,Y)}),H}(z,B)}async function J_(c,u){return Sf(`${c}/messages.json`,u)}function Zd(c,u){let g=c.target.closest("[data-emoji]");if(g){let v=u.find(C=>C.emoji===g.dataset.emoji);if(v)return v}return null}function cy(c){var u;let g=(u=window.matchMedia)===null||u===void 0?void 0:u.call(window,"(prefers-reduced-motion: reduce)");return c.animate&&!g?.matches}function Q_(c,u){return c.toLowerCase().includes(u.toLowerCase())}function Tb(c,u){let g=null;return()=>{g||(g=window.setTimeout(()=>{c(),g=null},u))}}function Cb(c,u){let g=null;return(...v)=>{g&&window.clearTimeout(g),g=window.setTimeout(()=>{c(...v),g=null},u)}}function Gs(c,u,g,v){return cy(v)&&c.animate?c.animate(u,g).finished:Promise.resolve()}function Yd(c){var u;let g=document.createElement("template");return g.innerHTML=c,(u=g.content)===null||u===void 0?void 0:u.firstElementChild}function kb(c){return kt(this,void 0,void 0,function*(){let u=new TextEncoder().encode(c),g=yield crypto.subtle.digest("SHA-256",u);return Array.from(new Uint8Array(g)).map(v=>v.toString(16).padStart(2,"0")).join("")})}function ey(c){return kt(this,void 0,void 0,function*(){try{return(yield fetch(c,{method:"HEAD"})).headers.get("etag")}catch{return null}})}function hy(c,u,g){return kt(this,void 0,void 0,function*(){let v=g||u(c);return yield v.open(),v})}function Sb(c,u,g){return kt(this,void 0,void 0,function*(){let v=yield hy(c,u,g),[C,o]=yield function(z){let{emojisUrl:B,messagesUrl:H}=function(Y,oe){let Ee=`https://cdn.jsdelivr.net/npm/emojibase-data@latest/${oe}`;return{emojisUrl:`${Ee}/data.json`,messagesUrl:`${Ee}/messages.json`}}(0,z);try{return Promise.all([ey(B),ey(H)])}catch{return Promise.all([null,null])}}(c);if(yield v.isPopulated())C&&o&&(yield function(z,B,H){return kt(this,void 0,void 0,function*(){let Y;try{Y=yield z.getEtags()}catch{Y={}}let{storedEmojisEtag:oe,storedMessagesEtag:Ee}=Y;if(H!==Ee||B!==oe){let[Ae,Ce]=yield Promise.all([J_(z.locale),Y_(z.locale)]);yield z.populate({groups:Ae.groups,emojis:Ce,emojisEtag:B,messagesEtag:H})}})}(v,C,o));else{let[z,B]=yield Promise.all([J_(c),Y_(c)]);yield v.populate({groups:z.groups,emojis:B,emojisEtag:C,messagesEtag:o})}return v})}function Ab(c,u,g,v,C){return kt(this,void 0,void 0,function*(){let o=yield hy(c,u,C),z=yield kb(v);return(yield o.isPopulated())&&!(yield function(B,H){return kt(this,void 0,void 0,function*(){let Y=yield B.getHash();return H!==Y})}(o,z))||(yield o.populate({groups:g.groups,emojis:v,hash:z})),o})}function uy(c,u,g,v,C){return kt(this,void 0,void 0,function*(){return g&&v?Ab(c,u,g,v,C):Sb(c,u,C)})}var Fc=class{constructor(){this.handleKeyDown=this.handleKeyDown.bind(this)}activate(u){this.rootElement=u,this.rootElement.addEventListener("keydown",this.handleKeyDown)}deactivate(){var u;(u=this.rootElement)===null||u===void 0||u.removeEventListener("keydown",this.handleKeyDown)}get focusableElements(){return this.rootElement.querySelectorAll('input, [tabindex="0"]')}get lastFocusableElement(){return this.focusableElements[this.focusableElements.length-1]}get firstFocusableElement(){return this.focusableElements[0]}checkFocus(u,g,v){u.target===g&&(v.focus(),u.preventDefault())}handleKeyDown(u){u.key==="Tab"&&this.checkFocus(u,u.shiftKey?this.firstFocusableElement:this.lastFocusableElement,u.shiftKey?this.lastFocusableElement:this.firstFocusableElement)}},St=class{constructor({template:u,classes:g,parent:v}){this.isDestroyed=!1,this.appEvents={},this.uiEvents=[],this.uiElements={},this.ui={},this.template=u,this.classes=g,this.parent=v,this.keyBindingHandler=this.keyBindingHandler.bind(this)}initialize(){this.bindAppEvents()}setCustomEmojis(u){this.customEmojis=u}setEvents(u){this.events=u}setPickerId(u){this.pickerId=u}emit(u,...g){this.events.emit(u,...g)}setI18n(u){this.i18n=u}setRenderer(u){this.renderer=u}setEmojiData(u){this.emojiDataPromise=u,u.then(g=>{this.emojiData=g})}updateEmojiData(u){this.emojiData=u,this.emojiDataPromise=Promise.resolve(u)}setOptions(u){this.options=u}renderSync(u={}){return this.el=this.template.renderSync(Object.assign({classes:this.classes,i18n:this.i18n,pickerId:this.pickerId},u)),this.postRender(),this.el}render(u={}){return kt(this,void 0,void 0,function*(){return yield this.emojiDataPromise,this.el=yield this.template.renderAsync(Object.assign({classes:this.classes,i18n:this.i18n,pickerId:this.pickerId},u)),this.postRender(),this.el})}postRender(){this.bindUIElements(),this.bindKeyBindings(),this.bindUIEvents(),this.scheduleShowAnimation()}bindAppEvents(){Object.keys(this.appEvents).forEach(u=>{this.events.on(u,this.appEvents[u],this)}),this.events.on("data:ready",this.updateEmojiData,this)}unbindAppEvents(){Object.keys(this.appEvents).forEach(u=>{this.events.off(u,this.appEvents[u])}),this.events.off("data:ready",this.updateEmojiData)}keyBindingHandler(u){let g=this.keyBindings[u.key];g&&g.call(this,u)}bindKeyBindings(){this.keyBindings&&this.el.addEventListener("keydown",this.keyBindingHandler)}unbindKeyBindings(){this.keyBindings&&this.el.removeEventListener("keydown",this.keyBindingHandler)}bindUIElements(){this.ui=Object.keys(this.uiElements).reduce((u,g)=>Object.assign(Object.assign({},u),{[g]:this.el.querySelector(this.uiElements[g])}),{})}bindUIEvents(){this.uiEvents.forEach(u=>{u.handler=u.handler.bind(this),(u.target?this.ui[u.target]:this.el).addEventListener(u.event,u.handler,u.options)})}unbindUIEvents(){this.uiEvents.forEach(u=>{(u.target?this.ui[u.target]:this.el).removeEventListener(u.event,u.handler)})}destroy(){this.unbindAppEvents(),this.unbindUIEvents(),this.unbindKeyBindings(),this.el.remove(),this.isDestroyed=!0}scheduleShowAnimation(){if(this.parent){let u=new MutationObserver(g=>{let[v]=g;v.type==="childList"&&v.addedNodes[0]===this.el&&(cy(this.options)&&this.animateShow&&this.animateShow(),u.disconnect)});u.observe(this.parent,{childList:!0})}}static childEvent(u,g,v,C={}){return{target:u,event:g,handler:v,options:C}}static uiEvent(u,g,v={}){return{event:u,handler:g,options:v}}static byClass(u){return`.${u}`}};function sr(c,u){u===void 0&&(u={});var g=u.insertAt;if(c&&typeof document<"u"){var v=document.head||document.getElementsByTagName("head")[0],C=document.createElement("style");C.type="text/css",g==="top"&&v.firstChild?v.insertBefore(C,v.firstChild):v.appendChild(C),C.styleSheet?C.styleSheet.cssText=c:C.appendChild(document.createTextNode(c))}}var ty={icon:"icons_icon__YUQ3S","icon-small":"icons_icon-small__fEcU6","icon-medium":"icons_icon-medium__e5lKJ","icon-large":"icons_icon-large__t5mwg","icon-2x":"icons_icon-2x__on8is","icon-3x":"icons_icon-3x__RBDYg","icon-4x":"icons_icon-4x__UjvXP","icon-5x":"icons_icon-5x__zRG9K","icon-8x":"icons_icon-8x__PsCPS","icon-10x":"icons_icon-10x__WLjku"};sr(`.icons_icon__YUQ3S {
  width: 1.25em;
  height: 1em;
  fill: currentColor;
}

.icons_icon-small__fEcU6 {
  font-size: 0.8em;
}

.icons_icon-medium__e5lKJ {
  font-size: 1em;
}

.icons_icon-large__t5mwg {
  font-size: 1.25em;
}

.icons_icon-2x__on8is {
  font-size: 2em;
}

.icons_icon-3x__RBDYg {
  font-size: 3em;
}

.icons_icon-4x__UjvXP {
  font-size: 4em;
}

.icons_icon-5x__zRG9K {
  font-size: 5em;
}

.icons_icon-8x__PsCPS {
  font-size: 8em;
}

.icons_icon-10x__WLjku {
  font-size: 10em;
}`);var iy={clock:'<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 512 512"><!--! Font Awesome Pro 6.1.1 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license (Commercial License) Copyright 2022 Fonticons, Inc. --><path d="M256 512C114.6 512 0 397.4 0 256C0 114.6 114.6 0 256 0C397.4 0 512 114.6 512 256C512 397.4 397.4 512 256 512zM232 256C232 264 236 271.5 242.7 275.1L338.7 339.1C349.7 347.3 364.6 344.3 371.1 333.3C379.3 322.3 376.3 307.4 365.3 300L280 243.2V120C280 106.7 269.3 96 255.1 96C242.7 96 231.1 106.7 231.1 120L232 256z"/></svg>',flag:'<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 512 512"><!--! Font Awesome Pro 6.1.1 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license (Commercial License) Copyright 2022 Fonticons, Inc. --><path d="M64 496C64 504.8 56.75 512 48 512h-32C7.25 512 0 504.8 0 496V32c0-17.75 14.25-32 32-32s32 14.25 32 32V496zM476.3 0c-6.365 0-13.01 1.35-19.34 4.233c-45.69 20.86-79.56 27.94-107.8 27.94c-59.96 0-94.81-31.86-163.9-31.87C160.9 .3055 131.6 4.867 96 15.75v350.5c32-9.984 59.87-14.1 84.85-14.1c73.63 0 124.9 31.78 198.6 31.78c31.91 0 68.02-5.971 111.1-23.09C504.1 355.9 512 344.4 512 332.1V30.73C512 11.1 495.3 0 476.3 0z"/></svg>',frown:'<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 512 512"><!--! Font Awesome Pro 6.1.1 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license (Commercial License) Copyright 2022 Fonticons, Inc. --><path d="M0 256C0 114.6 114.6 0 256 0C397.4 0 512 114.6 512 256C512 397.4 397.4 512 256 512C114.6 512 0 397.4 0 256zM176.4 240C194 240 208.4 225.7 208.4 208C208.4 190.3 194 176 176.4 176C158.7 176 144.4 190.3 144.4 208C144.4 225.7 158.7 240 176.4 240zM336.4 176C318.7 176 304.4 190.3 304.4 208C304.4 225.7 318.7 240 336.4 240C354 240 368.4 225.7 368.4 208C368.4 190.3 354 176 336.4 176zM259.9 369.4C288.8 369.4 316.2 375.2 340.6 385.5C352.9 390.7 366.7 381.3 361.4 369.1C344.8 330.9 305.6 303.1 259.9 303.1C214.3 303.1 175.1 330.8 158.4 369.1C153.1 381.3 166.1 390.6 179.3 385.4C203.7 375.1 231 369.4 259.9 369.4L259.9 369.4z"/></svg>',gamepad:'<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 640 512"><!--! Font Awesome Pro 6.1.1 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license (Commercial License) Copyright 2022 Fonticons, Inc. --><path d="M448 64H192C85.96 64 0 149.1 0 256s85.96 192 192 192h256c106 0 192-85.96 192-192S554 64 448 64zM247.1 280h-32v32c0 13.2-10.78 24-23.98 24c-13.2 0-24.02-10.8-24.02-24v-32L136 279.1C122.8 279.1 111.1 269.2 111.1 256c0-13.2 10.85-24.01 24.05-24.01L167.1 232v-32c0-13.2 10.82-24 24.02-24c13.2 0 23.98 10.8 23.98 24v32h32c13.2 0 24.02 10.8 24.02 24C271.1 269.2 261.2 280 247.1 280zM431.1 344c-22.12 0-39.1-17.87-39.1-39.1s17.87-40 39.1-40s39.1 17.88 39.1 40S454.1 344 431.1 344zM495.1 248c-22.12 0-39.1-17.87-39.1-39.1s17.87-40 39.1-40c22.12 0 39.1 17.88 39.1 40S518.1 248 495.1 248z"/></svg>',lightbulb:'<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 384 512"><!--! Font Awesome Pro 6.1.1 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license (Commercial License) Copyright 2022 Fonticons, Inc. --><path d="M112.1 454.3c0 6.297 1.816 12.44 5.284 17.69l17.14 25.69c5.25 7.875 17.17 14.28 26.64 14.28h61.67c9.438 0 21.36-6.401 26.61-14.28l17.08-25.68c2.938-4.438 5.348-12.37 5.348-17.7L272 415.1h-160L112.1 454.3zM191.4 .0132C89.44 .3257 16 82.97 16 175.1c0 44.38 16.44 84.84 43.56 115.8c16.53 18.84 42.34 58.23 52.22 91.45c.0313 .25 .0938 .5166 .125 .7823h160.2c.0313-.2656 .0938-.5166 .125-.7823c9.875-33.22 35.69-72.61 52.22-91.45C351.6 260.8 368 220.4 368 175.1C368 78.61 288.9-.2837 191.4 .0132zM192 96.01c-44.13 0-80 35.89-80 79.1C112 184.8 104.8 192 96 192S80 184.8 80 176c0-61.76 50.25-111.1 112-111.1c8.844 0 16 7.159 16 16S200.8 96.01 192 96.01z"/></svg>',mug:'<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 640 512"><!--! Font Awesome Pro 6.1.1 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license (Commercial License) Copyright 2022 Fonticons, Inc. --><path d="M512 32H120c-13.25 0-24 10.75-24 24L96.01 288c0 53 43 96 96 96h192C437 384 480 341 480 288h32c70.63 0 128-57.38 128-128S582.6 32 512 32zM512 224h-32V96h32c35.25 0 64 28.75 64 64S547.3 224 512 224zM560 416h-544C7.164 416 0 423.2 0 432C0 458.5 21.49 480 48 480h480c26.51 0 48-21.49 48-48C576 423.2 568.8 416 560 416z"/></svg>',plane:'<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 576 512"><!--! Font Awesome Pro 6.1.1 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license (Commercial License) Copyright 2022 Fonticons, Inc. --><path d="M482.3 192C516.5 192 576 221 576 256C576 292 516.5 320 482.3 320H365.7L265.2 495.9C259.5 505.8 248.9 512 237.4 512H181.2C170.6 512 162.9 501.8 165.8 491.6L214.9 320H112L68.8 377.6C65.78 381.6 61.04 384 56 384H14.03C6.284 384 0 377.7 0 369.1C0 368.7 .1818 367.4 .5398 366.1L32 256L.5398 145.9C.1818 144.6 0 143.3 0 142C0 134.3 6.284 128 14.03 128H56C61.04 128 65.78 130.4 68.8 134.4L112 192H214.9L165.8 20.4C162.9 10.17 170.6 0 181.2 0H237.4C248.9 0 259.5 6.153 265.2 16.12L365.7 192H482.3z"/></svg>',robot:'<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 640 512"><!--! Font Awesome Pro 6.1.1 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license (Commercial License) Copyright 2022 Fonticons, Inc. --><path d="M9.375 233.4C3.375 239.4 0 247.5 0 256v128c0 8.5 3.375 16.62 9.375 22.62S23.5 416 32 416h32V224H32C23.5 224 15.38 227.4 9.375 233.4zM464 96H352V32c0-17.62-14.38-32-32-32S288 14.38 288 32v64H176C131.8 96 96 131.8 96 176V448c0 35.38 28.62 64 64 64h320c35.38 0 64-28.62 64-64V176C544 131.8 508.3 96 464 96zM256 416H192v-32h64V416zM224 296C201.9 296 184 278.1 184 256S201.9 216 224 216S264 233.9 264 256S246.1 296 224 296zM352 416H288v-32h64V416zM448 416h-64v-32h64V416zM416 296c-22.12 0-40-17.88-40-40S393.9 216 416 216S456 233.9 456 256S438.1 296 416 296zM630.6 233.4C624.6 227.4 616.5 224 608 224h-32v192h32c8.5 0 16.62-3.375 22.62-9.375S640 392.5 640 384V256C640 247.5 636.6 239.4 630.6 233.4z"/></svg>',sad:`<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 512 512">
  <defs>
    <radialGradient gradientUnits="userSpaceOnUse" cy="10%" id="gradient-0">
      <stop offset="0" style="stop-color: hsl(50, 100%, 50%);"/>
      <stop offset="1" style="stop-color: hsl(50, 100%, 60%);"/>
    </radialGradient>
  </defs>
  <!--! Font Awesome Pro 6.1.1 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license (Commercial License) Copyright 2022 Fonticons, Inc. -->
  <ellipse style="stroke: rgb(0, 0, 0); fill: rgba(0, 0, 0, 0.59);" cx="172.586" cy="207.006" rx="39.974" ry="39.974"/>
  <ellipse style="stroke: rgb(0, 0, 0); fill: rgba(0, 0, 0, 0.59);" cx="334.523" cy="207.481" rx="39.974" ry="39.974"/>
  <ellipse style="stroke: rgb(0, 0, 0); fill: rgba(0, 0, 0, 0.59);" cx="313.325" cy="356.208" rx="91.497" ry="59.893"/>
  <path style="fill: rgb(85, 167, 255);" d="M 159.427 274.06 L 102.158 363.286 L 124.366 417.011 L 160.476 423.338 L 196.937 414.736 L 218.502 375.214"></path>
  <path style="fill: url(#gradient-0);" d="M256 0C397.4 0 512 114.6 512 256C512 397.4 397.4 512 256 512C114.6 512 0 397.4 0 256C0 114.6 114.6 0 256 0zM256 352C290.9 352 323.2 367.8 348.3 394.9C354.3 401.4 364.4 401.7 370.9 395.7C377.4 389.7 377.7 379.6 371.7 373.1C341.6 340.5 301 320 256 320C247.2 320 240 327.2 240 336C240 344.8 247.2 352 256 352H256zM208 369C208 349 179.6 308.6 166.4 291.3C163.2 286.9 156.8 286.9 153.6 291.3C140.6 308.6 112 349 112 369C112 395 133.5 416 160 416C186.5 416 208 395 208 369H208zM303.6 208C303.6 225.7 317.1 240 335.6 240C353.3 240 367.6 225.7 367.6 208C367.6 190.3 353.3 176 335.6 176C317.1 176 303.6 190.3 303.6 208zM207.6 208C207.6 190.3 193.3 176 175.6 176C157.1 176 143.6 190.3 143.6 208C143.6 225.7 157.1 240 175.6 240C193.3 240 207.6 225.7 207.6 208z" />
</svg>`,search:'<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 512 512"><!--! Font Awesome Pro 6.1.1 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license (Commercial License) Copyright 2022 Fonticons, Inc. --><path d="M500.3 443.7l-119.7-119.7c27.22-40.41 40.65-90.9 33.46-144.7C401.8 87.79 326.8 13.32 235.2 1.723C99.01-15.51-15.51 99.01 1.724 235.2c11.6 91.64 86.08 166.7 177.6 178.9c53.8 7.189 104.3-6.236 144.7-33.46l119.7 119.7c15.62 15.62 40.95 15.62 56.57 0C515.9 484.7 515.9 459.3 500.3 443.7zM79.1 208c0-70.58 57.42-128 128-128s128 57.42 128 128c0 70.58-57.42 128-128 128S79.1 278.6 79.1 208z"/></svg>',smiley:'<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 512 512"><!--! Font Awesome Pro 6.1.1 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license (Commercial License) Copyright 2022 Fonticons, Inc. --><path d="M0 256C0 114.6 114.6 0 256 0C397.4 0 512 114.6 512 256C512 397.4 397.4 512 256 512C114.6 512 0 397.4 0 256zM256.3 331.8C208.9 331.8 164.1 324.9 124.5 312.8C112.2 309 100.2 319.7 105.2 331.5C130.1 390.6 188.4 432 256.3 432C324.2 432 382.4 390.6 407.4 331.5C412.4 319.7 400.4 309 388.1 312.8C348.4 324.9 303.7 331.8 256.3 331.8H256.3zM176.4 176C158.7 176 144.4 190.3 144.4 208C144.4 225.7 158.7 240 176.4 240C194 240 208.4 225.7 208.4 208C208.4 190.3 194 176 176.4 176zM336.4 240C354 240 368.4 225.7 368.4 208C368.4 190.3 354 176 336.4 176C318.7 176 304.4 190.3 304.4 208C304.4 225.7 318.7 240 336.4 240z"/></svg>',symbols:'<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 512 512"><!--! Font Awesome Pro 6.1.1 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license (Commercial License) Copyright 2022 Fonticons, Inc. --><path d="M500.3 7.251C507.7 13.33 512 22.41 512 31.1V175.1C512 202.5 483.3 223.1 447.1 223.1C412.7 223.1 383.1 202.5 383.1 175.1C383.1 149.5 412.7 127.1 447.1 127.1V71.03L351.1 90.23V207.1C351.1 234.5 323.3 255.1 287.1 255.1C252.7 255.1 223.1 234.5 223.1 207.1C223.1 181.5 252.7 159.1 287.1 159.1V63.1C287.1 48.74 298.8 35.61 313.7 32.62L473.7 .6198C483.1-1.261 492.9 1.173 500.3 7.251H500.3zM74.66 303.1L86.5 286.2C92.43 277.3 102.4 271.1 113.1 271.1H174.9C185.6 271.1 195.6 277.3 201.5 286.2L213.3 303.1H239.1C266.5 303.1 287.1 325.5 287.1 351.1V463.1C287.1 490.5 266.5 511.1 239.1 511.1H47.1C21.49 511.1-.0019 490.5-.0019 463.1V351.1C-.0019 325.5 21.49 303.1 47.1 303.1H74.66zM143.1 359.1C117.5 359.1 95.1 381.5 95.1 407.1C95.1 434.5 117.5 455.1 143.1 455.1C170.5 455.1 191.1 434.5 191.1 407.1C191.1 381.5 170.5 359.1 143.1 359.1zM440.3 367.1H496C502.7 367.1 508.6 372.1 510.1 378.4C513.3 384.6 511.6 391.7 506.5 396L378.5 508C372.9 512.1 364.6 513.3 358.6 508.9C352.6 504.6 350.3 496.6 353.3 489.7L391.7 399.1H336C329.3 399.1 323.4 395.9 321 389.6C318.7 383.4 320.4 376.3 325.5 371.1L453.5 259.1C459.1 255 467.4 254.7 473.4 259.1C479.4 263.4 481.6 271.4 478.7 278.3L440.3 367.1zM116.7 219.1L19.85 119.2C-8.112 90.26-6.614 42.31 24.85 15.34C51.82-8.137 93.26-3.642 118.2 21.83L128.2 32.32L137.7 21.83C162.7-3.642 203.6-8.137 231.6 15.34C262.6 42.31 264.1 90.26 236.1 119.2L139.7 219.1C133.2 225.6 122.7 225.6 116.7 219.1H116.7z"/></svg>',tree:'<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 448 512"><!--! Font Awesome Pro 6.1.1 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license (Commercial License) Copyright 2022 Fonticons, Inc. --><path d="M413.8 447.1L256 448l0 31.99C256 497.7 241.8 512 224.1 512c-17.67 0-32.1-14.32-32.1-31.99l0-31.99l-158.9-.0099c-28.5 0-43.69-34.49-24.69-56.4l68.98-79.59H62.22c-25.41 0-39.15-29.8-22.67-49.13l60.41-70.85H89.21c-21.28 0-32.87-22.5-19.28-37.31l134.8-146.5c10.4-11.3 28.22-11.3 38.62-.0033l134.9 146.5c13.62 14.81 2.001 37.31-19.28 37.31h-10.77l60.35 70.86c16.46 19.34 2.716 49.12-22.68 49.12h-15.2l68.98 79.59C458.7 413.7 443.1 447.1 413.8 447.1z"/></svg>',users:'<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 640 512"><!--! Font Awesome Pro 6.1.1 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license (Commercial License) Copyright 2022 Fonticons, Inc. --><path d="M224 256c70.7 0 128-57.31 128-128S294.7 0 224 0C153.3 0 96 57.31 96 128S153.3 256 224 256zM274.7 304H173.3c-95.73 0-173.3 77.6-173.3 173.3C0 496.5 15.52 512 34.66 512H413.3C432.5 512 448 496.5 448 477.3C448 381.6 370.4 304 274.7 304zM479.1 320h-73.85C451.2 357.7 480 414.1 480 477.3C480 490.1 476.2 501.9 470 512h138C625.7 512 640 497.6 640 479.1C640 391.6 568.4 320 479.1 320zM432 256C493.9 256 544 205.9 544 144S493.9 32 432 32c-25.11 0-48.04 8.555-66.72 22.51C376.8 76.63 384 101.4 384 128c0 35.52-11.93 68.14-31.59 94.71C372.7 243.2 400.8 256 432 256z"/></svg>',warning:`<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 512 512">
  <defs>
    <radialGradient id="radial" cy="85%">
      <stop offset="20%" stop-color="var(--color-secondary)" />
      <stop offset="100%" stop-color="var(--color-primary)" />
    </radialGradient>
  </defs>
  <!--! Font Awesome Pro 6.1.1 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license (Commercial License) Copyright 2022 Fonticons, Inc. -->
  <path fill="url('#radial')" d="M506.3 417l-213.3-364c-16.33-28-57.54-28-73.98 0l-213.2 364C-10.59 444.9 9.849 480 42.74 480h426.6C502.1 480 522.6 445 506.3 417zM232 168c0-13.25 10.75-24 24-24S280 154.8 280 168v128c0 13.25-10.75 24-23.1 24S232 309.3 232 296V168zM256 416c-17.36 0-31.44-14.08-31.44-31.44c0-17.36 14.07-31.44 31.44-31.44s31.44 14.08 31.44 31.44C287.4 401.9 273.4 416 256 416z" />
</svg>`,xmark:'<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 320 512"><!--! Font Awesome Pro 6.1.1 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license (Commercial License) Copyright 2022 Fonticons, Inc. --><path d="M310.6 361.4c12.5 12.5 12.5 32.75 0 45.25C304.4 412.9 296.2 416 288 416s-16.38-3.125-22.62-9.375L160 301.3L54.63 406.6C48.38 412.9 40.19 416 32 416S15.63 412.9 9.375 406.6c-12.5-12.5-12.5-32.75 0-45.25l105.4-105.4L9.375 150.6c-12.5-12.5-12.5-32.75 0-45.25s32.75-12.5 45.25 0L160 210.8l105.4-105.4c12.5-12.5 32.75-12.5 45.25 0s12.5 32.75 0 45.25l-105.4 105.4L310.6 361.4z"/></svg>'},Uu={recents:"clock","smileys-emotion":"smiley","people-body":"users","animals-nature":"tree","food-drink":"mug",activities:"gamepad","travel-places":"plane",objects:"lightbulb",symbols:"symbols",flags:"flag",custom:"robot"};function py(c,u){if(!(c in iy))return console.warn(`Unknown icon: "${c}"`),document.createElement("div");let g=function(v,C){let o=Yd(C);return o.dataset.icon=v,o.classList.add(ty.icon),o}(c,iy[c]);return u&&g.classList.add(ty[`icon-${u}`]),g}var jo,Rc,Fu,Jd,Qd,ef,Mb="sync",Ii=class{constructor(u,g={}){jo.add(this),Rc.set(this,void 0),Fu.set(this,void 0),Kd(this,Rc,u,"f"),Kd(this,Fu,g.mode||Mb,"f")}renderSync(u={}){let g=Yd(Mi(this,Rc,"f").call(this,u));return Mi(this,jo,"m",ef).call(this,g,u),Mi(this,jo,"m",Qd).call(this,g),Mi(this,jo,"m",Jd).call(this,g,u),g}renderAsync(u={}){return kt(this,void 0,void 0,function*(){let g=Yd(Mi(this,Rc,"f").call(this,u));return Mi(this,jo,"m",ef).call(this,g,u),Mi(this,jo,"m",Qd).call(this,g),yield Mi(this,jo,"m",Jd).call(this,g,u),g})}render(u){return Mi(this,Fu,"f")==="sync"?this.renderSync(u):this.renderAsync(u)}};Rc=new WeakMap,Fu=new WeakMap,jo=new WeakSet,Jd=function(c,u){return kt(this,void 0,void 0,function*(){let g=c.querySelectorAll("[data-view]"),v=[];for(let C of g){let o=u[C.dataset.view];o?C.dataset.render!=="sync"?v.push(o.render().then(z=>(C.replaceWith(z),z))):C.replaceWith(o.renderSync()):C.remove()}return Promise.all(v)})},Qd=function(c){c.querySelectorAll("i[data-icon]").forEach(u=>{let{icon:g,size:v}=u.dataset;u.replaceWith(py(g,v))})},ef=function(c,u){return c.querySelectorAll("[data-placeholder]").forEach(g=>{let v=g.dataset.placeholder;if(v&&u[v]){let C=u[v];g.replaceWith(...[C].flat())}else console.warn(`Missing placeholder element for key "${v}"`)}),c};var Ib={imagePlaceholder:"common_imagePlaceholder__FRWLu",placeholder:"common_placeholder__qe-fo",shine:"common_shine__tUVG2"};sr(`@keyframes common_shine__tUVG2 {
  to {
    transform: translateX(100%);
  }
}
.common_imagePlaceholder__FRWLu {
  width: 2rem;
  height: 2rem;
  border-radius: 50%;
}

.common_placeholder__qe-fo {
  background: #DDDBDD;
  position: relative;
}
.common_placeholder__qe-fo::after {
  position: absolute;
  top: 0;
  right: 0;
  bottom: 0;
  left: 0;
  transform: translateX(-100%);
  background-image: linear-gradient(90deg, rgba(255, 255, 255, 0) 0, rgba(255, 255, 255, 0.2) 20%, rgba(255, 255, 255, 0.5) 60%, rgba(255, 255, 255, 0));
  animation: common_shine__tUVG2 2s infinite;
  content: "";
}`);var zb=new Ii(({classes:c})=>`
  <div class="${c.placeholder} ${c.imagePlaceholder}"></div>
`),tf=class extends St{constructor({classNames:u}={}){super({template:zb,classes:Ib}),this.classNames=u}load(u){let g=document.createElement("img");this.classNames&&(g.className=this.classNames),g.addEventListener("load",()=>{this.el.replaceWith(g)},{once:!0}),Promise.resolve(u).then(v=>g.src=v)}renderSync(){return super.renderSync(),this.classNames&&this.classNames.split(" ").forEach(u=>this.el.classList.add(u)),this.el}},Pb={customEmoji:"custom_customEmoji__Kspg6"};sr(`.custom_customEmoji__Kspg6 {
  width: 1em;
  height: 1em;
}`);var rf=class{renderElement(u){return{content:u}}renderImage(u="",g){let v=new tf({classNames:u});return v.renderSync(),{content:v,resolver:()=>(v.load(g()),v.el)}}doRender(u,g,v){if(u.custom)return this.renderCustom(u,g,v);let{content:C,resolver:o}=this.render(u,v),z=C instanceof Element?C:C.el;return o&&o(),z}doEmit(u){return u.custom?this.emitCustom(u):this.emit(u)}emitCustom({url:u,label:g,emoji:v,data:C}){return{url:u,label:g,emoji:v,data:C}}renderCustom(u,g,v=""){let C=[Pb.customEmoji,v].join(" ").trim(),{content:o,resolver:z}=this.renderImage(C,()=>u.url),B=o instanceof Element?o:o.el;return z&&z(),B}},Db=new Ii(({emoji:c})=>`<span>${c}</span>`),nf=class extends rf{render(u){return this.renderElement(Db.renderSync({emoji:u.emoji}))}emit({emoji:u,hexcode:g,label:v}){return{emoji:u,hexcode:g,label:v}}};sr(`.themes_lightTheme__mMNem {
  color-scheme: light;
  --accent-color: #4f46e5;
  --background-color: #f9fafb;
  --border-color: #cccccc;
  --category-name-background-color: #f9fafb;
  --category-name-button-color: #999999;
  --category-name-text-color: hsl(214, 30%, 50%);
  --category-tab-active-background-color: rgba(255, 255, 255, 0.6);
  --category-tab-active-color: var(--accent-color);
  --category-tab-color: #666;
  --category-tab-highlight-background-color: rgba(0, 0, 0, 0.15);
  --error-color-dark: hsl(0, 100%, 45%);
  --error-color: hsl(0, 100%, 40%);
  --focus-indicator-background-color: hsl(198, 65%, 85%);
  --focus-indicator-color: #333333;
  --hover-background-color: #c7d2fe;
  --placeholder-background-color: #cccccc;
  --preview-background-color: var(--secondary-background-color);
  --scrollbar-background-color: var(--background-color);
  --scrollbar-color: rgba(0, 0, 0, 0.75);
  --search-background-color: #f9fafb;
  --search-focus-background-color: #ffffff;
  --search-icon-color: #999999;
  --search-placeholder-color: #71717a;
  --secondary-background-color: #e2e8f0;
  --secondary-text-color: #666666;
  --tag-background-color: rgba(162, 190, 245, 0.3);
  --text-color: #000000;
  --variant-popup-background-color: #ffffff;
}

.themes_darkTheme__qgrZP {
  color-scheme: dark;
  --accent-color: #A580F9;
  --background-color: #333333;
  --border-color: #666666;
  --category-name-background-color: #333333;
  --category-name-button-color: #eeeeee;
  --category-name-text-color: #ffffff;
  --category-tab-active-background-color: #000000;
  --category-tab-active-color: var(--accent-color);
  --category-tab-color: #cccccc;
  --category-tab-highlight-background-color: #4A4A4A;
  --error-color-dark: hsl(0, 7%, 3%);
  --error-color: hsl(0, 30%, 60%);
  --focus-indicator-background-color: hsl(0, 0%, 50%);
  --focus-indicator-color: #999999;
  --hover-background-color: hsla(0, 0%, 40%, 0.85);
  --image-placeholder-color: #ffffff;
  --placeholder-background-color: #666666;
  --search-background-color: #71717a;
  --search-focus-background-color: #52525b;
  --search-icon-color: #cccccc;
  --search-placeholder-color: #d4d4d8;
  --secondary-background-color: #000000 ;
  --secondary-text-color: #999999;
  --tag-background-color: rgba(162, 190, 245, 0.3);
  --text-color: #ffffff;
  --variant-popup-background-color: #333333;
}

.themes_autoTheme__tik-v {
  color-scheme: light;
  --accent-color: #4f46e5;
  --background-color: #f9fafb;
  --border-color: #cccccc;
  --category-name-background-color: #f9fafb;
  --category-name-button-color: #999999;
  --category-name-text-color: hsl(214, 30%, 50%);
  --category-tab-active-background-color: rgba(255, 255, 255, 0.6);
  --category-tab-active-color: var(--accent-color);
  --category-tab-color: #666;
  --category-tab-highlight-background-color: rgba(0, 0, 0, 0.15);
  --error-color-dark: hsl(0, 100%, 45%);
  --error-color: hsl(0, 100%, 40%);
  --focus-indicator-background-color: hsl(198, 65%, 85%);
  --focus-indicator-color: #333333;
  --hover-background-color: #c7d2fe;
  --placeholder-background-color: #cccccc;
  --preview-background-color: var(--secondary-background-color);
  --scrollbar-background-color: var(--background-color);
  --scrollbar-color: rgba(0, 0, 0, 0.75);
  --search-background-color: #f9fafb;
  --search-focus-background-color: #ffffff;
  --search-icon-color: #999999;
  --search-placeholder-color: #71717a;
  --secondary-background-color: #e2e8f0;
  --secondary-text-color: #666666;
  --tag-background-color: rgba(162, 190, 245, 0.3);
  --text-color: #000000;
  --variant-popup-background-color: #ffffff;
}

@media (prefers-color-scheme: dark) {
  .themes_autoTheme__tik-v {
    color-scheme: dark;
    --accent-color: #A580F9;
    --background-color: #333333;
    --border-color: #666666;
    --category-name-background-color: #333333;
    --category-name-button-color: #eeeeee;
    --category-name-text-color: #ffffff;
    --category-tab-active-background-color: #000000;
    --category-tab-active-color: var(--accent-color);
    --category-tab-color: #cccccc;
    --category-tab-highlight-background-color: #4A4A4A;
    --error-color-dark: hsl(0, 7%, 3%);
    --error-color: hsl(0, 30%, 60%);
    --focus-indicator-background-color: hsl(0, 0%, 50%);
    --focus-indicator-color: #999999;
    --hover-background-color: hsla(0, 0%, 40%, 0.85);
    --image-placeholder-color: #ffffff;
    --placeholder-background-color: #666666;
    --search-background-color: #71717a;
    --search-focus-background-color: #52525b;
    --search-icon-color: #cccccc;
    --search-placeholder-color: #d4d4d8;
    --secondary-background-color: #000000 ;
    --secondary-text-color: #999999;
    --tag-background-color: rgba(162, 190, 245, 0.3);
    --text-color: #ffffff;
    --variant-popup-background-color: #333333;
  }
}`);var{autoTheme:n3,lightTheme:Lb,darkTheme:o3}={lightTheme:"themes_lightTheme__mMNem",darkTheme:"themes_darkTheme__qgrZP",autoTheme:"themes_autoTheme__tik-v"},Bb={"categories.activities":"Activities","categories.animals-nature":"Animals & Nature","categories.custom":"Custom","categories.flags":"Flags","categories.food-drink":"Food & Drink","categories.objects":"Objects","categories.people-body":"People & Body","categories.recents":"Recently Used","categories.smileys-emotion":"Smileys & Emotion","categories.symbols":"Symbols","categories.travel-places":"Travel & Places","error.load":"Failed to load emojis","recents.clear":"Clear recent emojis","recents.none":"You haven't selected any emojis yet.",retry:"Try again","search.clear":"Clear search","search.error":"Failed to search emojis","search.notFound":"No results found",search:"Search emojis..."},Rb=[(c,u)=>(c.hexcode==="1F91D"&&u<14&&(c.skins=[]),c),(c,u)=>(c.skins&&(c.skins=c.skins.filter(g=>!g.version||g.version<=u)),c)];function Vu(c,u){return c.filter(g=>function(v,C){return Rb.some(o=>o(v,C)===null)?null:v}(g,u)!==null)}function Oc(c){var u;return{emoji:c.emoji,label:c.label,tags:c.tags,skins:(u=c.skins)===null||u===void 0?void 0:u.map(g=>Oc(g)),order:c.order,custom:!1,hexcode:c.hexcode,version:c.version}}function Nu(c,u,g){var v;return!(g&&!g.some(C=>C.order===c.group))&&(Q_(c.label,u)||((v=c.tags)===null||v===void 0?void 0:v.some(C=>Q_(C,u))))}var Gu=class{constructor(u="en"){this.locale=u}};function dy(c){return new of(c)}dy.deleteDatabase=c=>new Promise((u,g)=>{let v=indexedDB.deleteDatabase(`PicMo-${c}`);v.addEventListener("success",u),v.addEventListener("error",g)});var of=class extends Gu{open(){return kt(this,void 0,void 0,function*(){let u=indexedDB.open(`PicMo-${this.locale}`);return new Promise((g,v)=>{u.addEventListener("success",C=>{var o;this.db=(o=C.target)===null||o===void 0?void 0:o.result,g()}),u.addEventListener("error",v),u.addEventListener("upgradeneeded",C=>kt(this,void 0,void 0,function*(){var o;this.db=(o=C.target)===null||o===void 0?void 0:o.result,this.db.createObjectStore("category",{keyPath:"order"});let z=this.db.createObjectStore("emoji",{keyPath:"emoji"});z.createIndex("category","group"),z.createIndex("version","version"),this.db.createObjectStore("meta")}))})})}delete(){return kt(this,void 0,void 0,function*(){this.close();let u=indexedDB.deleteDatabase(`PicMo-${this.locale}`);yield this.waitForRequest(u)})}close(){this.db.close()}getEmojiCount(){return kt(this,void 0,void 0,function*(){let u=this.db.transaction("emoji","readonly").objectStore("emoji");return(yield this.waitForRequest(u.count())).target.result})}getEtags(){return kt(this,void 0,void 0,function*(){let u=this.db.transaction("meta","readonly").objectStore("meta"),[g,v]=yield Promise.all([this.waitForRequest(u.get("emojisEtag")),this.waitForRequest(u.get("messagesEtag"))]);return{storedEmojisEtag:g.target.result,storedMessagesEtag:v.target.result}})}setMeta(u){return kt(this,void 0,void 0,function*(){let g=this.db.transaction("meta","readwrite"),v=g.objectStore("meta");return new Promise(C=>{g.oncomplete=C,Object.keys(u).filter(Boolean).forEach(o=>{v.put(u[o],o)})})})}getHash(){return kt(this,void 0,void 0,function*(){let u=this.db.transaction("meta","readonly").objectStore("meta");return(yield this.waitForRequest(u.get("hash"))).target.result})}isPopulated(){return kt(this,void 0,void 0,function*(){let u=this.db.transaction("category","readonly").objectStore("category");return(yield this.waitForRequest(u.count())).target.result>0})}populate({groups:u,emojis:g,emojisEtag:v,messagesEtag:C,hash:o}){return kt(this,void 0,void 0,function*(){yield this.removeAllObjects("category","emoji");let z=[this.addObjects("category",u),this.addObjects("emoji",g),this.setMeta({emojisEtag:v,messagesEtag:C,hash:o})];yield Promise.all(z)})}getCategories(u){var g;return kt(this,void 0,void 0,function*(){let v=this.db.transaction("category","readonly").objectStore("category"),C=(yield this.waitForRequest(v.getAll())).target.result.filter(o=>o.key!=="component");if(u.showRecents&&C.unshift({key:"recents",order:-1}),!((g=u.custom)===null||g===void 0)&&g.length&&C.push({key:"custom",order:10}),u.categories){let o=u.categories;C=C.filter(z=>o.includes(z.key)),C.sort((z,B)=>o.indexOf(z.key)-o.indexOf(B.key))}else C.sort((o,z)=>o.order-z.order);return C})}getEmojis(u,g){return kt(this,void 0,void 0,function*(){let v=this.db.transaction("emoji","readonly").objectStore("emoji").index("category");return Vu((yield this.waitForRequest(v.getAll(u.order))).target.result.filter(C=>C.version<=g).sort((C,o)=>C.order!=null&&o.order!=null?C.order-o.order:0).map(Oc),g)})}searchEmojis(u,g,v,C){return kt(this,void 0,void 0,function*(){let o=[];return new Promise((z,B)=>{let H=this.db.transaction("emoji","readonly").objectStore("emoji").openCursor();H.addEventListener("success",Y=>{var oe;let Ee=(oe=Y.target)===null||oe===void 0?void 0:oe.result;if(!Ee)return z([...Vu(o,v),...g.filter(Ce=>Nu(Ce,u))]);let Ae=Ee.value;Nu(Ae,u,C)&&Ae.version<=v&&o.push(Oc(Ae)),Ee.continue()}),H.addEventListener("error",Y=>{B(Y)})})})}waitForRequest(u){return kt(this,void 0,void 0,function*(){return new Promise((g,v)=>{u.onsuccess=g,u.onerror=v})})}withTransaction(u,g="readwrite",v){return new Promise((C,o)=>{let z=this.db.transaction(u,g);z.oncomplete=C,z.onerror=o,v(z)})}removeAllObjects(...u){return kt(this,void 0,void 0,function*(){let g=this.db.transaction(u,"readwrite"),v=u.map(C=>g.objectStore(C));yield Promise.all(v.map(C=>this.waitForRequest(C.clear())))})}addObjects(u,g){return kt(this,void 0,void 0,function*(){return this.withTransaction(u,"readwrite",v=>{let C=v.objectStore(u);g.forEach(o=>{C.add(o)})})})}},sf=class{},af=class extends sf{constructor(u){super(),this.storage=u}clear(){this.storage.removeItem("PicMo:recents")}getRecents(u){var g;try{return JSON.parse((g=this.storage.getItem("PicMo:recents"))!==null&&g!==void 0?g:"[]").slice(0,u)}catch{return[]}}addOrUpdateRecent(u,g){let v=[u,...this.getRecents(g).filter(C=>C.hexcode!==u.hexcode)].slice(0,g);try{this.storage.setItem("PicMo:recents",JSON.stringify(v))}catch{console.warn("storage is not available, recent emojis will not be saved")}}},lf=class extends af{constructor(){super(localStorage)}},Fb={renderer:new nf,dataStore:dy,theme:Lb,animate:!0,showCategoryTabs:!0,showPreview:!0,showRecents:!0,showSearch:!0,showVariants:!0,emojisPerRow:8,visibleRows:6,emojiVersion:"auto",i18n:Bb,locale:"en",maxRecents:50,recentsProvider:new lf,custom:[]};function Af(c={}){return Object.assign(Object.assign({},Fb),c)}var Ns,$s,$u,cf,qs=class{constructor(){Ns.add(this),$s.set(this,new Map)}on(u,g,v){Mi(this,Ns,"m",cf).call(this,u,g,v)}once(u,g,v){Mi(this,Ns,"m",cf).call(this,u,g,v,!0)}off(u,g){let v=Mi(this,Ns,"m",$u).call(this,u);Mi(this,$s,"f").set(u,v.filter(C=>C.handler!==g))}emit(u,...g){Mi(this,Ns,"m",$u).call(this,u).forEach(v=>{v.handler.apply(v.context,g),v.once&&this.off(u,v.handler)})}removeAll(){Mi(this,$s,"f").clear()}};$s=new WeakMap,Ns=new WeakSet,$u=function(c){return Mi(this,$s,"f").has(c)||Mi(this,$s,"f").set(c,[]),Mi(this,$s,"f").get(c)},cf=function(c,u,g,v=!1){Mi(this,Ns,"m",$u).call(this,c).push({context:g,handler:u,once:v})};var hf=class extends qs{},uf=class extends qs{},pf={emojiCategory:"EmojiCategory_emojiCategory__7G3mq",categoryName:"EmojiCategory_categoryName__zHcOq",noRecents:"EmojiCategory_noRecents__Pk1Ys",recentEmojis:"EmojiCategory_recentEmojis__CybhN"};sr(`.EmojiCategory_emojiCategory__7G3mq {
  position: relative;
}

.EmojiCategory_categoryName__zHcOq {
  font-size: 0.9em;
  padding: 0.5rem;
  margin: 0;
  background: var(--category-name-background-color);
  color: var(--category-name-text-color);
  top: 0;
  z-index: 1;
  display: grid;
  gap: 4px;
  grid-template-columns: auto 1fr auto;
  align-items: center;
  line-height: 1;
  box-sizing: border-box;
  height: var(--category-name-height);
  justify-content: flex-start;
  text-transform: uppercase;
}
.EmojiCategory_categoryName__zHcOq button {
  background: transparent;
  border: none;
  display: flex;
  align-items: center;
  cursor: pointer;
  color: var(--category-name-button-color);
}
.EmojiCategory_categoryName__zHcOq button:hover {
  opacity: 1;
}

.EmojiCategory_noRecents__Pk1Ys {
  color: var(--secondary-text-color);
  grid-column: 1/span var(--emojis-per-row);
  font-size: 0.9em;
  text-align: center;
  display: flex;
  align-items: center;
  justify-content: center;
  min-height: calc(var(--emoji-size) * var(--emoji-size-multiplier));
}

.EmojiCategory_recentEmojis__CybhN[data-empty=true] {
  display: none;
}

.EmojiCategory_recentEmojis__CybhN[data-empty=false] + div {
  display: none;
}`);var jc=class extends St{constructor({template:u,category:g,showVariants:v,lazyLoader:C}){super({template:u,classes:pf}),this.baseUIElements={categoryName:St.byClass(pf.categoryName)},this.category=g,this.showVariants=v,this.lazyLoader=C}setActive(u,g,v){this.emojiContainer.setActive(u,g,v)}},Ob=new Ii(({classes:c,emoji:u})=>`
  <button
    type="button"
    class="${c.emoji}"
    title="${u.label}"
    data-emoji="${u.emoji}"
    tabindex="-1">
    <div data-placeholder="emojiContent"></div>
  </button>
`),jb={emoji:"Emoji_emoji__iKc1G"};sr(`.Emoji_emoji__iKc1G {
  background: transparent;
  border: none;
  border-radius: 15px;
  cursor: pointer;
  font-family: var(--emoji-font);
  font-size: var(--emoji-size);
  height: 100%;
  justify-content: center;
  margin: 0;
  overflow: hidden;
  padding: 0;
  width: 100%;
}
.Emoji_emoji__iKc1G:hover {
  background: var(--hover-background-color);
}
.Emoji_emoji__iKc1G:focus {
  border-radius: 0;
  background: var(--focus-indicator-background-color);
  outline: 1px soldi var(--focus-indicator-color);
}`);var qu=class extends St{constructor({emoji:u,lazyLoader:g,category:v}){super({template:Ob,classes:jb}),this.emoji=u,this.lazyLoader=g,this.category=v}initialize(){this.uiEvents=[St.uiEvent("focus",this.handleFocus)],super.initialize()}handleFocus(){this.category&&this.events.emit("focus:change",this.category)}activateFocus(u){this.el.tabIndex=0,u&&this.el.focus()}deactivateFocus(){this.el.tabIndex=-1}renderSync(){return super.renderSync({emoji:this.emoji,emojiContent:this.renderer.doRender(this.emoji,this.lazyLoader)})}},df=class{constructor(u,g,v=0,C=0,o=!1){this.events=new qs,this.keyHandlers={ArrowLeft:this.focusPrevious.bind(this),ArrowRight:this.focusNext.bind(this),ArrowUp:this.focusUp.bind(this),ArrowDown:this.focusDown.bind(this)},this.rowCount=Math.ceil(g/u),this.columnCount=u,this.focusedRow=v,this.focusedColumn=C,this.emojiCount=g,this.wrap=o,this.handleKeyDown=this.handleKeyDown.bind(this)}destroy(){this.events.removeAll()}on(u,g){this.events.on(u,g)}handleKeyDown(u){u.key in this.keyHandlers&&(u.preventDefault(),this.keyHandlers[u.key]())}setCell(u,g,v=!0){let C=this.getIndex();this.focusedRow=u,g!==void 0&&(this.focusedColumn=Math.min(this.columnCount,g)),(this.focusedRow>=this.rowCount||this.getIndex()>=this.emojiCount)&&(this.focusedRow=this.rowCount-1,this.focusedColumn=this.emojiCount%this.columnCount-1),this.events.emit("focus:change",{from:C,to:this.getIndex(),performFocus:v})}setFocusedIndex(u,g=!0){let v=Math.floor(u/this.columnCount),C=u%this.columnCount;this.setCell(v,C,g)}focusNext(){this.focusedColumn<this.columnCount-1&&this.getIndex()<this.emojiCount-1?this.setCell(this.focusedRow,this.focusedColumn+1):this.focusedRow<this.rowCount-1?this.setCell(this.focusedRow+1,0):this.wrap?this.setCell(0,0):this.events.emit("focus:overflow",0)}focusPrevious(){this.focusedColumn>0?this.setCell(this.focusedRow,this.focusedColumn-1):this.focusedRow>0?this.setCell(this.focusedRow-1,this.columnCount-1):this.wrap?this.setCell(this.rowCount-1,this.columnCount-1):this.events.emit("focus:underflow",this.columnCount-1)}focusUp(){this.focusedRow>0?this.setCell(this.focusedRow-1,this.focusedColumn):this.events.emit("focus:underflow",this.focusedColumn)}focusDown(){this.focusedRow<this.rowCount-1?this.setCell(this.focusedRow+1,this.focusedColumn):this.events.emit("focus:overflow",this.focusedColumn)}focusToIndex(u){this.setCell(Math.floor(u/this.columnCount),u%this.columnCount)}getIndex(){return this.focusedRow*this.columnCount+this.focusedColumn}getCell(){return{row:this.focusedRow,column:this.focusedColumn}}getRowCount(){return this.rowCount}},Ub=new Ii(({classes:c})=>`
  <div class="${c.emojiContainer}">
    <div data-placeholder="emojis"></div>
  </div>
`),Vb={emojiContainer:"EmojiContainer_emojiContainer__4SPb5"};sr(`.EmojiContainer_emojiContainer__4SPb5 {
  display: grid;
  justify-content: space-between;
  gap: 1px;
  padding: 0 0.5em;
  grid-template-columns: repeat(var(--emojis-per-row), calc(var(--emoji-size) * var(--emoji-size-multiplier)));
  grid-auto-rows: calc(var(--emoji-size) * var(--emoji-size-multiplier));
  align-items: center;
  justify-items: center;
}`);var Zs=class extends St{constructor({emojis:u,showVariants:g,preview:v=!0,lazyLoader:C,category:o,fullHeight:z=!1}){super({template:Ub,classes:Vb}),this.fullHeight=!1,this.showVariants=g,this.lazyLoader=C,this.preview=v,this.emojis=u,this.category=o,this.fullHeight=z,this.setFocus=this.setFocus.bind(this),this.triggerNextCategory=this.triggerNextCategory.bind(this),this.triggerPreviousCategory=this.triggerPreviousCategory.bind(this)}initialize(){this.grid=new df(this.options.emojisPerRow,this.emojiCount,0,0,!this.category),this.grid.on("focus:change",this.setFocus),this.grid.on("focus:overflow",this.triggerNextCategory),this.grid.on("focus:underflow",this.triggerPreviousCategory),this.uiEvents=[St.uiEvent("click",this.selectEmoji),St.uiEvent("keydown",this.grid.handleKeyDown)],this.preview&&this.uiEvents.push(St.uiEvent("mouseover",this.showPreview),St.uiEvent("mouseout",this.hidePreview),St.uiEvent("focus",this.showPreview,{capture:!0}),St.uiEvent("blur",this.hidePreview,{capture:!0})),super.initialize()}setFocusedView(u,g){if(u)if(typeof u=="string"){let v=this.emojis.findIndex(C=>C.emoji===u);this.grid.setFocusedIndex(v,!1),setTimeout(()=>{var C,o,z,B;let H=this.emojiViews[v].el;H.scrollIntoView();let Y=(C=H.parentElement)===null||C===void 0?void 0:C.previousElementSibling;((z=(o=H.parentElement)===null||o===void 0?void 0:o.parentElement)===null||z===void 0?void 0:z.parentElement).scrollTop-=(B=Y?.offsetHeight)!==null&&B!==void 0?B:0})}else u.row==="first"||u.row===0?this.grid.setCell(0,u.offset,g):u.row==="last"&&this.grid.setCell(this.grid.getRowCount()-1,u.offset,g)}setActive(u,g,v){var C;u?this.setFocusedView(g,v):(C=this.emojiViews[this.grid.getIndex()])===null||C===void 0||C.deactivateFocus()}renderSync(){return this.emojiViews=this.emojis.map(u=>this.viewFactory.create(qu,{emoji:u,category:this.category,lazyLoader:this.lazyLoader,renderer:this.renderer})),this.emojiElements=this.emojiViews.map(u=>u.renderSync()),super.renderSync({emojis:this.emojiElements,i18n:this.i18n})}destroy(){super.destroy(),this.emojiViews.forEach(u=>u.destroy()),this.grid.destroy()}triggerPreviousCategory(u){this.events.emit("category:previous",u)}triggerNextCategory(u){this.category&&this.events.emit("category:next",u)}setFocus({from:u,to:g,performFocus:v}){var C,o;(C=this.emojiViews[u])===null||C===void 0||C.deactivateFocus(),(o=this.emojiViews[g])===null||o===void 0||o.activateFocus(v)}selectEmoji(u){let g=Zd(u,this.emojis);g&&this.events.emit("emoji:select",{emoji:g,showVariants:this.showVariants})}showPreview(u){let g=u.target.closest("button"),v=g?.firstElementChild,C=Zd(u,this.emojis);C&&this.events.emit("preview:show",C,v?.cloneNode(!0))}hidePreview(u){Zd(u,this.emojis)&&this.events.emit("preview:hide")}get emojiCount(){return this.emojis.length}},Nb=new Ii(({classes:c,category:u,pickerId:g,icon:v,i18n:C})=>`
  <section class="${c.emojiCategory}" role="tabpanel" aria-labelledby="${g}-category-${u.key}">
    <h3 data-category="${u.key}" class="${c.categoryName}">
      <i data-icon="${v}"></i>
      ${C.get(`categories.${u.key}`,u.message||u.key)}
    </h3>
    <div data-view="emojis" data-render="sync"></div>
  </section>
`),ff=class extends jc{constructor({category:u,showVariants:g,lazyLoader:v,emojiVersion:C}){super({category:u,showVariants:g,lazyLoader:v,template:Nb}),this.showVariants=g,this.lazyLoader=v,this.emojiVersion=C}initialize(){this.uiElements=Object.assign({},this.baseUIElements),super.initialize()}render(){let u=Object.create(null,{render:{get:()=>super.render}});return kt(this,void 0,void 0,function*(){yield this.emojiDataPromise;let g=yield this.emojiData.getEmojis(this.category,this.emojiVersion);return this.emojiContainer=this.viewFactory.create(Zs,{emojis:g,showVariants:this.showVariants,lazyLoader:this.lazyLoader,category:this.category.key}),u.render.call(this,{category:this.category,emojis:this.emojiContainer,emojiCount:g.length,icon:Uu[this.category.key]})})}},mf=class extends Zs{constructor({category:u,emojis:g,preview:v=!0,lazyLoader:C}){super({category:u,emojis:g,showVariants:!1,preview:v,lazyLoader:C})}addOrUpdate(u){return kt(this,void 0,void 0,function*(){let g=this.el.querySelector(`[data-emoji="${u.emoji}"]`);g&&(this.el.removeChild(g),this.emojis=this.emojis.filter(C=>C!==u));let v=this.viewFactory.create(qu,{emoji:u});if(this.el.insertBefore(v.renderSync(),this.el.firstChild),this.emojis=[u,...this.emojis.filter(C=>C!==u)],this.emojis.length>this.options.maxRecents){this.emojis=this.emojis.slice(0,this.options.maxRecents);let C=this.el.childElementCount-this.options.maxRecents;for(let o=0;o<C;o++)this.el.lastElementChild&&this.el.removeChild(this.el.lastElementChild)}})}},Gb=new Ii(({emojiCount:c,classes:u,category:g,pickerId:v,icon:C,i18n:o})=>`
  <section class="${u.emojiCategory}" role="tabpanel" aria-labelledby="${v}-category-${g.key}">
  <h3 data-category="${g.key}" class="${u.categoryName}">
    <i data-icon="${C}"></i>
    ${o.get(`categories.${g.key}`,g.message||g.key)}
  </h3>
  <div data-empty="${c===0}" class="${u.recentEmojis}">
    <div data-view="emojis" data-render="sync"></div>
  </div>
  <div class="${u.noRecents}">
    ${o.get("recents.none")}
  </div>
</section>
`,{mode:"async"}),$b=new Ii(({classes:c,category:u,pickerId:g,icon:v,i18n:C})=>`
  <section class="${c.emojiCategory}" role="tabpanel" aria-labelledby="${g}-category-${u.key}">
    <h3 data-category="${u.key}" class="${c.categoryName}">
      <i data-icon="${v}"></i>
      ${C.get(`categories.${u.key}`,u.message||u.key)}
    </h3>
    <div data-view="emojis" data-render="sync"></div>
  </section>
`),Zu=class{constructor(){this.elements=new Map}lazyLoad(u,g){return this.elements.set(u,g),u}observe(u){if(window.IntersectionObserver){let g=new IntersectionObserver(v=>{v.filter(C=>C.intersectionRatio>0).map(C=>C.target).forEach(C=>{let o=this.elements.get(C);o?.(),g.unobserve(C)})},{root:u});this.elements.forEach((v,C)=>{g.observe(C)})}else this.elements.forEach(g=>{g()})}},ry={emojis:"EmojiArea_emojis__L4mMq"};sr(`.EmojiArea_emojis__L4mMq {
  height: var(--emoji-area-height);
  overflow-y: auto;
  position: relative;
  scrollbar-color: var(--scrollbar-color) var(--scrollbar-background-color);
  scrollbar-width: 8px;
}
.EmojiArea_emojis__L4mMq::-webkit-scrollbar {
  background: var(--scrollbar-background-color);
  width: 1.1em;
}
.EmojiArea_emojis__L4mMq::-webkit-scrollbar-thumb {
  background: var(--scrollbar-color);
  border-left: 4px solid transparent;
  border-right: 4px solid transparent;
  background-clip: padding-box;
  height: 1em;
  border-radius: 1em;
}`);var qb=new Ii(({classes:c})=>`
  <div class="${c.emojis}">
    <div data-placeholder="emojis"></div>
  </div>
`,{mode:"async"}),Zb={recents:class extends jc{constructor({category:c,lazyLoader:u,provider:g}){super({category:c,showVariants:!1,lazyLoader:u,template:Gb}),this.provider=g}initialize(){this.uiElements=Object.assign(Object.assign({},this.baseUIElements),{recents:St.byClass(pf.recentEmojis)}),this.appEvents={"recent:add":this.addRecent},super.initialize()}addRecent(c){return kt(this,void 0,void 0,function*(){yield this.emojiContainer.addOrUpdate(c),this.ui.recents.dataset.empty="false"})}render(){let c=Object.create(null,{render:{get:()=>super.render}});var u;return kt(this,void 0,void 0,function*(){let g=(u=this.provider)===null||u===void 0?void 0:u.getRecents(this.options.maxRecents);return this.emojiContainer=this.viewFactory.create(mf,{emojis:g,showVariants:!1,lazyLoader:this.lazyLoader,category:this.category.key}),yield c.render.call(this,{category:this.category,emojis:this.emojiContainer,emojiCount:g.length,icon:Uu[this.category.key]}),this.el})}},custom:class extends jc{constructor({category:c,lazyLoader:u}){super({template:$b,showVariants:!1,lazyLoader:u,category:c})}initialize(){this.uiElements=Object.assign({},this.baseUIElements),super.initialize()}render(){let c=Object.create(null,{render:{get:()=>super.render}});return kt(this,void 0,void 0,function*(){return this.emojiContainer=this.viewFactory.create(Zs,{emojis:this.customEmojis,showVariants:this.showVariants,lazyLoader:this.lazyLoader,category:this.category.key}),c.render.call(this,{category:this.category,emojis:this.emojiContainer,emojiCount:this.customEmojis.length,icon:Uu[this.category.key]})})}}},gf=class extends St{constructor({categoryTabs:u,categories:g,emojiVersion:v}){super({template:qb,classes:ry}),this.selectedCategory=0,this.scrollListenerState="active",this.lazyLoader=new Zu,this.categoryTabs=u,this.categories=g,this.emojiVersion=v,this.handleScroll=Tb(this.handleScroll.bind(this),100)}initialize(){this.appEvents={"category:select":this.handleCategorySelect,"category:previous":this.focusPreviousCategory,"category:next":this.focusNextCategory,"focus:change":this.updateFocusedCategory},this.uiElements={emojis:St.byClass(ry.emojis)},this.uiEvents=[St.uiEvent("scroll",this.handleScroll)],super.initialize()}get focusableEmoji(){return this.el.querySelector('[tabindex="0"]')}render(){let u=Object.create(null,{render:{get:()=>super.render}});return kt(this,void 0,void 0,function*(){this.emojiCategories=this.categories.map(this.createCategory,this);let g={};return this.categories.forEach((v,C)=>{g[`emojis-${v.key}`]=this.emojiCategories[C]}),yield u.render.call(this,{emojis:yield Promise.all(this.emojiCategories.map(v=>v.render()))}),this.lazyLoader.observe(this.el),window.ResizeObserver&&(this.observer=new ResizeObserver(()=>{let v=this.el.scrollHeight-this.scrollHeight;this.el.scrollTop-this.scrollTop===0&&v>0&&(this.el.scrollTop+=v),this.scrollHeight=this.el.scrollHeight,this.scrollTop=this.el.scrollTop}),this.emojiCategories.forEach(v=>{this.observer.observe(v.el)})),this.el})}destroy(){super.destroy(),this.emojiCategories.forEach(u=>{var g;(g=this.observer)===null||g===void 0||g.unobserve(u.el),u.destroy()})}handleCategorySelect(u,g){this.selectCategory(u,g)}createCategory(u){let g=function(v){return Zb[v.key]||ff}(u);return this.viewFactory.create(g,{category:u,showVariants:!0,lazyLoader:this.lazyLoader,emojiVersion:this.emojiVersion,provider:this.options.recentsProvider})}determineInitialCategory(){var u;return this.options.initialCategory&&this.categories.find(g=>g.key===this.options.initialCategory)?this.options.initialCategory:(u=this.categories.find(g=>g.key!=="recents"))===null||u===void 0?void 0:u.key}determineFocusTarget(u){let g=this.emojiCategories.find(v=>v.category.key===u);return this.options.initialEmoji&&g?.el.querySelector(`[data-emoji="${this.options.initialEmoji}"]`)?this.options.initialEmoji:"button"}reset(){this.events.emit("preview:hide");let u=this.determineInitialCategory();u&&(this.selectCategory(u,{focus:this.determineFocusTarget(u),performFocus:!0,scroll:"jump"}),this.selectedCategory=this.getCategoryIndex(u))}getCategoryIndex(u){return this.categories.findIndex(g=>g.key===u)}focusPreviousCategory(u){this.selectedCategory>0&&this.focusCategory(this.selectedCategory-1,{row:"last",offset:u??this.options.emojisPerRow})}focusNextCategory(u){this.selectedCategory<this.categories.length-1&&this.focusCategory(this.selectedCategory+1,{row:"first",offset:u??0})}focusCategory(u,g){this.selectCategory(u,{focus:g,performFocus:!0})}selectCategory(u,g={}){var v;return kt(this,void 0,void 0,function*(){this.scrollListenerState="suspend";let{focus:C,performFocus:o,scroll:z}=Object.assign({performFocus:!1},g);this.emojiCategories[this.selectedCategory].setActive(!1);let B=this.selectedCategory=typeof u=="number"?u:this.getCategoryIndex(u);(v=this.categoryTabs)===null||v===void 0||v.setActiveTab(this.selectedCategory,o,C==="button");let H=this.emojiCategories[B].el.offsetTop;this.emojiCategories[B].setActive(!0,function(Y){return Y&&Y!=="button"?Y:{row:"first",offset:0}}(C),C!=="button"&&o),z&&(this.el.scrollTop=H),this.scrollListenerState="resume"})}updateFocusedCategory(u){var g;this.categories[this.selectedCategory].key!==u&&(this.scrollListenerState="suspend",this.selectedCategory=this.getCategoryIndex(u),(g=this.categoryTabs)===null||g===void 0||g.setActiveTab(this.selectedCategory,!1),this.scrollListenerState="resume")}handleScroll(){if(this.scrollListenerState==="suspend"||!this.categoryTabs)return;if(this.scrollListenerState==="resume")return void(this.scrollListenerState="active");let u=this.el.scrollTop,g=this.el.scrollHeight-this.el.offsetHeight,v=this.emojiCategories.findIndex((C,o)=>{var z;return u<((z=this.emojiCategories[o+1])===null||z===void 0?void 0:z.el.offsetTop)});u===0?this.categoryTabs.setActiveTab(0,!1):Math.floor(u)===Math.floor(g)||v<0?this.categoryTabs.setActiveTab(this.categories.length-1,!1):this.categoryTabs.setActiveTab(v,!1)}},Wb=new Ii(({classList:c,classes:u,icon:g,message:v})=>`
<div class="${c}" role="alert">
  <div class="${u.icon}"><i data-size="10x" data-icon="${g}"></i></div>
  <h3 class="${u.title}">${v}</h3>
</div>
`),ny={error:"ErrorMessage_error__7I7y1",icon:"ErrorMessage_icon__4---V","appear-grow":"ErrorMessage_appear-grow__oBenJ",title:"ErrorMessage_title__shDDT",appear:"ErrorMessage_appear__kry-R"};sr(`@keyframes ErrorMessage_appear__kry-R {
  0% {
    opacity: 0;
  }
  100% {
    opacity: 0.8;
  }
}
@keyframes ErrorMessage_appear-grow__oBenJ {
  0% {
    opacity: 0;
    transform: scale(0.8);
  }
  100% {
    opacity: 0.8;
    transform: scale(1);
  }
}
.ErrorMessage_error__7I7y1 {
  display: flex;
  flex-direction: column;
  align-items: center;
  justify-content: center;
  height: 100%;
  color: var(--secondary-text-color);
}
.ErrorMessage_error__7I7y1 .ErrorMessage_icon__4---V {
  opacity: 0.8;
  animation: ErrorMessage_appear-grow__oBenJ 250ms cubic-bezier(0.175, 0.885, 0.32, 1.275);
  --color-primary: var(--error-color);
  --color-secondary: var(--error-color-dark);
}
.ErrorMessage_error__7I7y1 .ErrorMessage_title__shDDT {
  animation: ErrorMessage_appear__kry-R 250ms;
  animation-delay: 50ms;
  animation-fill-mode: both;
}
.ErrorMessage_error__7I7y1 button {
  padding: 8px 16px;
  cursor: pointer;
  background: var(--background-color);
  border: 1px solid var(--text-color);
  border-radius: 5px;
  color: var(--text-color);
}
.ErrorMessage_error__7I7y1 button:hover {
  background: var(--text-color);
  color: var(--background-color);
}`);var Uc=class extends St{constructor({message:u,icon:g="warning",template:v=Wb,className:C}){super({template:v,classes:ny}),this.message=u,this.icon=g,this.className=C}renderSync(){let u=[ny.error,this.className].join(" ").trim();return super.renderSync({message:this.message,icon:this.icon,classList:u})}},Hb="DataError_dataError__jyJ0H";sr(`.DataError_dataError__jyJ0H [data-icon] {
  opacity: 0.8;
}`);var Xb=new Ii(({classList:c,classes:u,icon:g,i18n:v,message:C})=>`
  <div class="${c}">
    <div class="${u.icon}"><i data-size="10x" data-icon="${g}"></i></div>
    <h3 class="${u.title}">${C}</h3>
    <button type="button">${v.get("retry")}</button>
  </div>
`),_f=class extends Uc{constructor({message:u}){super({message:u,template:Xb,className:Hb})}initialize(){this.uiElements={retryButton:"button"},this.uiEvents=[St.childEvent("retryButton","click",this.onRetry)],super.initialize()}onRetry(){return kt(this,void 0,void 0,function*(){this.emojiData?yield this.emojiData.delete():yield this.options.dataStore.deleteDatabase(this.options.locale),this.events.emit("reinitialize");let u=yield uy(this.options.locale,this.options.dataStore,this.options.messages,this.options.emojiData,this.emojiData);this.viewFactory.setEmojiData(u),this.events.emit("data:ready",u)})}},Dc={preview:"Preview_preview__HcFH6",previewEmoji:"Preview_previewEmoji__vjUki",previewName:"Preview_previewName__C79nL",tagList:"Preview_tagList__DielP",tag:"Preview_tag__aUSTM"};sr(`.Preview_preview__HcFH6 {
  border-top: 1px solid var(--border-color);
  display: grid;
  align-items: center;
  gap: 6px;
  grid-template-columns: auto 1fr;
  grid-template-rows: auto 1fr;
  grid-template-areas: "emoji name" "emoji tags";
  height: var(--emoji-preview-height);
  box-sizing: border-box;
  padding: 0.5em;
  position: relative;
  background: var(--preview-background-color);
}

.Preview_previewEmoji__vjUki {
  grid-area: emoji;
  font-size: var(--emoji-preview-size);
  font-family: var(--emoji-font);
  width: 1.25em;
  display: flex;
  align-items: center;
  justify-content: center;
}

.Preview_previewName__C79nL {
  grid-area: name;
  color: var(--text-color);
  font-size: 0.8em;
  white-space: nowrap;
  overflow: hidden;
  text-overflow: ellipsis;
  font-weight: 500;
}

.Preview_tagList__DielP {
  grid-area: tags;
  list-style-type: none;
  display: flex;
  flex-direction: row;
  padding: 0;
  margin: 0;
  font-size: 0.75em;
  overflow: hidden;
}

.Preview_tag__aUSTM {
  border-radius: 3px;
  background: var(--tag-background-color);
  color: var(--text-color);
  padding: 2px 8px;
  margin-right: 0.25em;
  white-space: nowrap;
}
.Preview_tag__aUSTM:last-child {
  margin-right: 0;
}`);var Kb=new Ii(({classes:c,tag:u})=>`
  <li class="${c.tag}">${u}</li>
`),Yb=new Ii(({classes:c})=>`
  <div class="${c.preview}">
    <div class="${c.previewEmoji}"></div>
    <div class="${c.previewName}"></div>
    <ul class="${c.tagList}"></ul>
  </div>
`),yf=class extends St{constructor(){super({template:Yb,classes:Dc})}initialize(){this.uiElements={emoji:St.byClass(Dc.previewEmoji),name:St.byClass(Dc.previewName),tagList:St.byClass(Dc.tagList)},this.appEvents={"preview:show":this.showPreview,"preview:hide":this.hidePreview},super.initialize()}showPreview(u,g){if(this.ui.emoji.replaceChildren(g),this.ui.name.textContent=u.label,u.tags){this.ui.tagList.style.display="flex";let v=u.tags.map(C=>Kb.renderSync({tag:C,classes:Dc}));this.ui.tagList.replaceChildren(...v)}}hidePreview(){this.ui.emoji.replaceChildren(),this.ui.name.textContent="",this.ui.tagList.replaceChildren()}},Lc={searchContainer:"Search_searchContainer__aJW7V",searchField:"Search_searchField__tENKn",clearButton:"Search_clearButton__oFTEY",searchAccessory:"Search_searchAccessory__0rdYO",clearSearchButton:"Search_clearSearchButton__AoDtB",notFound:"Search_notFound__rOdr1"};sr(`.Search_searchContainer__aJW7V {
  display: flex;
  height: var(--search-height);
  box-sizing: border-box;
  padding: 0 8px;
  position: relative;
}

.Search_searchField__tENKn {
  background: var(--search-background-color);
  border-radius: 3px;
  border: none;
  box-sizing: border-box;
  color: var(--text-color);
  font-size: 0.9em;
  outline: none;
  padding-right: 2em;
  padding: 0.5em 2.25em 0.5em 0.5em;
  width: 100%;
}
.Search_searchField__tENKn:focus {
  background: var(--search-focus-background-color);
}
.Search_searchField__tENKn::placeholder {
  color: var(--search-placeholder-color);
}

.Search_clearButton__oFTEY {
  border: 0;
  color: var(--search-icon-color);
  background: transparent;
  cursor: pointer;
}

.Search_searchAccessory__0rdYO {
  color: var(--search-icon-color);
  height: 100%;
  position: absolute;
  right: 1em;
  top: 0;
  width: 1.25rem;
  display: flex;
  align-items: center;
}
.Search_searchAccessory__0rdYO svg {
  fill: var(--search-icon-color);
}

.Search_clearSearchButton__AoDtB {
  cursor: pointer;
  border: none;
  background: transparent;
  color: var(--search-icon-color);
  font-size: 1em;
  width: 100%;
  height: 100%;
  display: flex;
  align-items: center;
  padding: 0;
}

.Search_notFound__rOdr1 [data-icon] {
  fill: #f3e265;
}`);var Jb=new Ii(({classes:c,i18n:u})=>`
  <button title="${u.get("search.clear")}" class="${c.clearSearchButton}">
    <i data-icon="xmark"></i>
  </button>
`),Qb=new Ii(({classes:c,i18n:u})=>`
<div class="${c.searchContainer}">
  <input class="${c.searchField}" placeholder="${u.get("search")}">
  <span class="${c.searchAccessory}"></span>
</div>
`,{mode:"async"}),xf=class extends St{constructor({categories:u,emojiVersion:g}){super({template:Qb,classes:Lc}),this.categories=u.filter(v=>v.key!=="recents"),this.emojiVersion=g,this.search=Cb(this.search.bind(this),100)}initialize(){this.uiElements={searchField:St.byClass(Lc.searchField),searchAccessory:St.byClass(Lc.searchAccessory)},this.uiEvents=[St.childEvent("searchField","keydown",this.onKeyDown),St.childEvent("searchField","input",this.onSearchInput)],super.initialize()}render(){let u=Object.create(null,{render:{get:()=>super.render}});return kt(this,void 0,void 0,function*(){return yield u.render.call(this),this.searchIcon=py("search"),this.notFoundMessage=this.viewFactory.create(Uc,{message:this.i18n.get("search.notFound"),className:Lc.notFound,icon:"sad"}),this.notFoundMessage.renderSync(),this.errorMessage=this.viewFactory.create(Uc,{message:this.i18n.get("search.error")}),this.errorMessage.renderSync(),this.clearSearchButton=Jb.render({classes:Lc,i18n:this.i18n}),this.clearSearchButton.addEventListener("click",g=>this.onClearSearch(g)),this.searchField=this.ui.searchField,this.showSearchIcon(),this.el})}showSearchIcon(){this.showSearchAccessory(this.searchIcon)}showClearSearchButton(){this.showSearchAccessory(this.clearSearchButton)}showSearchAccessory(u){this.ui.searchAccessory.replaceChildren(u)}clear(){this.searchField.value="",this.showSearchIcon()}focus(){this.searchField.focus()}onClearSearch(u){var g;u.stopPropagation(),this.searchField.value="",(g=this.resultsContainer)===null||g===void 0||g.destroy(),this.resultsContainer=null,this.showSearchIcon(),this.events.emit("content:show"),this.searchField.focus()}handleResultsKeydown(u){this.resultsContainer&&u.key==="Escape"&&this.onClearSearch(u)}onKeyDown(u){var g;u.key==="Escape"&&this.searchField.value?this.onClearSearch(u):u.key!=="Enter"&&u.key!=="ArrowDown"||!this.resultsContainer||(u.preventDefault(),(g=this.resultsContainer.el.querySelector('[tabindex="0"]'))===null||g===void 0||g.focus())}onSearchInput(u){this.searchField.value?(this.showClearSearchButton(),this.search()):this.onClearSearch(u)}search(){var u;return kt(this,void 0,void 0,function*(){if(this.searchField.value)try{let g=yield this.emojiData.searchEmojis(this.searchField.value,this.customEmojis,this.emojiVersion,this.categories);if(this.events.emit("preview:hide"),g.length){let v=new Zu;this.resultsContainer=this.viewFactory.create(Zs,{emojis:g,fullHeight:!0,showVariants:!0,lazyLoader:v}),this.resultsContainer.renderSync(),!((u=this.resultsContainer)===null||u===void 0)&&u.el&&(v.observe(this.resultsContainer.el),this.resultsContainer.setActive(!0,{row:0,offset:0},!1),this.resultsContainer.el.addEventListener("keydown",C=>this.handleResultsKeydown(C)),this.events.emit("content:show",this.resultsContainer))}else this.events.emit("content:show",this.notFoundMessage)}catch{this.events.emit("content:show",this.errorMessage)}})}},e2=new Ii(({classes:c})=>`
  <div class="${c.variantOverlay}">
    <div class="${c.variantPopup}">
      <div data-view="emojis" data-render="sync"></div>
    </div>
  </div>
`),oy={variantOverlay:"VariantPopup_variantOverlay__gGwue",variantPopup:"VariantPopup_variantPopup__c2pHF"};sr(`.VariantPopup_variantOverlay__gGwue {
  background: var(--overlay-background-color);
  border-radius: 5px;
  display: flex;
  flex-direction: column;
  height: 100%;
  justify-content: center;
  left: 0;
  position: absolute;
  top: 0;
  width: 100%;
  z-index: 1;
}

.VariantPopup_variantPopup__c2pHF {
  background: var(--variant-popup-background-color);
  border-radius: 5px;
  margin: 0.5em;
  padding: 0.5em;
  text-align: center;
  user-select: none;
  display: flex;
  align-items: center;
  justify-content: center;
}`);var Wd={easing:"ease-in-out",duration:250,fill:"both"},sy={opacity:[0,1]},ay={opacity:[0,1],transform:["scale3d(0.8, 0.8, 0.8)","scale3d(1, 1, 1)"]},vf=class extends St{constructor({emoji:u,parent:g}){super({template:e2,classes:oy,parent:g}),this.focusedEmojiIndex=0,this.focusTrap=new Fc,this.animateShow=()=>Promise.all([Gs(this.el,sy,Wd,this.options),Gs(this.ui.popup,ay,Wd,this.options)]),this.emoji=u}initialize(){this.uiElements={popup:St.byClass(oy.variantPopup)},this.uiEvents=[St.uiEvent("click",this.handleClick),St.uiEvent("keydown",this.handleKeydown)],super.initialize()}animateHide(){let u=Object.assign(Object.assign({},Wd),{direction:"reverse"});return Promise.all([Gs(this.el,sy,u,this.options),Gs(this.ui.popup,ay,u,this.options)])}hide(){return kt(this,void 0,void 0,function*(){yield this.animateHide(),this.events.emit("variantPopup:hide")})}handleKeydown(u){u.key==="Escape"&&(this.hide(),u.stopPropagation())}handleClick(u){this.ui.popup.contains(u.target)||this.hide()}getEmoji(u){return this.renderedEmojis[u]}setFocusedEmoji(u){this.getEmoji(this.focusedEmojiIndex).tabIndex=-1,this.focusedEmojiIndex=u;let g=this.getEmoji(this.focusedEmojiIndex);g.tabIndex=0,g.focus()}destroy(){this.emojiContainer.destroy(),this.focusTrap.deactivate(),super.destroy()}renderSync(){let u=[Object.assign(Object.assign({},this.emoji),{skins:null}),...(this.emoji.skins||[]).map(g=>Object.assign(Object.assign({},g),{label:this.emoji.label,tags:this.emoji.tags}))];return this.emojiContainer=this.viewFactory.create(Zs,{emojis:u,preview:!1}),super.renderSync({emojis:this.emojiContainer}),u.length<this.options.emojisPerRow&&this.el.style.setProperty("--emojis-per-row",u.length.toString()),this.el}activate(){this.emojiContainer.setActive(!0,{row:0,offset:0},!0),this.focusTrap.activate(this.el)}},t2=new Ii(({classes:c,i18n:u,category:g,pickerId:v,icon:C})=>`
<li class="${c.categoryTab}">
  <button
    aria-selected="false"
    role="tab"
    class="${c.categoryButton}"
    tabindex="-1"
    title="${u.get(`categories.${g.key}`,g.message||g.key)}"
    type="button"
    data-category="${g.key}"
    id="${v}-category-${g.key}"
  >
    <i data-icon="${C}"></i>
</li>
`),Ou={categoryButtons:"CategoryTabs_categoryButtons__dJVp-",categoryButton:"CategoryTabs_categoryButton__AsR9b",categoryTab:"CategoryTabs_categoryTab__fAgQT",categoryTabActive:"CategoryTabs_categoryTabActive__691be"};sr(`.CategoryTabs_categoryButtons__dJVp- {
  --tab-size-ratio: 1.55;
  --tab-padding: 0.5em;
  --tab-area-width: calc(var(--picker-width) - (var(--tab-padding) * 2));
  --tab-size: calc((var(--tab-area-width) / var(--category-count))) / var(--tab-size-ratio);
  display: grid;
  grid-auto-columns: 1fr;
  grid-auto-flow: column;
  gap: var(--tab-gap);
  justify-content: center;
  margin: 0;
  padding: 0 var(--tab-padding);
  align-items: center;
  height: var(--category-tabs-height);
  box-sizing: border-box;
  position: relative;
  list-style-type: none;
}

.CategoryTabs_categoryButton__AsR9b {
  border-radius: 5px;
  background: transparent;
  border: 2px solid transparent;
  color: var(--category-tab-color);
  cursor: pointer;
  padding: 2px;
  vertical-align: middle;
  display: flex;
  align-items: center;
  justify-content: center;
  font-size: 1.2rem;
  font-size: min(var(--tab-size), 1.2rem);
  width: 1.6em;
  height: 1.6em;
  transition: all 100ms;
}
.CategoryTabs_categoryButton__AsR9b img {
  width: var(--category-tab-size);
  height: var(--category-tab-size);
}
.CategoryTabs_categoryButton__AsR9b:hover {
  background: var(--category-tab-highlight-background-color);
}

.CategoryTabs_categoryTab__fAgQT {
  display: flex;
  align-items: center;
  justify-content: stretch;
  transition: all 100ms;
}

.CategoryTabs_categoryTabActive__691be .CategoryTabs_categoryButton__AsR9b {
  color: var(--category-tab-active-color);
  background: linear-gradient(rgba(255, 255, 255, 0.75) 0%, rgba(255, 255, 255, 0.75) 100%), linear-gradient(var(--category-tab-active-color) 0%, var(--category-tab-active-color) 100%);
  border: 2px solid var(--category-tab-active-color);
}
.CategoryTabs_categoryTabActive__691be .CategoryTabs_categoryButton__AsR9b:hover {
  background-color: var(--category-tab-active-background-color);
}`);var bf=class extends St{constructor({category:u,icon:g}){super({template:t2,classes:Ou}),this.isActive=!1,this.category=u,this.icon=g}initialize(){this.uiElements={button:St.byClass(Ou.categoryButton)},this.uiEvents=[St.childEvent("button","click",this.selectCategory)],super.initialize()}renderSync(){return super.renderSync({category:this.category,icon:this.icon}),this.ui.button.ariaSelected="false",this.el}setActive(u,g=!0,v=!1){this.el.classList.toggle(Ou.categoryTabActive,u),g&&this.setFocused(u,v),this.isActive=u}setFocused(u,g=!1){this.ui.button.ariaSelected=u.toString(),u?(this.ui.button.tabIndex=0,this.ui.button.focus(),g&&this.events.emit("category:select",this.category.key,{scroll:"animate",focus:"button",performFocus:!1})):this.ui.button.tabIndex=-1}selectCategory(){this.isActive||this.events.emit("category:select",this.category.key,{scroll:"animate",focus:"button",performFocus:!0})}},i2=new Ii(({classes:c})=>`
  <ul role="tablist" class="${c.categoryButtons}">
    <div data-placeholder="tabs"></div>
  </ul>
`),wf=class extends St{constructor({categories:u}){super({template:i2,classes:Ou}),this.activeCategoryIndex=0,this.categories=u}initialize(){this.keyBindings={ArrowLeft:this.stepSelectedTab(-1),ArrowRight:this.stepSelectedTab(1)},super.initialize()}renderSync(){return this.tabViews=this.categories.map(u=>this.viewFactory.create(bf,{category:u,icon:Uu[u.key]})),super.renderSync({tabs:this.tabViews.map(u=>u.renderSync())}),this.currentTabView.setActive(!0),this.el}get currentCategory(){return this.categories[this.activeCategoryIndex]}get currentTabView(){return this.tabViews[this.activeCategoryIndex]}setActiveTab(u,g=!0,v=!0){if(u===this.activeCategoryIndex)return;let C=this.currentTabView,o=this.tabViews[u];C.setActive(!1,g),o.setActive(!0,g,v),this.activeCategoryIndex=u}getTargetCategory(u){return u<0?this.categories.length-1:u>=this.categories.length?0:u}stepSelectedTab(u){return()=>{let g=this.activeCategoryIndex+u;this.setActiveTab(this.getTargetCategory(g))}}},r2=[{version:15,emoji:String.fromCodePoint(129768)},{version:14,emoji:String.fromCodePoint(128733)},{version:13,emoji:String.fromCodePoint(129729)},{version:12,emoji:String.fromCodePoint(129449)},{version:11,emoji:String.fromCodePoint(129463)},{version:5,emoji:String.fromCodePoint(129322)},{version:4,emoji:String.fromCodePoint(9877)},{version:3,emoji:String.fromCodePoint(129314)},{version:2,emoji:String.fromCodePoint(128488)},{version:1,emoji:String.fromCodePoint(128512)}];function n2(){var c;let u=r2.find(g=>function(v){let C=document.createElement("canvas").getContext("2d");if(C)return C.textBaseline="top",C.font="32px Arial",C.fillText(v,0,0),C.getImageData(16,16,1,1).data[0]!==0}(g.emoji));return(c=u?.version)!==null&&c!==void 0?c:1}function Hd(c,u){return Array.from({length:c},()=>u).join("")}function o2(c){let{emojiCount:u,classes:g,theme:v,className:C}=c;return`
    <div class="${g.skeleton} ${g.picker} ${v} ${C}">
      ${(({showHeader:o,classes:z})=>o?`
    <header class="${z.header}">
      ${(({showSearch:B,classes:H})=>B?`
    <div class="${H.searchSkeleton}">
      <div class="${H.searchInput} ${H.placeholder}"></div>
    </div>
  `:"")(c)}
      ${(({showCategoryTabs:B,classes:H})=>B?`
    <div class="${H.categoryTabsSkeleton}">
      ${Hd(10,`<div class="${H.placeholder} ${H.categoryTab}"></div>`)}
    </div>
  `:"")(c)}
    </header>
  `:"")(c)}
      <div class="${g.contentSkeleton}">
        <div class="${g.placeholder} ${g.categoryName}"></div>
        <div class="${g.emojiGrid}">
          ${Hd(u,`<div class="${g.placeholder} ${g.emoji}"></div>`)}
        </div>
      </div>
      ${(({showPreview:o,classes:z})=>o?`
    <div class="${z.previewSkeleton}">
      <div class="${z.placeholder} ${z.previewEmoji}"></div>
      <div class="${z.placeholder} ${z.previewName}"></div>
      <ul class="${z.tagList}">
        ${Hd(3,`<li class="${z.placeholder} ${z.tag}"></li>`)}
      </ul>
    </div>
  `:"")(c)}
    </div>
  `}var s2=new Ii(c=>c.isLoaded?function(u){let{classes:g,theme:v,className:C=""}=u;return`
    <div class="${g.picker} ${v} ${C}">
      ${function({showHeader:o,classes:z}){return o?`
    <header class="${z.header}">
      <div data-view="search"></div>
      <div data-view="categoryTabs" data-render="sync"></div>
    </header>
  `:""}(u)}
      <div class="${g.content}">
        <div data-view="emojiArea"></div>
      </div>
      <div data-view="preview"></div>
    </div>
  `}(c):o2(c)),Ru={picker:"EmojiPicker_picker__19Vln",skeleton:"EmojiPicker_skeleton__M1a2g",placeholder:"EmojiPicker_placeholder__YDJn-",shine:"EmojiPicker_shine__s-vEs",searchSkeleton:"EmojiPicker_searchSkeleton__gNgdU",searchInput:"EmojiPicker_searchInput__tpaBs",categoryTabsSkeleton:"EmojiPicker_categoryTabsSkeleton__2dISl",categoryTab:"EmojiPicker_categoryTab__mmSVF",contentSkeleton:"EmojiPicker_contentSkeleton__UWfQu",categoryName:"EmojiPicker_categoryName__d2-Ed",emojiGrid:"EmojiPicker_emojiGrid__WnoCI",emoji:"EmojiPicker_emoji__jaN-w",previewSkeleton:"EmojiPicker_previewSkeleton__Bjqkm",previewEmoji:"EmojiPicker_previewEmoji__uOLbA",previewName:"EmojiPicker_previewName__QJ47d",tagList:"EmojiPicker_tagList__tc6nv",tag:"EmojiPicker_tag__gAU6B",overlay:"EmojiPicker_overlay__kDT99",content:"EmojiPicker_content__xT6Kl",fullHeight:"EmojiPicker_fullHeight__7kz2H",pluginContainer:"EmojiPicker_pluginContainer__Gz3yT",header:"EmojiPicker_header__eDZPD"};sr(`@keyframes EmojiPicker_shine__s-vEs {
  to {
    transform: translateX(100%);
  }
}
.EmojiPicker_picker__19Vln {
  --border-radius: 5px;
  --emoji-area-height: calc(
    (var(--row-count) * var(--emoji-size) * var(--emoji-size-multiplier)) + var(--category-name-height)
  );
  --content-height: var(--emoji-area-height);
  --emojis-per-row: 8;
  --row-count: 6;
  --emoji-preview-margin: 4px;
  --emoji-preview-height: calc(var(--emoji-preview-size) + 1em + 1px);
  --emoji-preview-height-full: calc(var(--emoji-preview-height) + var(--emoji-preview-margin));
  --emoji-preview-size: 2.75em;
  --emoji-size: 2rem;
  --emoji-size-multiplier: 1.3;
  --content-margin: 8px;
  --category-tabs-height: calc(1.5em + 4px + 4px + 1px);
  --category-tabs-offset: 8px;
  --category-tab-size: 1.2rem;
  --category-name-height: 2rem;
  --category-name-padding-y: 6px;
  --search-height: 2em;
  --search-margin: 0.5em;
  --search-margin-bottom: 4px;
  --search-height-full: calc(var(--search-height) + var(--search-margin) + var(--search-margin-bottom));
  --overlay-background-color: rgba(0, 0, 0, 0.8);
  --emoji-font: "Segoe UI Emoji", "Segoe UI Symbol", "Segoe UI", "Apple Color Emoji", "Twemoji Mozilla",
    "Noto Color Emoji", "EmojiOne Color", "Android Emoji";
  --ui-font: -apple-system, BlinkMacSystemFont, "Helvetica Neue", sans-serif;
  --ui-font-size: 16px;
  --picker-width: calc(var(--emojis-per-row) * var(--emoji-size) * var(--emoji-size-multiplier) + 2.75rem);
  background: var(--background-color);
  border-radius: var(--border-radius);
  border: 1px solid var(--border-color);
  font-family: var(--ui-font);
  font-size: var(--ui-font-size);
  overflow: hidden;
  position: relative;
  width: var(--picker-width);
  display: grid;
  gap: 8px;
}
.EmojiPicker_picker__19Vln > * {
  font-family: var(--ui-font);
}

.EmojiPicker_skeleton__M1a2g {
  background: var(--background-color);
  border-radius: var(--border-radius);
  border: 1px solid var(--border-color);
  font-family: var(--ui-font);
  width: var(--picker-width);
  color: var(--secondary-text-color);
}
.EmojiPicker_skeleton__M1a2g * {
  box-sizing: border-box;
}
.EmojiPicker_skeleton__M1a2g .EmojiPicker_placeholder__YDJn- {
  background: var(--placeholder-background-color);
  position: relative;
  overflow: hidden;
}
.EmojiPicker_skeleton__M1a2g .EmojiPicker_placeholder__YDJn-::after {
  position: absolute;
  top: 0;
  right: 0;
  bottom: 0;
  left: 0;
  transform: translateX(-100%);
  background-image: linear-gradient(90deg, rgba(255, 255, 255, 0) 0, rgba(255, 255, 255, 0.2) 20%, rgba(255, 255, 255, 0.5) 60%, rgba(255, 255, 255, 0));
  animation: EmojiPicker_shine__s-vEs 2s infinite;
  content: "";
}
.EmojiPicker_skeleton__M1a2g .EmojiPicker_searchSkeleton__gNgdU {
  padding: 0 8px;
  height: var(--search-height);
}
.EmojiPicker_skeleton__M1a2g .EmojiPicker_searchSkeleton__gNgdU .EmojiPicker_searchInput__tpaBs {
  width: 100%;
  height: 28px;
  border-radius: 3px;
}
.EmojiPicker_skeleton__M1a2g .EmojiPicker_categoryTabsSkeleton__2dISl {
  height: var(--category-tabs-height);
  display: flex;
  flex-direction: row;
  justify-content: space-around;
  align-items: center;
}
.EmojiPicker_skeleton__M1a2g .EmojiPicker_categoryTabsSkeleton__2dISl .EmojiPicker_categoryTab__mmSVF {
  width: 25px;
  height: 25px;
  padding: 2px;
  border-radius: 5px;
}
.EmojiPicker_skeleton__M1a2g .EmojiPicker_contentSkeleton__UWfQu {
  height: var(--content-height);
  padding-right: 8px;
  opacity: 0.7;
}
.EmojiPicker_skeleton__M1a2g .EmojiPicker_contentSkeleton__UWfQu .EmojiPicker_categoryName__d2-Ed {
  width: 50%;
  height: 1rem;
  margin: 0.5rem;
  box-sizing: border-box;
}
.EmojiPicker_skeleton__M1a2g .EmojiPicker_contentSkeleton__UWfQu .EmojiPicker_emojiGrid__WnoCI {
  display: grid;
  justify-content: space-between;
  gap: 1px;
  padding: 0 0.5em;
  grid-template-columns: repeat(var(--emojis-per-row), calc(var(--emoji-size) * var(--emoji-size-multiplier)));
  grid-auto-rows: calc(var(--emoji-size) * var(--emoji-size-multiplier));
  align-items: center;
  justify-items: center;
}
.EmojiPicker_skeleton__M1a2g .EmojiPicker_contentSkeleton__UWfQu .EmojiPicker_emojiGrid__WnoCI .EmojiPicker_emoji__jaN-w {
  width: var(--emoji-size);
  height: var(--emoji-size);
  border-radius: 50%;
}
.EmojiPicker_skeleton__M1a2g .EmojiPicker_previewSkeleton__Bjqkm {
  height: var(--emoji-preview-height);
  border-top: 1px solid var(--border-color);
  display: grid;
  align-items: center;
  padding: 0.5em;
  gap: 6px;
  grid-template-columns: auto 1fr;
  grid-template-rows: auto 1fr;
  grid-template-areas: "emoji name" "emoji tags";
}
.EmojiPicker_skeleton__M1a2g .EmojiPicker_previewSkeleton__Bjqkm .EmojiPicker_previewEmoji__uOLbA {
  grid-area: emoji;
  border-radius: 50%;
  width: var(--emoji-preview-size);
  height: var(--emoji-preview-size);
}
.EmojiPicker_skeleton__M1a2g .EmojiPicker_previewSkeleton__Bjqkm .EmojiPicker_previewName__QJ47d {
  grid-area: name;
  width: 12em;
  height: 0.8em;
}
.EmojiPicker_skeleton__M1a2g .EmojiPicker_previewSkeleton__Bjqkm .EmojiPicker_tagList__tc6nv {
  grid-area: tags;
  list-style-type: none;
  display: flex;
  flex-direction: row;
  padding: 0;
  margin: 0;
}
.EmojiPicker_skeleton__M1a2g .EmojiPicker_previewSkeleton__Bjqkm .EmojiPicker_tagList__tc6nv .EmojiPicker_tag__gAU6B {
  border-radius: 3px;
  padding: 2px 8px;
  margin-right: 0.25em;
  height: 1em;
  width: 3em;
}

.EmojiPicker_overlay__kDT99 {
  background: rgba(0, 0, 0, 0.75);
  height: 100%;
  left: 0;
  position: fixed;
  top: 0;
  width: 100%;
  z-index: 1000;
}

.EmojiPicker_content__xT6Kl {
  position: relative;
  overflow: hidden;
  height: var(--content-height);
}
.EmojiPicker_content__xT6Kl.EmojiPicker_fullHeight__7kz2H {
  height: calc(var(--content-height) + var(--category-tabs-height) + var(--category-tabs-offset));
  overflow-y: auto;
  scrollbar-color: var(--scrollbar-color) var(--scrollbar-background-color);
  scrollbar-width: 8px;
}
.EmojiPicker_content__xT6Kl.EmojiPicker_fullHeight__7kz2H::-webkit-scrollbar {
  background: var(--scrollbar-background-color);
  width: 1.1em;
}
.EmojiPicker_content__xT6Kl.EmojiPicker_fullHeight__7kz2H::-webkit-scrollbar-thumb {
  background: var(--scrollbar-color);
  border-left: 4px solid transparent;
  border-right: 4px solid transparent;
  background-clip: padding-box;
  height: 1em;
  border-radius: 1em;
}

.EmojiPicker_pluginContainer__Gz3yT {
  margin: 0.5em;
  display: flex;
  flex-direction: row;
}

.EmojiPicker_header__eDZPD {
  background-color: var(--secondary-background-color);
  padding-top: 8px;
  padding-bottom: 8px;
  display: grid;
  gap: 8px;
  border-bottom: 1px solid var(--border-color);
}

@media (prefers-reduced-motion: reduce) {
  .EmojiPicker_placeholder__YDJn- {
    background: var(--placeholder-background-color);
    position: relative;
    overflow: hidden;
  }
  .EmojiPicker_placeholder__YDJn-::after {
    display: none;
  }
}`);var ly={emojisPerRow:"--emojis-per-row",visibleRows:"--row-count",emojiSize:"--emoji-size"},Ef=class extends St{constructor(){super({template:s2,classes:Ru}),this.pickerReady=!1,this.externalEvents=new uf}initialize(){this.uiElements={pickerContent:St.byClass(Ru.content),header:St.byClass(Ru.header)},this.uiEvents=[St.uiEvent("keydown",this.handleKeyDown)],this.appEvents={error:this.onError,reinitialize:this.reinitialize,"data:ready":this.onDataReady,"content:show":this.showContent,"variantPopup:hide":this.hideVariantPopup,"emoji:select":this.selectEmoji},super.initialize(),this.options.recentsProvider}destroy(){var u,g;super.destroy(),(u=this.search)===null||u===void 0||u.destroy(),this.emojiArea.destroy(),(g=this.categoryTabs)===null||g===void 0||g.destroy(),this.events.removeAll(),this.externalEvents.removeAll()}clearRecents(){this.options.recentsProvider.clear()}addEventListener(u,g){this.externalEvents.on(u,g)}removeEventListener(u,g){this.externalEvents.off(u,g)}initializePickerView(){this.pickerReady&&(this.showContent(),this.emojiArea.reset())}handleKeyDown(u){let g=u.ctrlKey||u.metaKey;u.key==="s"&&g&&this.search&&(u.preventDefault(),this.search.focus())}buildChildViews(){return this.options.showPreview&&(this.preview=this.viewFactory.create(yf)),this.options.showSearch&&(this.search=this.viewFactory.create(xf,{categories:this.categories,emojiVersion:this.emojiVersion})),this.options.showCategoryTabs&&(this.categoryTabs=this.viewFactory.create(wf,{categories:this.categories})),this.currentView=this.emojiArea=this.viewFactory.create(gf,{categoryTabs:this.categoryTabs,categories:this.categories,emojiVersion:this.emojiVersion}),[this.preview,this.search,this.emojiArea,this.categoryTabs]}setStyleProperties(){this.options.showSearch||this.el.style.setProperty("--search-height-full","0px"),this.options.showCategoryTabs||(this.el.style.setProperty("--category-tabs-height","0px"),this.el.style.setProperty("--category-tabs-offset","0px")),this.options.showPreview||this.el.style.setProperty("--emoji-preview-height-full","0px"),Object.keys(ly).forEach(u=>{this.options[u]&&this.el.style.setProperty(ly[u],this.options[u].toString())})}reinitialize(){this.renderSync()}onError(u){let g=this.viewFactory.create(_f,{message:this.i18n.get("error.load")}),v=this.el.offsetHeight||375;throw this.el.style.height=`${v}px`,this.el.replaceChildren(g.renderSync()),u}onDataReady(u){let g=Object.create(null,{render:{get:()=>super.render}});return kt(this,void 0,void 0,function*(){let v=this.el;try{u?this.emojiData=u:yield this.emojiDataPromise,this.options.emojiVersion==="auto"?this.emojiVersion=n2()||parseFloat("14.0"):this.emojiVersion=this.options.emojiVersion,this.categories=yield this.emojiData.getCategories(this.options);let[C,o,z,B]=this.buildChildViews();yield g.render.call(this,{isLoaded:!0,search:o,categoryTabs:B,emojiArea:z,preview:C,showHeader:Boolean(this.search||this.categoryTabs),theme:this.options.theme,className:this.options.className}),this.el.style.setProperty("--category-count",this.categories.length.toString()),this.pickerReady=!0,v.replaceWith(this.el),this.setStyleProperties(),this.initializePickerView(),this.setInitialFocus(),this.externalEvents.emit("data:ready")}catch(C){this.events.emit("error",C)}})}renderSync(){if(super.renderSync({isLoaded:!1,theme:this.options.theme,showSearch:this.options.showSearch,showPreview:this.options.showPreview,showCategoryTabs:this.options.showCategoryTabs,showHeader:this.options.showSearch||this.options.showCategoryTabs,emojiCount:this.options.emojisPerRow*this.options.visibleRows}),!this.options.rootElement)throw new Error("Picker must be given a root element via the rootElement option");return this.options.rootElement.replaceChildren(this.el),this.setStyleProperties(),this.pickerReady&&this.initializePickerView(),this.el}getInitialFocusTarget(){if(this.options.autoFocus!==void 0)switch(this.options.autoFocus){case"emojis":return this.emojiArea.focusableEmoji;case"search":return this.search;default:return null}if(this.options.autoFocusSearch===!0)return console.warn("options.autoFocusSearch is deprecated, please use options.focusTarget instead"),this.search}setInitialFocus(){var u;this.pickerReady&&((u=this.getInitialFocusTarget())===null||u===void 0||u.focus())}reset(){this.pickerReady&&(this.emojiArea.reset(),this.showContent(this.emojiArea)),this.search&&this.search.clear()}showContent(u=this.emojiArea){var g,v;u!==this.currentView&&(this.currentView!==this.emojiArea&&((g=this.currentView)===null||g===void 0||g.destroy()),this.ui.pickerContent.classList.toggle(Ru.fullHeight,u!==this.emojiArea),this.ui.pickerContent.replaceChildren(u.el),this.currentView=u,u===this.emojiArea?(this.emojiArea.reset(),this.categoryTabs&&this.ui.header.appendChild(this.categoryTabs.el)):(v=this.categoryTabs)===null||v===void 0||v.el.remove())}hideVariantPopup(){var u;(u=this.variantPopup)===null||u===void 0||u.destroy()}isPickerClick(u){var g,v;let C=u.target,o=this.el.contains(C),z=(v=(g=this.variantPopup)===null||g===void 0?void 0:g.el)===null||v===void 0?void 0:v.contains(C);return o||z}selectEmoji({emoji:u}){var g,v;return kt(this,void 0,void 0,function*(){((g=u.skins)===null||g===void 0?void 0:g.length)&&this.options.showVariants&&!this.isVariantPopupOpen?this.showVariantPopup(u):(yield(v=this.variantPopup)===null||v===void 0?void 0:v.animateHide(),this.events.emit("variantPopup:hide"),yield this.emitEmoji(u))})}get isVariantPopupOpen(){return this.variantPopup&&!this.variantPopup.isDestroyed}showVariantPopup(u){return kt(this,void 0,void 0,function*(){let g=document.activeElement;this.events.once("variantPopup:hide",()=>{g?.focus()}),this.variantPopup=this.viewFactory.create(vf,{emoji:u,parent:this.el}),this.el.appendChild(this.variantPopup.renderSync()),this.variantPopup.activate()})}emitEmoji(u){return kt(this,void 0,void 0,function*(){this.externalEvents.emit("emoji:select",yield this.renderer.doEmit(u)),this.options.recentsProvider.addOrUpdateRecent(u,this.options.maxRecents),this.events.emit("recent:add",u)})}},Tf=class{constructor({events:u,i18n:g,renderer:v,emojiData:C,options:o,customEmojis:z=[],pickerId:B}){this.events=u,this.i18n=g,this.renderer=v,this.emojiData=C,this.options=o,this.customEmojis=z,this.pickerId=B}setEmojiData(u){this.emojiData=Promise.resolve(u)}create(u,...g){let v=new u(...g);return v.setPickerId(this.pickerId),v.setEvents(this.events),v.setI18n(this.i18n),v.setRenderer(this.renderer),v.setEmojiData(this.emojiData),v.setOptions(this.options),v.setCustomEmojis(this.customEmojis),v.viewFactory=this,v.initialize(),v}},ju,Cf=class{constructor(u={}){ju.set(this,void 0),Kd(this,ju,new Map(Object.entries(u)),"f")}get(u,g=u){return Mi(this,ju,"f").get(u)||g}};ju=new WeakMap;var a2=0;function fy(c){let u=Af(c),g=(u?.custom||[]).map(B=>Object.assign(Object.assign({},B),{custom:!0,tags:["custom",...B.tags||[]]})),v=new hf,C=function(B){return uy(B.locale,B.dataStore,B.messages,B.emojiData)}(u),o=new Cf(u.i18n);C.then(B=>{v.emit("data:ready",B)}).catch(B=>{v.emit("error",B)});let z=new Tf({events:v,i18n:o,customEmojis:g,renderer:u.renderer,options:u,emojiData:C,pickerId:`picmo-${Date.now()}-${a2++}`}).create(Ef);return z.renderSync(),z}var Xd={};function l2(c){return Xd[c]||(Xd[c]=new kf(c)),Xd[c]}l2.deleteDatabase=c=>{};var kf=class extends Gu{open(){return Promise.resolve()}delete(){return Promise.resolve()}close(){}isPopulated(){return Promise.resolve(!1)}getEmojiCount(){return Promise.resolve(this.emojis.length)}getEtags(){return Promise.resolve({foo:"bar"})}getHash(){return Promise.resolve("")}populate(u){return this.categories=u.groups,this.emojis=u.emojis,Promise.resolve()}getCategories(u){var g;let v=this.categories.filter(C=>C.key!=="component");if(u.showRecents&&v.unshift({key:"recents",order:-1}),!((g=u.custom)===null||g===void 0)&&g.length&&v.push({key:"custom",order:10}),u.categories){let C=u.categories;v=v.filter(o=>C.includes(o.key)),v.sort((o,z)=>C.indexOf(o.key)-C.indexOf(z.key))}else v.sort((C,o)=>C.order-o.order);return Promise.resolve(v)}getEmojis(u,g){let v=this.emojis.filter(C=>C.group===u.order).filter(C=>C.version<=g).sort((C,o)=>C.order!=null&&o.order!=null?C.order-o.order:0).map(Oc);return Promise.resolve(Vu(v,g))}searchEmojis(u,g,v,C){let o=this.emojis.filter(H=>Nu(H,u,C)).map(Oc),z=g.filter(H=>Nu(H,u,C)),B=[...Vu(o,v),...z];return Promise.resolve(B)}setMeta(u){this.meta=u}};function Uo(c,u,g,v){return new(g||(g=Promise))(function(C,o){function z(Y){try{H(v.next(Y))}catch(oe){o(oe)}}function B(Y){try{H(v.throw(Y))}catch(oe){o(oe)}}function H(Y){var oe;Y.done?C(Y.value):(oe=Y.value,oe instanceof g?oe:new g(function(Ee){Ee(oe)})).then(z,B)}H((v=v.apply(c,u||[])).next())})}var Mf=class extends qs{};function Ws(c){return c.split("-")[0]}function al(c){return c.split("-")[1]}function Yu(c){return["top","bottom"].includes(Ws(c))?"x":"y"}function Ty(c){return c==="y"?"height":"width"}function my(c,u,g){let{reference:v,floating:C}=c,o=v.x+v.width/2-C.width/2,z=v.y+v.height/2-C.height/2,B=Yu(u),H=Ty(B),Y=v[H]/2-C[H]/2,oe=B==="x",Ee;switch(Ws(u)){case"top":Ee={x:o,y:v.y-C.height};break;case"bottom":Ee={x:o,y:v.y+v.height};break;case"right":Ee={x:v.x+v.width,y:z};break;case"left":Ee={x:v.x-C.width,y:z};break;default:Ee={x:v.x,y:v.y}}switch(al(u)){case"start":Ee[B]-=Y*(g&&oe?-1:1);break;case"end":Ee[B]+=Y*(g&&oe?-1:1)}return Ee}function Wu(c){return{...c,top:c.y,left:c.x,right:c.x+c.width,bottom:c.y+c.height}}async function Df(c,u){var g;u===void 0&&(u={});let{x:v,y:C,platform:o,rects:z,elements:B,strategy:H}=c,{boundary:Y="clippingAncestors",rootBoundary:oe="viewport",elementContext:Ee="floating",altBoundary:Ae=!1,padding:Ce=0}=u,Ge=function(wt){return typeof wt!="number"?function(Je){return{top:0,right:0,bottom:0,left:0,...Je}}(wt):{top:wt,right:wt,bottom:wt,left:wt}}(Ce),Ke=B[Ae?Ee==="floating"?"reference":"floating":Ee],Ye=Wu(await o.getClippingRect({element:(g=await(o.isElement==null?void 0:o.isElement(Ke)))==null||g?Ke:Ke.contextElement||await(o.getDocumentElement==null?void 0:o.getDocumentElement(B.floating)),boundary:Y,rootBoundary:oe,strategy:H})),ut=Wu(o.convertOffsetParentRelativeRectToViewportRelativeRect?await o.convertOffsetParentRelativeRectToViewportRelativeRect({rect:Ee==="floating"?{...z.floating,x:v,y:C}:z.reference,offsetParent:await(o.getOffsetParent==null?void 0:o.getOffsetParent(B.floating)),strategy:H}):z[Ee]);return{top:Ye.top-ut.top+Ge.top,bottom:ut.bottom-Ye.bottom+Ge.bottom,left:Ye.left-ut.left+Ge.left,right:ut.right-Ye.right+Ge.right}}var c2=Math.min,h2=Math.max;function gy(c,u,g){return h2(c,c2(u,g))}var u2={left:"right",right:"left",bottom:"top",top:"bottom"};function Hu(c){return c.replace(/left|right|bottom|top/g,u=>u2[u])}function Cy(c,u,g){g===void 0&&(g=!1);let v=al(c),C=Yu(c),o=Ty(C),z=C==="x"?v===(g?"end":"start")?"right":"left":v==="start"?"bottom":"top";return u.reference[o]>u.floating[o]&&(z=Hu(z)),{main:z,cross:Hu(z)}}var p2={start:"end",end:"start"};function If(c){return c.replace(/start|end/g,u=>p2[u])}var d2=["top","right","bottom","left"].reduce((c,u)=>c.concat(u,u+"-start",u+"-end"),[]),f2=function(c){return c===void 0&&(c={}),{name:"autoPlacement",options:c,async fn(u){var g,v,C,o,z;let{x:B,y:H,rects:Y,middlewareData:oe,placement:Ee,platform:Ae,elements:Ce}=u,{alignment:Ge=null,allowedPlacements:Ke=d2,autoAlignment:Ye=!0,...ut}=c,wt=function(vi,cr,Ri){return(vi?[...Ri.filter(Si=>al(Si)===vi),...Ri.filter(Si=>al(Si)!==vi)]:Ri.filter(Si=>Ws(Si)===Si)).filter(Si=>!vi||al(Si)===vi||!!cr&&If(Si)!==Si)}(Ge,Ye,Ke),Je=await Df(u,ut),Et=(g=(v=oe.autoPlacement)==null?void 0:v.index)!=null?g:0,It=wt[Et];if(It==null)return{};let{main:Ht,cross:li}=Cy(It,Y,await(Ae.isRTL==null?void 0:Ae.isRTL(Ce.floating)));if(Ee!==It)return{x:B,y:H,reset:{placement:wt[0]}};let Bt=[Je[Ws(It)],Je[Ht],Je[li]],Ci=[...(C=(o=oe.autoPlacement)==null?void 0:o.overflows)!=null?C:[],{placement:It,overflows:Bt}],ki=wt[Et+1];if(ki)return{data:{index:Et+1,overflows:Ci},reset:{placement:ki}};let ar=Ci.slice().sort((vi,cr)=>vi.overflows[0]-cr.overflows[0]),lr=(z=ar.find(vi=>{let{overflows:cr}=vi;return cr.every(Ri=>Ri<=0)}))==null?void 0:z.placement,Ji=lr??ar[0].placement;return Ji!==Ee?{data:{index:Et+1,overflows:Ci},reset:{placement:Ji}}:{}}}},m2=function(c){return c===void 0&&(c={}),{name:"flip",options:c,async fn(u){var g;let{placement:v,middlewareData:C,rects:o,initialPlacement:z,platform:B,elements:H}=u,{mainAxis:Y=!0,crossAxis:oe=!0,fallbackPlacements:Ee,fallbackStrategy:Ae="bestFit",flipAlignment:Ce=!0,...Ge}=c,Ke=Ws(v),Ye=Ee||(Ke===z||!Ce?[Hu(z)]:function(Bt){let Ci=Hu(Bt);return[If(Bt),Ci,If(Ci)]}(z)),ut=[z,...Ye],wt=await Df(u,Ge),Je=[],Et=((g=C.flip)==null?void 0:g.overflows)||[];if(Y&&Je.push(wt[Ke]),oe){let{main:Bt,cross:Ci}=Cy(v,o,await(B.isRTL==null?void 0:B.isRTL(H.floating)));Je.push(wt[Bt],wt[Ci])}if(Et=[...Et,{placement:v,overflows:Je}],!Je.every(Bt=>Bt<=0)){var It,Ht;let Bt=((It=(Ht=C.flip)==null?void 0:Ht.index)!=null?It:0)+1,Ci=ut[Bt];if(Ci)return{data:{index:Bt,overflows:Et},reset:{placement:Ci}};let ki="bottom";switch(Ae){case"bestFit":{var li;let ar=(li=Et.map(lr=>[lr,lr.overflows.filter(Ji=>Ji>0).reduce((Ji,vi)=>Ji+vi,0)]).sort((lr,Ji)=>lr[1]-Ji[1])[0])==null?void 0:li[0].placement;ar&&(ki=ar);break}case"initialPlacement":ki=z}if(v!==ki)return{reset:{placement:ki}}}return{}}}},_y=function(c){return c===void 0&&(c=0),{name:"offset",options:c,async fn(u){let{x:g,y:v}=u,C=await async function(o,z){let{placement:B,platform:H,elements:Y}=o,oe=await(H.isRTL==null?void 0:H.isRTL(Y.floating)),Ee=Ws(B),Ae=al(B),Ce=Yu(B)==="x",Ge=["left","top"].includes(Ee)?-1:1,Ke=oe&&Ce?-1:1,Ye=typeof z=="function"?z(o):z,{mainAxis:ut,crossAxis:wt,alignmentAxis:Je}=typeof Ye=="number"?{mainAxis:Ye,crossAxis:0,alignmentAxis:null}:{mainAxis:0,crossAxis:0,alignmentAxis:null,...Ye};return Ae&&typeof Je=="number"&&(wt=Ae==="end"?-1*Je:Je),Ce?{x:wt*Ke,y:ut*Ge}:{x:ut*Ge,y:wt*Ke}}(u,c);return{x:g+C.x,y:v+C.y,data:C}}}},yy=function(c){return c===void 0&&(c={}),{name:"shift",options:c,async fn(u){let{x:g,y:v,placement:C}=u,{mainAxis:o=!0,crossAxis:z=!1,limiter:B={fn:Ye=>{let{x:ut,y:wt}=Ye;return{x:ut,y:wt}}},...H}=c,Y={x:g,y:v},oe=await Df(u,H),Ee=Yu(Ws(C)),Ae=Ee==="x"?"y":"x",Ce=Y[Ee],Ge=Y[Ae];if(o){let Ye=Ee==="y"?"bottom":"right";Ce=gy(Ce+oe[Ee==="y"?"top":"left"],Ce,Ce-oe[Ye])}if(z){let Ye=Ae==="y"?"bottom":"right";Ge=gy(Ge+oe[Ae==="y"?"top":"left"],Ge,Ge-oe[Ye])}let Ke=B.fn({...u,[Ee]:Ce,[Ae]:Ge});return{...Ke,data:{x:Ke.x-g,y:Ke.y-v}}}}};function ky(c){return c&&c.document&&c.location&&c.alert&&c.setInterval}function to(c){if(c==null)return window;if(!ky(c)){let u=c.ownerDocument;return u&&u.defaultView||window}return c}function Nc(c){return to(c).getComputedStyle(c)}function Qn(c){return ky(c)?"":c?(c.nodeName||"").toLowerCase():""}function Sy(){let c=navigator.userAgentData;return c!=null&&c.brands?c.brands.map(u=>u.brand+"/"+u.version).join(" "):navigator.userAgent}function Sn(c){return c instanceof to(c).HTMLElement}function No(c){return c instanceof to(c).Element}function Lf(c){return typeof ShadowRoot>"u"?!1:c instanceof to(c).ShadowRoot||c instanceof ShadowRoot}function Ju(c){let{overflow:u,overflowX:g,overflowY:v}=Nc(c);return/auto|scroll|overlay|hidden/.test(u+v+g)}function g2(c){return["table","td","th"].includes(Qn(c))}function xy(c){let u=/firefox/i.test(Sy()),g=Nc(c);return g.transform!=="none"||g.perspective!=="none"||g.contain==="paint"||["transform","perspective"].includes(g.willChange)||u&&g.willChange==="filter"||u&&!!g.filter&&g.filter!=="none"}function Ay(){return!/^((?!chrome|android).)*safari/i.test(Sy())}var vy=Math.min,Vc=Math.max,Xu=Math.round;function eo(c,u,g){var v,C,o,z;u===void 0&&(u=!1),g===void 0&&(g=!1);let B=c.getBoundingClientRect(),H=1,Y=1;u&&Sn(c)&&(H=c.offsetWidth>0&&Xu(B.width)/c.offsetWidth||1,Y=c.offsetHeight>0&&Xu(B.height)/c.offsetHeight||1);let oe=No(c)?to(c):window,Ee=!Ay()&&g,Ae=(B.left+(Ee&&(v=(C=oe.visualViewport)==null?void 0:C.offsetLeft)!=null?v:0))/H,Ce=(B.top+(Ee&&(o=(z=oe.visualViewport)==null?void 0:z.offsetTop)!=null?o:0))/Y,Ge=B.width/H,Ke=B.height/Y;return{width:Ge,height:Ke,top:Ce,right:Ae+Ge,bottom:Ce+Ke,left:Ae,x:Ae,y:Ce}}function Vo(c){return(u=c,(u instanceof to(u).Node?c.ownerDocument:c.document)||window.document).documentElement;var u}function Qu(c){return No(c)?{scrollLeft:c.scrollLeft,scrollTop:c.scrollTop}:{scrollLeft:c.pageXOffset,scrollTop:c.pageYOffset}}function My(c){return eo(Vo(c)).left+Qu(c).scrollLeft}function _2(c,u,g){let v=Sn(u),C=Vo(u),o=eo(c,v&&function(H){let Y=eo(H);return Xu(Y.width)!==H.offsetWidth||Xu(Y.height)!==H.offsetHeight}(u),g==="fixed"),z={scrollLeft:0,scrollTop:0},B={x:0,y:0};if(v||!v&&g!=="fixed")if((Qn(u)!=="body"||Ju(C))&&(z=Qu(u)),Sn(u)){let H=eo(u,!0);B.x=H.x+u.clientLeft,B.y=H.y+u.clientTop}else C&&(B.x=My(C));return{x:o.left+z.scrollLeft-B.x,y:o.top+z.scrollTop-B.y,width:o.width,height:o.height}}function Iy(c){return Qn(c)==="html"?c:c.assignedSlot||c.parentNode||(Lf(c)?c.host:null)||Vo(c)}function by(c){return Sn(c)&&getComputedStyle(c).position!=="fixed"?c.offsetParent:null}function zf(c){let u=to(c),g=by(c);for(;g&&g2(g)&&getComputedStyle(g).position==="static";)g=by(g);return g&&(Qn(g)==="html"||Qn(g)==="body"&&getComputedStyle(g).position==="static"&&!xy(g))?u:g||function(v){let C=Iy(v);for(Lf(C)&&(C=C.host);Sn(C)&&!["html","body"].includes(Qn(C));){if(xy(C))return C;C=C.parentNode}return null}(c)||u}function wy(c){if(Sn(c))return{width:c.offsetWidth,height:c.offsetHeight};let u=eo(c);return{width:u.width,height:u.height}}function zy(c){let u=Iy(c);return["html","body","#document"].includes(Qn(u))?c.ownerDocument.body:Sn(u)&&Ju(u)?u:zy(u)}function Ku(c,u){var g;u===void 0&&(u=[]);let v=zy(c),C=v===((g=c.ownerDocument)==null?void 0:g.body),o=to(v),z=C?[o].concat(o.visualViewport||[],Ju(v)?v:[]):v,B=u.concat(z);return C?B:B.concat(Ku(z))}function Ey(c,u,g){return u==="viewport"?Wu(function(v,C){let o=to(v),z=Vo(v),B=o.visualViewport,H=z.clientWidth,Y=z.clientHeight,oe=0,Ee=0;if(B){H=B.width,Y=B.height;let Ae=Ay();(Ae||!Ae&&C==="fixed")&&(oe=B.offsetLeft,Ee=B.offsetTop)}return{width:H,height:Y,x:oe,y:Ee}}(c,g)):No(u)?function(v,C){let o=eo(v,!1,C==="fixed"),z=o.top+v.clientTop,B=o.left+v.clientLeft;return{top:z,left:B,x:B,y:z,right:B+v.clientWidth,bottom:z+v.clientHeight,width:v.clientWidth,height:v.clientHeight}}(u,g):Wu(function(v){var C;let o=Vo(v),z=Qu(v),B=(C=v.ownerDocument)==null?void 0:C.body,H=Vc(o.scrollWidth,o.clientWidth,B?B.scrollWidth:0,B?B.clientWidth:0),Y=Vc(o.scrollHeight,o.clientHeight,B?B.scrollHeight:0,B?B.clientHeight:0),oe=-z.scrollLeft+My(v),Ee=-z.scrollTop;return Nc(B||o).direction==="rtl"&&(oe+=Vc(o.clientWidth,B?B.clientWidth:0)-H),{width:H,height:Y,x:oe,y:Ee}}(Vo(c)))}function y2(c){let u=Ku(c),g=["absolute","fixed"].includes(Nc(c).position)&&Sn(c)?zf(c):c;return No(g)?u.filter(v=>No(v)&&function(C,o){let z=o.getRootNode==null?void 0:o.getRootNode();if(C.contains(o))return!0;if(z&&Lf(z)){let B=o;do{if(B&&C===B)return!0;B=B.parentNode||B.host}while(B)}return!1}(v,g)&&Qn(v)!=="body"):[]}var x2={getClippingRect:function(c){let{element:u,boundary:g,rootBoundary:v,strategy:C}=c,o=[...g==="clippingAncestors"?y2(u):[].concat(g),v],z=o[0],B=o.reduce((H,Y)=>{let oe=Ey(u,Y,C);return H.top=Vc(oe.top,H.top),H.right=vy(oe.right,H.right),H.bottom=vy(oe.bottom,H.bottom),H.left=Vc(oe.left,H.left),H},Ey(u,z,C));return{width:B.right-B.left,height:B.bottom-B.top,x:B.left,y:B.top}},convertOffsetParentRelativeRectToViewportRelativeRect:function(c){let{rect:u,offsetParent:g,strategy:v}=c,C=Sn(g),o=Vo(g);if(g===o)return u;let z={scrollLeft:0,scrollTop:0},B={x:0,y:0};if((C||!C&&v!=="fixed")&&((Qn(g)!=="body"||Ju(o))&&(z=Qu(g)),Sn(g))){let H=eo(g,!0);B.x=H.x+g.clientLeft,B.y=H.y+g.clientTop}return{...u,x:u.x-z.scrollLeft+B.x,y:u.y-z.scrollTop+B.y}},isElement:No,getDimensions:wy,getOffsetParent:zf,getDocumentElement:Vo,getElementRects:c=>{let{reference:u,floating:g,strategy:v}=c;return{reference:_2(u,zf(g),v),floating:{...wy(g),x:0,y:0}}},getClientRects:c=>Array.from(c.getClientRects()),isRTL:c=>Nc(c).direction==="rtl"},v2=(c,u,g)=>(async(v,C,o)=>{let{placement:z="bottom",strategy:B="absolute",middleware:H=[],platform:Y}=o,oe=await(Y.isRTL==null?void 0:Y.isRTL(C)),Ee=await Y.getElementRects({reference:v,floating:C,strategy:B}),{x:Ae,y:Ce}=my(Ee,z,oe),Ge=z,Ke={},Ye=0;for(let ut=0;ut<H.length;ut++){let{name:wt,fn:Je}=H[ut],{x:Et,y:It,data:Ht,reset:li}=await Je({x:Ae,y:Ce,initialPlacement:z,placement:Ge,strategy:B,middlewareData:Ke,rects:Ee,platform:Y,elements:{reference:v,floating:C}});Ae=Et??Ae,Ce=It??Ce,Ke={...Ke,[wt]:{...Ke[wt],...Ht}},li&&Ye<=50&&(Ye++,typeof li=="object"&&(li.placement&&(Ge=li.placement),li.rects&&(Ee=li.rects===!0?await Y.getElementRects({reference:v,floating:C,strategy:B}):li.rects),{x:Ae,y:Ce}=my(Ee,Ge,oe)),ut=-1)}return{x:Ae,y:Ce,placement:Ge,strategy:B,middlewareData:Ke}})(c,u,{platform:x2,...g});function b2(c,u,g){return Uo(this,void 0,void 0,function*(){if(!g)throw new Error("Must provide a positioning option");return yield typeof g=="string"?function(v,C,o){return Uo(this,void 0,void 0,function*(){if(!C)throw new Error("Reference element is required for relative positioning");let z;return z=o==="auto"?{middleware:[f2(),yy(),_y({mainAxis:5,crossAxis:12})]}:{placement:o,middleware:[m2(),yy(),_y(5)]},function(B,H,Y,oe){oe===void 0&&(oe={});let{ancestorScroll:Ee=!0,ancestorResize:Ae=!0,elementResize:Ce=!0,animationFrame:Ge=!1}=oe,Ke=Ee&&!Ge,Ye=Ae&&!Ge,ut=Ke||Ye?[...No(B)?Ku(B):[],...Ku(H)]:[];ut.forEach(It=>{Ke&&It.addEventListener("scroll",Y,{passive:!0}),Ye&&It.addEventListener("resize",Y)});let wt,Je=null;if(Ce){let It=!0;Je=new ResizeObserver(()=>{It||Y(),It=!1}),No(B)&&!Ge&&Je.observe(B),Je.observe(H)}let Et=Ge?eo(B):null;return Ge&&function It(){let Ht=eo(B);!Et||Ht.x===Et.x&&Ht.y===Et.y&&Ht.width===Et.width&&Ht.height===Et.height||Y(),Et=Ht,wt=requestAnimationFrame(It)}(),Y(),()=>{var It;ut.forEach(Ht=>{Ke&&Ht.removeEventListener("scroll",Y),Ye&&Ht.removeEventListener("resize",Y)}),(It=Je)==null||It.disconnect(),Je=null,Ge&&cancelAnimationFrame(wt)}}(C,v,()=>Uo(this,void 0,void 0,function*(){let{x:B,y:H}=yield v2(C,v,z);Object.assign(v.style,{position:"absolute",left:`${B}px`,top:`${H}px`})}))})}(c,u,g):function(v,C){return v.style.position="fixed",Object.entries(C).forEach(([o,z])=>{v.style[o]=z}),()=>{}}(c,g)})}var w2={hideOnClickOutside:!0,hideOnEmojiSelect:!0,hideOnEscape:!0,position:"auto",showCloseButton:!0},E2="popupPicker_popupContainer__-DboI",T2="popupPicker_closeButton__j1nuQ";(function(c,u){u===void 0&&(u={});var g=u.insertAt;if(c&&typeof document<"u"){var v=document.head||document.getElementsByTagName("head")[0],C=document.createElement("style");C.type="text/css",g==="top"&&v.firstChild?v.insertBefore(C,v.firstChild):v.appendChild(C),C.styleSheet?C.styleSheet.cssText=c:C.appendChild(document.createTextNode(c))}})(`.popupPicker_popupContainer__-DboI {
  display: flex;
  flex-direction: column;
  position: absolute;
}

.popupPicker_closeButton__j1nuQ {
  position: absolute;
  opacity: 0;
  background: transparent;
  border: none;
  z-index: 1;
  right: 0;
  top: 0;
  cursor: pointer;
  padding: 4px;
  align-self: flex-end;
  transform: translate(50%, -50%);
  background: #999999;
  width: 1.5rem;
  height: 1.5rem;
  display: flex;
  align-items: center;
  justify-content: center;
  border-radius: 50%;
}
.popupPicker_closeButton__j1nuQ:hover {
  background: var(--accent-color);
}
.popupPicker_closeButton__j1nuQ svg {
  fill: white;
  width: 1.25rem;
  height: 1.25rem;
}`);var Pf=class{constructor(u,g){this.isOpen=!1,this.externalEvents=new Mf,this.options=Object.assign(Object.assign({},function(C={}){return Object.assign(Object.assign(Object.assign({},w2),{rootElement:document.body}),C)}(g)),Af(u)),this.popupEl=document.createElement("div"),this.popupEl.classList.add(E2),this.popupEl.classList.add(this.options.theme),g.className&&this.popupEl.classList.add(g.className),this.options.showCloseButton&&(this.closeButton=document.createElement("button"),this.closeButton.classList.add(T2),this.closeButton.innerHTML='<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 320 512"><!--! Font Awesome Pro 6.1.1 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license (Commercial License) Copyright 2022 Fonticons, Inc. --><path d="M310.6 361.4c12.5 12.5 12.5 32.75 0 45.25C304.4 412.9 296.2 416 288 416s-16.38-3.125-22.62-9.375L160 301.3L54.63 406.6C48.38 412.9 40.19 416 32 416S15.63 412.9 9.375 406.6c-12.5-12.5-12.5-32.75 0-45.25l105.4-105.4L9.375 150.6c-12.5-12.5-12.5-32.75 0-45.25s32.75-12.5 45.25 0L160 210.8l105.4-105.4c12.5-12.5 32.75-12.5 45.25 0s12.5 32.75 0 45.25l-105.4 105.4L310.6 361.4z"/></svg>',this.popupEl.appendChild(this.closeButton));let v=document.createElement("div");this.popupEl.appendChild(v),this.picker=fy(Object.assign(Object.assign({},this.options),{rootElement:v})),this.focusTrap=new Fc,this.picker.addEventListener("data:ready",()=>{this.focusTrap.activate(this.picker.el),this.picker.setInitialFocus()}),this.options.hideOnEmojiSelect&&this.picker.addEventListener("emoji:select",()=>{this.close()}),this.options.hideOnClickOutside&&(this.onDocumentClick=this.onDocumentClick.bind(this),document.addEventListener("click",this.onDocumentClick)),this.options.hideOnEscape&&(this.handleKeydown=this.handleKeydown.bind(this),this.popupEl.addEventListener("keydown",this.handleKeydown))}addEventListener(u,g){this.externalEvents.on(u,g),this.picker.addEventListener(u,g)}removeEventListener(u,g){this.externalEvents.off(u,g),this.picker.removeEventListener(u,g)}handleKeydown(u){u.key==="Escape"&&this.close()}destroy(){return Uo(this,void 0,void 0,function*(){this.isOpen&&(yield this.close()),document.removeEventListener("click",this.onDocumentClick),this.picker.destroy(),this.externalEvents.removeAll()})}toggle(){return this.isOpen?this.close():this.open()}open(){return Uo(this,void 0,void 0,function*(){this.isOpen||(yield this.initiateOpenStateChange(!0),this.options.rootElement.appendChild(this.popupEl),yield this.setPosition(),this.picker.reset(),yield this.animatePopup(!0),yield this.animateCloseButton(!0),this.picker.setInitialFocus(),this.externalEvents.emit("picker:open"))})}close(){var u,g;return Uo(this,void 0,void 0,function*(){this.isOpen&&(yield this.initiateOpenStateChange(!1),yield this.animateCloseButton(!1),yield this.animatePopup(!1),this.popupEl.remove(),this.picker.reset(),(u=this.positionCleanup)===null||u===void 0||u.call(this),this.focusTrap.deactivate(),(g=this.options.triggerElement)===null||g===void 0||g.focus(),this.externalEvents.emit("picker:close"))})}getRunningAnimations(){return this.picker.el.getAnimations().filter(u=>u.playState==="running")}setPosition(){var u;return Uo(this,void 0,void 0,function*(){(u=this.positionCleanup)===null||u===void 0||u.call(this),this.positionCleanup=yield b2(this.popupEl,this.options.referenceElement,this.options.position)})}awaitPendingAnimations(){return Promise.all(this.getRunningAnimations().map(u=>u.finished))}onDocumentClick(u){var g;let v=u.target,C=(g=this.options.triggerElement)===null||g===void 0?void 0:g.contains(v);!this.isOpen||this.picker.isPickerClick(u)||C||this.close()}animatePopup(u){return Gs(this.picker.el,{opacity:[0,1],transform:["scale(0.9)","scale(1)"]},{duration:150,id:u?"show-picker":"hide-picker",easing:"ease-in-out",direction:u?"normal":"reverse",fill:"both"},this.options)}animateCloseButton(u){if(this.closeButton)return Gs(this.closeButton,{opacity:[0,1]},{duration:25,id:u?"show-close":"hide-close",easing:"ease-in-out",direction:u?"normal":"reverse",fill:"both"},this.options)}initiateOpenStateChange(u){return Uo(this,void 0,void 0,function*(){this.isOpen=u,yield this.awaitPendingAnimations()})}};function Py(c,u){return new Pf(c,u)}var Dy={"categories.activities":"Actividades","categories.animals-nature":"Animales y Naturaleza","categories.custom":"Custom","categories.flags":"Banderas","categories.food-drink":"Comida y Bebida","categories.objects":"Objectos","categories.people-body":"Personas y Cuerpo","categories.recents":"Recientemente Usado","categories.smileys-emotion":"Emoticonos y Emociones","categories.symbols":"Simbolos","categories.travel-places":"Viajes y Lugares","error.load":"Error al cargar emojis","recents.clear":"Borrar emojis recientes","recents.none":"A\xFAn no has seleccionado ning\xFAn emoji",retry:"Intentar otra vez","search.clear":"Borrar b\xFAsqueda","search.error":"Error al buscar emojis","search.notFound":"No se han encontrado resultados",search:"Buscar emojis..."},Ly={"categories.activities":"Activit\xE9s","categories.animals-nature":"Animaux et Nature","categories.custom":"Custom","categories.flags":"Drapeaux","categories.food-drink":"Comida y Bebida","categories.objects":"Nourriture et Boisson","categories.people-body":"Les gens et le Corps","categories.recents":"Utilis\xE9 R\xE9cemment","categories.smileys-emotion":"\xC9motic\xF4nes et \xC9motions","categories.symbols":"Simbolos","categories.travel-places":"Symboles","error.load":"Error al cargar emojis","recents.clear":"Erreur de chargement des emoji","recents.none":"Vous n'avez pas encore s\xE9lectionn\xE9 d'emoji",retry:"R\xE9essayer","search.clear":"Effacer la recherche","search.error":"Erreur lors de la recherche d'emojis","search.notFound":"Aucun r\xE9sultat trouv\xE9",search:"Rechercher des \xE9motic\xF4nes..."},By={"categories.activities":"Atividades","categories.animals-nature":"Animais e Natureza","categories.custom":"Custom","categories.flags":"Bandeiras","categories.food-drink":"Comida e Bebida","categories.objects":"Objectos","categories.people-body":"Pessoas e Corpo","categories.recents":"Usado Recentemente","categories.smileys-emotion":"Emoticons e Emo\xE7\xF5es","categories.symbols":"Simbolos","categories.travel-places":"S\xEDmbolos","error.load":"Erro ao carregar emoji","recents.clear":"Limpar emojis recentes","recents.none":"Voc\xEA ainda n\xE3o selecionou nenhum emoji",retry:"Tente novamente","search.clear":"Limpar pesquisa","search.error":"Erro ao pesquisar emojis","search.notFound":"N\xE3o foram encontrados resultados",search:"Pesquisar emoticons..."},Ry={"categories.activities":"Aktivit\xE4ten","categories.animals-nature":"Tiere und Natur","categories.custom":"Custom","categories.flags":"Flaggen","categories.food-drink":"Essen und Trinken","categories.objects":"Objekte","categories.people-body":"Mensch und K\xF6rper","categories.recents":"K\xFCrzlich Verwendet","categories.smileys-emotion":"Emoticons und Emotionen","categories.symbols":"Symbole","categories.travel-places":"Reisen und Orte","error.load":"Fehler beim Laden von Emoji","recents.clear":"Letzte Emojis l\xF6schen","recents.none":"Sie haben noch kein Emoji ausgew\xE4hlt",retry:"Versuchen Sie es nochmal","search.clear":"Saubere Suche","search.error":"Fehler bei der Suche nach Emojis","search.notFound":"keine Ergebnisse gefunden",search:"Emoji suchen..."},ep={en:"Write your message",es:"Escriba su mensaje",fr:"R\xE9digez votre message",pt:"Escreva sua mensagem",de:"Schreibe deine Nachricht"};var Ff=_x(Oy());var tp=class extends HTMLElement{get isOpen(){return this.getAttribute("isOpen")}set isOpen(u){u?this.getAttribute("isOpen",""):this.removeAttribute("isOpen")}get websocketUrl(){return this.getAttribute("websocketUrl")}set websocketUrl(u){u?this.setAttribute("websocketUrl",u):this.removeAttribute("websocketUrl")}get initialPayload(){return this.getAttribute("initialPayload")}set initialPayload(u){u?this.setAttribute("initialPayload",u):this.removeAttribute("initialPayload")}get gradA(){return this.getAttribute("gradA")}set gradA(u){u?this.setAttribute("gradA",u):this.removeAttribute("gradA")}get gradB(){return this.getAttribute("gradB")}set gradB(u){u?this.setAttribute("gradB",u):this.removeAttribute("gradB")}get bgClient(){return this.getAttribute("bgClient")}set bgClient(u){u?this.setAttribute("bgClient",u):this.removeAttribute("bgClient")}get clientColor(){return this.getAttribute("clientColor")}set clientColor(u){u?this.setAttribute("clientColor",u):this.removeAttribute("clientColor")}get showTime(){return this.getAttribute("showTime")}set showTime(u){u?this.setAttribute("showTime",""):this.removeAttribute("showTime")}get brand(){return this.getAttribute("brand")}set brand(u){u?this.setAttribute("brand",u):this.removeAttribute("brand")}get slogan(){return this.getAttribute("slogan")}set slogan(u){u?this.setAttribute("slogan",u):this.removeAttribute("slogan")}get brandAvatar(){return this.getAttribute("brandAvatar")}set brandAvatar(u){u?this.setAttribute("brandAvatar",u):this.removeAttribute("brandAvatar")}get emoji(){return this.getAttribute("emoji")}set emoji(u){u?this.setAttribute("emoji",u):this.removeAttribute("emoji")}get height(){return this.getAttribute("height")}set height(u){u?this.setAttribute("height",u):this.removeAttribute("height")}get width(){return this.getAttribute("width")}set width(u){u?this.setAttribute("width",u):this.removeAttribute("width")}constructor(){super(),this.attachShadow({mode:"open"}),this.defaults={isOpen:!1,websocketUrl:"http://localhost:5005",initialPayload:"/",gradA:"#243A4B",gradB:"#386370",bgClient:"#386370",clientColor:"#FFFFFF",showTime:!0,brand:"AI Widget",slogan:"Connect RASA with style",brandAvatar:"default",emoji:"basic",mapToken:void 0,mapZoom:8,height:450,width:350},this.online=!1,this.open=!1,this.uuid=!1,this.socket=!1,this.lan=navigator.language||navigator.userLanguage}isMobile(){var u=window.matchMedia||window.msMatchMedia;if(u){var g=u("(pointer:coarse)");return g.matches}return!1}toogleOpen(u){this.open?(u.preventDefault(),this.botSuport.classList.remove("bot-open"),this.botButton.children[0].innerHTML=this.icons.isNotClicked,this.open=!1):this.open===!1&&(u.preventDefault(),this.online===!1&&this.openSocket(),this.botSuport.classList.add("bot-open"),this.botButton.children[0].innerHTML=this.icons.isClicked,this.open=!0)}appendMessage(u,g){let v=document.createElement("div");v.innerHTML=u;let C=document.createElement("span"),o=new Date;C.textContent=o.toLocaleTimeString(navigator.language,{hour:"2-digit",minute:"2-digit"}),v.appendChild(C),v.classList.add("messages-item","is-client"),g.insertBefore(v,g.children[0]),g.scrollTop=g.scrollHeight}_getSessionId(){let g=decodeURIComponent(document.cookie).split("; ");var v;if(g.forEach(C=>{C.indexOf("uuid=")===0&&(v=C.substring(5))}),v===void 0){v=crypto.randomUUID();let C=new Date;C.setTime(C.getTime()+30*24*60*60*1e3);let o="expires="+C.toUTCString();document.cookie="uuid="+v+", "+o+", path=/ ; SameSite=None; Secure"}return v}openSocket(){this.uuid=this._getSessionId();var u=Ic(this.websocketUrl,{autoConnect:!0});u.on("connect",()=>{console.log("SOCKET: connected to the socket server",u.connected,this.uuid),u.emit("session_request",{session_id:this.uuid}),this.initialPayload!="/"&&(u.emit("user_uttered",{session_id:this.uuid,message:this.initialPayload}),console.log("sendig payload")),this.setAttribute("online",!0)}),u.on("error",g=>{console.log("SOCKET: errors",g),this.setAttribute("online",!1)}),u.on("connect_error",g=>{console.log("SOCKET: connect_error ---->",g),this.setAttribute("online",!1)}),u.on("disconnect",g=>{console.log(g)}),u.on("bot_uttered",g=>{console.log(g),this.responsesQueue.push(g)}),this.socket=u}connectedCallback(){let{shadowRoot:u}=this;this.icons={isClicked:'<svg x="0px" y="0px" viewBox="0 0 30 30" width="30" height="30" xmlns="http://www.w3.org/2000/svg"> <g id="g4"      transform="matrix(0.06696429,0,0,0.06696429,-2.1428571,-2.2098214)"><path d="M 256,33 C 132.3,33 32,133.3 32,257 32,380.7 132.3,481 256,481 379.7,481 480,380.7 480,257 480,133.3 379.7,33 256,33 Z m 108.3,299.5 c 1.5,1.5 2.3,3.5 2.3,5.6 0,2.1 -0.8,4.2 -2.3,5.6 l -21.6,21.7 c -1.6,1.6 -3.6,2.3 -5.6,2.3 -2,0 -4.1,-0.8 -5.6,-2.3 L 256,289.8 180.6,365.5 c -1.5,1.6 -3.6,2.3 -5.6,2.3 -2,0 -4.1,-0.8 -5.6,-2.3 l -21.6,-21.7 c -1.5,-1.5 -2.3,-3.5 -2.3,-5.6 0,-2.1 0.8,-4.2 2.3,-5.6 l 75.7,-76 -75.9,-75 c -3.1,-3.1 -3.1,-8.2 0,-11.3 l 21.6,-21.7 c 1.5,-1.5 3.5,-2.3 5.6,-2.3 2.1,0 4.1,0.8 5.6,2.3 l 75.7,74.7 75.7,-74.7 c 1.5,-1.5 3.5,-2.3 5.6,-2.3 2.1,0 4.1,0.8 5.6,2.3 l 21.6,21.7 c 3.1,3.1 3.1,8.2 0,11.3 l -75.9,75 z"  id="path2" fill="'+this.gradA+'" /></g></svg>',isNotClicked:'<svg x="0px" y="0px" viewBox="0 0 30 30" width="30" height="30" xmlns="http://www.w3.org/2000/svg"> <g id="XMLID_1202_"    transform="matrix(0.06521739,0,0,0.06519286,0,-0.38460043)"> 	<g id="g8"> <g    id="g6"> <path    d="M 440.047,396.143 C 426.855,390.936 415.321,381.986 407.003,370.333 439.582,348.319 460,316.762 460,281.701 c 0,-38.367 -24.445,-72.543 -62.527,-94.602 -4.023,92.95 -102.669,159.14 -213.667,159.14 -9.342,0 -18.6,-0.481 -27.755,-1.387 28.905,34.387 80.701,57.309 139.8,57.309 21.556,0 42.138,-3.055 60.996,-8.597 16.873,15.79 40.876,23.447 65.237,18.454 6.542,-1.341 12.702,-3.51 18.395,-6.376 1.834,-0.923 2.955,-2.838 2.862,-4.889 -0.094,-2.053 -1.384,-3.856 -3.294,-4.61 z"     id="path2" fill="'+this.gradA+'"  /> <path d="M 367.612,181.353 C 367.612,106.858 285.319,46.468 183.806,46.468 82.293,46.468 0,106.858 0,181.353 0,220.61 22.86,255.945 59.337,280.594 49.767,294 36.4,304.212 21.124,309.968 c -1.919,0.723 -3.236,2.503 -3.364,4.55 -0.128,2.047 0.958,3.978 2.773,4.934 11.88,6.254 25.231,9.519 38.572,9.519 21.307,0 41.377,-8.301 56.401,-22.36 21.116,6.206 44.163,9.627 68.301,9.627 101.513,0 183.805,-60.39 183.805,-134.885 z"  id="path2" fill="'+this.gradA+'"  /> </g> </g> </g> </svg>'},this.sendIcon='<svg x="0px" y="0px" viewBox="0 0 30 30" width="30" height="30" xmlns="http://www.w3.org/2000/svg"><g id="send" stroke="none" stroke-width="1" fill="none" fill-rule="evenodd"> <g id="ic_fluent_send_28_filled" fill="#212121" fill-rule="nonzero"><path d="M3.78963301,2.77233335 L24.8609339,12.8499121 C25.4837277,13.1477699 25.7471402,13.8941055 25.4492823,14.5168992 C25.326107,14.7744476 25.1184823,14.9820723 24.8609339,15.1052476 L3.78963301,25.1828263 C3.16683929,25.4806842 2.42050372,25.2172716 2.12264586,24.5944779 C1.99321184,24.3238431 1.96542524,24.015685 2.04435886,23.7262618 L4.15190935,15.9983421 C4.204709,15.8047375 4.36814355,15.6614577 4.56699265,15.634447 L14.7775879,14.2474874 C14.8655834,14.2349166 14.938494,14.177091 14.9721837,14.0981464 L14.9897199,14.0353553 C15.0064567,13.9181981 14.9390703,13.8084248 14.8334007,13.7671556 L14.7775879,13.7525126 L4.57894108,12.3655968 C4.38011873,12.3385589 4.21671819,12.1952832 4.16392965,12.0016992 L2.04435886,4.22889788 C1.8627142,3.56286745 2.25538645,2.87569101 2.92141688,2.69404635 C3.21084015,2.61511273 3.51899823,2.64289932 3.78963301,2.77233335 Z"  id="path2" fill="'+this.clientColor+'"></path> </g> </g></svg>',this.brandIcon='<svg xmlns="http://www.w3.org/2000/svg" width="50" height="50" viewBox="0 0 50 50"><path d="m 39.56634,14.579155 c 0,8.048627 -6.526363,14.577073 -14.577072,14.577073 -8.050709,0 -14.577073,-6.528446 -14.577073,-14.577073 C 10.412195,6.5263637 16.938559,0 24.989268,0 33.039977,0 39.56634,6.5263637 39.56634,14.579155 Z m -3.327737,14.951912 c -3.136153,2.367733 -7.026149,3.790039 -11.249335,3.790039 -4.227351,0 -8.11943,-1.426471 -11.259748,-3.794204 C 5.2498287,33.260715 0,44.886972 0,49.978535 h 49.978535 c 0,-5.045749 -5.414341,-16.672006 -13.739932,-20.447468 z" fill="'+this.clientColor+'"/></svg>',this.responsesQueue=[];var g=function(B,H){B.push=function(Y){Array.prototype.push.call(B,Y),H(B)}};async function v(B){let H=u.querySelector(".bot-messages"),Y=document.createElement("div");Y.innerHTML=`
            <div class="typing">
                <div class="typing__dot"></div>
                <div class="typing__dot"></div>
                <div class="typing__dot"></div>
            </div>
            `,Y.classList.add("messages-item","is-bot","is-typing"),H.data,H.querySelectorAll(".typing").length==0&&H.insertBefore(Y,H.children[0]),H.scrollTop=H.scrollHeight,await new Promise(oe=>setTimeout(()=>{var Ee=new Jn;let Ae=B.shift(),Ce=document.createElement("div");if(Ce.classList.add("messages-item","is-bot"),Ae.text!==void 0){let Ye=Ee.render(Ae.text);Ce.innerHTML=Ye}if(Ae.attachment!==void 0){if(Ae.attachment.type==="image"){let Ye=document.createElement("img");Ye.src=Ae.attachment.payload.src,Ce.appendChild(Ye)}if(Ae.attachment.type==="video")if(Ae.attachment.payload.src.includes("https://www.youtube.com/")){console.log(Ae.attachment.payload.src),console.log(Ae.attachment.payload.src.replace("watch","embebed"));let Ye=document.createElement("div");Ye.classList.add("messages-video"),Ye.innerHTML=`
                                <iframe width="560" height="315" src="${Ae.attachment.payload.src.replace("watch","embebed")}" title="YouTube video player" frameborder="0" allow="accelerometer; autoplay; clipboard-write; encrypted-media; gyroscope; picture-in-picture" allowfullscreen></iframe>`,Ce.appendChild(Ye)}else{let Ye=document.createElement("video");Ye.src=Ae.attachment.payload.src,Ce.appendChild(Ye)}}if(Ae.custom!==void 0&&(Ae.custom.content_type==="image"&&(Ce.innerHTML=`
                            <img src="${Ae.custom.payload.src}"/>
                            <h1>${Ae.custom.payload.title}</h1>
                            ${Ae.custom.payload.description!==void 0?`<p>${Ae.custom.payload.description}</p>`:""}
                        `),Ae.custom.content_type==="location")){Ff.default.accessToken="pk.eyJ1IjoiYW50b25pb2ZyZWdvc28iLCJhIjoiY2t2NnZsYjRtMjJ0NjJxbXMwN2g1ajg5YyJ9.pD7yaooCH5IqBdc4jftIrA";let Ye=new Ff.default.Map({container:Ce,enter:[-99.21646907316129,19.29342060773046]})}if(Ae.quick_replies!==void 0){Ce.classList.remove("is-bot"),Ce.classList.add("messages-quick-replies");let Ye=document.createElement("div");Ae.quick_replies.forEach(ut=>{let wt=document.createElement("button");wt.innerHTML=ut.title,wt.classList.add("button"),wt.addEventListener("click",Je=>{let Et=document.createElement("div");Et.innerHTML=ut.title;let It=document.createElement("span"),Ht=new Date;It.textContent=Ht.toLocaleTimeString(navigator.language,{hour:"2-digit",minute:"2-digit"}),Et.appendChild(It),Et.classList.add("messages-item","is-client"),H.insertBefore(Et,H.children[0]),H.scrollTop=H.scrollHeight,Et.remove(),this.socket.emit("user_uttered",{message:ut.payload})}),Ye.appendChild(wt)}),Ce.appendChild(Ye)}let Ge=document.createElement("span"),Ke=new Date;Ge.textContent=Ke.toLocaleTimeString(navigator.language,{hour:"2-digit",minute:"2-digit"}),Ce.appendChild(Ge),H.querySelectorAll(".is-typing").forEach(Ye=>Ye.remove()),H.insertBefore(Ce,H.children[0]),H.scrollTop=H.scrollHeight},B[0].text!==void 0?B[0].text.split(" ").length*300:1200,B))}g(this.responsesQueue,function(B){v(B)}),u.innerHTML=`
        <style>            
            .bot-container {
                position: fixed;
                bottom: 30px;
                right: 30px;
                font-family: 'Fredoka', sans-serif; 
                box-sizing: border-box;
                margin: 0;
                padding: 0;
                border: 5px;
            }
            .bot-suport {
                display: flex;
                flex-direction: column;
                background: #f9f9f9;
                height: ${this.isMobile()?screen.height-100+"px":this.height+"px"};
                width: ${this.isMobile()?"100%":this.width+"px"};
                z-index: -123456;
                opacity: 0;
                transition: all .5s ease-in-out;
                box-shadow: 0px 0px 15px rgba(0, 0, 0, 0.1);
                border-top-left-radius: 20px;
                border-top-right-radius: 20px;
            }
            .bot-open {
                transform: translateY(-40px);
                z-index: 123456;
                opacity: 1;
            }
            .bot-button {
                text-align: right;
            }
            .bot-button button,
            .bot-button button:focus,
            .bot-button button:visited {
                padding: 10px;
                background: white;
                border: none;
                outline: none;
                border-top-left-radius: 50px;
                border-top-right-radius: 50px;
                border-bottom-left-radius: 50px;
                box-shadow: 0px 10px 15px rgba(0, 0, 0, 0.1);
                cursor: pointer;
            }
            .bot-header {
                position: sticky;
                top: 0;
                display: flex;
                flex-direction: row;
                align-items: center;
                justify-content: center;
                padding: 0.5rem;
                border-top-left-radius: 20px;
                border-top-right-radius: 20px;
                box-shadow: 0px 10px 15px rgba(0, 0, 0, 0.1);
                background: linear-gradient(93.12deg, ${this.gradA} 0.52%, ${this.gradB} 100%);
            }
            .bot-header div h1 {
                font-size: 1rem;
                color: white;

            }
            .bot-header div p {
                font-size: .9rem;
                color: white;
                
            }
            .bot-header-image {
                margin-right: 15px;                
            }
            .bot-header-image img {
                width:50px;
                height:50px;
            }
            .bot-messages {
                padding: 0px 20px 20px 20px;
                display: flex;
                flex-direction: column;
                overflow-y: scroll;
                overflow-x: hidden;
                flex-direction: column-reverse;
                background-color:#eee;
            }
            .messages-quick-replies {
                margin-top: 10px;
                margin: auto;
                border-radius: 20px;
                background-color:white;
            }
            .messages-quick-replies button {
                margin-left: 5px;
                margin-right: 5px;
                padding: 5px 10px 5px 10px;
                box-shadow: 0 8px 16px 0 rgba(0,0,0,0.2), 0 6px 20px 0 rgba(0,0,0,0.19);
            }
            .messages-quick-replies div {
                text-align: center;
            }
            .messages-item {
                width: fit-content;
                margin-top: 10px;
                padding: 8px 12px;
                font-size: medium;
                box-shadow: rgba(0, 0, 0, 0.15) 1.95px 1.95px 2.6px;
            }
            .messages-item img {
                width: 100%;
                height: auto;
            }
            .messages-item video {
                width: 100%;
                height: auto;
            }
            .messages-video {
                width: 90%;
                height: auto;
            }
            .messages-item ul {
                margin-left: 5px;
                list-style-type: disc;
            }
            .messages-item ol {
                margin-left: 5px;
            }
            .messages-item a:link {
                font-style: italic;
                color:inherit;
            }
            .messages-item span{
                font-size: 0.7em;
                display:${this.showTime=="true"?"block":"none"};
                text-align: right;
            }
            .messages-item h1 {
                font-size: 1.0em;
            }
            .is-client {
                margin-left: auto;
                border-top-left-radius: 20px;
                border-top-right-radius: 20px;
                border-bottom-left-radius: 20px;
                color: ${this.clientColor};
                background-color:${this.bgClient};
            }
            .is-bot {
                margin-right: auto;
                border-top-left-radius: 20px;
                border-top-right-radius: 20px;
                border-bottom-right-radius: 20px;
                background-color:white;
            }
            .typing {
                position: relative;
              }
              .typing__dot {
                float: left;
                width: 8px;
                height: 8px;
                margin: 0 4px;
                background: #8d8c91;
                border-radius: 50%;
                opacity: 0;
                animation: loadingFade 1s infinite;
              }              
              .typing__dot:nth-child(1) {
                animation-delay: 0s;
              }              
              .typing__dot:nth-child(2) {
                animation-delay: 0.2s;
              }              
              .typing__dot:nth-child(3) {
                animation-delay: 0.4s;
              }
              @keyframes loadingFade {
                0% {
                  opacity: 0;
                  transform: translateY(0px);
                }
                50% {
                  opacity: 0.8;
                  transform: translateY(8px);
                }
                100% {
                  opacity: 0;
                  transform: translateY(0px);
                }
              }
            .bot-footer {
                position: sticky;
                bottom: 0;
                display: flex;
                flex-direction: row;
                align-items: center;
                justify-content: space-between;
                padding: 20px 20px;
                box-shadow: 0px -10px 15px rgba(0, 0, 0, 0.1);
                border-bottom-right-radius: 10px;
                border-bottom-left-radius: 10px;
                background: linear-gradient(93.12deg, ${this.gradB} 0.52%, ${this.gradA} 100%);
            }
            .bot-footer input {
                flex-grow:2;
                border: none;
                padding: 10px 10px;
                border-radius: 30px;
                text-align: left;
                width: 85%;
            }
            .bot-footer span {
                padding-left: 10px;
                font-size: 1.2rem;
                cursor: pointer; 
            }
            .bot-footer button {
                background-color: transparent;
                border: none;
                outline:none;
                cursor: pointer; 
            }
            .bot-footer:hover button {
                transform: translatex(4px);
            }
            .mapboxgl-map{font:12px/20px Helvetica Neue,Arial,Helvetica,sans-serif;overflow:hidden;position:relative;-webkit-tap-highlight-color:rgb(0 0 0/0)}.mapboxgl-canvas{position:absolute;left:0;top:0}.mapboxgl-map:-webkit-full-screen{width:100%;height:100%}.mapboxgl-canary{background-color:salmon}.mapboxgl-canvas-container.mapboxgl-interactive,.mapboxgl-ctrl-group button.mapboxgl-ctrl-compass{cursor:grab;-webkit-user-select:none;user-select:none}.mapboxgl-canvas-container.mapboxgl-interactive.mapboxgl-track-pointer{cursor:pointer}.mapboxgl-canvas-container.mapboxgl-interactive:active,.mapboxgl-ctrl-group button.mapboxgl-ctrl-compass:active{cursor:grabbing}.mapboxgl-canvas-container.mapboxgl-touch-zoom-rotate,.mapboxgl-canvas-container.mapboxgl-touch-zoom-rotate .mapboxgl-canvas{touch-action:pan-x pan-y}.mapboxgl-canvas-container.mapboxgl-touch-drag-pan,.mapboxgl-canvas-container.mapboxgl-touch-drag-pan .mapboxgl-canvas{touch-action:pinch-zoom}.mapboxgl-canvas-container.mapboxgl-touch-zoom-rotate.mapboxgl-touch-drag-pan,.mapboxgl-canvas-container.mapboxgl-touch-zoom-rotate.mapboxgl-touch-drag-pan .mapboxgl-canvas{touch-action:none}.mapboxgl-ctrl-bottom-left,.mapboxgl-ctrl-bottom-right,.mapboxgl-ctrl-top-left,.mapboxgl-ctrl-top-right{position:absolute;pointer-events:none;z-index:2}.mapboxgl-ctrl-top-left{top:0;left:0}.mapboxgl-ctrl-top-right{top:0;right:0}.mapboxgl-ctrl-bottom-left{bottom:0;left:0}.mapboxgl-ctrl-bottom-right{right:0;bottom:0}.mapboxgl-ctrl{clear:both;pointer-events:auto;transform:translate(0)}.mapboxgl-ctrl-top-left .mapboxgl-ctrl{margin:10px 0 0 10px;float:left}.mapboxgl-ctrl-top-right .mapboxgl-ctrl{margin:10px 10px 0 0;float:right}.mapboxgl-ctrl-bottom-left .mapboxgl-ctrl{margin:0 0 10px 10px;float:left}.mapboxgl-ctrl-bottom-right .mapboxgl-ctrl{margin:0 10px 10px 0;float:right}.mapboxgl-ctrl-group{border-radius:4px;background:#fff}.mapboxgl-ctrl-group:not(:empty){box-shadow:0 0 0 2px rgb(0 0 0/10%)}@media (-ms-high-contrast:active){.mapboxgl-ctrl-group:not(:empty){box-shadow:0 0 0 2px ButtonText}}.mapboxgl-ctrl-group button{width:29px;height:29px;display:block;padding:0;outline:none;border:0;box-sizing:border-box;background-color:transparent;cursor:pointer;overflow:hidden}.mapboxgl-ctrl-group button+button{border-top:1px solid #ddd}.mapboxgl-ctrl button .mapboxgl-ctrl-icon{display:block;width:100%;height:100%;background-repeat:no-repeat;background-position:50%}@media (-ms-high-contrast:active){.mapboxgl-ctrl-icon{background-color:transparent}.mapboxgl-ctrl-group button+button{border-top:1px solid ButtonText}}.mapboxgl-ctrl-attrib-button:focus,.mapboxgl-ctrl-group button:focus{box-shadow:0 0 2px 2px rgb(0 150 255/100%)}.mapboxgl-ctrl button:disabled{cursor:not-allowed}.mapboxgl-ctrl button:disabled .mapboxgl-ctrl-icon{opacity:.25}.mapboxgl-ctrl-group button:first-child{border-radius:4px 4px 0 0}.mapboxgl-ctrl-group button:last-child{border-radius:0 0 4px 4px}.mapboxgl-ctrl-group button:only-child{border-radius:inherit}.mapboxgl-ctrl button:not(:disabled):hover{background-color:rgb(0 0 0/5%)}.mapboxgl-ctrl-group button:focus:focus-visible{box-shadow:0 0 2px 2px rgb(0 150 255/100%)}.mapboxgl-ctrl-group button:focus:not(:focus-visible){box-shadow:none}.mapboxgl-ctrl button.mapboxgl-ctrl-zoom-out .mapboxgl-ctrl-icon{background-image:url("data:image/svg+xml;charset=utf-8,%3Csvg width='29' height='29' viewBox='0 0 29 29' xmlns='http://www.w3.org/2000/svg' fill='%23333'%3E %3Cpath d='M10 13c-.75 0-1.5.75-1.5 1.5S9.25 16 10 16h9c.75 0 1.5-.75 1.5-1.5S19.75 13 19 13h-9z'/%3E %3C/svg%3E")}.mapboxgl-ctrl button.mapboxgl-ctrl-zoom-in .mapboxgl-ctrl-icon{background-image:url("data:image/svg+xml;charset=utf-8,%3Csvg width='29' height='29' viewBox='0 0 29 29' xmlns='http://www.w3.org/2000/svg' fill='%23333'%3E %3Cpath d='M14.5 8.5c-.75 0-1.5.75-1.5 1.5v3h-3c-.75 0-1.5.75-1.5 1.5S9.25 16 10 16h3v3c0 .75.75 1.5 1.5 1.5S16 19.75 16 19v-3h3c.75 0 1.5-.75 1.5-1.5S19.75 13 19 13h-3v-3c0-.75-.75-1.5-1.5-1.5z'/%3E %3C/svg%3E")}@media (-ms-high-contrast:active){.mapboxgl-ctrl button.mapboxgl-ctrl-zoom-out .mapboxgl-ctrl-icon{background-image:url("data:image/svg+xml;charset=utf-8,%3Csvg width='29' height='29' viewBox='0 0 29 29' xmlns='http://www.w3.org/2000/svg' fill='%23fff'%3E %3Cpath d='M10 13c-.75 0-1.5.75-1.5 1.5S9.25 16 10 16h9c.75 0 1.5-.75 1.5-1.5S19.75 13 19 13h-9z'/%3E %3C/svg%3E")}.mapboxgl-ctrl button.mapboxgl-ctrl-zoom-in .mapboxgl-ctrl-icon{background-image:url("data:image/svg+xml;charset=utf-8,%3Csvg width='29' height='29' viewBox='0 0 29 29' xmlns='http://www.w3.org/2000/svg' fill='%23fff'%3E %3Cpath d='M14.5 8.5c-.75 0-1.5.75-1.5 1.5v3h-3c-.75 0-1.5.75-1.5 1.5S9.25 16 10 16h3v3c0 .75.75 1.5 1.5 1.5S16 19.75 16 19v-3h3c.75 0 1.5-.75 1.5-1.5S19.75 13 19 13h-3v-3c0-.75-.75-1.5-1.5-1.5z'/%3E %3C/svg%3E")}}@media (-ms-high-contrast:black-on-white){.mapboxgl-ctrl button.mapboxgl-ctrl-zoom-out .mapboxgl-ctrl-icon{background-image:url("data:image/svg+xml;charset=utf-8,%3Csvg width='29' height='29' viewBox='0 0 29 29' xmlns='http://www.w3.org/2000/svg' fill='%23000'%3E %3Cpath d='M10 13c-.75 0-1.5.75-1.5 1.5S9.25 16 10 16h9c.75 0 1.5-.75 1.5-1.5S19.75 13 19 13h-9z'/%3E %3C/svg%3E")}.mapboxgl-ctrl button.mapboxgl-ctrl-zoom-in .mapboxgl-ctrl-icon{background-image:url("data:image/svg+xml;charset=utf-8,%3Csvg width='29' height='29' viewBox='0 0 29 29' xmlns='http://www.w3.org/2000/svg' fill='%23000'%3E %3Cpath d='M14.5 8.5c-.75 0-1.5.75-1.5 1.5v3h-3c-.75 0-1.5.75-1.5 1.5S9.25 16 10 16h3v3c0 .75.75 1.5 1.5 1.5S16 19.75 16 19v-3h3c.75 0 1.5-.75 1.5-1.5S19.75 13 19 13h-3v-3c0-.75-.75-1.5-1.5-1.5z'/%3E %3C/svg%3E")}}.mapboxgl-ctrl button.mapboxgl-ctrl-fullscreen .mapboxgl-ctrl-icon{background-image:url("data:image/svg+xml;charset=utf-8,%3Csvg width='29' height='29' viewBox='0 0 29 29' xmlns='http://www.w3.org/2000/svg' fill='%23333'%3E %3Cpath d='M24 16v5.5c0 1.75-.75 2.5-2.5 2.5H16v-1l3-1.5-4-5.5 1-1 5.5 4 1.5-3h1zM6 16l1.5 3 5.5-4 1 1-4 5.5 3 1.5v1H7.5C5.75 24 5 23.25 5 21.5V16h1zm7-11v1l-3 1.5 4 5.5-1 1-5.5-4L6 13H5V7.5C5 5.75 5.75 5 7.5 5H13zm11 2.5c0-1.75-.75-2.5-2.5-2.5H16v1l3 1.5-4 5.5 1 1 5.5-4 1.5 3h1V7.5z'/%3E %3C/svg%3E")}.mapboxgl-ctrl button.mapboxgl-ctrl-shrink .mapboxgl-ctrl-icon{background-image:url("data:image/svg+xml;charset=utf-8,%3Csvg width='29' height='29' viewBox='0 0 29 29' xmlns='http://www.w3.org/2000/svg'%3E %3Cpath d='M18.5 16c-1.75 0-2.5.75-2.5 2.5V24h1l1.5-3 5.5 4 1-1-4-5.5 3-1.5v-1h-5.5zM13 18.5c0-1.75-.75-2.5-2.5-2.5H5v1l3 1.5L4 24l1 1 5.5-4 1.5 3h1v-5.5zm3-8c0 1.75.75 2.5 2.5 2.5H24v-1l-3-1.5L25 5l-1-1-5.5 4L17 5h-1v5.5zM10.5 13c1.75 0 2.5-.75 2.5-2.5V5h-1l-1.5 3L5 4 4 5l4 5.5L5 12v1h5.5z'/%3E %3C/svg%3E")}@media (-ms-high-contrast:active){.mapboxgl-ctrl button.mapboxgl-ctrl-fullscreen .mapboxgl-ctrl-icon{background-image:url("data:image/svg+xml;charset=utf-8,%3Csvg width='29' height='29' viewBox='0 0 29 29' xmlns='http://www.w3.org/2000/svg' fill='%23fff'%3E %3Cpath d='M24 16v5.5c0 1.75-.75 2.5-2.5 2.5H16v-1l3-1.5-4-5.5 1-1 5.5 4 1.5-3h1zM6 16l1.5 3 5.5-4 1 1-4 5.5 3 1.5v1H7.5C5.75 24 5 23.25 5 21.5V16h1zm7-11v1l-3 1.5 4 5.5-1 1-5.5-4L6 13H5V7.5C5 5.75 5.75 5 7.5 5H13zm11 2.5c0-1.75-.75-2.5-2.5-2.5H16v1l3 1.5-4 5.5 1 1 5.5-4 1.5 3h1V7.5z'/%3E %3C/svg%3E")}.mapboxgl-ctrl button.mapboxgl-ctrl-shrink .mapboxgl-ctrl-icon{background-image:url("data:image/svg+xml;charset=utf-8,%3Csvg width='29' height='29' viewBox='0 0 29 29' xmlns='http://www.w3.org/2000/svg' fill='%23fff'%3E %3Cpath d='M18.5 16c-1.75 0-2.5.75-2.5 2.5V24h1l1.5-3 5.5 4 1-1-4-5.5 3-1.5v-1h-5.5zM13 18.5c0-1.75-.75-2.5-2.5-2.5H5v1l3 1.5L4 24l1 1 5.5-4 1.5 3h1v-5.5zm3-8c0 1.75.75 2.5 2.5 2.5H24v-1l-3-1.5L25 5l-1-1-5.5 4L17 5h-1v5.5zM10.5 13c1.75 0 2.5-.75 2.5-2.5V5h-1l-1.5 3L5 4 4 5l4 5.5L5 12v1h5.5z'/%3E %3C/svg%3E")}}@media (-ms-high-contrast:black-on-white){.mapboxgl-ctrl button.mapboxgl-ctrl-fullscreen .mapboxgl-ctrl-icon{background-image:url("data:image/svg+xml;charset=utf-8,%3Csvg width='29' height='29' viewBox='0 0 29 29' xmlns='http://www.w3.org/2000/svg' fill='%23000'%3E %3Cpath d='M24 16v5.5c0 1.75-.75 2.5-2.5 2.5H16v-1l3-1.5-4-5.5 1-1 5.5 4 1.5-3h1zM6 16l1.5 3 5.5-4 1 1-4 5.5 3 1.5v1H7.5C5.75 24 5 23.25 5 21.5V16h1zm7-11v1l-3 1.5 4 5.5-1 1-5.5-4L6 13H5V7.5C5 5.75 5.75 5 7.5 5H13zm11 2.5c0-1.75-.75-2.5-2.5-2.5H16v1l3 1.5-4 5.5 1 1 5.5-4 1.5 3h1V7.5z'/%3E %3C/svg%3E")}.mapboxgl-ctrl button.mapboxgl-ctrl-shrink .mapboxgl-ctrl-icon{background-image:url("data:image/svg+xml;charset=utf-8,%3Csvg width='29' height='29' viewBox='0 0 29 29' xmlns='http://www.w3.org/2000/svg' fill='%23000'%3E %3Cpath d='M18.5 16c-1.75 0-2.5.75-2.5 2.5V24h1l1.5-3 5.5 4 1-1-4-5.5 3-1.5v-1h-5.5zM13 18.5c0-1.75-.75-2.5-2.5-2.5H5v1l3 1.5L4 24l1 1 5.5-4 1.5 3h1v-5.5zm3-8c0 1.75.75 2.5 2.5 2.5H24v-1l-3-1.5L25 5l-1-1-5.5 4L17 5h-1v5.5zM10.5 13c1.75 0 2.5-.75 2.5-2.5V5h-1l-1.5 3L5 4 4 5l4 5.5L5 12v1h5.5z'/%3E %3C/svg%3E")}}.mapboxgl-ctrl button.mapboxgl-ctrl-compass .mapboxgl-ctrl-icon{background-image:url("data:image/svg+xml;charset=utf-8,%3Csvg width='29' height='29' viewBox='0 0 29 29' xmlns='http://www.w3.org/2000/svg' fill='%23333'%3E %3Cpath d='M10.5 14l4-8 4 8h-8z'/%3E %3Cpath id='south' d='M10.5 16l4 8 4-8h-8z' fill='%23ccc'/%3E %3C/svg%3E")}@media (-ms-high-contrast:active){.mapboxgl-ctrl button.mapboxgl-ctrl-compass .mapboxgl-ctrl-icon{background-image:url("data:image/svg+xml;charset=utf-8,%3Csvg width='29' height='29' viewBox='0 0 29 29' xmlns='http://www.w3.org/2000/svg' fill='%23fff'%3E %3Cpath d='M10.5 14l4-8 4 8h-8z'/%3E %3Cpath id='south' d='M10.5 16l4 8 4-8h-8z' fill='%23999'/%3E %3C/svg%3E")}}@media (-ms-high-contrast:black-on-white){.mapboxgl-ctrl button.mapboxgl-ctrl-compass .mapboxgl-ctrl-icon{background-image:url("data:image/svg+xml;charset=utf-8,%3Csvg width='29' height='29' viewBox='0 0 29 29' xmlns='http://www.w3.org/2000/svg' fill='%23000'%3E %3Cpath d='M10.5 14l4-8 4 8h-8z'/%3E %3Cpath id='south' d='M10.5 16l4 8 4-8h-8z' fill='%23ccc'/%3E %3C/svg%3E")}}.mapboxgl-ctrl button.mapboxgl-ctrl-geolocate .mapboxgl-ctrl-icon{background-image:url("data:image/svg+xml;charset=utf-8,%3Csvg width='29' height='29' viewBox='0 0 20 20' xmlns='http://www.w3.org/2000/svg' fill='%23333'%3E %3Cpath d='M10 4C9 4 9 5 9 5v.1A5 5 0 0 0 5.1 9H5s-1 0-1 1 1 1 1 1h.1A5 5 0 0 0 9 14.9v.1s0 1 1 1 1-1 1-1v-.1a5 5 0 0 0 3.9-3.9h.1s1 0 1-1-1-1-1-1h-.1A5 5 0 0 0 11 5.1V5s0-1-1-1zm0 2.5a3.5 3.5 0 1 1 0 7 3.5 3.5 0 1 1 0-7z'/%3E %3Ccircle id='dot' cx='10' cy='10' r='2'/%3E %3Cpath id='stroke' d='M14 5l1 1-9 9-1-1 9-9z' display='none'/%3E %3C/svg%3E")}.mapboxgl-ctrl button.mapboxgl-ctrl-geolocate:disabled .mapboxgl-ctrl-icon{background-image:url("data:image/svg+xml;charset=utf-8,%3Csvg width='29' height='29' viewBox='0 0 20 20' xmlns='http://www.w3.org/2000/svg' fill='%23aaa'%3E %3Cpath d='M10 4C9 4 9 5 9 5v.1A5 5 0 0 0 5.1 9H5s-1 0-1 1 1 1 1 1h.1A5 5 0 0 0 9 14.9v.1s0 1 1 1 1-1 1-1v-.1a5 5 0 0 0 3.9-3.9h.1s1 0 1-1-1-1-1-1h-.1A5 5 0 0 0 11 5.1V5s0-1-1-1zm0 2.5a3.5 3.5 0 1 1 0 7 3.5 3.5 0 1 1 0-7z'/%3E %3Ccircle id='dot' cx='10' cy='10' r='2'/%3E %3Cpath id='stroke' d='M14 5l1 1-9 9-1-1 9-9z' fill='red'/%3E %3C/svg%3E")}.mapboxgl-ctrl button.mapboxgl-ctrl-geolocate.mapboxgl-ctrl-geolocate-active .mapboxgl-ctrl-icon{background-image:url("data:image/svg+xml;charset=utf-8,%3Csvg width='29' height='29' viewBox='0 0 20 20' xmlns='http://www.w3.org/2000/svg' fill='%2333b5e5'%3E %3Cpath d='M10 4C9 4 9 5 9 5v.1A5 5 0 0 0 5.1 9H5s-1 0-1 1 1 1 1 1h.1A5 5 0 0 0 9 14.9v.1s0 1 1 1 1-1 1-1v-.1a5 5 0 0 0 3.9-3.9h.1s1 0 1-1-1-1-1-1h-.1A5 5 0 0 0 11 5.1V5s0-1-1-1zm0 2.5a3.5 3.5 0 1 1 0 7 3.5 3.5 0 1 1 0-7z'/%3E %3Ccircle id='dot' cx='10' cy='10' r='2'/%3E %3Cpath id='stroke' d='M14 5l1 1-9 9-1-1 9-9z' display='none'/%3E %3C/svg%3E")}.mapboxgl-ctrl button.mapboxgl-ctrl-geolocate.mapboxgl-ctrl-geolocate-active-error .mapboxgl-ctrl-icon{background-image:url("data:image/svg+xml;charset=utf-8,%3Csvg width='29' height='29' viewBox='0 0 20 20' xmlns='http://www.w3.org/2000/svg' fill='%23e58978'%3E %3Cpath d='M10 4C9 4 9 5 9 5v.1A5 5 0 0 0 5.1 9H5s-1 0-1 1 1 1 1 1h.1A5 5 0 0 0 9 14.9v.1s0 1 1 1 1-1 1-1v-.1a5 5 0 0 0 3.9-3.9h.1s1 0 1-1-1-1-1-1h-.1A5 5 0 0 0 11 5.1V5s0-1-1-1zm0 2.5a3.5 3.5 0 1 1 0 7 3.5 3.5 0 1 1 0-7z'/%3E %3Ccircle id='dot' cx='10' cy='10' r='2'/%3E %3Cpath id='stroke' d='M14 5l1 1-9 9-1-1 9-9z' display='none'/%3E %3C/svg%3E")}.mapboxgl-ctrl button.mapboxgl-ctrl-geolocate.mapboxgl-ctrl-geolocate-background .mapboxgl-ctrl-icon{background-image:url("data:image/svg+xml;charset=utf-8,%3Csvg width='29' height='29' viewBox='0 0 20 20' xmlns='http://www.w3.org/2000/svg' fill='%2333b5e5'%3E %3Cpath d='M10 4C9 4 9 5 9 5v.1A5 5 0 0 0 5.1 9H5s-1 0-1 1 1 1 1 1h.1A5 5 0 0 0 9 14.9v.1s0 1 1 1 1-1 1-1v-.1a5 5 0 0 0 3.9-3.9h.1s1 0 1-1-1-1-1-1h-.1A5 5 0 0 0 11 5.1V5s0-1-1-1zm0 2.5a3.5 3.5 0 1 1 0 7 3.5 3.5 0 1 1 0-7z'/%3E %3Ccircle id='dot' cx='10' cy='10' r='2' display='none'/%3E %3Cpath id='stroke' d='M14 5l1 1-9 9-1-1 9-9z' display='none'/%3E %3C/svg%3E")}.mapboxgl-ctrl button.mapboxgl-ctrl-geolocate.mapboxgl-ctrl-geolocate-background-error .mapboxgl-ctrl-icon{background-image:url("data:image/svg+xml;charset=utf-8,%3Csvg width='29' height='29' viewBox='0 0 20 20' xmlns='http://www.w3.org/2000/svg' fill='%23e54e33'%3E %3Cpath d='M10 4C9 4 9 5 9 5v.1A5 5 0 0 0 5.1 9H5s-1 0-1 1 1 1 1 1h.1A5 5 0 0 0 9 14.9v.1s0 1 1 1 1-1 1-1v-.1a5 5 0 0 0 3.9-3.9h.1s1 0 1-1-1-1-1-1h-.1A5 5 0 0 0 11 5.1V5s0-1-1-1zm0 2.5a3.5 3.5 0 1 1 0 7 3.5 3.5 0 1 1 0-7z'/%3E %3Ccircle id='dot' cx='10' cy='10' r='2' display='none'/%3E %3Cpath id='stroke' d='M14 5l1 1-9 9-1-1 9-9z' display='none'/%3E %3C/svg%3E")}.mapboxgl-ctrl button.mapboxgl-ctrl-geolocate.mapboxgl-ctrl-geolocate-waiting .mapboxgl-ctrl-icon{animation:mapboxgl-spin 2s linear infinite}@media (-ms-high-contrast:active){.mapboxgl-ctrl button.mapboxgl-ctrl-geolocate .mapboxgl-ctrl-icon{background-image:url("data:image/svg+xml;charset=utf-8,%3Csvg width='29' height='29' viewBox='0 0 20 20' xmlns='http://www.w3.org/2000/svg' fill='%23fff'%3E %3Cpath d='M10 4C9 4 9 5 9 5v.1A5 5 0 0 0 5.1 9H5s-1 0-1 1 1 1 1 1h.1A5 5 0 0 0 9 14.9v.1s0 1 1 1 1-1 1-1v-.1a5 5 0 0 0 3.9-3.9h.1s1 0 1-1-1-1-1-1h-.1A5 5 0 0 0 11 5.1V5s0-1-1-1zm0 2.5a3.5 3.5 0 1 1 0 7 3.5 3.5 0 1 1 0-7z'/%3E %3Ccircle id='dot' cx='10' cy='10' r='2'/%3E %3Cpath id='stroke' d='M14 5l1 1-9 9-1-1 9-9z' display='none'/%3E %3C/svg%3E")}.mapboxgl-ctrl button.mapboxgl-ctrl-geolocate:disabled .mapboxgl-ctrl-icon{background-image:url("data:image/svg+xml;charset=utf-8,%3Csvg width='29' height='29' viewBox='0 0 20 20' xmlns='http://www.w3.org/2000/svg' fill='%23999'%3E %3Cpath d='M10 4C9 4 9 5 9 5v.1A5 5 0 0 0 5.1 9H5s-1 0-1 1 1 1 1 1h.1A5 5 0 0 0 9 14.9v.1s0 1 1 1 1-1 1-1v-.1a5 5 0 0 0 3.9-3.9h.1s1 0 1-1-1-1-1-1h-.1A5 5 0 0 0 11 5.1V5s0-1-1-1zm0 2.5a3.5 3.5 0 1 1 0 7 3.5 3.5 0 1 1 0-7z'/%3E %3Ccircle id='dot' cx='10' cy='10' r='2'/%3E %3Cpath id='stroke' d='M14 5l1 1-9 9-1-1 9-9z' fill='red'/%3E %3C/svg%3E")}.mapboxgl-ctrl button.mapboxgl-ctrl-geolocate.mapboxgl-ctrl-geolocate-active .mapboxgl-ctrl-icon{background-image:url("data:image/svg+xml;charset=utf-8,%3Csvg width='29' height='29' viewBox='0 0 20 20' xmlns='http://www.w3.org/2000/svg' fill='%2333b5e5'%3E %3Cpath d='M10 4C9 4 9 5 9 5v.1A5 5 0 0 0 5.1 9H5s-1 0-1 1 1 1 1 1h.1A5 5 0 0 0 9 14.9v.1s0 1 1 1 1-1 1-1v-.1a5 5 0 0 0 3.9-3.9h.1s1 0 1-1-1-1-1-1h-.1A5 5 0 0 0 11 5.1V5s0-1-1-1zm0 2.5a3.5 3.5 0 1 1 0 7 3.5 3.5 0 1 1 0-7z'/%3E %3Ccircle id='dot' cx='10' cy='10' r='2'/%3E %3Cpath id='stroke' d='M14 5l1 1-9 9-1-1 9-9z' display='none'/%3E %3C/svg%3E")}.mapboxgl-ctrl button.mapboxgl-ctrl-geolocate.mapboxgl-ctrl-geolocate-active-error .mapboxgl-ctrl-icon{background-image:url("data:image/svg+xml;charset=utf-8,%3Csvg width='29' height='29' viewBox='0 0 20 20' xmlns='http://www.w3.org/2000/svg' fill='%23e58978'%3E %3Cpath d='M10 4C9 4 9 5 9 5v.1A5 5 0 0 0 5.1 9H5s-1 0-1 1 1 1 1 1h.1A5 5 0 0 0 9 14.9v.1s0 1 1 1 1-1 1-1v-.1a5 5 0 0 0 3.9-3.9h.1s1 0 1-1-1-1-1-1h-.1A5 5 0 0 0 11 5.1V5s0-1-1-1zm0 2.5a3.5 3.5 0 1 1 0 7 3.5 3.5 0 1 1 0-7z'/%3E %3Ccircle id='dot' cx='10' cy='10' r='2'/%3E %3Cpath id='stroke' d='M14 5l1 1-9 9-1-1 9-9z' display='none'/%3E %3C/svg%3E")}.mapboxgl-ctrl button.mapboxgl-ctrl-geolocate.mapboxgl-ctrl-geolocate-background .mapboxgl-ctrl-icon{background-image:url("data:image/svg+xml;charset=utf-8,%3Csvg width='29' height='29' viewBox='0 0 20 20' xmlns='http://www.w3.org/2000/svg' fill='%2333b5e5'%3E %3Cpath d='M10 4C9 4 9 5 9 5v.1A5 5 0 0 0 5.1 9H5s-1 0-1 1 1 1 1 1h.1A5 5 0 0 0 9 14.9v.1s0 1 1 1 1-1 1-1v-.1a5 5 0 0 0 3.9-3.9h.1s1 0 1-1-1-1-1-1h-.1A5 5 0 0 0 11 5.1V5s0-1-1-1zm0 2.5a3.5 3.5 0 1 1 0 7 3.5 3.5 0 1 1 0-7z'/%3E %3Ccircle id='dot' cx='10' cy='10' r='2' display='none'/%3E %3Cpath id='stroke' d='M14 5l1 1-9 9-1-1 9-9z' display='none'/%3E %3C/svg%3E")}.mapboxgl-ctrl button.mapboxgl-ctrl-geolocate.mapboxgl-ctrl-geolocate-background-error .mapboxgl-ctrl-icon{background-image:url("data:image/svg+xml;charset=utf-8,%3Csvg width='29' height='29' viewBox='0 0 20 20' xmlns='http://www.w3.org/2000/svg' fill='%23e54e33'%3E %3Cpath d='M10 4C9 4 9 5 9 5v.1A5 5 0 0 0 5.1 9H5s-1 0-1 1 1 1 1 1h.1A5 5 0 0 0 9 14.9v.1s0 1 1 1 1-1 1-1v-.1a5 5 0 0 0 3.9-3.9h.1s1 0 1-1-1-1-1-1h-.1A5 5 0 0 0 11 5.1V5s0-1-1-1zm0 2.5a3.5 3.5 0 1 1 0 7 3.5 3.5 0 1 1 0-7z'/%3E %3Ccircle id='dot' cx='10' cy='10' r='2' display='none'/%3E %3Cpath id='stroke' d='M14 5l1 1-9 9-1-1 9-9z' display='none'/%3E %3C/svg%3E")}}@media (-ms-high-contrast:black-on-white){.mapboxgl-ctrl button.mapboxgl-ctrl-geolocate .mapboxgl-ctrl-icon{background-image:url("data:image/svg+xml;charset=utf-8,%3Csvg width='29' height='29' viewBox='0 0 20 20' xmlns='http://www.w3.org/2000/svg' fill='%23000'%3E %3Cpath d='M10 4C9 4 9 5 9 5v.1A5 5 0 0 0 5.1 9H5s-1 0-1 1 1 1 1 1h.1A5 5 0 0 0 9 14.9v.1s0 1 1 1 1-1 1-1v-.1a5 5 0 0 0 3.9-3.9h.1s1 0 1-1-1-1-1-1h-.1A5 5 0 0 0 11 5.1V5s0-1-1-1zm0 2.5a3.5 3.5 0 1 1 0 7 3.5 3.5 0 1 1 0-7z'/%3E %3Ccircle id='dot' cx='10' cy='10' r='2'/%3E %3Cpath id='stroke' d='M14 5l1 1-9 9-1-1 9-9z' display='none'/%3E %3C/svg%3E")}.mapboxgl-ctrl button.mapboxgl-ctrl-geolocate:disabled .mapboxgl-ctrl-icon{background-image:url("data:image/svg+xml;charset=utf-8,%3Csvg width='29' height='29' viewBox='0 0 20 20' xmlns='http://www.w3.org/2000/svg' fill='%23666'%3E %3Cpath d='M10 4C9 4 9 5 9 5v.1A5 5 0 0 0 5.1 9H5s-1 0-1 1 1 1 1 1h.1A5 5 0 0 0 9 14.9v.1s0 1 1 1 1-1 1-1v-.1a5 5 0 0 0 3.9-3.9h.1s1 0 1-1-1-1-1-1h-.1A5 5 0 0 0 11 5.1V5s0-1-1-1zm0 2.5a3.5 3.5 0 1 1 0 7 3.5 3.5 0 1 1 0-7z'/%3E %3Ccircle id='dot' cx='10' cy='10' r='2'/%3E %3Cpath id='stroke' d='M14 5l1 1-9 9-1-1 9-9z' fill='red'/%3E %3C/svg%3E")}}@keyframes mapboxgl-spin{0%{transform:rotate(0deg)}to{transform:rotate(1turn)}}a.mapboxgl-ctrl-logo{width:88px;height:23px;margin:0 0 -4px -4px;display:block;background-repeat:no-repeat;cursor:pointer;overflow:hidden;background-image:url("data:image/svg+xml;charset=utf-8,%3Csvg width='88' height='23' viewBox='0 0 88 23' xmlns='http://www.w3.org/2000/svg' xmlns:xlink='http://www.w3.org/1999/xlink' fill-rule='evenodd'%3E %3Cdefs%3E %3Cpath id='logo' d='M11.5 2.25c5.105 0 9.25 4.145 9.25 9.25s-4.145 9.25-9.25 9.25-9.25-4.145-9.25-9.25 4.145-9.25 9.25-9.25zM6.997 15.983c-.051-.338-.828-5.802 2.233-8.873a4.395 4.395 0 013.13-1.28c1.27 0 2.49.51 3.39 1.42.91.9 1.42 2.12 1.42 3.39 0 1.18-.449 2.301-1.28 3.13C12.72 16.93 7 16 7 16l-.003-.017zM15.3 10.5l-2 .8-.8 2-.8-2-2-.8 2-.8.8-2 .8 2 2 .8z'/%3E %3Cpath id='text' d='M50.63 8c.13 0 .23.1.23.23V9c.7-.76 1.7-1.18 2.73-1.18 2.17 0 3.95 1.85 3.95 4.17s-1.77 4.19-3.94 4.19c-1.04 0-2.03-.43-2.74-1.18v3.77c0 .13-.1.23-.23.23h-1.4c-.13 0-.23-.1-.23-.23V8.23c0-.12.1-.23.23-.23h1.4zm-3.86.01c.01 0 .01 0 .01-.01.13 0 .22.1.22.22v7.55c0 .12-.1.23-.23.23h-1.4c-.13 0-.23-.1-.23-.23V15c-.7.76-1.69 1.19-2.73 1.19-2.17 0-3.94-1.87-3.94-4.19 0-2.32 1.77-4.19 3.94-4.19 1.03 0 2.02.43 2.73 1.18v-.75c0-.12.1-.23.23-.23h1.4zm26.375-.19a4.24 4.24 0 00-4.16 3.29c-.13.59-.13 1.19 0 1.77a4.233 4.233 0 004.17 3.3c2.35 0 4.26-1.87 4.26-4.19 0-2.32-1.9-4.17-4.27-4.17zM60.63 5c.13 0 .23.1.23.23v3.76c.7-.76 1.7-1.18 2.73-1.18 1.88 0 3.45 1.4 3.84 3.28.13.59.13 1.2 0 1.8-.39 1.88-1.96 3.29-3.84 3.29-1.03 0-2.02-.43-2.73-1.18v.77c0 .12-.1.23-.23.23h-1.4c-.13 0-.23-.1-.23-.23V5.23c0-.12.1-.23.23-.23h1.4zm-34 11h-1.4c-.13 0-.23-.11-.23-.23V8.22c.01-.13.1-.22.23-.22h1.4c.13 0 .22.11.23.22v.68c.5-.68 1.3-1.09 2.16-1.1h.03c1.09 0 2.09.6 2.6 1.55.45-.95 1.4-1.55 2.44-1.56 1.62 0 2.93 1.25 2.9 2.78l.03 5.2c0 .13-.1.23-.23.23h-1.41c-.13 0-.23-.11-.23-.23v-4.59c0-.98-.74-1.71-1.62-1.71-.8 0-1.46.7-1.59 1.62l.01 4.68c0 .13-.11.23-.23.23h-1.41c-.13 0-.23-.11-.23-.23v-4.59c0-.98-.74-1.71-1.62-1.71-.85 0-1.54.79-1.6 1.8v4.5c0 .13-.1.23-.23.23zm53.615 0h-1.61c-.04 0-.08-.01-.12-.03-.09-.06-.13-.19-.06-.28l2.43-3.71-2.39-3.65a.213.213 0 01-.03-.12c0-.12.09-.21.21-.21h1.61c.13 0 .24.06.3.17l1.41 2.37 1.4-2.37a.34.34 0 01.3-.17h1.6c.04 0 .08.01.12.03.09.06.13.19.06.28l-2.37 3.65 2.43 3.7c0 .05.01.09.01.13 0 .12-.09.21-.21.21h-1.61c-.13 0-.24-.06-.3-.17l-1.44-2.42-1.44 2.42a.34.34 0 01-.3.17zm-7.12-1.49c-1.33 0-2.42-1.12-2.42-2.51 0-1.39 1.08-2.52 2.42-2.52 1.33 0 2.42 1.12 2.42 2.51 0 1.39-1.08 2.51-2.42 2.52zm-19.865 0c-1.32 0-2.39-1.11-2.42-2.48v-.07c.02-1.38 1.09-2.49 2.4-2.49 1.32 0 2.41 1.12 2.41 2.51 0 1.39-1.07 2.52-2.39 2.53zm-8.11-2.48c-.01 1.37-1.09 2.47-2.41 2.47s-2.42-1.12-2.42-2.51c0-1.39 1.08-2.52 2.4-2.52 1.33 0 2.39 1.11 2.41 2.48l.02.08zm18.12 2.47c-1.32 0-2.39-1.11-2.41-2.48v-.06c.02-1.38 1.09-2.48 2.41-2.48s2.42 1.12 2.42 2.51c0 1.39-1.09 2.51-2.42 2.51z'/%3E %3C/defs%3E %3Cmask id='clip'%3E %3Crect x='0' y='0' width='100%25' height='100%25' fill='white'/%3E %3Cuse xlink:href='%23logo'/%3E %3Cuse xlink:href='%23text'/%3E %3C/mask%3E %3Cg id='outline' opacity='0.3' stroke='%23000' stroke-width='3'%3E %3Ccircle mask='url(%23clip)' cx='11.5' cy='11.5' r='9.25'/%3E %3Cuse xlink:href='%23text' mask='url(%23clip)'/%3E %3C/g%3E %3Cg id='fill' opacity='0.9' fill='%23fff'%3E %3Cuse xlink:href='%23logo'/%3E %3Cuse xlink:href='%23text'/%3E %3C/g%3E %3C/svg%3E")}a.mapboxgl-ctrl-logo.mapboxgl-compact{width:23px}@media (-ms-high-contrast:active){a.mapboxgl-ctrl-logo{background-color:transparent;background-image:url("data:image/svg+xml;charset=utf-8,%3Csvg width='88' height='23' viewBox='0 0 88 23' xmlns='http://www.w3.org/2000/svg' xmlns:xlink='http://www.w3.org/1999/xlink' fill-rule='evenodd'%3E %3Cdefs%3E %3Cpath id='logo' d='M11.5 2.25c5.105 0 9.25 4.145 9.25 9.25s-4.145 9.25-9.25 9.25-9.25-4.145-9.25-9.25 4.145-9.25 9.25-9.25zM6.997 15.983c-.051-.338-.828-5.802 2.233-8.873a4.395 4.395 0 013.13-1.28c1.27 0 2.49.51 3.39 1.42.91.9 1.42 2.12 1.42 3.39 0 1.18-.449 2.301-1.28 3.13C12.72 16.93 7 16 7 16l-.003-.017zM15.3 10.5l-2 .8-.8 2-.8-2-2-.8 2-.8.8-2 .8 2 2 .8z'/%3E %3Cpath id='text' d='M50.63 8c.13 0 .23.1.23.23V9c.7-.76 1.7-1.18 2.73-1.18 2.17 0 3.95 1.85 3.95 4.17s-1.77 4.19-3.94 4.19c-1.04 0-2.03-.43-2.74-1.18v3.77c0 .13-.1.23-.23.23h-1.4c-.13 0-.23-.1-.23-.23V8.23c0-.12.1-.23.23-.23h1.4zm-3.86.01c.01 0 .01 0 .01-.01.13 0 .22.1.22.22v7.55c0 .12-.1.23-.23.23h-1.4c-.13 0-.23-.1-.23-.23V15c-.7.76-1.69 1.19-2.73 1.19-2.17 0-3.94-1.87-3.94-4.19 0-2.32 1.77-4.19 3.94-4.19 1.03 0 2.02.43 2.73 1.18v-.75c0-.12.1-.23.23-.23h1.4zm26.375-.19a4.24 4.24 0 00-4.16 3.29c-.13.59-.13 1.19 0 1.77a4.233 4.233 0 004.17 3.3c2.35 0 4.26-1.87 4.26-4.19 0-2.32-1.9-4.17-4.27-4.17zM60.63 5c.13 0 .23.1.23.23v3.76c.7-.76 1.7-1.18 2.73-1.18 1.88 0 3.45 1.4 3.84 3.28.13.59.13 1.2 0 1.8-.39 1.88-1.96 3.29-3.84 3.29-1.03 0-2.02-.43-2.73-1.18v.77c0 .12-.1.23-.23.23h-1.4c-.13 0-.23-.1-.23-.23V5.23c0-.12.1-.23.23-.23h1.4zm-34 11h-1.4c-.13 0-.23-.11-.23-.23V8.22c.01-.13.1-.22.23-.22h1.4c.13 0 .22.11.23.22v.68c.5-.68 1.3-1.09 2.16-1.1h.03c1.09 0 2.09.6 2.6 1.55.45-.95 1.4-1.55 2.44-1.56 1.62 0 2.93 1.25 2.9 2.78l.03 5.2c0 .13-.1.23-.23.23h-1.41c-.13 0-.23-.11-.23-.23v-4.59c0-.98-.74-1.71-1.62-1.71-.8 0-1.46.7-1.59 1.62l.01 4.68c0 .13-.11.23-.23.23h-1.41c-.13 0-.23-.11-.23-.23v-4.59c0-.98-.74-1.71-1.62-1.71-.85 0-1.54.79-1.6 1.8v4.5c0 .13-.1.23-.23.23zm53.615 0h-1.61c-.04 0-.08-.01-.12-.03-.09-.06-.13-.19-.06-.28l2.43-3.71-2.39-3.65a.213.213 0 01-.03-.12c0-.12.09-.21.21-.21h1.61c.13 0 .24.06.3.17l1.41 2.37 1.4-2.37a.34.34 0 01.3-.17h1.6c.04 0 .08.01.12.03.09.06.13.19.06.28l-2.37 3.65 2.43 3.7c0 .05.01.09.01.13 0 .12-.09.21-.21.21h-1.61c-.13 0-.24-.06-.3-.17l-1.44-2.42-1.44 2.42a.34.34 0 01-.3.17zm-7.12-1.49c-1.33 0-2.42-1.12-2.42-2.51 0-1.39 1.08-2.52 2.42-2.52 1.33 0 2.42 1.12 2.42 2.51 0 1.39-1.08 2.51-2.42 2.52zm-19.865 0c-1.32 0-2.39-1.11-2.42-2.48v-.07c.02-1.38 1.09-2.49 2.4-2.49 1.32 0 2.41 1.12 2.41 2.51 0 1.39-1.07 2.52-2.39 2.53zm-8.11-2.48c-.01 1.37-1.09 2.47-2.41 2.47s-2.42-1.12-2.42-2.51c0-1.39 1.08-2.52 2.4-2.52 1.33 0 2.39 1.11 2.41 2.48l.02.08zm18.12 2.47c-1.32 0-2.39-1.11-2.41-2.48v-.06c.02-1.38 1.09-2.48 2.41-2.48s2.42 1.12 2.42 2.51c0 1.39-1.09 2.51-2.42 2.51z'/%3E %3C/defs%3E %3Cmask id='clip'%3E %3Crect x='0' y='0' width='100%25' height='100%25' fill='white'/%3E %3Cuse xlink:href='%23logo'/%3E %3Cuse xlink:href='%23text'/%3E %3C/mask%3E %3Cg id='outline' opacity='1' stroke='%23000' stroke-width='3'%3E %3Ccircle mask='url(%23clip)' cx='11.5' cy='11.5' r='9.25'/%3E %3Cuse xlink:href='%23text' mask='url(%23clip)'/%3E %3C/g%3E %3Cg id='fill' opacity='1' fill='%23fff'%3E %3Cuse xlink:href='%23logo'/%3E %3Cuse xlink:href='%23text'/%3E %3C/g%3E %3C/svg%3E")}}@media (-ms-high-contrast:black-on-white){a.mapboxgl-ctrl-logo{background-image:url("data:image/svg+xml;charset=utf-8,%3Csvg width='88' height='23' viewBox='0 0 88 23' xmlns='http://www.w3.org/2000/svg' xmlns:xlink='http://www.w3.org/1999/xlink' fill-rule='evenodd'%3E %3Cdefs%3E %3Cpath id='logo' d='M11.5 2.25c5.105 0 9.25 4.145 9.25 9.25s-4.145 9.25-9.25 9.25-9.25-4.145-9.25-9.25 4.145-9.25 9.25-9.25zM6.997 15.983c-.051-.338-.828-5.802 2.233-8.873a4.395 4.395 0 013.13-1.28c1.27 0 2.49.51 3.39 1.42.91.9 1.42 2.12 1.42 3.39 0 1.18-.449 2.301-1.28 3.13C12.72 16.93 7 16 7 16l-.003-.017zM15.3 10.5l-2 .8-.8 2-.8-2-2-.8 2-.8.8-2 .8 2 2 .8z'/%3E %3Cpath id='text' d='M50.63 8c.13 0 .23.1.23.23V9c.7-.76 1.7-1.18 2.73-1.18 2.17 0 3.95 1.85 3.95 4.17s-1.77 4.19-3.94 4.19c-1.04 0-2.03-.43-2.74-1.18v3.77c0 .13-.1.23-.23.23h-1.4c-.13 0-.23-.1-.23-.23V8.23c0-.12.1-.23.23-.23h1.4zm-3.86.01c.01 0 .01 0 .01-.01.13 0 .22.1.22.22v7.55c0 .12-.1.23-.23.23h-1.4c-.13 0-.23-.1-.23-.23V15c-.7.76-1.69 1.19-2.73 1.19-2.17 0-3.94-1.87-3.94-4.19 0-2.32 1.77-4.19 3.94-4.19 1.03 0 2.02.43 2.73 1.18v-.75c0-.12.1-.23.23-.23h1.4zm26.375-.19a4.24 4.24 0 00-4.16 3.29c-.13.59-.13 1.19 0 1.77a4.233 4.233 0 004.17 3.3c2.35 0 4.26-1.87 4.26-4.19 0-2.32-1.9-4.17-4.27-4.17zM60.63 5c.13 0 .23.1.23.23v3.76c.7-.76 1.7-1.18 2.73-1.18 1.88 0 3.45 1.4 3.84 3.28.13.59.13 1.2 0 1.8-.39 1.88-1.96 3.29-3.84 3.29-1.03 0-2.02-.43-2.73-1.18v.77c0 .12-.1.23-.23.23h-1.4c-.13 0-.23-.1-.23-.23V5.23c0-.12.1-.23.23-.23h1.4zm-34 11h-1.4c-.13 0-.23-.11-.23-.23V8.22c.01-.13.1-.22.23-.22h1.4c.13 0 .22.11.23.22v.68c.5-.68 1.3-1.09 2.16-1.1h.03c1.09 0 2.09.6 2.6 1.55.45-.95 1.4-1.55 2.44-1.56 1.62 0 2.93 1.25 2.9 2.78l.03 5.2c0 .13-.1.23-.23.23h-1.41c-.13 0-.23-.11-.23-.23v-4.59c0-.98-.74-1.71-1.62-1.71-.8 0-1.46.7-1.59 1.62l.01 4.68c0 .13-.11.23-.23.23h-1.41c-.13 0-.23-.11-.23-.23v-4.59c0-.98-.74-1.71-1.62-1.71-.85 0-1.54.79-1.6 1.8v4.5c0 .13-.1.23-.23.23zm53.615 0h-1.61c-.04 0-.08-.01-.12-.03-.09-.06-.13-.19-.06-.28l2.43-3.71-2.39-3.65a.213.213 0 01-.03-.12c0-.12.09-.21.21-.21h1.61c.13 0 .24.06.3.17l1.41 2.37 1.4-2.37a.34.34 0 01.3-.17h1.6c.04 0 .08.01.12.03.09.06.13.19.06.28l-2.37 3.65 2.43 3.7c0 .05.01.09.01.13 0 .12-.09.21-.21.21h-1.61c-.13 0-.24-.06-.3-.17l-1.44-2.42-1.44 2.42a.34.34 0 01-.3.17zm-7.12-1.49c-1.33 0-2.42-1.12-2.42-2.51 0-1.39 1.08-2.52 2.42-2.52 1.33 0 2.42 1.12 2.42 2.51 0 1.39-1.08 2.51-2.42 2.52zm-19.865 0c-1.32 0-2.39-1.11-2.42-2.48v-.07c.02-1.38 1.09-2.49 2.4-2.49 1.32 0 2.41 1.12 2.41 2.51 0 1.39-1.07 2.52-2.39 2.53zm-8.11-2.48c-.01 1.37-1.09 2.47-2.41 2.47s-2.42-1.12-2.42-2.51c0-1.39 1.08-2.52 2.4-2.52 1.33 0 2.39 1.11 2.41 2.48l.02.08zm18.12 2.47c-1.32 0-2.39-1.11-2.41-2.48v-.06c.02-1.38 1.09-2.48 2.41-2.48s2.42 1.12 2.42 2.51c0 1.39-1.09 2.51-2.42 2.51z'/%3E %3C/defs%3E %3Cmask id='clip'%3E %3Crect x='0' y='0' width='100%25' height='100%25' fill='white'/%3E %3Cuse xlink:href='%23logo'/%3E %3Cuse xlink:href='%23text'/%3E %3C/mask%3E %3Cg id='outline' opacity='1' stroke='%23fff' stroke-width='3' fill='%23fff'%3E %3Ccircle mask='url(%23clip)' cx='11.5' cy='11.5' r='9.25'/%3E %3Cuse xlink:href='%23text' mask='url(%23clip)'/%3E %3C/g%3E %3Cg id='fill' opacity='1' fill='%23000'%3E %3Cuse xlink:href='%23logo'/%3E %3Cuse xlink:href='%23text'/%3E %3C/g%3E %3C/svg%3E")}}.mapboxgl-ctrl.mapboxgl-ctrl-attrib{padding:0 5px;background-color:rgb(255 255 255/50%);margin:0}@media screen{.mapboxgl-ctrl-attrib.mapboxgl-compact{min-height:20px;padding:2px 24px 2px 0;margin:10px;position:relative;background-color:#fff;border-radius:12px}.mapboxgl-ctrl-attrib.mapboxgl-compact-show{padding:2px 28px 2px 8px;visibility:visible}.mapboxgl-ctrl-bottom-left>.mapboxgl-ctrl-attrib.mapboxgl-compact-show,.mapboxgl-ctrl-top-left>.mapboxgl-ctrl-attrib.mapboxgl-compact-show{padding:2px 8px 2px 28px;border-radius:12px}.mapboxgl-ctrl-attrib.mapboxgl-compact .mapboxgl-ctrl-attrib-inner{display:none}.mapboxgl-ctrl-attrib-button{display:none;cursor:pointer;position:absolute;background-image:url("data:image/svg+xml;charset=utf-8,%3Csvg width='24' height='24' viewBox='0 0 20 20' xmlns='http://www.w3.org/2000/svg' fill-rule='evenodd'%3E %3Cpath d='M4 10a6 6 0 1 0 12 0 6 6 0 1 0-12 0m5-3a1 1 0 1 0 2 0 1 1 0 1 0-2 0m0 3a1 1 0 1 1 2 0v3a1 1 0 1 1-2 0'/%3E %3C/svg%3E");background-color:rgb(255 255 255/50%);width:24px;height:24px;box-sizing:border-box;border-radius:12px;outline:none;top:0;right:0;border:0}.mapboxgl-ctrl-bottom-left .mapboxgl-ctrl-attrib-button,.mapboxgl-ctrl-top-left .mapboxgl-ctrl-attrib-button{left:0}.mapboxgl-ctrl-attrib.mapboxgl-compact-show .mapboxgl-ctrl-attrib-inner,.mapboxgl-ctrl-attrib.mapboxgl-compact .mapboxgl-ctrl-attrib-button{display:block}.mapboxgl-ctrl-attrib.mapboxgl-compact-show .mapboxgl-ctrl-attrib-button{background-color:rgb(0 0 0/5%)}.mapboxgl-ctrl-bottom-right>.mapboxgl-ctrl-attrib.mapboxgl-compact:after{bottom:0;right:0}.mapboxgl-ctrl-top-right>.mapboxgl-ctrl-attrib.mapboxgl-compact:after{top:0;right:0}.mapboxgl-ctrl-top-left>.mapboxgl-ctrl-attrib.mapboxgl-compact:after{top:0;left:0}.mapboxgl-ctrl-bottom-left>.mapboxgl-ctrl-attrib.mapboxgl-compact:after{bottom:0;left:0}}@media screen and (-ms-high-contrast:active){.mapboxgl-ctrl-attrib.mapboxgl-compact:after{background-image:url("data:image/svg+xml;charset=utf-8,%3Csvg width='24' height='24' viewBox='0 0 20 20' xmlns='http://www.w3.org/2000/svg' fill-rule='evenodd' fill='%23fff'%3E %3Cpath d='M4 10a6 6 0 1 0 12 0 6 6 0 1 0-12 0m5-3a1 1 0 1 0 2 0 1 1 0 1 0-2 0m0 3a1 1 0 1 1 2 0v3a1 1 0 1 1-2 0'/%3E %3C/svg%3E")}}@media screen and (-ms-high-contrast:black-on-white){.mapboxgl-ctrl-attrib.mapboxgl-compact:after{background-image:url("data:image/svg+xml;charset=utf-8,%3Csvg width='24' height='24' viewBox='0 0 20 20' xmlns='http://www.w3.org/2000/svg' fill-rule='evenodd'%3E %3Cpath d='M4 10a6 6 0 1 0 12 0 6 6 0 1 0-12 0m5-3a1 1 0 1 0 2 0 1 1 0 1 0-2 0m0 3a1 1 0 1 1 2 0v3a1 1 0 1 1-2 0'/%3E %3C/svg%3E")}}.mapboxgl-ctrl-attrib a{color:rgb(0 0 0/75%);text-decoration:none}.mapboxgl-ctrl-attrib a:hover{color:inherit;text-decoration:underline}.mapboxgl-ctrl-attrib .mapbox-improve-map{font-weight:700;margin-left:2px}.mapboxgl-attrib-empty{display:none}.mapboxgl-ctrl-scale{background-color:rgb(255 255 255/75%);font-size:10px;border:2px solid #333;border-top:#333;padding:0 5px;color:#333;box-sizing:border-box;white-space:nowrap}.mapboxgl-popup{position:absolute;top:0;left:0;display:flex;will-change:transform;pointer-events:none}.mapboxgl-popup-anchor-top,.mapboxgl-popup-anchor-top-left,.mapboxgl-popup-anchor-top-right{flex-direction:column}.mapboxgl-popup-anchor-bottom,.mapboxgl-popup-anchor-bottom-left,.mapboxgl-popup-anchor-bottom-right{flex-direction:column-reverse}.mapboxgl-popup-anchor-left{flex-direction:row}.mapboxgl-popup-anchor-right{flex-direction:row-reverse}.mapboxgl-popup-tip{width:0;height:0;border:10px solid transparent;z-index:1}.mapboxgl-popup-anchor-top .mapboxgl-popup-tip{align-self:center;border-top:none;border-bottom-color:#fff}.mapboxgl-popup-anchor-top-left .mapboxgl-popup-tip{align-self:flex-start;border-top:none;border-left:none;border-bottom-color:#fff}.mapboxgl-popup-anchor-top-right .mapboxgl-popup-tip{align-self:flex-end;border-top:none;border-right:none;border-bottom-color:#fff}.mapboxgl-popup-anchor-bottom .mapboxgl-popup-tip{align-self:center;border-bottom:none;border-top-color:#fff}.mapboxgl-popup-anchor-bottom-left .mapboxgl-popup-tip{align-self:flex-start;border-bottom:none;border-left:none;border-top-color:#fff}.mapboxgl-popup-anchor-bottom-right .mapboxgl-popup-tip{align-self:flex-end;border-bottom:none;border-right:none;border-top-color:#fff}.mapboxgl-popup-anchor-left .mapboxgl-popup-tip{align-self:center;border-left:none;border-right-color:#fff}.mapboxgl-popup-anchor-right .mapboxgl-popup-tip{align-self:center;border-right:none;border-left-color:#fff}.mapboxgl-popup-close-button{position:absolute;right:0;top:0;border:0;border-radius:0 3px 0 0;cursor:pointer;background-color:transparent}.mapboxgl-popup-close-button:hover{background-color:rgb(0 0 0/5%)}.mapboxgl-popup-content{position:relative;background:#fff;border-radius:3px;box-shadow:0 1px 2px rgb(0 0 0/10%);padding:10px 10px 15px;pointer-events:auto}.mapboxgl-popup-anchor-top-left .mapboxgl-popup-content{border-top-left-radius:0}.mapboxgl-popup-anchor-top-right .mapboxgl-popup-content{border-top-right-radius:0}.mapboxgl-popup-anchor-bottom-left .mapboxgl-popup-content{border-bottom-left-radius:0}.mapboxgl-popup-anchor-bottom-right .mapboxgl-popup-content{border-bottom-right-radius:0}.mapboxgl-popup-track-pointer{display:none}.mapboxgl-popup-track-pointer *{pointer-events:none;user-select:none}.mapboxgl-map:hover .mapboxgl-popup-track-pointer{display:flex}.mapboxgl-map:active .mapboxgl-popup-track-pointer{display:none}.mapboxgl-marker{position:absolute;top:0;left:0;will-change:transform;opacity:1;transition:opacity .2s}.mapboxgl-user-location-dot,.mapboxgl-user-location-dot:before{background-color:#1da1f2;width:15px;height:15px;border-radius:50%}.mapboxgl-user-location-dot:before{content:"";position:absolute;animation:mapboxgl-user-location-dot-pulse 2s infinite}.mapboxgl-user-location-dot:after{border-radius:50%;border:2px solid #fff;content:"";height:19px;left:-2px;position:absolute;top:-2px;width:19px;box-sizing:border-box;box-shadow:0 0 3px rgb(0 0 0/35%)}.mapboxgl-user-location-show-heading .mapboxgl-user-location-heading{width:0;height:0}.mapboxgl-user-location-show-heading .mapboxgl-user-location-heading:after,.mapboxgl-user-location-show-heading .mapboxgl-user-location-heading:before{content:"";border-bottom:7.5px solid #4aa1eb;position:absolute}.mapboxgl-user-location-show-heading .mapboxgl-user-location-heading:before{border-left:7.5px solid transparent;transform:translateY(-28px) skewY(-20deg)}.mapboxgl-user-location-show-heading .mapboxgl-user-location-heading:after{border-right:7.5px solid transparent;transform:translate(7.5px,-28px) skewY(20deg)}@keyframes mapboxgl-user-location-dot-pulse{0%{transform:scale(1);opacity:1}70%{transform:scale(3);opacity:0}to{transform:scale(1);opacity:0}}.mapboxgl-user-location-dot-stale{background-color:#aaa}.mapboxgl-user-location-dot-stale:after{display:none}.mapboxgl-user-location-accuracy-circle{background-color:rgba(29,161,242,.2);width:1px;height:1px;border-radius:100%}.mapboxgl-crosshair,.mapboxgl-crosshair .mapboxgl-interactive,.mapboxgl-crosshair .mapboxgl-interactive:active{cursor:crosshair}.mapboxgl-boxzoom{position:absolute;top:0;left:0;width:0;height:0;background:#fff;border:2px dotted #202020;opacity:.5}@media print{.mapbox-improve-map{display:none}}.mapboxgl-scroll-zoom-blocker,.mapboxgl-touch-pan-blocker{color:#fff;font-family:-apple-system,BlinkMacSystemFont,Segoe UI,Helvetica,Arial,sans-serif;justify-content:center;text-align:center;position:absolute;display:flex;align-items:center;top:0;left:0;width:100%;height:100%;background:rgb(0 0 0/70%);opacity:0;pointer-events:none;transition:opacity .75s ease-in-out;transition-delay:1s}.mapboxgl-scroll-zoom-blocker-show,.mapboxgl-touch-pan-blocker-show{opacity:1;transition:opacity .1s ease-in-out}.mapboxgl-canvas-container.mapboxgl-touch-pan-blocker-override.mapboxgl-scrollable-page,.mapboxgl-canvas-container.mapboxgl-touch-pan-blocker-override.mapboxgl-scrollable-page .mapboxgl-canvas{touch-action:pan-x pan-y}
        </style>
         <div class="bot-container">
            <div class="bot-suport">
                <div class="bot-header">
                    <div class="bot-header-image">
                        ${this.brandAvatar!="default"?`<img src="${this.brandAvatar}"/>`:this.brandIcon}
                    </div>
                    <div class="bot-header-content">
                        <h1>${this.brand}</h1>
                        ${this.isMobile()===!1?`<p>${this.slogan}</p>`:""}
                        
                    </div>
                </div>
                <div class="bot-messages">
                </div>
                <form class="bot-footer">
                    <input type="text" placeholder="${this.lan.substring(0,2)in ep?ep[this.lan.substring(0,2)]:ep.en}"/>
                    <span>&#128512</span>
                    <button>${this.sendIcon}</button>
                </form>
            </div>
            <div class="pickerContainer"></div>
            <div class="bot-button">
                <button>${this.icons.isNotClicked}</button>
            </div>
        </div>
        `,this.botSuport=u.querySelector(".bot-suport"),this.botHeader=u.querySelector(".bot-header"),this.botMesagges=u.querySelector(".bot-messages"),this.botFooter=u.querySelector(".bot-footer"),this.bootImput=u.querySelector("form.bot-footer input"),this.emojiButton=u.querySelector("form.bot-footer span"),this.botButton=u.querySelector(".bot-button");let C=this.botSuport.offsetHeight-this.botHeader.offsetHeight-this.botFooter.offsetHeight;this.botMesagges.style.height=C.toString()+"px",this.isOpen=="open"&&(this.botSuport.classList.add("bot-open"),this.botButton.children[0].innerHTML=this.icons.isClicked,this.open=!0,this.onLine===!1&&this.openSocket()),this.botFooter.addEventListener("submit",B=>{B.preventDefault();let H=this.bootImput.value;H&&(this.socket.emit("user_uttered",{session_id:this.uuid,message:H}),this.bootImput.value="",this.appendMessage(H,this.botMesagges))});var o={showPreview:!1,showRecents:!1,showSearch:!1,showVariants:!1,showCategoryTabs:!1,categories:["smileys-emotion"]};switch(this.lan.substring(0,2)){case"es":o.i18n=Dy;break;case"fr":o.i18n=Ly;case"pt":o.i18n=By;case"de":o.i18n=Ry}this.emoji=="complete"&&(delete o.showSearch,delete o.showVariants,delete o.showCategoryTabs,delete o.categories);let z=Py(o,{referenceElement:this.emojiButton,triggerElement:this.emojiButton});this.emojiButton.addEventListener("click",B=>{B.stopPropagation(),z.toggle()}),z.addEventListener("emoji:select",B=>{this.bootImput.value=this.bootImput.value.concat(B.emoji)}),this.botButton.addEventListener("click",B=>this.toogleOpen(B)),this.open=this.open}disconnectedCallback(){this.botFooter.removeEventListener("submit")}};document.addEventListener("DOMContentLoaded",()=>{window.customElements.define("ai-widget",tp);let c=document.querySelector(".ai-widget"),u=document.createElement("ai-widget");for(let[g,v]of Object.entries(u.defaults))c.dataset[g]!=null?u.setAttribute(g,c.dataset[g]):u.setAttribute(g,v);c.append(u)});})();
/*!
 * ai-widget v1.0.0
 * (c) 2022 Antonio Fregoso - https://www.antoniofregoso.com/
 * Released under License AGPL-3.0 or later (http://www.gnu.org/licenses/agpl).
 */
